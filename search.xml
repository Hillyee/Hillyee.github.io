<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Promiseé¢è¯•é¢˜(æŒç»­æ›´æ–°~)</title>
      <link href="/2022/04/22/Promise%E9%9D%A2%E8%AF%95%E9%A2%98-%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/"/>
      <url>/2022/04/22/Promise%E9%9D%A2%E8%AF%95%E9%A2%98-%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="Promiseé¢è¯•é¢˜">Promiseé¢è¯•é¢˜</h2><h3 id="å‡ é“æ‰“å°çš„åŸºç¡€é¢˜">å‡ é“æ‰“å°çš„åŸºç¡€é¢˜</h3><h4 id="é¢˜1">é¢˜1</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br></pre></td></tr></table></figure><blockquote><p>1 2 4 3</p></blockquote><h4 id="é¢˜2">é¢˜2</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>, promise1)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>, promise2)</span><br></pre></td></tr></table></figure><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/751fd1862f5d45da84fd5c78be97f7b6~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h4 id="é¢˜3">é¢˜3</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; (<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><blockquote><p>1<br>2<br>success</p></blockquote><h4 id="é¢˜4">é¢˜4</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; (<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>2<br>1<br>success</p></blockquote><h3 id="Promiseç»“åˆsetTimeout">Promiseç»“åˆsetTimeout</h3><h4 id="é¢˜1-2">é¢˜1</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>) </span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br></pre></td></tr></table></figure><blockquote><p>1432</p></blockquote><h4 id="é¢˜2-2">é¢˜2</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">&#125;)</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><blockquote><p>14523success</p></blockquote><h4 id="é¢˜3-2">é¢˜3</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> timer1 = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timer2 = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;5&#x27;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>51342</p></blockquote><h4 id="é¢˜4-2">é¢˜4</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error message&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>, promise1)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>, promise2)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>, promise1)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>, promise2)</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88748175c2814348aa8e523c251bbee9~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> ğŸ˜£é¢è¯•é¢˜-jsç¯‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> promise </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹å†™promise</title>
      <link href="/2022/04/17/%E6%89%8B%E5%86%99promise/"/>
      <url>/2022/04/17/%E6%89%8B%E5%86%99promise/</url>
      
        <content type="html"><![CDATA[<h2 id="æ‰‹å†™Promise">æ‰‹å†™Promise</h2><h3 id="Promiseè§„èŒƒ">Promiseè§„èŒƒ</h3><blockquote><p><a href="https://promisesaplus.com/">https://promisesaplus.com/</a>  PromiseA+è§„èŒƒ</p><p>A+è§„èŒƒåªæœ‰thenæ–¹æ³•</p></blockquote><h3 id="Promise-ç±»è®¾è®¡">Promise ç±»è®¾è®¡</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyPromise</span> &#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">MyPromise</span>(<span class="params"></span>) &#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸¤ç§æ–¹å¼ï¼Œæˆ‘é€‰ç¬¬ä¸€ç§</p></blockquote><h3 id="æ„é€ å‡½æ•°constructorè®¾è®¡">æ„é€ å‡½æ•°constructorè®¾è®¡</h3><p>å®ç°ï¼š</p><ol><li>è®©executorå‡½æ•°æ‰§è¡Œèµ·æ¥</li><li>å®šä¹‰çŠ¶æ€å¸¸é‡</li><li>å®šä¹‰resolveï¼Œrejectå›è°ƒï¼Œæ‰§è¡Œçš„æ—¶å€™æ”¹å˜çŠ¶æ€</li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">STATUE_PENDING</span> = <span class="string">&#x27;pending&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STATUE_FULFILLED</span> = <span class="string">&#x27;fulfilled&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STATUS_REJECTED</span> = <span class="string">&#x27;rejected&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPromise</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">executor</span>) &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜çŠ¶æ€ä¸å€¼</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUE_PENDING</span>  </span><br><span class="line">    <span class="comment">// ç”±äºåé¢çš„thenæ–¹æ³•å¯èƒ½ä¼šç”¨åˆ°è¿™äº›å‚æ•°å€¼ï¼Œéœ€è¦ä¿å­˜èµ·æ¥</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰resolveå›è°ƒ</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">// æ”¹å˜çŠ¶æ€å¹¶ä¿å­˜å€¼</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUE_FULFILLED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resolveæ‰§è¡Œ&quot;</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å®šä¹‰rejectå›è°ƒ</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">// æ”¹å˜çŠ¶æ€å¹¶ä¿å­˜å€¼</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUS_REJECTED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">reason</span> = reason</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;rejectæ‰§è¡Œ&quot;</span>, reason);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">executor</span>(resolve, reject)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pending~&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;111&quot;</span>)</span><br><span class="line">  <span class="title function_">reject</span>(<span class="string">&quot;222&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="4"><li>ä¸ºäº†ä¸è®©resolveï¼Œrejectå›è°ƒå¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ªåˆ¤æ–­ï¼Œåªæœ‰çŠ¶æ€ä¸ºpendingçš„æ—¶å€™æ‰æ‰§è¡Œå›è°ƒ</li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;  <span class="comment">// åŠ ä¸€ä¸ªåˆ¤æ–­</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUE_FULFILLED</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resolveæ‰§è¡Œ&quot;</span>, value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123; <span class="comment">// åŠ ä¸€ä¸ªåˆ¤æ–­</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUS_REJECTED</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reason</span> = reason</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;rejectæ‰§è¡Œ&quot;</span>, reason);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="then-æ–¹æ³•çš„å®ç°">then æ–¹æ³•çš„å®ç°</h3><h4 id="ç®€å•å®ç°">ç®€å•å®ç°</h4><ol><li>thenæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯æˆåŠŸæ—¶çš„å›è°ƒonFulfilledï¼Œå¤±è´¥æ—¶çš„å›è°ƒonRejected</li><li>æŠŠå›è°ƒä¿å­˜åˆ°å½“å‰çš„promiseå®ä¾‹ï¼Œå¹¶åœ¨å¯¹åº”çš„resolveï¼Œrejectå›è°ƒæ—¶æ‰§è¡Œ</li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyPromise</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">executor</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUE_PENDING</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUE_FULFILLED</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resolveæ‰§è¡Œ&quot;</span>, value);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>) <span class="comment">// åœ¨è¿™é‡Œæ‰§è¡Œ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUS_REJECTED</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reason</span> = reason</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;rejectæ‰§è¡Œ&quot;</span>, reason);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)  <span class="comment">// åœ¨è¿™é‡Œæ‰§è¡Œ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">executor</span>(resolve, reject)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onFulfilled</span> = onFulfilled  <span class="comment">// ä¿å­˜æ–¹æ³•</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onRejected</span> = onRejected <span class="comment">// ä¿å­˜æ–¹æ³•</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pending~&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;111&quot;</span>)</span><br><span class="line">  <span class="title function_">reject</span>(<span class="string">&quot;222&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res: &quot;</span>, res);</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err: &quot;</span>, err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™æˆ‘ä»¬ä¼šå‘ç°ï¼ŒæŠ¥é”™äº†ï¼šthis.onFulfilled is not a function</p><p>ä¸ºä»€ä¹ˆï¼Ÿï¼Ÿ</p><p>æˆ‘ä»¬æ‹ä¸€æ‹ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹å°±å¯ä»¥å‘ç°ï¼Œå½“æ‰§è¡Œ<code>resolve(&quot;111&quot;)</code> çš„æ—¶å€™ï¼Œéƒ½è¿˜æ²¡æœ‰åˆ°thené‚£ä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜æ²¡æ‰§è¡Œthenæ–¹æ³•ï¼Œé‚£ä¹ˆæ€ä¹ˆå¯èƒ½ä¼šæœ‰ <code>onFulfilled, onRejected</code> æ–¹æ³•å‘¢ï¼</p><p>è¿™æ—¶å€™æˆ‘ä»¬å°±ç”¨åˆ°äº†ä¸€ä¸ªæ–¹æ³•ï¼š<code>queueMicrotask()</code></p><blockquote><p>MDNï¼š<a href="https://developer.mozilla.org/en-US/docs/Web/API/queueMicrotask">https://developer.mozilla.org/en-US/docs/Web/API/queueMicrotask</a></p><p>ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥æŠŠæˆ‘ä»¬ä¼ å…¥çš„æ–¹æ³•åŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œè®©å®ƒå»¶è¿Ÿåˆ°å½“å‰ä¸»çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åå†æ‰§è¡Œ</p></blockquote><p>æ‰€ä»¥å¯ä»¥åœ¨resolveæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œå…ˆä¸æ‰§è¡ŒonFulfilledï¼ŒæŠŠå®ƒåŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ¥ç€å°±ä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„thenæ–¹æ³•ï¼Œè¿™æ—¶å€™å°±æœ‰<code>onFulfilled, onRejected</code> æ–¹æ³•äº†ï¼Œæœ€åä¸»çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå†æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ onFulfilledï¼Œï¼Œï¼ˆrejectåŒç†ï¼‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">    <span class="title function_">queueMicrotask</span>(<span class="function">() =&gt;</span> &#123;   <span class="comment">// åŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUE_FULFILLED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">    <span class="title function_">queueMicrotask</span>(<span class="function">() =&gt;</span> &#123;  <span class="comment">// åŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUS_REJECTED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">reason</span> = reason</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™åˆå‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œresolveå’Œrejectå¯ä»¥åŒæ—¶è°ƒç”¨äº†</p><p>å› ä¸ºæˆ‘ä»¬æ‰§è¡Œresolveçš„å®ç°ï¼ŒåŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå› æ­¤çŠ¶æ€æ²¡æœ‰è¢«æ”¹å˜ï¼Œä¾ç„¶æ˜¯pending</p><p>æ¥ç€æ‰§è¡Œrejectï¼Œåˆ¤æ–­çŠ¶æ€æ˜¯pendingï¼Œæ‰€ä»¥ä¹ŸåŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—äº†</p><p>è§£å†³ï¼šåœ¨æ‰§è¡Œå¾®ä»»åŠ¡çš„ä»£ç ä¸€å¼€å§‹åŠ å…¥ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœçŠ¶æ€å·²ç»ä¸æ˜¯pendingäº†ï¼Œç›´æ¥returnå‡ºå»ï¼Œåœæ­¢æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">    <span class="title function_">queueMicrotask</span>(<span class="function">() =&gt;</span> &#123;  </span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> !== <span class="variable constant_">STATUE_PENDING</span>) <span class="keyword">return</span>  <span class="comment">// æ·»åŠ åˆ¤æ–­</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUE_FULFILLED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">    <span class="title function_">queueMicrotask</span>(<span class="function">() =&gt;</span> &#123;  </span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> !== <span class="variable constant_">STATUE_PENDING</span>) <span class="keyword">return</span> <span class="comment">// æ·»åŠ åˆ¤æ–­</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUS_REJECTED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">reason</span> = reason</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å½“ç„¶ï¼Œæœ‰äººå¯èƒ½ä¼šè¯´æŠŠçŠ¶æ€æ”¹å˜æ”¾åˆ°å¾®ä»»åŠ¡å¤–é¢ä¸å°±è¡Œäº†å—ï¼Ÿ</p><p>ä¸è¡Œï¼ï¼è¿™æ ·åœ¨åé¢å®ç°é“¾å¼è°ƒç”¨ä¼šå‡ºç°é—®é¢˜</p><p>ä½ åé¢å¯ä»¥è¯•ä¸€ä¸‹ï¼Œå¤šä¸ªthenæ‰§è¡Œå’Œé“¾å¼è°ƒç”¨ä¸€èµ·çš„æ—¶å€™ï¼Œæ‰§è¡Œé¡ºåºæ˜¯æœ‰é—®é¢˜çš„</p><p>è‡³äºä¸ºä»€ä¹ˆï¼Œé‚£å°±è‡ªå·±æ‹ä¸€æ‹æ•´ä¸ªä»£ç çš„æ‰§è¡Œé¡ºåºå­</p></blockquote><h4 id="åŒæ—¶è°ƒç”¨å¤šä¸ªthençš„å®ç°">åŒæ—¶è°ƒç”¨å¤šä¸ªthençš„å®ç°</h4><p>ä¸Šé¢çš„å®ç°æ˜¯ä¸èƒ½åŒæ—¶è°ƒç”¨å¤šä¸ªthençš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res: &quot;</span>, res);</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err: &quot;</span>, err);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res2: &quot;</span>, res);</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err2: &quot;</span>, err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åé¢çš„thenä¼šè¦†ç›–å‰é¢çš„ï¼Œå› æ­¤åªä¼šæ‰§è¡Œ res2 æˆ–è€… err2</p><p>å®ç°æ€è·¯ï¼šæˆ‘ä»¬éœ€è¦æŠŠthenä¼ å…¥çš„å›è°ƒä¿å­˜åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œåˆ°æ—¶å€™ä¸€èµ·æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyPromise</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">executor</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUE_PENDING</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span> = [] <span class="comment">// å®šä¹‰æ•°ç»„å­˜æ”¾æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span> = [] <span class="comment">// å®šä¹‰æ•°ç»„å­˜æ”¾å¤±è´¥çš„å›è°ƒ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">        <span class="title function_">queueMicrotask</span>(<span class="function">() =&gt;</span> &#123;   <span class="comment">// åŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> !== <span class="variable constant_">STATUE_PENDING</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUE_FULFILLED</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">          <span class="comment">// ç”¨forEachéå†æ‰§è¡Œæ•°ç»„ä¸­çš„å›è°ƒ </span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;  </span><br><span class="line">            <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">        <span class="title function_">queueMicrotask</span>(<span class="function">() =&gt;</span> &#123;  <span class="comment">// åŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> !== <span class="variable constant_">STATUE_PENDING</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">STATUS_REJECTED</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">reason</span> = reason</span><br><span class="line">          <span class="comment">// ç”¨forEachéå†æ‰§è¡Œæ•°ç»„ä¸­çš„å›è°ƒ</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">executor</span>(resolve, reject)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(onFulfilled)  <span class="comment">// ä¿å­˜åˆ°æ•°ç»„</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(onRejected) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pending~&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;111&quot;</span>)</span><br><span class="line">  <span class="title function_">reject</span>(<span class="string">&quot;222&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res: &quot;</span>, res);</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err: &quot;</span>, err);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res2: &quot;</span>, res);</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err2: &quot;</span>, err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="å»¶è¿Ÿè°ƒç”¨then">å»¶è¿Ÿè°ƒç”¨then</h4><p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼šresolveæˆ–rejectæ‰§è¡Œå®Œä¹‹åï¼Œå»¶è¿Ÿæ‰§è¡Œthen</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pending~&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;111&quot;</span>)</span><br><span class="line">  <span class="comment">// reject(&quot;222&quot;)</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res3: &quot;</span>, res);</span><br><span class="line">  &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err3: &quot;</span>, err);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><p>setTimeout ä¼šåœ¨ä¸»çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå¹¶ä¸”å¾®ä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ‰§è¡Œå®Œåæ‰æ‰§è¡Œ</p><p>æ‹ä¸€æ‹æ‰§è¡Œé¡ºåºï¼š</p><ol><li><p>é¦–å…ˆä¸»çº¿ç¨‹ <code>resolve(&quot;111&quot;)</code>æ‰§è¡Œï¼Œå…ˆ<strong>æ”¹å˜çŠ¶æ€ä¸ºfulfilled</strong>ï¼Œä¿å­˜valueï¼Œç„¶ååœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­åŠ å…¥ä¸€ä¸ªä»»åŠ¡</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a7c758c4c8fc4368951ba935c8a4ea75~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /></li><li><p>ç„¶åç»§ç»­å¾€ä¸‹ï¼Œ<strong>setTimeout</strong> è¢«åŠ å…¥åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶æœªæ‰§è¡Œthen</p></li><li><p>ä¸»çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œï¼Œæ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œ<strong>éå†æ•°ç»„ä¸­çš„å‡½æ•°å¹¶æ‰§è¡Œ</strong>ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‰é¢thenæ²¡æœ‰æ‰§è¡Œï¼Œæ•°ç»„ä¸­å¹¶æ²¡æœ‰å¯¹åº”å›è°ƒï¼Œæ‰€ä»¥æ²¡æœ‰æ‰§è¡Œ</p></li><li><p>æ¥ç€æ‰§è¡Œå®ä»»åŠ¡é˜Ÿåˆ—ä¸­setTimeoutï¼Œä¹Ÿå°±æ˜¯thenæ–¹æ³•è¢«æ‰§è¡Œï¼Œ</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc271dd9a1d84d3c8defab59010b4b35~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p><strong>è¿™ä¸ªæ—¶å€™æ‰æŠŠå›è°ƒåŠ å…¥æ•°ç»„</strong>ã€‚ã€‚ã€‚ä»»åŠ¡ç»“æŸ</p></li></ol><p>å› æ­¤å¯ä»¥æƒ³åˆ°å®ç°æ€è·¯ï¼šåœ¨thenæ–¹æ³•ä¸­åŠ å…¥åˆ¤æ–­ï¼Œå¦‚æœå½“å‰çŠ¶æ€æ˜¯ç¡®å®šçš„ï¼Œï¼ˆfulfilledæˆ–rejectedï¼‰ï¼Œé‚£ä¹ˆç›´æ¥æ‰§è¡Œè¿™ä¸ªå›è°ƒï¼Œä¸ç”¨æ·»åŠ åˆ°æ•°ç»„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_FULFILLED</span> &amp;&amp; onFulfilled) &#123;</span><br><span class="line">    <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUS_REJECTED</span> &amp;&amp; onRejected) &#123;</span><br><span class="line">    <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(onFulfilled) </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(onRejected) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é“¾å¼è°ƒç”¨then">é“¾å¼è°ƒç”¨then</h4><p>thenéœ€è¦è¿”å›ä¸€ä¸ªpromiseï¼Œåé¢æ‰èƒ½ç»§ç»­è°ƒç”¨then</p><p>å¹¶ä¸”ä¸‹ä¸€æ¬¡çš„thenæ˜¯åœ¨ä¸Šæ¬¡å›è°ƒæ‰§è¡Œå®Œä¹‹åæ‰æ‰§è¡Œçš„ï¼Œè€Œä¸”éœ€è¦æ‹¿åˆ°ä¸Šæ¬¡onFulfilled/onRejected æ‰§è¡Œå®Œä¹‹åçš„ç»“æœï¼Œå†å»æ‰§è¡Œresolveï¼Œreject</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_FULFILLED</span> &amp;&amp; onFulfilled) &#123;</span><br><span class="line">    <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUS_REJECTED</span> &amp;&amp; onRejected) &#123;</span><br><span class="line">    <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(onFulfilled) </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(onRejected) </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>() <span class="comment">// è¿™é‡Œéœ€è¦æ‹¿åˆ°ä¸Šæ¬¡å›è°ƒçš„ç»“æœå¹¶ä¸”ä¼ è¿›å»</span></span><br><span class="line">    <span class="title function_">reject</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ€ä¹ˆæ‹¿åˆ°ä¸Šæ¬¡æ‰§è¡Œçš„ç»“æœå€¼ï¼Ÿ</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0042b6e0559549e1b91351eb795be282~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>æ€è·¯ï¼šæŠŠä¸Šé¢é‚£ä¸€å¨ä»£ç æ”¾åˆ°newé‡Œé¢æ‰§è¡Œï¼Œè¿™æ ·å°±è®©é‡Œè¾¹å…·å¤‡äº†æ‹¿åˆ°è¿”å›ç»“æœçš„èƒ½åŠ›</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_FULFILLED</span> &amp;&amp; onFulfilled) &#123;</span><br><span class="line">      <span class="comment">// æ¯”å¦‚è¿™é‡Œå°±å¯ä»¥æ‹¿åˆ°ç»“æœ</span></span><br><span class="line">      <span class="keyword">const</span> value = <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">      <span class="comment">// ç„¶åå†æ‰§è¡Œ(è¿™é‡Œå·²ç»æ˜¯ä¸‹ä¸€ä¸ªpromiseçš„resolveäº†)</span></span><br><span class="line">      <span class="title function_">resolve</span>(value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUS_REJECTED</span> &amp;&amp; onRejected) &#123;</span><br><span class="line">      <span class="keyword">const</span> reason = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)</span><br><span class="line">      <span class="comment">// æ³¨æ„è¿™é‡Œè°ƒç”¨çš„åº”è¯¥æ˜¯resolveï¼Œé™¤éä¸Šä¸€æ¬¡çš„é”™è¯¯å›è°ƒå‡½æ•°æŠ›å‡ºäº†é”™è¯¯</span></span><br><span class="line">      <span class="title function_">resolve</span>(reason)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(onFulfilled) </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(onRejected) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºå³ä½¿æˆ‘ä»¬ä¸é“¾å¼è°ƒç”¨ï¼Œé‡Œé¢çš„ä»£ç è¿˜æ˜¯ä¼šæ‰§è¡Œçš„ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³æ‹¿åˆ°æƒ³è¦çš„ç»“æœï¼Œå¹¶ä¸”åœ¨æŸä¸ªæ—¶æœºè°ƒç”¨ resolve, reject</p><p>ä¸¤ç§æƒ…å†µéƒ½è°ƒç”¨resolveï¼Ÿé‚£ä»€ä¹ˆæ—¶å€™è°ƒç”¨rejectå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåªæœ‰åœ¨ä¸Šæ¬¡çš„thenä¸­æŠ›å‡ºå¼‚å¸¸äº†ï¼Œä¸‹æ¬¡æ‰ä¼šæ‰§è¡Œreject</p><p>æ‰€ä»¥æˆ‘ä»¬å†æ”¹è¿›ä¸€ä¸‹ï¼šä½¿ç”¨tryâ€¦catch</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_FULFILLED</span> &amp;&amp; onFulfilled) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> value = <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">        <span class="title function_">resolve</span>(value)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="title function_">reject</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUS_REJECTED</span> &amp;&amp; onRejected) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> reason = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)</span><br><span class="line">        <span class="title function_">resolve</span>(reason)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="title function_">reject</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(onFulfilled) </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(onRejected) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢éƒ½æ˜¯åœ¨çŠ¶æ€å·²ç»ç¡®å®šä¹‹åçš„æƒ…å†µï¼Œæˆ‘ä»¬çŸ¥é“åœ¨çŠ¶æ€ä¸ºpendingçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯æŠŠå›è°ƒä¿å­˜åˆ°æ•°ç»„ï¼Œç„¶ååœ¨ä¸Šé¢çš„resolveã€rejectä¸­éå†æ•°ç»„æ‰§è¡Œçš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;  </span><br><span class="line">  <span class="keyword">let</span> value = <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">value</span>)  <span class="comment">// åœ¨è¿™é‡Œæ‰§è¡Œçš„</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‚£è¿™ä¸ªæ‰§è¡Œç»“æœæ€ä¹ˆæ‹¿åˆ°å‘¢ç„¶åä¼ ç»™ä¸‹é¢çš„resolveã€rejectå‘¢ï¼Ÿ</p><p>è§£å†³æ–¹æ¡ˆï¼šæ”¹è¿›æˆ‘ä»¬æ·»åŠ åˆ°æ•°ç»„çš„æ–¹å¼</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">onFulfilled</span>()</span><br><span class="line">  &#125;) </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">onRejected</span>()</span><br><span class="line">  &#125;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸ç›´æ¥æŠŠå›è°ƒæ·»åŠ åˆ°æ•°ç»„ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªå‡½æ•°åŒ…è£¹èµ·æ¥ï¼Œé‚£ä¹ˆåˆ°æ—¶ä¸Šé¢éå†æ‰§è¡Œçš„å°±æ˜¯è¿™ä¸ªåŒ…è£¹çš„å‡½æ•°ï¼Œç„¶åæˆ‘ä»¬åœ¨è¿™é‡Œå†…éƒ¨æ‰§è¡ŒonFulfilledï¼Œå°±å¯ä»¥åœ¨è¿™é‡Œæ‹¿åˆ°onFulfilledçš„æ‰§è¡Œç»“æœ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> value = <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">    <span class="title function_">resolve</span>(value)</span><br><span class="line">  &#125;) </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> reason = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)</span><br><span class="line">    <span class="title function_">resolve</span>(reason)</span><br><span class="line">  &#125;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒç†ï¼Œtryâ€¦catchæ”¹è¿›ä¸€ä¸‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> value = <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">      <span class="title function_">resolve</span>(value)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;) </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> reason = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)</span><br><span class="line">      <span class="title function_">resolve</span>(reason)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•çš„æ—¶å€™å‘ç°ï¼Œæœ‰ä¸€ç§æƒ…å†µæˆ‘ä»¬æ²¡æœ‰å¤„ç†</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pending~&quot;</span>);</span><br><span class="line">  <span class="comment">// resolve(&quot;111&quot;)</span></span><br><span class="line">  <span class="comment">// reject(&quot;222&quot;)</span></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error message&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ”¹è¿›ï¼Œåœ¨ <strong>executor</strong> é‚£é‡ŒåŠ tryâ€¦catchï¼Œå¦‚æœæŠ›å‡ºäº†å¼‚å¸¸ç›´æ¥æ‰§è¡Œreject</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="title function_">executor</span>(resolve, reject)</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="title function_">reject</span>(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pending~&quot;</span>);</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error message&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res: &quot;</span>, res);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;aaa&quot;</span></span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err: &quot;</span>, err); <span class="comment">// æ‰§è¡Œè¿™é‡Œ</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;bbb&quot;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res2: &quot;</span>, res); <span class="comment">// ç„¶åæ¥åˆ°è¿™é‡Œ</span></span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err2: &quot;</span>, err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/076b7b8527004ff7b91edd5f07a20ddd~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>æµ‹è¯•æ²¡é—®é¢˜ï¼ï¼</p><h4 id="å·¥å…·å‡½æ•°">å·¥å…·å‡½æ•°</h4><p>åˆ°è¿™é‡Œthenæ–¹æ³•åŸºæœ¬å°±å®ç°å®Œäº†ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°å¾ˆå¤š tryâ€¦catchçš„é‡å¤ä»£ç </p><p>æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªæŠ½å–ï¼Œå®šä¹‰ä¸€ä¸ªå·¥å…·å‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">execFunctionWithCatchError</span>(<span class="params">exeFn, value, resolve, reject</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="title function_">exeFn</span>(value)</span><br><span class="line">    <span class="title function_">resolve</span>(result)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="title function_">reject</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä¼˜åŒ–thenæ–¹æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_FULFILLED</span> &amp;&amp; onFulfilled) &#123;</span><br><span class="line">      <span class="comment">// try &#123;</span></span><br><span class="line">      <span class="comment">//   const value = onFulfilled(this.value)</span></span><br><span class="line">      <span class="comment">//   resolve(value)</span></span><br><span class="line">      <span class="comment">// &#125; catch (err) &#123;</span></span><br><span class="line">      <span class="comment">//   reject(err)</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">      <span class="title function_">execFunctionWithCatchError</span>(onFulfilled, <span class="variable language_">this</span>.<span class="property">value</span>, resolve, reject)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUS_REJECTED</span> &amp;&amp; onRejected) &#123;</span><br><span class="line">      <span class="title function_">execFunctionWithCatchError</span>(onRejected, <span class="variable language_">this</span>.<span class="property">reason</span>, resolve, reject)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">execFunctionWithCatchError</span>(onFulfilled, <span class="variable language_">this</span>.<span class="property">value</span>, resolve, reject)</span><br><span class="line">      &#125;) </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">execFunctionWithCatchError</span>(onRejected, <span class="variable language_">this</span>.<span class="property">reason</span>, resolve, reject)</span><br><span class="line">      &#125;) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="catch-æ–¹æ³•çš„å®ç°">catch æ–¹æ³•çš„å®ç°</h3><p>catchæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯å¤±è´¥çš„å›è°ƒï¼Œå› ä¸ºcatchå®é™…ä¸Šå°±ç›¸å½“äºè¯­æ³•ç³–ï¼Œè€Œä¸”ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„promiseï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨then</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">undefined</span>, onRejected)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pending~&quot;</span>);</span><br><span class="line">  <span class="comment">// resolve(111)  </span></span><br><span class="line">  <span class="title function_">reject</span>(<span class="number">222</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res: &quot;</span>, res);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;aaa&quot;</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;catch&quot;</span>, err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é¢ï¼ŒæŠ¥é”™äº†</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b877817e3a7c4cc093ddafaea55b641a~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>åˆ«æ€¥ï¼Œåˆ†æåŸå› ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä¸€ä¸‹ï¼Œæœ¬æ¥æˆ‘ä»¬çš„å¤±è´¥å›è°ƒåº”è¯¥æ˜¯åœ¨ç¬¬ä¸€ä¸ªthenä¸­ä¼ å…¥çš„ï¼Œæ˜¯ä½œä¸ºç¬¬ä¸€ä¸ªpromiseçš„å¤±è´¥çš„å›è°ƒçš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res: &quot;</span>, res);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;aaa&quot;</span></span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;catch&quot;</span>, err);</span><br><span class="line">&#125;).<span class="title function_">catch</span>()</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å†™åˆ°catché‡Œé¢ï¼Œæ„å‘³ç€è¿™ä¸ªcatchä¼ å…¥çš„å›è°ƒæ˜¯è¢«åŠ å…¥åˆ°ä¸€ä¸ªæ–°çš„promiseä¸­ï¼Œä½œä¸ºæ–°çš„promiseçš„å¤±è´¥çš„å›è°ƒäº†ï¼Œæ‰€ä»¥æ‰§è¡Œä¸åˆ°è¿™ä¸ªå›è°ƒäº†</p><blockquote><p>promise1 -&gt; undefined</p><p>promise2 -&gt; err ={}</p></blockquote><p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ ·è®©promise1æ‰§è¡Œåˆ°err ={} å‘¢ï¼Ÿï¼Ÿ</p><p>å®ç°æ€è·¯ï¼šå‡å¦‚è¯´promise1çš„å¤±è´¥å›è°ƒæ²¡æœ‰å€¼ï¼Œæˆ‘ä»¬ç›´æ¥æŠ›å‡ºå»ï¼Œè¿™æ ·å°±ä¼šæ¥åˆ°promise2ä¸­å¤±è´¥çš„å›è°ƒäº†</p><blockquote><p>promise1 -&gt; err =&gt; {throw err} // æŠ›å‡ºå»</p><p>promise2 -&gt; err ={} // å°±ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ</p></blockquote><p>è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹æ˜¯ï¼Œæ—¢ç„¶onFulfilledæˆ–onRejectedå¯èƒ½ä¼šä¼ è¿›æ¥undefinedï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€å¥½åŠ ä¸Šä¸€ä¸ªåˆ¤æ–­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">defaultOnRejected</span> = err =&gt; &#123; <span class="keyword">throw</span> err &#125;  <span class="comment">// æ·»åŠ éƒ¨åˆ†</span></span><br><span class="line">  onRejected = onRejected || defaultOnRejected</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_FULFILLED</span> &amp;&amp; onFulfilled) &#123;</span><br><span class="line">      <span class="title function_">execFunctionWithCatchError</span>(onFulfilled, <span class="variable language_">this</span>.<span class="property">value</span>, resolve, reject)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUS_REJECTED</span> &amp;&amp; onRejected) &#123;</span><br><span class="line">      <span class="title function_">execFunctionWithCatchError</span>(onRejected, <span class="variable language_">this</span>.<span class="property">reason</span>, resolve, reject)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (onFulfilled) <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">execFunctionWithCatchError</span>(onFulfilled, <span class="variable language_">this</span>.<span class="property">value</span>, resolve, reject)</span><br><span class="line">      &#125;) </span><br><span class="line">      <span class="keyword">if</span> (onRejected) <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">execFunctionWithCatchError</span>(onRejected, <span class="variable language_">this</span>.<span class="property">reason</span>, resolve, reject)</span><br><span class="line">      &#125;) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="finally-æ–¹æ³•çš„å®ç°">finally æ–¹æ³•çš„å®ç°</h3><p>æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œæ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼Œæœ€åéƒ½ä¼šæ‰§è¡Œ</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒæˆåŠŸä¸å¤±è´¥çš„å›è°ƒéƒ½æ˜¯ä½ ä¼ å…¥çš„é‚£ä¸ªå‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// finally</span></span><br><span class="line"><span class="title function_">finally</span>(<span class="params">onFinally</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">onFinally</span>()</span><br><span class="line">  &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">onFinally</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿˜ä¼šæœ‰ä¸€ä¸ªé—®é¢˜</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pending~&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="number">111</span>)  <span class="comment">// è°ƒç”¨resolveæœ‰é—®é¢˜</span></span><br><span class="line">  <span class="comment">// reject(222) è°ƒç”¨rejectæ²¡é—®é¢˜</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res: &quot;</span>, res); <span class="comment">// åœˆ1</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;catch&quot;</span>, err);<span class="comment">// åœˆ2</span></span><br><span class="line">&#125;).<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;finally&#x27;</span>); <span class="comment">// åœˆ3</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åˆ†æï¼šæ‹ä¸€æ‹</p><blockquote><p>å¦‚æœä¸Šé¢æ˜¯resolveçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œåœˆ1ï¼Œç„¶åæ¥åˆ°promise2çš„æˆåŠŸå›è°ƒ</p><p>promise1ï¼šæˆåŠŸå›è°ƒæ˜¯ åœˆ1ï¼Œå¤±è´¥å›è°ƒæ˜¯æˆ‘ä»¬é»˜è®¤çš„reject</p><p>promise2ï¼šæ²¡æœ‰æˆåŠŸå›è°ƒï¼Œå¤±è´¥å›è°ƒæ˜¯åœˆ2ï¼Œ</p><p>â€‹æ²¡æœ‰æˆåŠŸå›è°ƒï¼Œè¿™æ—¶å€™å°±ä¼šå‡ºé”™äº†ï¼Œåé¢ä¹Ÿä¸ä¼šç»§ç»­æ‰§è¡Œäº†ï¼Œå› æ­¤è¦ç»™é»˜è®¤çš„æˆåŠŸå›è°ƒ value =&gt; { return value }</p><p>ç„¶åæ‰ä¼šæ‰§è¡Œfinallyçš„ç¬¬ä¸€ä¸ªå›è°ƒ</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">defaultOnRejected</span> = err =&gt; &#123; <span class="keyword">throw</span> err &#125;</span><br><span class="line">  onRejected = onRejected || defaultOnRejected</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ éƒ¨åˆ†</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">defaultOnFulfilled</span> = value =&gt; &#123; <span class="keyword">return</span> value &#125;</span><br><span class="line">  onFulfilled = onFulfilled || defaultOnFulfilled</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¥åˆ°è¿™é‡Œå°±å¯ä»¥ä¿è¯ onRejectedï¼ŒonFulfilled æ˜¯æœ‰å€¼çš„äº†ï¼Œæ‰€ä»¥ä¸‹é¢çš„åˆ¤æ–­ä¹Ÿå¯ä»¥ä¸è¦äº†</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_FULFILLED</span>) &#123;  <span class="comment">// æ”¹äº†è¿™é‡Œ</span></span><br><span class="line">      <span class="title function_">execFunctionWithCatchError</span>(onFulfilled, <span class="variable language_">this</span>.<span class="property">value</span>, resolve, reject)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUS_REJECTED</span>) &#123; <span class="comment">// æ”¹äº†è¿™é‡Œ</span></span><br><span class="line">      <span class="title function_">execFunctionWithCatchError</span>(onRejected, <span class="variable language_">this</span>.<span class="property">reason</span>, resolve, reject)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">STATUE_PENDING</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (onFulfilled) <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">execFunctionWithCatchError</span>(onFulfilled, <span class="variable language_">this</span>.<span class="property">value</span>, resolve, reject)</span><br><span class="line">      &#125;) </span><br><span class="line">      <span class="keyword">if</span> (onRejected) <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">execFunctionWithCatchError</span>(onRejected, <span class="variable language_">this</span>.<span class="property">reason</span>, resolve, reject)</span><br><span class="line">      &#125;) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="resolve-reject-ç±»æ–¹æ³•çš„å®ç°">resolve reject ç±»æ–¹æ³•çš„å®ç°</h3><p>resolve ç±»æ–¹æ³•æœ¬è´¨å°±æ˜¯newäº†ä¸€ä¸ª promiseï¼Œç„¶åç›´æ¥è°ƒç”¨resolve</p><p>rejectåŒç†</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="title function_">resolve</span>(value))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="title function_">reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="title function_">reject</span>(reason))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">MyPromise</span>.<span class="title function_">resolve</span>(<span class="number">123</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// 123</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="all-æ–¹æ³•çš„å®ç°">all æ–¹æ³•çš„å®ç°</h3><p>allæ–¹æ³•æ¥æ”¶ä¸€ä¸ªpromiseæ•°ç»„ï¼ŒåŒæ ·è¿”å›ä¸€ä¸ªpromise</p><p>å…³é”®æ€è·¯ï¼šä»€ä¹ˆæ—¶å€™è¦æ‰§è¡Œresolve, ä»€ä¹ˆæ—¶å€™è¦æ‰§è¡Œreject</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="title function_">all</span>(<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> values = [] <span class="comment">// å®šä¹‰ç»“æœæ•°ç»„</span></span><br><span class="line">    promises.<span class="title function_">forEach</span>(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">      promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        values.<span class="title function_">push</span>(res)</span><br><span class="line"><span class="comment">// å½“ç»“æœçš„ä¸ªæ•°ç­‰äºä¼ å…¥promiseä¸ªæ•°çš„æ—¶å€™ï¼Œè¡¨ç¤ºå·²ç»æ‰§è¡Œå®Œäº†ï¼Œç„¶åå†å›è°ƒresolve</span></span><br><span class="line">        <span class="keyword">if</span> (values.<span class="property">length</span> === promises.<span class="property">length</span>) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(values)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(err) <span class="comment">// å¤±è´¥ç›´æ¥æ‰§è¡Œå›è°ƒreject</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;111&quot;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;222&quot;</span>)</span><br><span class="line">    <span class="comment">// reject(&quot;222&quot;)</span></span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;333&quot;</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">MyPromise</span>.<span class="title function_">all</span>([p1, p2, p3]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// [&#x27;111&#x27;, &#x27;222&#x27;, &#x27;333&#x27;]</span></span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);  <span class="comment">// å¦‚æœp2è°ƒç”¨rejectï¼Œå°±ä¼šæ‰§è¡Œè¿™é‡Œï¼Œè¾“å‡º 222</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="allSettled-æ–¹æ³•çš„å®ç°">allSettled æ–¹æ³•çš„å®ç°</h3><p>ä¸allç±»å‹ï¼ŒåŒºåˆ«å°±æ˜¯æ— è®ºæˆåŠŸä¸å¦éƒ½ä¼šæŠŠç»“æœä¿å­˜åˆ°æ•°ç»„</p><p>æµ‹è¯•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;111&quot;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&quot;222&quot;</span>)</span><br><span class="line">    <span class="comment">// reject(&quot;222&quot;)</span></span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;333&quot;</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">MyPromise</span>.<span class="title function_">allSettled</span>([p1, p2, p3]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d1c6ab0512854961862eb9db477b1e1e~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h3 id="race-æ–¹æ³•çš„å®ç°">race æ–¹æ³•çš„å®ç°</h3><p>åªè¦çŠ¶æ€æ”¹å˜å°±æ‰§è¡Œå›è°ƒ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="title function_">race</span>(<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    promises.<span class="title function_">forEach</span>(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// promise.then(res =&gt; &#123;</span></span><br><span class="line">      <span class="comment">//   resolve(res)</span></span><br><span class="line">      <span class="comment">// &#125;, err =&gt; &#123;</span></span><br><span class="line">      <span class="comment">//   reject(err)</span></span><br><span class="line">      <span class="comment">// &#125;)</span></span><br><span class="line">      <span class="comment">// ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™</span></span><br><span class="line">      promise.<span class="title function_">then</span>(resolve, reject)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="any-æ–¹æ³•çš„å®ç°">any æ–¹æ³•çš„å®ç°</h3><p>ç­‰åˆ°ç¬¬ä¸€ä¸ªfulfilledçŠ¶æ€ï¼Œæ‰æ‰§è¡Œresolveå›è°ƒ</p><p>å¦‚æœå…¨éƒ½æ˜¯rejectedçŠ¶æ€ï¼Œé‚£ä¹ˆæŠ›å‡ºå¼‚å¸¸</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="title function_">any</span>(<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> reasons = []</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    promises.<span class="title function_">forEach</span>(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">      promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(res)</span><br><span class="line">      &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        reasons.<span class="title function_">push</span>(err)</span><br><span class="line">        <span class="comment">// å½“å…¨éƒ¨promiseæ‰§è¡Œå®Œä¹‹å</span></span><br><span class="line">        <span class="keyword">if</span> (reasons.<span class="property">length</span> === promises.<span class="property">length</span>) &#123;</span><br><span class="line">          <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">AggregateError</span>(reasons))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å…¨éƒ½æ˜¯rejectçš„æƒ…å†µ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&quot;111&quot;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&quot;222&quot;</span>)</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&quot;333&quot;</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">MyPromise</span>.<span class="title function_">any</span>([p1, p2, p3]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err, err.<span class="property">errors</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5c3b3d01b0fd4086a807b8896d97ac16~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>åˆ°æ­¤ï¼Œæ‰‹å†™promiseå°±å·®ä¸å¤šå¤§åŠŸå‘Šæˆå•¦ï¼</p>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> promise </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>promiseè¯¦è§£</title>
      <link href="/2022/04/17/promise%E8%AF%A6%E8%A7%A3/"/>
      <url>/2022/04/17/promise%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h2 id="Promiseè¯¦è§£">Promiseè¯¦è§£</h2><blockquote><p>ES6 æ–°å¢ Promise</p></blockquote><h3 id="ä»‹ç»">ä»‹ç»</h3><p>Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼š</p><p>ä»è¯­æ³•ä¸Šè®²ï¼Œpromiseæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ï¼›</p><p>ä»æœ¬æ„ä¸Šè®²ï¼Œå®ƒæ˜¯æ‰¿è¯ºï¼Œæ‰¿è¯ºå®ƒè¿‡ä¸€æ®µæ—¶é—´ä¼šç»™ä½ ä¸€ä¸ªç»“æœã€‚</p><p>1.ä¸ºä»€ä¹ˆéœ€è¦æœ‰Promiseï¼Ÿ</p><p>promiseä¸»è¦è§£å†³çš„é—®é¢˜ï¼š</p><ul><li>å›è°ƒåœ°ç‹±ï¼Œä»£ç éš¾ä»¥ç»´æŠ¤ï¼Œ å¸¸å¸¸ç¬¬ä¸€ä¸ªçš„å‡½æ•°çš„è¾“å‡ºæ˜¯ç¬¬äºŒä¸ªå‡½æ•°çš„è¾“å…¥è¿™ç§ç°è±¡</li><li>promiseå¯ä»¥æ”¯æŒå¤šä¸ªå¹¶å‘çš„è¯·æ±‚ï¼Œè·å–å¹¶å‘è¯·æ±‚ä¸­çš„æ•°æ®</li><li>è¿™ä¸ªpromiseå¯ä»¥è§£å†³å¼‚æ­¥çš„é—®é¢˜ï¼Œæœ¬èº«ä¸èƒ½è¯´promiseæ˜¯å¼‚æ­¥çš„</li></ul><blockquote><p>è¡¥å……ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°ï¼Ÿ</p><p>å°±æ˜¯æˆ‘ç»™ä½ ä¼ ä¸€ä¸ªå‡½æ•°ï¼Œä½ åè¿‡æ¥è°ƒç”¨æˆ‘</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78475af436354b338af3be4b9a9083da~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /></blockquote><p>ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¼šç¢°åˆ°çš„å›è°ƒåµŒå¥—éƒ½ä¸ä¼šå¾ˆå¤šï¼Œä¸€èˆ¬å°±ä¸€åˆ°ä¸¤çº§ï¼Œä½†æ˜¯æŸäº›æƒ…å†µä¸‹ï¼Œå›è°ƒåµŒå¥—å¾ˆå¤šæ—¶ï¼Œä»£ç å°±ä¼šéå¸¸ç¹çï¼Œä¼šç»™æˆ‘ä»¬çš„ç¼–ç¨‹å¸¦æ¥å¾ˆå¤šçš„éº»çƒ¦ï¼Œè¿™ç§æƒ…å†µä¿—ç§°â€”â€”å›è°ƒåœ°ç‹±ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å½“å‚æ•°aå¤§äº10ä¸”å‚æ•°fn2æ˜¯ä¸€ä¸ªæ–¹æ³•æ—¶ æ‰§è¡Œfn2</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params">a, fn2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (a &gt; <span class="number">10</span> &amp;&amp; <span class="keyword">typeof</span> fn2 == <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">fn2</span>() <span class="comment">// å›è°ƒå‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn1</span>(<span class="number">11</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this is a callback&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>2.Promiseæ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆä½¿ç”¨ï¼Ÿ</p><ul><li><p>Promise æ˜¯ä¸€ä¸ªç±»ï¼Œå­—é¢æ„æ€ï¼šæ‰¿è¯ºã€æœŸçº¦</p></li><li><p>é€šè¿‡ new å¯ä»¥åˆ›å»ºä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦ä¼ å…¥å›è°ƒå‡½æ•°ï¼ˆexecutorï¼‰</p><p>è¿™ä¸ªå›è°ƒå‡½æ•°ä¼šè¢«<strong>ç«‹å³æ‰§è¡Œ</strong>ï¼Œå¹¶ä¸”ä¼šä¼ å…¥å¦å¤–ä¸¤ä¸ªå›è°ƒå‡½æ•° resolveã€reject</p><p>å½“æˆ‘ä»¬è°ƒç”¨resolveå›è°ƒå‡½æ•°æ—¶ï¼Œä¼šæ‰§è¡ŒPromiseå¯¹è±¡çš„thenæ–¹æ³•ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“è°ƒç”¨rejectçš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œç¬¬äºŒä¸ªå›è°ƒ</p></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;success message&quot;</span>)</span><br><span class="line">  <span class="comment">// reject(&quot;failure&quot;)</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Promiseçš„ä¸‰ç§çŠ¶æ€">Promiseçš„ä¸‰ç§çŠ¶æ€</h3><p>Promiseä½¿ç”¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒåˆ’åˆ†æˆä¸‰ä¸ªçŠ¶æ€ï¼š</p><p><strong>pending</strong>ï¼šå¾…å®šï¼Œåˆå§‹çŠ¶æ€ï¼Œæ—¢æ²¡æœ‰è¢«å…‘ç°ï¼Œä¹Ÿæ²¡æœ‰è¢«æ‹’ç»ï¼›å½“æ‰§è¡Œexecutorä¸­çš„ä»£ç æ—¶ï¼Œå¤„äºè¯¥çŠ¶æ€ï¼›</p><p><strong>fulfilled</strong>ï¼šå·²å…‘ç°ï¼Œ æ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆï¼›æ‰§è¡Œäº†resolveæ—¶ï¼Œå¤„äºè¯¥çŠ¶æ€ï¼› ï¼ˆä¹Ÿæœ‰çš„åœ°æ–¹å«resolvedçŠ¶æ€ï¼‰</p><p><strong>rejected</strong>ï¼šå·²æ‹’ç»ï¼Œæ„å‘³ç€æ“ä½œå¤±è´¥ï¼› æ‰§è¡Œäº†rejectæ—¶ï¼Œå¤„äºè¯¥çŠ¶æ€ï¼›</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// pendingå¾…å®š</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">resolve</span>() <span class="comment">// fulfilled(å·²å®Œæˆ)</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">reject</span>() <span class="comment">// rejected(å·²æ‹’ç»)</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šPromiseçš„çŠ¶æ€ä¸€æ—¦ç¡®å®šï¼Œå°±ä¸å¯æ›´æ”¹ï¼Œåªæœ‰ä¸¤ç§çŠ¶æ€æ”¹å˜ï¼š</p><p><code>pending</code> -&gt;<code> fulfilled</code>             <code>pending</code> -&gt;<code> rejected</code></p><blockquote><p>å¦å¤–æˆ‘ä»¬å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼ŒçŠ¶æ€ä¹Ÿæ˜¯rejectedï¼Œä¼šå›è°ƒthençš„ç¬¬äºŒä¸ªå‚æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;å¼‚å¸¸&quot;</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);  <span class="comment">// Error: å¼‚å¸¸</span></span><br><span class="line">&#125;)  </span><br></pre></td></tr></table></figure></blockquote><h3 id="resolveä¸åŒå€¼çš„åŒºåˆ«">resolveä¸åŒå€¼çš„åŒºåˆ«</h3><p><strong>resolve(å‚æ•°)</strong>ï¼šresolveçš„å‚æ•°ï¼Œä¸‰ç§æƒ…å†µ</p><ol><li><p>å‚æ•°æ˜¯æ™®é€šå€¼(æ•°å€¼/å­—ç¬¦ä¸²/æ™®é€šå¯¹è±¡/undefined)ï¼ŒçŠ¶æ€å˜åŒ– pending -&gt; fulfilled</p></li><li><p>å‚æ•°åˆæ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–°Promiseä¼šå†³å®šåŸPromiseçš„çŠ¶æ€</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> newPromise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;hahhaha&quot;</span>)</span><br><span class="line">  <span class="comment">// reject()</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(newPromise) <span class="comment">// çŠ¶æ€ç”±newPromiseå†³å®š</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// hahhaha</span></span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡æœ‰å®ç°thenæ–¹æ³•ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œè¯¥thenæ–¹æ³•ï¼Œå¹¶ä¸”æ ¹æ® thenæ–¹æ³•çš„ç»“æœæ¥å†³å®šPromiseçš„çŠ¶æ€</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">then</span>: <span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="string">&quot;resolve message&quot;</span>)</span><br><span class="line">      <span class="comment">// reject()</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">resolve</span>(obj)</span><br><span class="line"></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); </span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><h3 id="Promiseå¯¹è±¡æ–¹æ³•">Promiseå¯¹è±¡æ–¹æ³•</h3><blockquote><p>thenï¼Œcatchï¼Œfinally</p></blockquote><h4 id="thenæ–¹æ³•">thenæ–¹æ³•</h4><p><strong>1. ä¸¤ä¸ªå‚æ•°</strong></p><p>thenæ–¹æ³•æ˜¯Promiseå¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯æ”¾åœ¨Promiseçš„åŸå‹ä¸Šçš„ï¼šPromise.prototype.then</p><p>thenæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li>fulfilledçš„å›è°ƒå‡½æ•°ï¼šå½“çŠ¶æ€å˜æˆfulfilledæ—¶ä¼šå›è°ƒçš„å‡½æ•°</li><li>rejectçš„å›è°ƒå‡½æ•°ï¼šå½“çŠ¶æ€å˜æˆrejectæ—¶ä¼šå›è°ƒçš„å‡½æ•°</li></ul><p><strong>2. å¤šæ¬¡è°ƒç”¨</strong></p><p>åŒä¸€ä¸ªPromiseæ˜¯å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨thenæ–¹æ³•çš„ï¼Œå½“resolveæ–¹æ³•è¢«å›è°ƒæ—¶ï¼Œæ‰€æœ‰çš„thenæ–¹æ³•ä¼ å…¥çš„å›è°ƒå‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„è¿™ä¸æ˜¯é“¾å¼è°ƒç”¨</span></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res1</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res1); <span class="comment">// success</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res2</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res2); <span class="comment">// success</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res3</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res3); <span class="comment">// success</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>3. thençš„è¿”å›å€¼</strong></p><p>thenæ–¹æ³•æœ¬èº«æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯Promise</p><ul><li>å¦‚æœæˆ‘ä»¬thençš„ç¬¬ä¸€ä¸ªå›è°ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæ™®é€šå€¼(æ•°å€¼/å­—ç¬¦ä¸²/æ™®é€šå¯¹è±¡/undefined), é‚£ä¹ˆè¿™ä¸ªæ™®é€šçš„å€¼ä¼šè¢«ä½œä¸ºä¸€ä¸ªæ–°çš„Promiseçš„resolveå€¼</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newPromise = promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;aaa&quot;</span> </span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newPromise); </span><br></pre></td></tr></table></figure><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c95c82ce3e094f79a428d32429a89591~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›è¡Œ<strong>é“¾å¼è°ƒç”¨</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;aaa&quot;</span> </span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// &quot;aaa&quot;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;bbb&quot;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// &quot;bbb&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªPromise</li></ul><p>é‚£ä¹ˆè¿™ä¸ªPromiseä¼šå†³å®šä¸‹ä¸€ä¸ªthenè¿”å›çš„promiseçš„çŠ¶æ€</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="number">1111</span>)</span><br><span class="line">    &#125;, <span class="number">3000</span>)</span><br><span class="line">    <span class="comment">// reject(&#x27;err&#x27;)</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// 3ç§’åæ‰“å° 1111</span></span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡, å¹¶ä¸”è¯¥å¯¹è±¡å®ç°äº†thenæ–¹æ³•</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">then</span>: <span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="number">2222</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res) <span class="comment">// 222</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>å…¶å®ä¸€æ ·çš„ï¼Œæ—¢ç„¶thenè¿”å›ä¸€ä¸ªpromiseï¼Œé‚£å°±è·Ÿå‰é¢ä¸€æ ·çš„å¤„ç†ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç»§ç»­é“¾å¼è°ƒç”¨thenå»å¤„ç†ï¼Œè‡ªå·±å¤šå°è¯•å„ç§æƒ…å†µçœ‹çœ‹å°±éƒ½å¯ä»¥ç†è§£äº†</p></blockquote><h4 id="catchæ–¹æ³•">catchæ–¹æ³•</h4><p>catchæ–¹æ³•ä¹Ÿæ˜¯Promiseå¯¹è±¡ä¸Šçš„ä¸€ä¸ªæ–¹æ³•ï¼šå®ƒä¹Ÿæ˜¯æ”¾åœ¨Promiseçš„åŸå‹ä¸Šçš„ Promise.prototype.catch()</p><ul><li>catchæ–¹æ³•ä¼ å…¥é”™è¯¯ï¼ˆæ‹’ç»ï¼‰æ•è·çš„å›è°ƒå‡½æ•°</li><li>catchä¹Ÿå¯ä»¥å¤šæ¬¡è°ƒç”¨</li><li>æˆ‘ä»¬å¯ä»¥æŠŠcatchæ–¹æ³•ç†è§£ä¸º then æ–¹æ³•çš„è¯­æ³•ç³–</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">reject</span>(<span class="string">&quot;reject message&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»·äº</span></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="literal">undefined</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„ä¸‹é¢ä¸¤ç§æƒ…å†µï¼Œcatchçš„å¤„ç†</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">reject</span>(<span class="string">&quot;err message&quot;</span>) </span><br><span class="line">    <span class="comment">// å¦‚æœè¿™é‡Œè°ƒç”¨reject,ä¹Ÿå°±æ˜¯è¿™ä¸ªpromiseçš„çŠ¶æ€æ˜¯rejected</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&quot;reject2 message&quot;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err); <span class="comment">// err message</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;aaa&quot;</span>) <span class="comment">// å¦‚æœè¿™é‡Œè°ƒç”¨resolve,fulfilledçŠ¶æ€</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;   <span class="comment">// å…ˆè°ƒç”¨ then çš„ç¬¬ä¸€ä¸ªå›è°ƒ</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&quot;reject2 message&quot;</span>)  </span><br><span class="line">      <span class="comment">// thenè¿”å›çš„promiseçš„çŠ¶æ€æ˜¯rejected</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err); <span class="comment">// reject2 message   catchå¯ä»¥æ•è·åˆ°</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¯´catchä¼šå¤„ç†é¦–æ¬¡å‡ºç°æ‹’ç»çŠ¶æ€çš„Promise</p><ul><li>catchæ–¹æ³•ä¹Ÿæ˜¯ä¼šè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡çš„ï¼Œæ‰€ä»¥catchæ–¹æ³•åé¢æˆ‘ä»¬å¯ä»¥ç»§ç»­è°ƒç”¨thenæ–¹æ³•æˆ–è€…catchæ–¹æ³•</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">reject</span>(<span class="string">&quot;111&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);  <span class="comment">// &quot;111&quot;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;222&quot;</span>  <span class="comment">// è¿™ä¸ªcatchè¿”å›çš„promiseçš„çŠ¶æ€ä¸º fulfilled</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// 222</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="finallyæ–¹æ³•">finallyæ–¹æ³•</h4><p>finallyæ˜¯åœ¨ES9ï¼ˆES2018ï¼‰ä¸­æ–°å¢çš„ä¸€ä¸ªç‰¹æ€§ï¼šæ— è®ºPromiseå¯¹è±¡å˜æˆfulfilledè¿˜æ˜¯rejectçŠ¶æ€ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥finallyä¹Ÿä¸éœ€è¦æ¥æ”¶å‚æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err); </span><br><span class="line">&#125;).<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finally&quot;</span>); <span class="comment">// &quot;finally&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>finally ä¹Ÿä¼šè¿”å›ä¸€ä¸ªpromiseï¼Œä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šç»§ç»­å†åé¢åšå¤„ç†äº†</p></blockquote><h3 id="Promiseç±»æ–¹æ³•">Promiseç±»æ–¹æ³•</h3><blockquote><p>ä¹Ÿå°±æ˜¯ç›´æ¥é€šè¿‡Promiseè°ƒç”¨çš„æ–¹æ³•ï¼Œä¸éœ€è¦åˆ›å»ºå®ä¾‹</p></blockquote><h4 id="Promise-resolve">Promise.resolve</h4><p>ç›´æ¥æŠŠæŸä¸ªå†…å®¹è½¬æˆPromiseæ¥ä½¿ç”¨</p><p>Promise.resolveçš„ç”¨æ³•ç›¸å½“äºnew Promiseï¼Œå¹¶ä¸”æ‰§è¡Œresolveæ“ä½œ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>resolveçš„å‚æ•°è·Ÿå‰é¢ä¸€æ ·çš„ä¸‰ç§ï¼Œæ™®é€šçš„å€¼ï¼ŒPromiseï¼Œæœ‰thenæ–¹æ³•çš„obj</p><h4 id="Promise-reject">Promise.reject</h4><p>ä¼šå°†Promiseå¯¹è±¡çš„çŠ¶æ€è®¾ç½®ä¸ºrejectçŠ¶æ€</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">reject</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šPromise.rejectæ— è®ºä¼ å…¥çš„å‚æ•°æ˜¯ä»€ä¹ˆå½¢æ€ï¼Œéƒ½æ˜¯ä¼šç›´æ¥ä½œä¸ºrejectçŠ¶æ€çš„å‚æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;123&quot;</span>)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res:&quot;</span>, res)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err:&quot;</span>, err) <span class="comment">// err: PromiseÂ &#123;&lt;fulfilled&gt;: &#x27;123&#x27;&#125;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Promise-all">Promise.all</h4><p>å°†å¤šä¸ªPromiseåŒ…è£¹åœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªæ–°çš„Promiseï¼Œæ–°çš„PromiseçŠ¶æ€ç”±åŒ…è£¹çš„æ‰€æœ‰Promiseå…±åŒå†³å®šï¼š</p><ul><li><p>å½“æ‰€æœ‰çš„PromiseçŠ¶æ€å˜æˆ fulfilled çŠ¶æ€æ—¶ï¼Œæ–°çš„PromiseçŠ¶æ€ä¸ºfulfilledï¼Œå¹¶ä¸”ä¼šå°†æ‰€æœ‰Promiseçš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">111</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">222</span>)</span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">333</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([p1, p2, p3]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// [ 111, 222, 333 ]</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>å½“æœ‰ä¸€ä¸ªPromiseçŠ¶æ€ä¸ºrejectæ—¶ï¼Œæ–°çš„PromiseçŠ¶æ€ä¸ºrejectï¼Œå¹¶ä¸”ä¼šå°†ç¬¬ä¸€ä¸ªrejectçš„è¿”å›å€¼ä½œä¸ºå‚æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="number">222</span>)</span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([p1, p2, p3]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); </span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err); <span class="comment">// 222</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h4 id="Promise-allSettled-2">Promise.allSettled</h4><p>ES11ï¼ˆES2022ï¼‰æ–°å¢</p><p>è¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰çš„Promiseéƒ½æœ‰ç»“æœï¼ˆæ— è®ºæ˜¯fulfilledè¿˜æ˜¯rejectï¼‰åæ‰ä¼šæœ‰æœ€ç»ˆçš„çŠ¶æ€ï¼Œå¹¶ä¸”è¿”å›çš„Promiseçš„çŠ¶æ€ä¸€å®šæ˜¯fulfilled</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">111</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="number">222</span>)</span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">333</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">allSettled</span>([p1, p2, p3]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res:&quot;</span>, res); <span class="comment">// æ‰§è¡Œçš„æ˜¯è¿™é‡Œ</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err:&quot;</span>, err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a3fc81e9e0645de87394ad13d3bc9cd~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>æ‰“å°çš„ç»“æœæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾æ¯ä¸€ä¸ªPromiseçš„ç»“æœ</p><p>statusï¼šçŠ¶æ€ï¼Œvalueï¼šå€¼</p><h4 id="Promise-race">Promise.race</h4><blockquote><p>raceï¼šç«èµ›ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥ç†è§£ä¸ºPromiseçš„ç«èµ›</p></blockquote><p>åªè¦æœ‰ä¸€ä¸ªPromiseå˜æˆfulfilledçŠ¶æ€, é‚£ä¹ˆå°±ç»“æŸï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªpromiseçš„ç»“æœ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">111</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="number">222</span>)</span><br><span class="line">  &#125;, <span class="number">500</span>)  <span class="comment">// å…ˆæ‰§è¡Œå®Œ</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">333</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([p1, p2, p3]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res:&quot;</span>, res); </span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err:&quot;</span>, err); <span class="comment">// err: 222</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Promise-any">Promise.any</h4><p>ES12æ–°å¢ï¼Œå’Œraceæ–¹æ³•ç±»ä¼¼</p><p>anyæ–¹æ³•ä¼šç­‰åˆ°ç¬¬ä¸€ä¸ªfulfilledçŠ¶æ€ï¼Œæ‰ä¼šå†³å®šæ–°Promiseçš„çŠ¶æ€</p><p>å¦‚æœæ‰€æœ‰çš„Promiseéƒ½æ˜¯rejectçš„ï¼Œé‚£ä¹ˆä¼šæŠ¥ä¸€ä¸ªAggregateErrorçš„é”™è¯¯</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="number">111</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="number">222</span>)</span><br><span class="line">  &#125;, <span class="number">2000</span>)  </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">any</span>([p1, p2]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res:&quot;</span>, res); </span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err:&quot;</span>, err); <span class="comment">// err: 222</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">// err: AggregateError: All promises were rejected</span></span><br><span class="line"><span class="comment">// err.errorså¯ä»¥æ‹¿åˆ°å…¨éƒ¨é”™è¯¯ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> promise </tag>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•é¢˜â€”JSç¯‡ä¹‹ä»£ç è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆ</title>
      <link href="/2022/04/15/%E9%9D%A2%E8%AF%95%E9%A2%98%E2%80%94JS%E7%AF%87%E4%B9%8B%E4%BB%A3%E7%A0%81%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E6%98%AF%E4%BB%80%E4%B9%88/"/>
      <url>/2022/04/15/%E9%9D%A2%E8%AF%95%E9%A2%98%E2%80%94JS%E7%AF%87%E4%B9%8B%E4%BB%A3%E7%A0%81%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E6%98%AF%E4%BB%80%E4%B9%88/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŒ…å«ç±»å‹åˆ¤æ–­ã€ä½œç”¨åŸŸã€thisæŒ‡å‘ã€åŸå‹ã€äº‹ä»¶å¾ªç¯ç­‰çŸ¥è¯†ç‚¹</p></blockquote><h1>è¯·é—®ä¸‹é¢çš„ä»£ç è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</h1><h2 id="ç¬¬1é¢˜">ç¬¬1é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">b</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  a = <span class="number">2</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">b</span>(a)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š2  1</p></blockquote><h2 id="ç¬¬2é¢˜">ç¬¬2é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span> (b = c, c = <span class="number">1</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(b, c)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">a</span>()</span><br></pre></td></tr></table></figure><blockquote><p>æŠ¥é”™ï¼šCannot access â€˜câ€™ before initialization</p></blockquote><h2 id="ç¬¬3é¢˜">ç¬¬3é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = b = <span class="number">10</span></span><br><span class="line">;(<span class="keyword">function</span>(<span class="params"></span>)&#123; </span><br><span class="line">  <span class="keyword">let</span> a = b = <span class="number">20</span> </span><br><span class="line">&#125;)()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š10ã€20</p></blockquote><h2 id="ç¬¬4é¢˜">ç¬¬4é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="attr">n</span>:<span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">var</span> b = a</span><br><span class="line">a.<span class="property">x</span> = a = &#123;<span class="attr">n</span>:<span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">x</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b.<span class="property">x</span>)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼šundefinedã€{n: 2}</p></blockquote><h2 id="ç¬¬5é¢˜">ç¬¬5é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">arr[<span class="number">10</span>] = <span class="number">10</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x === <span class="literal">undefined</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š[ ]</p></blockquote><h2 id="ç¬¬6é¢˜">ç¬¬6é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;World&#x27;</span></span><br><span class="line">;(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">&quot;Jack&quot;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Goodbye &#x27;</span> + name)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Hello &#x27;</span> + name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼šGoodbye Jack</p></blockquote><h2 id="ç¬¬7é¢˜">ç¬¬7é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> + <span class="title class_">NaN</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;1&quot;</span> + <span class="number">3</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> + <span class="literal">undefined</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> + <span class="literal">null</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> + &#123;&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> + [])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] + &#123;&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼šNaNã€13ã€NaNã€1ã€1[object Object]ã€1ã€[object Object]</p></blockquote><h2 id="ç¬¬8é¢˜">ç¬¬8é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a=&#123;&#125;,</span><br><span class="line">    b=&#123;<span class="attr">key</span>:<span class="string">&#x27;b&#x27;</span>&#125;,</span><br><span class="line">    c=&#123;<span class="attr">key</span>:<span class="string">&#x27;c&#x27;</span>&#125;</span><br><span class="line">a[b]=<span class="number">123</span></span><br><span class="line">a[c]=<span class="number">456</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a[b])</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š456</p></blockquote><h2 id="ç¬¬9é¢˜">ç¬¬9é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> out = <span class="number">25</span></span><br><span class="line"><span class="keyword">var</span> inner = &#123;</span><br><span class="line">  <span class="attr">out</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">func</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> out = <span class="number">30</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">out</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((inner.<span class="property">func</span>, inner.<span class="property">func</span>)())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(inner.<span class="title function_">func</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((inner.<span class="property">func</span>)())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((inner.<span class="property">func</span> = inner.<span class="property">func</span>)())</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š25ã€20ã€20ã€25</p></blockquote><h2 id="ç¬¬10é¢˜">ç¬¬10é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;a,b,c&#125; = &#123; <span class="attr">c</span>:<span class="number">3</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">a</span>:<span class="number">1</span> &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, c)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š1ã€2ã€3</p></blockquote><h2 id="ç¬¬11é¢˜">ç¬¬11é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>]))</span><br></pre></td></tr></table></figure><blockquote><p>[4, 5, 3]</p></blockquote><h2 id="ç¬¬12é¢˜">ç¬¬12é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x=<span class="number">1</span></span><br><span class="line"><span class="keyword">switch</span>(x++)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">0</span>: ++x</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>: ++x</span><br><span class="line">  <span class="keyword">case</span> <span class="number">2</span>: ++x</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š4</p></blockquote><h2 id="ç¬¬13é¢˜">ç¬¬13é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">undefined</span> == <span class="keyword">typeof</span> <span class="variable constant_">NULL</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125; == <span class="keyword">typeof</span> <span class="keyword">class</span> &#123;&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼štrueã€true</p></blockquote><h2 id="ç¬¬14é¢˜">ç¬¬14é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> count === <span class="string">&quot;number&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(!!<span class="keyword">typeof</span> count === <span class="string">&quot;number&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼štrueã€false</p></blockquote><h2 id="ç¬¬15é¢˜">ç¬¬15é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">a</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š2ã€2</p></blockquote><h2 id="ç¬¬16é¢˜">ç¬¬16é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">2</span></span><br><span class="line">  <span class="title function_">b</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">a</span>()</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š1</p></blockquote><h2 id="ç¬¬17é¢˜">ç¬¬17é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;abc&#x27;</span>,</span><br><span class="line">  <span class="attr">fn</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;bcd&#x27;</span></span><br><span class="line">obj.<span class="title function_">fn</span>()</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼šundefined</p></blockquote><h2 id="ç¬¬18é¢˜">ç¬¬18é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">a</span>: &#123;</span><br><span class="line">    <span class="attr">b</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(obj, obj1))</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š{a: {b: 1}}</p></blockquote><h2 id="ç¬¬19é¢˜">ç¬¬19é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> getNum = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  a = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getNum</span>(<span class="params"></span>) &#123;</span><br><span class="line">  a = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line"><span class="title function_">getNum</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼šundefinedã€1ã€2</p></blockquote><h2 id="ç¬¬20é¢˜">ç¬¬20é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> scope = <span class="string">&#x27;global scope&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>)&#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(scope)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> b</span><br><span class="line">  <span class="keyword">var</span> scope = <span class="string">&#x27;local scope&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">a</span>()()</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼šundefined</p></blockquote><h2 id="ç¬¬21é¢˜">ç¬¬21é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span> ()&#123; </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> arr = [fn]</span><br><span class="line">arr[<span class="number">0</span>]()</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼šæ‰“å°å‡ºarræ•°ç»„æœ¬èº«</p></blockquote><h2 id="ç¬¬22é¢˜">ç¬¬22é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> b</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š1ã€bå‡½æ•°æœ¬èº«ã€bå‡½æ•°æœ¬èº«</p></blockquote><h2 id="ç¬¬23é¢˜">ç¬¬23é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    getName = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> getName = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯·å†™å‡ºä»¥ä¸‹è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="title class_">Foo</span>.<span class="title function_">getName</span>()</span><br><span class="line"><span class="title function_">getName</span>()</span><br><span class="line"><span class="title class_">Foo</span>().<span class="title function_">getName</span>()</span><br><span class="line"><span class="title function_">getName</span>()</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Foo</span>.<span class="title function_">getName</span>()</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Foo</span>().<span class="title function_">getName</span>()</span><br><span class="line"><span class="keyword">new</span> <span class="keyword">new</span> <span class="title class_">Foo</span>().<span class="title function_">getName</span>()</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š2ã€4ã€1ã€1ã€2ã€3ã€3</p></blockquote><h2 id="ç¬¬24é¢˜">ç¬¬24é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line"> <span class="attr">address</span>: &#123;</span><br><span class="line">  <span class="attr">country</span>:<span class="string">&quot;china&quot;</span>,</span><br><span class="line">  <span class="attr">city</span>:<span class="string">&quot;hangzhou&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">say</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`it&#x27;s <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>, from <span class="subst">$&#123;<span class="variable language_">this</span>.address.country&#125;</span>`</span>)</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">setCountry</span>:<span class="keyword">function</span> (<span class="params">country</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">address</span>.<span class="property">country</span>=country</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="title class_">Object</span>.<span class="title function_">create</span>(person)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="title class_">Object</span>.<span class="title function_">create</span>(person)</span><br><span class="line"></span><br><span class="line">p1.<span class="property">name</span> = <span class="string">&quot;Matthew&quot;</span></span><br><span class="line">p1.<span class="title function_">setCountry</span>(<span class="string">&quot;American&quot;</span>)</span><br><span class="line"></span><br><span class="line">p2.<span class="property">name</span> = <span class="string">&quot;Bob&quot;</span></span><br><span class="line">p2.<span class="title function_">setCountry</span>(<span class="string">&quot;England&quot;</span>)</span><br><span class="line"></span><br><span class="line">p1.<span class="title function_">say</span>()</span><br><span class="line">p2.<span class="title function_">say</span>()</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼šitâ€™s Matthew, from England</p><p>itâ€™s Bob, from England</p></blockquote><h2 id="ç¬¬25é¢˜">ç¬¬25é¢˜</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">var</span> i=<span class="number">0</span> ; i&lt;<span class="number">10000</span> ; i++ ) &#123;</span><br><span class="line">    i == <span class="number">9999</span> &amp;&amp; <span class="title function_">resolve</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š2ã€3ã€5ã€4ã€1</p></blockquote><h2 id="ç¬¬26é¢˜">ç¬¬26é¢˜</h2><p>æ³¨ï¼šprocessæ˜¯Node.jsæä¾›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä»£è¡¨å½“å‰Node.jsè¿›ç¨‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">  process.<span class="title function_">nextTick</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4&#x27;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>();</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;5&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line">process.<span class="title function_">nextTick</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;6&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;7&#x27;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>();</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;8&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;9&#x27;</span>);</span><br><span class="line">  process.<span class="title function_">nextTick</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;10&#x27;</span>);</span><br><span class="line">  &#125;) </span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;11&#x27;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>();</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;12&#x27;</span>)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆï¼š1ã€7ã€6ã€8ã€2ã€4ã€3ã€5ã€9ã€11ã€10ã€12</p></blockquote><blockquote><p>1-26 æ¥æºï¼š<a href="https://mp.weixin.qq.com/s/fks9SuTSY0ivUfPn6G-TOw">https://mp.weixin.qq.com/s/fks9SuTSY0ivUfPn6G-TOw</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ğŸ˜£é¢è¯•é¢˜-jsç¯‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ TypeScript</title>
      <link href="/2022/04/15/%E5%AD%A6%E4%B9%A0TypeScript/"/>
      <url>/2022/04/15/%E5%AD%A6%E4%B9%A0TypeScript/</url>
      
        <content type="html"><![CDATA[<h2 id="TypeScriptåˆè¯†">TypeScriptåˆè¯†</h2><blockquote><p>JavaScriptæ²¡æœ‰ç±»å‹æ£€æµ‹ï¼Œè¿™ä¼šè®©æˆ‘ä»¬çš„ä»£ç ä¸å®‰å…¨ï¼ŒTSå¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜</p></blockquote><h3 id="TSç®€ä»‹">TSç®€ä»‹</h3><p>Typescriptæ˜¯æ‹¥æœ‰ç±»å‹çš„JavaScriptè¶…é›†</p><p>JavaScriptæ‰€æ‹¥æœ‰çš„ç‰¹æ€§ï¼ŒTSå…¨éƒ¨éƒ½æ”¯æŒï¼Œå¹¶ä¸”åœ¨è¯­è¨€å±‚é¢ä¸Šæ·»åŠ äº†ç±»å‹çº¦æŸï¼Œè¿˜åŠ ä¸Šä¸€äº›è¯­æ³•çš„æ‰©å±•</p><h3 id="TSçš„ç¼–è¯‘ç¯å¢ƒ">TSçš„ç¼–è¯‘ç¯å¢ƒ</h3><p>TSæœ€ç»ˆè¿˜æ˜¯ä¼šè¢«ç¼–è¯‘æˆJSä»£ç è¿è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ­å»ºå¯¹åº”çš„ç¯å¢ƒ</p><p>åœ¨ç”µè„‘ä¸Šå®‰è£…Typescriptï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡TypeScriptçš„Compilerå°†å…¶ç¼–è¯‘æˆJavaScript</p><p>å…¨å±€å®‰è£…ï¼š<code>npm install typescript -g</code></p><p>æŸ¥çœ‹ç‰ˆæœ¬ï¼š<code>tsc --version</code></p><h3 id="TSçš„è¿è¡Œç¯å¢ƒ">TSçš„è¿è¡Œç¯å¢ƒ</h3><p>è¿è¡Œçš„ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li><code>tsc xxx.ts</code> æŠŠtsæ–‡ä»¶ç¼–è¯‘æˆJSä»£ç </li><li>åœ¨æµè§ˆå™¨æˆ–Nodeç¯å¢ƒä¸‹è¿è¡ŒJSä»£ç </li></ol><p>å¦‚æœæ¯æ¬¡éƒ½è¦åšè¿™ä¸¤ä¸ªæ­¥éª¤ï¼Œé‚£å°±å¤ªéº»çƒ¦äº†</p><p>æœ‰ä»€ä¹ˆç®€åŒ–çš„æ–¹å¼å‘¢ï¼Ÿ</p><p>ç¬¬ä¸€ç§ï¼šé€šè¿‡webpackï¼Œé…ç½®æœ¬åœ°çš„TSç¼–è¯‘ç¯å¢ƒå’Œå¼€å¯ä¸€ä¸ªæœ¬åœ°æœåŠ¡ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸Š</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f81ce51bbcd4d06b0e99f3148f0056f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:60%;" /><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d656d7ffb32e46f4b65292186998a1cf~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>ç¬¬äºŒç§ï¼šé€šè¿‡ts-nodeåº“ï¼Œä¸ºTSçš„è¿è¡Œæä¾›æ‰§è¡Œç¯å¢ƒ</p><ul><li><p>å®‰è£… ts-nodeï¼š<code>npm install ts-node -g</code></p></li><li><p>å¦å¤– ts-nodeéœ€è¦å®‰è£…ä¾èµ– tslib å’Œ @types/node ä¸¤ä¸ªåŒ…</p><p><code>npm install tslib @types/node -g</code></p></li><li><p>ç„¶åå¯ä»¥ç›´æ¥é€šè¿‡ ts-node æ¥è¿è¡Œ TS çš„ä»£ç ï¼š</p><p><code>ts-node xxx.ts</code></p></li></ul><h2 id="å˜é‡çš„å£°æ˜">å˜é‡çš„å£°æ˜</h2><ul><li><p>å®šä¹‰çš„æ—¶å€™ç»™æ ‡è¯†ç¬¦åŠ ç±»å‹ï¼š  var/let/const æ ‡è¯†ç¬¦: æ•°æ®ç±»å‹ = èµ‹å€¼</p><p>ä½†æ˜¯ var ä¸æ¨èä½¿ç”¨</p><p>å¦å¤–æ³¨æ„ string å’Œ String çš„åŒºåˆ«</p><p>stringæ˜¯TypeScriptä¸­å®šä¹‰çš„å­—ç¬¦ä¸²ç±»å‹ï¼ŒStringæ˜¯ECMAScriptä¸­å®šä¹‰çš„ä¸€ä¸ªåŒ…è£…ç±»</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">message</span>: string = <span class="string">&quot;abc&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(message);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">name</span>: string = <span class="string">&#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>ç±»å‹æ¨æ–­ï¼ˆæ¨å¯¼ï¼‰ï¼Œå°±æ˜¯è¯´æˆ‘ä»¬ç¬¬ä¸€æ¬¡ç»™å˜é‡èµ‹å€¼çš„æ—¶å€™ï¼Œä¼šæ ¹æ®è¿™ä¸ªèµ‹å€¼çš„å†…å®¹ï¼Œè‡ªåŠ¨æ¨æ–­å˜é‡çš„ç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="number">2</span> <span class="comment">// è‡ªåŠ¨ç±»å‹æ¨æ–­ä¸ºnumberç±»å‹</span></span><br><span class="line">num = <span class="string">&quot;123&quot;</span>  <span class="comment">// æŠ¥é”™</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p>æ¨èï¼šå¦‚æœå¯ä»¥è‡ªåŠ¨æ¨å¯¼å‡ºå˜é‡çš„ç±»å‹çš„æ—¶å€™ï¼Œä¸åŠ ç±»å‹</p><p>ä¸ç¡®å®šç±»å‹çš„æ—¶å€™ï¼Œè¦è‡ªå·±åŠ ä¸Šç±»å‹</p></blockquote><h2 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</h2><p>æˆ‘ä»¬å¸¸è¯´TSæ˜¯JSçš„ä¸€ä¸ªè¶…é›†</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4cbda679e37349e98f0c39d0213cfef9~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h3 id="JSç±»å‹">JSç±»å‹</h3><blockquote><p>TSå’ŒJSéƒ½æœ‰çš„æ•°æ®ç±»å‹</p></blockquote><ol><li><strong>numberç±»å‹</strong></li></ol><p>TS å’Œ JSä¸€æ ·</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">num</span>: number = <span class="number">123</span></span><br><span class="line">num = <span class="number">222</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// num = &quot;123&quot; // æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TS ä¹Ÿæ”¯æŒè¿›åˆ¶</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num1</span>: number = <span class="number">100</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num2</span>: number = <span class="number">0b100</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num3</span>: number = <span class="number">0o100</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num4</span>: number = <span class="number">0x100</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num1, num2, num3, num4); <span class="comment">// 100 4 64 256</span></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>booleanç±»å‹</strong></li></ol><p>trueã€false</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">flag</span>: boolean = truelet <span class="attr">flag</span>: boolean = <span class="literal">true</span></span><br><span class="line">flag = <span class="literal">false</span></span><br><span class="line">flag = <span class="number">20</span> &gt; <span class="number">30</span></span><br></pre></td></tr></table></figure><ol start="3"><li><strong>stringç±»å‹</strong></li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">message</span>: string = <span class="string">&quot;hello&quot;</span></span><br><span class="line">message = <span class="string">&#x27;hello ts&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒæ ·ä¹Ÿæ”¯æŒES6çš„æ¨¡æ¿å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">const</span> info = <span class="string">`hi <span class="subst">$&#123;message&#125;</span>`</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info); <span class="comment">// hi hello ts</span></span><br></pre></td></tr></table></figure><ol start="4"><li><strong>Arrayç±»å‹</strong></li></ol><p>å›ºå®šæ•°ç»„é‡Œé¢å­˜æ”¾çš„æ•°æ®ç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">name1</span>: string[] = [] <span class="comment">// æ¨è</span></span><br><span class="line"><span class="comment">// name1.push(1) // æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">name2</span>: <span class="title class_">Array</span>&lt;string&gt; = [] <span class="comment">// ä¸æ¨è(react jsxä¸­æ˜¯æœ‰å†²çª)   </span></span><br></pre></td></tr></table></figure><ol start="5"><li><strong>Objectç±»å‹</strong></li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">info</span>:object = &#123;  <span class="comment">// åœ¨è¿™é‡Œè®¾ç½®äº†objectç±»å‹</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">info[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;kkk&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info[<span class="string">&quot;age&quot;</span>]);</span><br></pre></td></tr></table></figure><p>è®¾ç½®äº†objectç±»å‹ä¸èƒ½è·å–æ•°æ®ä¹Ÿä¸èƒ½è®¾ç½®æ•°æ®<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/688374ddd57d49b89dd0ebe6506e3ec1~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /></p><p>å¦‚æœå»æ‰äº†:objectå°±å¯ä»¥è·å–ï¼Œå¹¶ä¸”é‡Œé¢çš„å±æ€§ç±»å‹ä¹Ÿæœ‰æ¨æ–­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> info = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">info[<span class="string">&quot;name&quot;</span>] = <span class="number">123</span> <span class="comment">// æŠ¥é”™</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info[<span class="string">&quot;age&quot;</span>]) <span class="comment">// 18</span></span><br></pre></td></tr></table></figure><ol start="6"><li><strong>Symbolç±»å‹</strong></li></ol><blockquote><p>è·Ÿ JS ä¸€æ ·ï¼Œä¸»è¦ç”¨äºè®¾ç½®å”¯ä¸€å±æ€§å</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">title1</span>: symbol = <span class="title class_">Symbol</span>(<span class="string">&quot;title&quot;</span>)</span><br><span class="line"><span class="comment">// title1 = 2 // numberèµ‹å€¼ç»™symbolç±»å‹,æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> title2 = <span class="title class_">Symbol</span>(<span class="string">&quot;title&quot;</span>) <span class="comment">// æ¨æ–­</span></span><br><span class="line"><span class="keyword">const</span> info = &#123;</span><br><span class="line">  [title1]: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">  [title2]: <span class="string">&quot;kkk&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="7"><li><strong>Null å’Œ Undefinedç±»å‹</strong></li></ol><p>nullï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">n1</span>: <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line">n1 = <span class="number">123</span> <span class="comment">// number -&gt; null æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> n2 = <span class="literal">null</span>  <span class="comment">// æ¨æ–­æ˜¯ anyç±»å‹</span></span><br><span class="line">n2 = <span class="number">123</span> <span class="comment">// ä¸æŠ¥é”™</span></span><br></pre></td></tr></table></figure><p>åŒç†ï¼šundefinedï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">n3</span>: <span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line">n3 = <span class="number">123</span> <span class="comment">// æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> n4 = <span class="literal">undefined</span></span><br><span class="line">n4 = <span class="number">123</span></span><br></pre></td></tr></table></figure><h2 id="TypeScriptç±»å‹">TypeScriptç±»å‹</h2><h3 id="anyç±»å‹">anyç±»å‹</h3><p>anyè¡¨ç¤ºä»»æ„ç±»å‹</p><p>åœ¨ä¸ç¡®å®šå˜é‡ç±»å‹çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨anyç±»å‹ï¼Œä½†æ˜¯ä¸€æ—¦ä½¿ç”¨äº†ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¯¹anyç±»å‹çš„å˜é‡è¿›è¡Œä»»ä½•çš„æ“ä½œï¼ŒåŒ…æ‹¬èµ‹å€¼ä»»ä½•ç±»å‹çš„å€¼ï¼›è·å–ä¸å­˜åœ¨çš„å±æ€§ã€æ–¹æ³•</p><p>éå¸¸ä¸å®‰å…¨ï¼Œä¸æ¨èä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">message</span>: any = <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line">message = <span class="number">123</span></span><br><span class="line">message = <span class="literal">true</span></span><br><span class="line">message = &#123;&#125;</span><br><span class="line"></span><br><span class="line">message.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="unknownç±»å‹">unknownç±»å‹</h3><p>ç”¨äºæè¿°ç±»å‹ä¸ç¡®å®šçš„å˜é‡</p><p>unknownç±»å‹åªèƒ½èµ‹å€¼ç»™anyå’Œunknownç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;abc&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> flag = <span class="literal">true</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">result</span>: unknown  <span class="comment">// å¦‚æœä½¿ç”¨anyå°±ä¸ä¼šæŠ¥é”™äº†</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line">  result = <span class="title function_">foo</span>()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  result = <span class="title function_">bar</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¿å…æ‹¿åˆ°ç»“æœä¹‹åä¹±ç”¨</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">message</span>: string = result </span><br><span class="line"><span class="comment">// ä¸èƒ½å°†ç±»å‹â€œunknownâ€åˆ†é…ç»™ç±»å‹â€œstringâ€</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br></pre></td></tr></table></figure><h3 id="voidç±»å‹">voidç±»å‹</h3><p>voidé€šå¸¸æ¥æŒ‡å®šä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›å€¼çš„ï¼Œé‚£ä¹ˆå®ƒçš„è¿”å›å€¼å°±æ˜¯voidç±»å‹</p><p>å¦å¤–ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥è¿”å› nullï¼Œundefined</p><blockquote><p>ä¸€èˆ¬éƒ½ä¸å†™çš„ï¼Œå› ä¸ºæ²¡æœ‰è¿”å›å€¼é»˜è®¤æ¨æ–­å°±æ˜¯void</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">num1: number, num2: number</span>): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(num1 + num2);         <span class="comment">// è¿™é‡Œå†™ä¸å†™voidéƒ½ä¸€æ ·çš„</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">sum</span>(<span class="number">20</span>, <span class="number">30</span>)</span><br></pre></td></tr></table></figure><h3 id="neverç±»å‹">neverç±»å‹</h3><p>è¡¨ç¤ºæ°¸è¿œä¸ä¼šå‘ç”Ÿå€¼çš„ç±»å‹</p><blockquote><p>neverè¡¨ç¤ºå‡½æ•°ç”¨äºæ‰§è¡Œä¸åˆ°è¿”å›å€¼é‚£ä¸€æ­¥ï¼ˆæŠ›å‡ºå¼‚å¸¸æˆ–æ­»å¾ªç¯ï¼‰çš„è¿”å›å€¼ç±»å‹</p><p>è€Œvoidæ˜¯å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œå¯ä»¥è¿”å›nullï¼Œundefined</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// æ­»å¾ªç¯</span></span><br><span class="line">  <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>() <span class="comment">// æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>never æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// function handleMessage(message: string | number ) &#123;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleMessage</span>(<span class="params">message: string | number | boolean </span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (<span class="keyword">typeof</span> message) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;string&#x27;</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;stringæ–¹å¼å¤„ç†message&#x27;</span>);</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;number&#x27;</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;numberæ–¹å¼å¤„ç†message&#x27;</span>);</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;boolean&#x27;</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;booleanæ–¹å¼å¤„ç†message&#x27;</span>);</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="attr">default</span>: </span><br><span class="line">      <span class="comment">// é»˜è®¤ä¸ä¼šæ‰§è¡Œåˆ°è¿”å›å€¼é‚£ä¸€æ­¥,æ‰€ä»¥å¦‚æœä½ æ²¡æœ‰å¯¹åº”çš„å¤„ç†é€»è¾‘,å°±ä¼šæŠ¥é”™</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">check</span>: never = message</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">handleMessage</span>(<span class="string">&quot;abc&quot;</span>)</span><br><span class="line"><span class="title function_">handleMessage</span>(<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ—¶å€™æœ‰äººæƒ³è¦ä¼ å…¥ booleanç±»å‹</span></span><br><span class="line"><span class="title function_">handleMessage</span>(<span class="literal">true</span>)</span><br><span class="line"><span class="comment">// ä½†å‘ç°æŠ¥é”™äº†, ç„¶åå°±ç»™å‡½æ•°å‚æ•°åŠ ä¸Šbooleanç±»å‹</span></span><br><span class="line"><span class="comment">// ç„¶åå°±ä¸æŠ¥é”™äº†,ä½†æ˜¯å‡½æ•°é‡Œé¢å¹¶æ²¡æœ‰å¤„ç†booleanå‚æ•°çš„é€»è¾‘,ä»–å¹¶ä¸çŸ¥é“</span></span><br><span class="line"><span class="comment">// å¦‚æœ, åŠ ä¸Šdefaulté‚£ä¸€æ®µ,å°±ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">// è¿™æ—¶å€™è¿™ä¸ªäººå°±çŸ¥é“é‡Œé¢éœ€è¦æœ‰booleançš„å¤„ç†é€»è¾‘,ç„¶åå°±å»åŠ ä¸Š</span></span><br></pre></td></tr></table></figure><h3 id="tupleç±»å‹">tupleç±»å‹</h3><p>tuple æ˜¯<strong>å…ƒç»„</strong>ç±»å‹ï¼Œå…ƒç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½æœ‰è‡ªå·±ç‰¹å®šçš„ç±»å‹ï¼Œæ ¹æ®ç´¢å¼•å€¼è·å–åˆ°çš„å€¼å¯ä»¥ç¡®å®šå¯¹åº”çš„ç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">info</span>: [string, number, number] = [<span class="string">&quot;xxx&quot;</span>, <span class="number">18</span>, <span class="number">1.88</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> name = info[<span class="number">0</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name.<span class="property">length</span>); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><blockquote><p>è€Œæ•°ç»„é€šå¸¸å»ºè®®å­˜æ”¾ç›¸åŒç±»å‹çš„å€¼</p></blockquote><p>tupleåº”ç”¨åœºæ™¯</p><p>tupleé€šå¸¸å¯ä»¥ä½œä¸ºè¿”å›çš„å€¼ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ä¼šéå¸¸çš„æ–¹ä¾¿</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> useState&lt;T&gt;(<span class="attr">state</span>: T) &#123;</span><br><span class="line">  <span class="keyword">let</span> currentState = state</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">changeState</span> = (<span class="params">newState: T</span>) =&gt; &#123;</span><br><span class="line">    currentState = newState</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">info</span>: [string, number] = [<span class="string">&#x27;xxx&#x27;</span>, <span class="number">18</span>]</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">tuple</span>: [T, <span class="function">(<span class="params">newState: T</span>) =&gt;</span> <span class="keyword">void</span>] = [currentState, changeState]</span><br><span class="line">  <span class="keyword">return</span> tuple</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [counter, setCounter] = <span class="title function_">useState</span>(<span class="number">10</span>)</span><br><span class="line"><span class="title function_">setCounter</span>(<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">const</span> [title, setTitle] = <span class="title function_">useState</span>(<span class="string">&quot;abc&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> [flag, setFlag] = <span class="title function_">useState</span>(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹">å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸€èˆ¬å¯ä»¥ä¸å†™è¿”å›å€¼çš„ç±»å‹ï¼Œä¼šè‡ªåŠ¨æ¨æ–­</span></span><br><span class="line"><span class="comment">// function sum(num1: number, num2: number): number &#123;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">num1: number, num2: number</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> num1 + num2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sum</span>(<span class="number">123</span>, <span class="number">321</span>)</span><br></pre></td></tr></table></figure><p>åŒ¿åå‡½æ•°çš„å‚æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> names = [<span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;bbb&quot;</span>, <span class="string">&quot;ccc&quot;</span>]</span><br><span class="line"><span class="comment">// æˆ‘ä»¬å¹¶æ²¡æœ‰æŒ‡å®šitemçš„ç±»å‹</span></span><br><span class="line"><span class="comment">// ä½†æ˜¯TypeScriptä¼šæ ¹æ®forEachå‡½æ•°çš„ç±»å‹ä»¥åŠæ•°ç»„çš„ç±»å‹æ¨æ–­å‡ºitemçš„ç±»å‹, è¿™ä¸ªæ—¶å€™å¯ä»¥ä¸æ·»åŠ çš„ç±»å‹æ³¨è§£</span></span><br><span class="line">names.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="å¯¹è±¡ç±»å‹">å¯¹è±¡ç±»å‹</h3><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›é™å®šä¸€ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printPoint</span>(<span class="params">point: &#123;x: number, y: number&#125;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(point.<span class="property">x</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(point.<span class="property">y</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">printPoint</span>(&#123;<span class="attr">x</span>: <span class="number">123</span>, <span class="attr">y</span>: <span class="number">321</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="è”åˆç±»å‹">è”åˆç±»å‹</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printId</span>(<span class="params">id: number | string</span>) &#123;</span><br><span class="line"><span class="comment">// id å¯ä»¥æ˜¯number ä¹Ÿå¯ä»¥æ˜¯ stringç±»å‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è”åˆç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printID</span>(<span class="params">id: number | string</span>) &#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨è”åˆç±»å‹çš„å€¼æ—¶ï¼Œéœ€è¦ç‰¹åˆ«çš„å°å¿ƒ</span></span><br><span class="line">  <span class="comment">// narrowï¼šç¼©å°</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> id === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// ç¡®å®šidæ˜¯stringç±»å‹</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(id.<span class="title function_">toUpperCase</span>());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯é€‰ç±»å‹">å¯é€‰ç±»å‹</h3><p>å¯¹è±¡ç±»å‹ä¹Ÿå¯ä»¥æŒ‡å®šå“ªäº›å±æ€§æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥åœ¨å±æ€§åé¢åŠ ä¸€ä¸ª?</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printPoint</span>(<span class="params">point: &#123;x: number, y:number, z?:number&#125;</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™ä¸ªå±æ€§å¯ä¼ å¯ä¸ä¼ </p><p>å¦å¤–ï¼Œå¯é€‰ç±»å‹å¯ä»¥çœ‹åšæ˜¯ç±»å‹å’Œundefinedçš„è”åˆç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">message?: string</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>() <span class="comment">// ä»€ä¹ˆéƒ½ä¸ä¼ å®é™…ä¸Šå°±æ˜¯ä»£è¡¨undefined</span></span><br><span class="line"><span class="title function_">foo</span>(<span class="literal">undefined</span>)</span><br></pre></td></tr></table></figure><h3 id="ç±»å‹åˆ«å">ç±»å‹åˆ«å</h3><p>æˆ‘ä»¬å¯ä»¥ç»™å¯¹è±¡ç±»å‹èµ·ä¸€ä¸ªåˆ«åï¼Œæ–¹é¢æˆ‘ä»¬åç»­ä½¿ç”¨</p><p>ç”¨åˆ°äº†å…³é”®å­— <strong>type</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type <span class="title class_">IDType</span> = string | number</span><br><span class="line">type <span class="title class_">PointType</span> = &#123;</span><br><span class="line">  <span class="attr">x</span>: number</span><br><span class="line">  <span class="attr">y</span>: number</span><br><span class="line">  z?: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printID</span>(<span class="params">id: IDType</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printPoint</span>(<span class="params">point: PointType</span>) &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="ç±»å‹æ–­è¨€-as">ç±»å‹æ–­è¨€ as</h3><p>å°†ç±»å‹è½¬æ¢ä¸ºæ›´å…·ä½“çš„ç±»å‹</p><p>æœ¬æ¥ä¸åŠ ç±»å‹æ–­è¨€çš„è¯ï¼ŒTSåªä¼šæŠŠelæ¨æ–­ä¸ºHTMLElementç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;xxx&quot;</span>) <span class="keyword">as</span> <span class="title class_">HTMLImageElement</span></span><br><span class="line">el.<span class="property">src</span> = <span class="string">&quot;urlåœ°å€&quot;</span></span><br></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼šPerson æ˜¯ Student çš„çˆ¶ç±»</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayHello</span>(<span class="params">p: Person</span>) &#123;</span><br><span class="line">  <span class="comment">// ä¸æ–­è¨€çš„è¯ä¼šæŠ¥é”™ï¼šç±»å‹â€œPersonâ€ä¸Šä¸å­˜åœ¨å±æ€§â€œstudyingâ€</span></span><br><span class="line">  (p <span class="keyword">as</span> <span class="title class_">Student</span>).<span class="title function_">studying</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="éç©ºç±»å‹æ–­è¨€">éç©ºç±»å‹æ–­è¨€!</h3><p>! ç”¨äºç¡®å®šæŸä¸ªæ ‡è¯†ç¬¦æ˜¯æœ‰å€¼çš„ï¼Œè·³è¿‡ ts åœ¨ç¼–è¯‘é˜¶æ®µæ—¶å¯¹å®ƒçš„æ£€æµ‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// message å¯ä»¥æ˜¯string/undefined</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">message?: string</span>) &#123;</span><br><span class="line">  <span class="comment">// å½“ç„¶å¯ä»¥ç›´æ¥ifåˆ¤æ–­</span></span><br><span class="line">  <span class="comment">// if(message) &#123;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½†æ˜¯ï¼æ›´ç®€æ´</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(message!.<span class="property">length</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯é€‰é“¾">å¯é€‰é“¾</h3><blockquote><p>å®é™…ä¸Šæ˜¯ ES11 å¢åŠ çš„ç‰¹æ€§</p></blockquote><p><code>?.</code> æ“ä½œç¬¦ï¼Œä½œç”¨æ˜¯å½“å¯¹è±¡çš„å±æ€§ä¸å­˜åœ¨æ—¶ï¼Œä¼šçŸ­è·¯ï¼Œç›´æ¥è¿”å›undefinedï¼Œå¦‚æœå­˜åœ¨ï¼Œé‚£ä¹ˆæ‰ä¼šç»§ç»­æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: string,</span><br><span class="line">  friend?: &#123;</span><br><span class="line">    f1?: &#123;</span><br><span class="line">      <span class="attr">name</span>: string</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">info</span>:<span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(info.friend.f1); // friendä¸å­˜åœ¨,å–ä¸åˆ°f1,æŠ¥é”™</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="property">friend</span>?.<span class="property">f1</span>); <span class="comment">// undefined, ä¸æŠ¥é”™</span></span><br><span class="line"><span class="comment">// info.friendå­˜åœ¨å—ï¼Ÿå­˜åœ¨å†ç»§ç»­å–f1</span></span><br></pre></td></tr></table></figure><h3 id="å’Œ-è¿ç®—ç¬¦">?? å’Œ !! è¿ç®—ç¬¦</h3><blockquote><p>?? æ˜¯ ES11æ–°å¢çš„ç‰¹æ€§</p></blockquote><p>**ç©ºå€¼åˆå¹¶æ“ä½œç¬¦ ?? **ï¼Œæ˜¯ä¸€ä¸ªé€»è¾‘æ“ä½œç¬¦ï¼Œå½“æ“ä½œç¬¦çš„å·¦ä¾§æ˜¯ null æˆ–è€… undefined æ—¶ï¼Œè¿”å›å…¶å³ä¾§æ“ä½œæ•°ï¼Œ å¦åˆ™è¿”å›å·¦ä¾§æ“ä½œæ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> message = <span class="literal">null</span></span><br><span class="line"><span class="keyword">const</span> res = message ?? <span class="string">&quot;123&quot;</span>  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// &quot;123&quot;</span></span><br></pre></td></tr></table></figure><p><strong>!!æ“ä½œç¬¦</strong>ï¼Œå°†ä¸€ä¸ªå…¶ä»–ç±»å‹è½¬æ¢æˆbooleanç±»å‹ï¼Œç±»å‹Boolean(å˜é‡)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> message = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">let</span> flag1 = <span class="title class_">Boolean</span>(message)</span><br><span class="line"><span class="keyword">let</span> flag2 = !!message</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(flag1); <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(flag2); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="å­—é¢é‡ç±»å‹">å­—é¢é‡ç±»å‹</h3><p>å­—é¢é‡ä¹Ÿå¯ä»¥å½“åšç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">msg</span>:<span class="string">&quot;hello&quot;</span> = <span class="string">&quot;hello&quot;</span> <span class="comment">// ä½†æ˜¯msgçš„å€¼åªèƒ½æ˜¯&quot;hello&quot;</span></span><br><span class="line">msg = <span class="string">&quot;asd&quot;</span> <span class="comment">// æŠ¥é”™</span></span><br></pre></td></tr></table></figure><p>é‚£æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿå¯ä»¥å°†å¤šä¸ªç±»å‹è”åˆåœ¨ä¸€èµ·</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type <span class="title class_">Alignment</span> = <span class="string">&#x27;left&#x27;</span> | <span class="string">&#x27;right&#x27;</span> | <span class="string">&#x27;center&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">changeAlign</span>(<span class="params">align: Alignment</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ä¿®æ”¹æ–¹å‘:&#x27;</span>, align);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">changeAlign</span>(<span class="string">&quot;center&quot;</span>) <span class="comment">// åªèƒ½ä¼ å…¥å®šä¹‰çš„ä¸‰ä¸ªå­—é¢é‡ç±»å‹</span></span><br></pre></td></tr></table></figure><h3 id="å­—é¢é‡æ¨ç†">å­—é¢é‡æ¨ç†</h3><p>ä¸‹é¢çš„ä»£ç ï¼Œé»˜è®¤æƒ…å†µä¸‹info è¿›è¡Œç±»å‹æ¨æ–­çš„æ—¶å€™ï¼Œmethodæ˜¯stringç±»å‹</p><p>åŠ ä¸Šas const åï¼Œmethodså°±æ˜¯&quot;GET&quot;å­—é¢é‡ç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> info = &#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;https://hillyee.github.io&quot;</span>,</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span></span><br><span class="line">&#125;  <span class="keyword">as</span> <span class="keyword">const</span> <span class="comment">// åŠ ä¸Šas const åï¼Œmethodså°±æ˜¯&quot;GET&quot;å­—é¢é‡ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">url: string, method: <span class="string">&quot;GET&quot;</span> | <span class="string">&quot;POST&quot;</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(url, method);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">request</span>(info.<span class="property">url</span>, info.<span class="property">method</span>) <span class="comment">// https://hillyee.github.io GET</span></span><br><span class="line"><span class="comment">// é»˜è®¤ï¼šç±»å‹â€œstringâ€çš„å‚æ•°ä¸èƒ½èµ‹ç»™ç±»å‹â€œ&quot;GET&quot; | &quot;POST&quot;â€çš„å‚æ•°ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="ç±»å‹ç¼©å°">ç±»å‹ç¼©å°</h3><p>Type Narrowing ç±»å‹ç¼©å°</p><p>å¯ä»¥é€šè¿‡ç±»ä¼¼äº typeof padding === â€œnumberâ€ çš„åˆ¤æ–­è¯­å¥ï¼Œæ¥æ”¹å˜TypeScriptçš„æ‰§è¡Œè·¯å¾„</p><p>åœ¨ç»™å®šçš„æ‰§è¡Œè·¯å¾„ä¸­ï¼Œç¼©å°æ¯”å£°æ˜æ—¶æ›´å°çš„ç±»å‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸º ç¼©å°</p><p>è€Œæˆ‘ä»¬ç¼–å†™çš„<code>typeof padding === &quot;number</code> å¯ä»¥ç§°ä¹‹ä¸ºç±»å‹ä¿æŠ¤</p><p>å¸¸è§çš„ç±»å‹ä¿æŠ¤ï¼š</p><ul><li><p>typeof</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type <span class="title class_">IDType</span> = number | string</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printID</span>(<span class="params">id: IDType</span>) &#123;</span><br><span class="line">  <span class="comment">// è¿™å¤–é¢ä½¿ç”¨idæ˜¯ IDtype ç±»å‹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> id === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œé¢ç¡®è®¤idæ˜¯stringç±»å‹</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(id.<span class="title function_">toUpperCase</span>());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ç¡®è®¤æ˜¯numberç±»å‹</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¹³ç­‰ç¼©å°ï¼ˆ=== == !== !=/switchï¼‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type <span class="title class_">Direction</span> = <span class="string">&quot;left&quot;</span> | <span class="string">&quot;right&quot;</span> | <span class="string">&quot;top&quot;</span> | <span class="string">&quot;bottom&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printDirection</span>(<span class="params">direction: Direction</span>) &#123;</span><br><span class="line">  <span class="comment">// 1.ifåˆ¤æ–­</span></span><br><span class="line">  <span class="comment">// if (direction === &#x27;left&#x27;) &#123;</span></span><br><span class="line">  <span class="comment">//   console.log(direction)</span></span><br><span class="line">  <span class="comment">// &#125; else if ()</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.switchåˆ¤æ–­</span></span><br><span class="line">  <span class="keyword">switch</span> (direction) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;left&#x27;</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(direction)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">//  case ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>instanceof</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Teacher</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">work</span>(<span class="params">p: Student | Teacher</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (p <span class="keyword">instanceof</span> <span class="title class_">Student</span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>in</p><blockquote><p>å±æ€§æ˜¯å¦å­˜åœ¨æŸå¯¹è±¡ä¸Š</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type <span class="title class_">Fish</span> = &#123;</span><br><span class="line">  <span class="attr">swimming</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">Dog</span> = &#123;</span><br><span class="line">  <span class="attr">running</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">walk</span>(<span class="params">animal: Fish | Dog</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&#x27;swimming&#x27;</span> <span class="keyword">in</span> animal) &#123;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    animal.<span class="title function_">running</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">fish</span>:<span class="title class_">Fish</span> = &#123;</span><br><span class="line">  <span class="title function_">swimming</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">walk</span>(fish)</span><br></pre></td></tr></table></figure></li></ul><h2 id="TSå‡½æ•°ç±»å‹">TSå‡½æ•°ç±»å‹</h2><ol><li><p>å®šä¹‰å¸¸é‡æ—¶ï¼Œç¼–å†™å‡½æ•°çš„ç±»å‹</p><p>(num1: number, num2: number) =&gt; number å°±æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œå¹¶æ¥æ”¶ä¸¤ä¸ªå‚æ•°num1ï¼Œnum2ï¼Œå¹¶ä¸”éƒ½æ˜¯numberç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type <span class="title class_">AddFnType</span> = <span class="function">(<span class="params">num1: number, num2: number</span>) =&gt;</span> number</span><br><span class="line"><span class="keyword">const</span> <span class="attr">add</span>: <span class="title class_">AddFnType</span> = <span class="function">(<span class="params">a1: number, a2: number</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a1 + a2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å‡½æ•°ä½œä¸ºå‚æ•°æ—¶ï¼Œåœ¨å‚æ•°ä¸­å¦‚ä½•ç¼–å†™ç±»å‹ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">FooFnType</span> = <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params">fn: FooFnType</span>) &#123;</span><br><span class="line">  <span class="title function_">fn</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">bar</span>(foo)</span><br></pre></td></tr></table></figure></li><li><p>å‚æ•°çš„å¯é€‰ç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x: number, y?: number</span>) &#123;&#125; <span class="comment">// yå¯é€‰</span></span><br></pre></td></tr></table></figure></li><li><p>é»˜è®¤å‚æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x: number, y: number = <span class="number">6</span></span>) &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>å‰©ä½™å‚æ•°</p><p>å°†ä¸€ä¸ªä¸å®šæ•°é‡çš„å‚æ•°æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">...nums: number[]</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> total = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> num <span class="keyword">of</span> nums) &#123;</span><br><span class="line">    total += num</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="thisç±»å‹">thisç±»å‹</h2><p>å½“thisä¸ç¡®å®šçš„æ—¶å€™ï¼Œé€šå¸¸TSä¼šè¦æ±‚æˆ‘ä»¬æ˜ç¡®çš„æŒ‡å®šthisçš„ç±»å‹</p><p>å¦‚æœä¸æŒ‡å®šçš„è¯ï¼Œéå¸¸ä¸å®‰å…¨ï¼Œå› ä¸ºæœ‰å¯èƒ½ç›´æ¥è°ƒç”¨å‡½æ•°æˆ–è€…é€šè¿‡åˆ«çš„å¯¹è±¡æ¥è°ƒç”¨å‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type thisType = &#123; <span class="attr">name</span>: string &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">eating</span>(<span class="params"><span class="variable language_">this</span>: thisType, message: string</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot; eating&quot;</span>, message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> info = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">  <span class="attr">eating</span>: eating</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éšå¼ç»‘å®š</span></span><br><span class="line">info.<span class="title function_">eating</span>(<span class="string">&quot;asd&quot;</span>) <span class="comment">// thisæ˜¯info</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾å¼ç»‘å®š</span></span><br><span class="line">eating.<span class="title function_">call</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;kkk&quot;</span>&#125;, <span class="string">&quot;hehehe&quot;</span>)</span><br><span class="line"><span class="comment">// &#123; name: &#x27;kkk&#x27; &#125;</span></span><br><span class="line"><span class="comment">// kkk eating hehehe</span></span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°çš„é‡è½½">å‡½æ•°çš„é‡è½½</h2><blockquote><p>å‡½æ•°çš„é‡è½½åœ¨å®é™…å¼€å‘ä¹Ÿä¸æ˜¯å¿…é¡»è¦ç”¨çš„ï¼Œå¦‚æœæœ¬æ¥å¯ä»¥ç”¨è”åˆç±»å‹ç®€å•å®ç°çš„è¯ï¼Œä¼˜å…ˆé€‰æ‹©è”åˆç±»å‹</p></blockquote><p>ä¾‹å¦‚æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œå¸Œæœ›å¯¹å­—ç¬¦ä¸²å’Œæ•°å­—ç±»å‹è¿›è¡Œç›¸åŠ </p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a1: number | string, a2: number | string</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> a1 === <span class="string">&quot;number&quot;</span> &amp;&amp; <span class="keyword">typeof</span> a2 === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a1 + a2</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> a1 === <span class="string">&quot;string&quot;</span> &amp;&amp; <span class="keyword">typeof</span> a2 === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a1 + a2</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// return a1 + a2</span></span><br><span class="line">  <span class="comment">// TS ä¼šæŠŠ string | number å½“åšæ˜¯ä¸€ä¸ªç±»å‹</span></span><br><span class="line">  <span class="comment">// è¿ç®—ç¬¦â€œ+â€ä¸èƒ½åº”ç”¨äºç±»å‹â€œstring | numberâ€å’Œâ€œstring | numberâ€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">add</span>(<span class="number">10</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šé€šè¿‡è”åˆç±»å‹çš„æ–¹å¼å®ç°æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š</p><ul><li>è¿›è¡Œå¾ˆå¤šçš„é€»è¾‘åˆ¤æ–­ï¼ˆç±»å‹ç¼©å°ï¼‰</li><li>è¿”å›å€¼çš„ç±»å‹ä¾ç„¶ä¸ç¡®å®š</li></ul><p><strong>å‡½æ•°çš„é‡è½½æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>å‡½æ•°çš„åç§°ç›¸åŒï¼Œä½†æ˜¯å‚æ•°ä¸åŒçš„å‡ ä¸ªå‡½æ•°å°±æ˜¯å‡½æ•°çš„é‡è½½ï¼Œå¹¶ä¸”æ˜¯æ²¡æœ‰å‡½æ•°æ‰§è¡Œä½“çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ„æˆå‡½æ•°é‡è½½</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">num1: number, num2: number</span>):number</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">num1: string, num2: string</span>):string</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°çš„å®ç°</span></span><br><span class="line"><span class="comment">// å¦‚æœæœ‰å‡½æ•°é‡è½½ï¼Œæ‰§è¡Œä½“æ˜¯ä¸èƒ½ç›´æ¥è¢«è°ƒç”¨çš„</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">num1: any, num2: any</span>): any &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯ string å°±è¿”å›é•¿åº¦ç›¸åŠ </span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> num1 === <span class="string">&#x27;string&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> num2 === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> num1.<span class="property">length</span> + num2.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> num1 + num2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res1 = <span class="title function_">add</span>(<span class="number">10</span>, <span class="number">20</span>) <span class="comment">// å…ˆæ‰¾åˆ°å‡½æ•°çš„å£°æ˜ å†æ‰¾æ‰§è¡Œä½“</span></span><br><span class="line"><span class="keyword">const</span> res2 = <span class="title function_">add</span>(<span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;bbb&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res1); <span class="comment">// 30</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res2); <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// add(&#123;name: &quot;xxx&quot;&#125;, &#123;age: 18&#125;)</span></span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸Šæ¡ˆä¾‹ç¡®å®ä½¿ç”¨å‡½æ•°é‡è½½å®ç°æ›´æ–¹ä¾¿ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©å‡½æ•°é‡è½½</p></blockquote><h2 id="TSç±»çš„ä½¿ç”¨">TSç±»çš„ä½¿ç”¨</h2><blockquote><p>è¿™éƒ¨åˆ†ï¼Œå®é™…å¼€å‘ä¸­ç›¸å¯¹ç”¨çš„å°‘ä¸€ç‚¹ï¼Œæ‰€ä»¥ç¬”è®°æš‚æ—¶è®°çš„æ¯”è¾ƒç²—ç³™</p></blockquote><p><strong>ç±»çš„å®šä¹‰</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string</span><br><span class="line">  <span class="attr">age</span>: number</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string, age: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">eating</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç±»çš„ç»§æ‰¿</strong>   extends super å…³é”®å­—</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string</span><br><span class="line">  <span class="attr">age</span>: number</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string, age: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">eating</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="attr">sno</span>: number</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string, age: number, sno: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name, age)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sno</span> = sno</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç±»çš„å¤šæ€</strong></p><blockquote><p>ä¸åŒçš„æ•°æ®ç±»å‹è¿›è¡ŒåŒä¸€ä¸ªæ“ä½œï¼Œè¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºï¼Œå°±æ˜¯å¤šæ€çš„ä½“ç°</p></blockquote><p><strong>ç±»çš„æˆå‘˜ä¿®é¥°ç¬¦</strong></p><ol><li><p>public</p><p>å…±æœ‰çš„ï¼Œé»˜è®¤ç¼–å†™çš„å±æ€§å°±æ˜¯public</p></li><li><p>private</p><p>ä»…åœ¨åŒä¸€ç±»ä¸­å¯è§</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  private <span class="attr">_name</span>: string = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¿é—®å™¨setter/getter</span></span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">name</span>(<span class="params">newName</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_name</span> = newName</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// getter</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">name</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_name</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ setter/getter æ˜¯è®¿é—®å™¨å±æ€§ï¼Œè¿™æ ·å¤–ç•Œå°±å¯ä»¥å­˜å‚¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">p.<span class="property">name</span> <span class="comment">// ä¼šè°ƒç”¨getè®¿é—®å™¨</span></span><br><span class="line">p.<span class="property">name</span> = <span class="string">&quot;kkk&quot;</span> <span class="comment">// set</span></span><br></pre></td></tr></table></figure></li><li><p>protected</p><p>ä»…åœ¨ç±»è‡ªèº«<strong>åŠå­ç±»</strong>ä¸­å¯è§ã€å—ä¿æŠ¤çš„å±æ€§å’Œæ–¹æ³•</p></li></ol><p><strong>åªè¯»å±æ€§readonly</strong></p><p>åªè¯»å±æ€§æ˜¯å¯ä»¥åœ¨æ„é€ å™¨ä¸­èµ‹å€¼, èµ‹å€¼ä¹‹åå°±ä¸å¯ä»¥ä¿®æ”¹</p><p>å±æ€§æœ¬èº«ä¸èƒ½è¿›è¡Œä¿®æ”¹, ä½†æ˜¯å¦‚æœå®ƒæ˜¯å¯¹è±¡ç±»å‹, å¯¹è±¡ä¸­çš„å±æ€§æ˜¯å¯ä»¥ä¿®æ”¹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  readonly <span class="attr">name</span>: string</span><br><span class="line">  age?: number</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">p.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span> <span class="comment">// æŠ¥é”™</span></span><br></pre></td></tr></table></figure><p><strong>é™æ€æˆå‘˜</strong></p><p>é€šè¿‡å…³é”®å­—<strong>static</strong>æ¥å®šä¹‰ï¼Œç›´æ¥é€šè¿‡ç±»è°ƒç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="attr">time</span>: string = <span class="string">&quot;20:00&quot;</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">attendClass</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å»ä¸Šè¯¾&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Student</span>.<span class="property">time</span>);</span><br><span class="line"><span class="title class_">Student</span>.<span class="title function_">attendClass</span>()</span><br></pre></td></tr></table></figure><p><strong>æŠ½è±¡ç±»abstract</strong></p><p>æŠ½è±¡ç±»ï¼š</p><ul><li>ä»¥abstract å£°æ˜çš„ç±»æ˜¯æŠ½è±¡ç±»</li><li>æŠ½è±¡ç±»å’Œå…¶ä»–ç±»åŒºåˆ«ä¸å¤§ï¼Œä½†æ˜¯ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼ˆä¸èƒ½é€šè¿‡newè°ƒç”¨ï¼‰</li><li>æŠ½è±¡ç±»å°±æ˜¯ä¸“é—¨ç”¨æ¥è¢«ç»§æ‰¿çš„ç±»</li></ul><p>æŠ½è±¡æ–¹æ³•ï¼šæ²¡æœ‰å…·ä½“å®ç°ï¼ˆæ²¡æœ‰æ–¹æ³•ä½“ï¼‰ï¼ŒæŠ½è±¡æ–¹æ³•å¿…é¡»å­˜åœ¨äºæŠ½è±¡ç±»ä¸­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">makeArea</span>(<span class="params">shape: Shape</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> shape.<span class="title function_">getArea</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">  abstract <span class="title function_">getArea</span>(): number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Shape</span> &#123;</span><br><span class="line">  private <span class="attr">width</span>: number</span><br><span class="line">  private <span class="attr">height</span>: number</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">width: number, height: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = width</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡å†™æ–¹æ³•</span></span><br><span class="line">  <span class="title function_">getArea</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">width</span> * <span class="variable language_">this</span>.<span class="property">height</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rectangle = <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="number">20</span>, <span class="number">30</span>) </span><br><span class="line"><span class="title function_">makeArea</span>(rectangle)</span><br></pre></td></tr></table></figure><p><strong>ç±»çš„ç±»å‹</strong></p><p>ç±»æœ¬èº«å¯ä»¥ä½œä¸ºä¸€ä¸ªç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string = <span class="string">&#x27;123&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="attr">p1</span>: <span class="title class_">Person</span> = &#123;  <span class="comment">// p1çš„ç±»å‹æ˜¯Personç±»ï¼Œæ‰€ä»¥å¿…é¡»è¦ä¼ name</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="TSæ¥å£çš„ä½¿ç”¨">TSæ¥å£çš„ä½¿ç”¨</h2><p>é™¤äº†å¯ä»¥é€šè¿‡typeå¼€å£°æ˜ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œè¿˜å¯ä»¥é€šè¿‡æ¥å£æ¥å£°æ˜</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: number</span><br><span class="line">  <span class="attr">y</span>: number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œæ¥å£ä¸­ä¹Ÿå¯ä»¥å®šä¹‰å¯é€‰å±æ€§ï¼Œåªè¯»å±æ€§</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface <span class="title class_">IInfoType</span> &#123;</span><br><span class="line">  readonly <span class="attr">name</span>: string</span><br><span class="line">  age?: number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç´¢å¼•ç±»å‹</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface <span class="title class_">IndexLanguage</span> &#123;</span><br><span class="line">  [<span class="attr">index</span>: number]: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">frontLanguage</span>: <span class="title class_">IndexLanguage</span> = &#123;</span><br><span class="line">  <span class="number">0</span>: <span class="string">&quot;HTML&quot;</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="string">&quot;CSS&quot;</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">&quot;JavaScript&quot;</span>,</span><br><span class="line">  <span class="number">3</span>: <span class="string">&quot;Vue&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å‡½æ•°ç±»å‹</strong></p><p>ç”¨è¿‡æ¥å£interfaceæ¥å®šä¹‰å‡½æ•°ç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface <span class="title class_">CalcFunc</span> &#123;</span><br><span class="line">  (<span class="attr">num1</span>: number, <span class="attr">num2</span>: number):number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">add</span>: <span class="title class_">CalcFunc</span> = <span class="function">(<span class="params">num1, num2</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> num1 + num2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å½“ç„¶è¿˜æ˜¯æ¨èä½¿ç”¨ç±»å‹åˆ«åæ¥å®šä¹‰å‡½æ•°</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type <span class="title class_">CalcFunc</span> = <span class="function">(<span class="params">num1: number, num2: number</span>) =&gt;</span> number</span><br></pre></td></tr></table></figure><p><strong>æ¥å£ç»§æ‰¿</strong></p><p>æ¥å£å’Œç±»ä¸€æ ·å¯ä»¥è¿›è¡Œç»§æ‰¿</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface <span class="title class_">ISwim</span> &#123;</span><br><span class="line">  <span class="attr">swimming</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">IRunning</span> &#123;</span><br><span class="line">  <span class="attr">running</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">IPerson</span> <span class="keyword">extends</span> <span class="title class_">ISwim</span>, <span class="title class_">IRunning</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">action</span>: <span class="title class_">IPerson</span> = &#123;</span><br><span class="line">  <span class="title function_">swimming</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  <span class="title function_">running</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¥å£çš„å®ç°</strong></p><p><strong>implements</strong> ç”¨äºæŒ‡å®š class æ»¡è¶³æŸä¸ªæ¥å£ï¼Œè€Œä¸”ç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£</p><blockquote><p>ä¸æ˜¯å¾ˆæ‡‚</p><p>é¢å‘æ¥å£å¼€å‘</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface <span class="title class_">ISwim</span> &#123;</span><br><span class="line">  <span class="attr">swimming</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">IRun</span> &#123;</span><br><span class="line">  <span class="attr">running</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> implements <span class="title class_">ISwim</span>, <span class="title class_">IRun</span> &#123;</span><br><span class="line">  <span class="title function_">swimming</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">running</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">swim</span>(<span class="params">swimmer: ISwim</span>) &#123;</span><br><span class="line">  swimmer.<span class="title function_">swimming</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="title function_">swim</span>(p)</span><br></pre></td></tr></table></figure><p><strong>äº¤å‰ç±»å‹</strong></p><p>ä¸€ç§ç±»å‹åˆå¹¶ï¼Œè¡¨ç¤ºéœ€è¦æ»¡è¶³å¤šä¸ªç±»å‹çš„æ¡ä»¶</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type <span class="title class_">MyType</span> = number &amp; string</span><br></pre></td></tr></table></figure><p><strong>interface å’Œ type åŒºåˆ«</strong></p><p>interfaceå¯ä»¥é‡å¤å¯¹æŸä¸ªæ¥å£æ¥å®šä¹‰å±æ€§å’Œæ–¹æ³•</p><p>è€Œtypeå®šä¹‰çš„æ˜¯åˆ«åï¼Œåˆ«åæ˜¯ä¸èƒ½é‡å¤çš„</p><p><strong>å­—é¢é‡èµ‹å€¼</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string</span><br><span class="line">  <span class="attr">age</span>: number</span><br><span class="line">  <span class="attr">height</span>: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printInfo</span>(<span class="params">person: IPerson</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(person);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// printInfo(&#123;</span></span><br><span class="line"><span class="comment">//   name: &quot;xxx&quot;,</span></span><br><span class="line"><span class="comment">//   age: 18,</span></span><br><span class="line"><span class="comment">//   height: 1.88,</span></span><br><span class="line"><span class="comment">//   address: &quot;å¹¿å·å¸‚&quot;  // æŠ¥é”™</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> info = &#123; <span class="comment">// å®šä¹‰å­—é¢é‡</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;why&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">1.88</span>,</span><br><span class="line">  <span class="attr">address</span>: <span class="string">&quot;å¹¿å·å¸‚&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">printInfo</span>(info) <span class="comment">// å†èµ‹å€¼å°±ä¸ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºTypeScriptåœ¨å­—é¢é‡ç›´æ¥èµ‹å€¼çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†è¿›è¡Œç±»å‹æ¨å¯¼ä¼šè¿›è¡Œä¸¥æ ¼çš„ç±»å‹é™åˆ¶ã€‚</p><p>ä½†æ˜¯ä¹‹åå¦‚æœæˆ‘ä»¬æ˜¯å°†ä¸€ä¸ª å˜é‡æ ‡è¯†ç¬¦èµ‹å€¼ç»™å…¶ä»–çš„å˜é‡æ—¶ï¼Œä¼šè¿›è¡Œfreshnessæ“¦é™¤æ“ä½œ</p><h2 id="TSæšä¸¾ç±»å‹">TSæšä¸¾ç±»å‹</h2><p>æšä¸¾å…¶å®å°±æ˜¯å°†ä¸€ç»„å¯èƒ½å‡ºç°çš„å€¼ï¼Œä¸€ä¸ªä¸ªåˆ—ä¸¾å‡ºæ¥ï¼Œå®šä¹‰åœ¨ä¸€ä¸ªç±»å‹ä¸­ï¼Œè¿™ä¸ªç±»å‹å°±æ˜¯æšä¸¾ç±»å‹</p><p>æšä¸¾å…è®¸å¼€å‘è€…å®šä¹‰ä¸€ç»„å‘½åå¸¸é‡ï¼Œå¸¸é‡å¯ä»¥æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²ç±»å‹</p><p>å®šä¹‰æšä¸¾ç±»å‹çš„å…³é”®å­—ï¼š<strong>enum</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">enum <span class="title class_">Direction</span> &#123;</span><br><span class="line">  <span class="variable constant_">LEFT</span>,</span><br><span class="line">  <span class="variable constant_">RIGHT</span>,</span><br><span class="line">  <span class="variable constant_">TOP</span>,</span><br><span class="line">  <span class="variable constant_">BOTTOM</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">turnDirection</span>(<span class="params">direction: Direction</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (direction) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Direction</span>.<span class="property">LEFT</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ”¹å˜è§’è‰²çš„æ–¹å‘å‘å·¦&quot;</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Direction</span>.<span class="property">RIGHT</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ”¹å˜è§’è‰²çš„æ–¹å‘å‘å³&quot;</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Direction</span>.<span class="property">TOP</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ”¹å˜è§’è‰²çš„æ–¹å‘å‘ä¸Š&quot;</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Direction</span>.<span class="property">BOTTOM</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ”¹å˜è§’è‰²çš„æ–¹å‘å‘ä¸‹&quot;</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">foo</span>: never = direction;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="TSæ³›å‹">TSæ³›å‹</h2><blockquote><p>éå¸¸é‡è¦ï¼</p></blockquote><h3 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h3><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼Œç±»å‹å‚æ•°åŒ–</p><p>ç±»å‹å†³å®šåœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™</p><p>åŸºæœ¬ä½¿ç”¨ï¼šå¤šåŠ ä¸€ä¸ª<code>&lt;Type&gt;</code>å‚æ•°æ¥æ¥æ”¶ç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> sum&lt;<span class="title class_">Type</span>&gt;(<span class="attr">num1</span>: <span class="title class_">Type</span>):<span class="title class_">Type</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> num1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sum&lt;number&gt;(<span class="number">10</span>)</span><br><span class="line">sum&lt;string&gt;(<span class="string">&quot;123&quot;</span>)</span><br><span class="line">sum&lt;&#123;<span class="attr">name</span>: string&#125;&gt;(&#123;<span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§è°ƒç”¨æ–¹å¼ï¼Œç±»å‹æ¨å¯¼</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">sum</span>(<span class="number">50</span>) <span class="comment">// é‚£ä¹ˆç±»å‹Typeå°±æ˜¯å­—é¢é‡50</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œè¿˜å¯ä»¥ä¼ å…¥å¤šä¸ªç±»å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> foo&lt;T, E, O&gt;(<span class="attr">arg1</span>: T, <span class="attr">arg2</span>: E, <span class="attr">arg3</span>: O, ...<span class="attr">args</span>: T[]) &#123;</span><br><span class="line"><span class="comment">// ...args: T[] æ˜¯å‰©ä½™å‚æ•°,æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œåªèƒ½é€‰æ‹©å‰é¢&lt;&gt;å®šä¹‰çš„ç±»å‹,</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo&lt;number, string, boolean&gt;(<span class="number">10</span>, <span class="string">&quot;aaa&quot;</span>, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure><p>å¼€å‘æ—¶å¸¸ç”¨çš„åç§°ï¼š</p><p>Tï¼šTypeçš„ç¼©å†™ï¼Œç±»å‹</p><p>Kã€Vï¼škeyå’Œvalueçš„ç¼©å†™ï¼Œé”®å€¼å¯¹</p><p>Eï¼šElementçš„ç¼©å†™ï¼Œå…ƒç´ </p><p>Oï¼šObjectçš„ç¼©å†™ï¼Œå¯¹è±¡</p><h3 id="æ³›å‹æ¥å£">æ³›å‹æ¥å£</h3><p>å®šä¹‰æ¥å£ä¸­ä½¿ç”¨æ³›å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface <span class="title class_">IPerson</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">name</span>: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">p</span>:<span class="title class_">IPerson</span>&lt;string&gt; = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xx&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³›å‹ç±»">æ³›å‹ç±»</h3><p>å®šä¹‰ç±»ä½¿ç”¨æ³›å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&lt;<span class="variable constant_">T1</span>, <span class="variable constant_">T2</span>&gt; &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="variable constant_">T1</span></span><br><span class="line">  <span class="attr">age</span>: <span class="variable constant_">T2</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: T1, age: T2</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»å‹æ¨æ–­</span></span><br><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;kkk&quot;</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå·±å®šä¹‰ç±»å‹</span></span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>&lt;string, number&gt;(<span class="string">&#x27;xxx&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">p3</span>:<span class="title class_">Person</span>&lt;string, number&gt; = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;aaa&quot;</span>, <span class="number">21</span>)</span><br></pre></td></tr></table></figure><h3 id="æ³›å‹çº¦æŸ">æ³›å‹çº¦æŸ</h3><blockquote><p>ç»™ç±»å‹å‚æ•°ä¸€ç‚¹çº¦æŸ</p></blockquote><p>å…³é”®å­— <strong>extends</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface <span class="title class_">ILength</span> &#123;</span><br><span class="line">  <span class="attr">length</span>: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> getLength&lt;T <span class="keyword">extends</span> <span class="title class_">ILength</span>&gt;(<span class="attr">arg</span>: T) &#123;</span><br><span class="line">  <span class="keyword">return</span> arg.<span class="property">length</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å…¥çš„å‚æ•°å¿…é¡»æœ‰lengthå±æ€§</span></span><br><span class="line"><span class="title function_">getLength</span>(<span class="string">&quot;aaa&quot;</span>)</span><br><span class="line"><span class="title function_">getLength</span>([<span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;bbb&quot;</span>])</span><br><span class="line"><span class="title function_">getLength</span>(&#123;<span class="attr">length</span>: <span class="number">100</span>&#125;)</span><br></pre></td></tr></table></figure><h2 id="TSå…¶ä»–å†…å®¹">TSå…¶ä»–å†…å®¹</h2><h3 id="æ¨¡å—åŒ–å¼€å‘">æ¨¡å—åŒ–å¼€å‘</h3><p>TSæœ‰ä¸¤ç§æ–¹å¼æ§åˆ¶ä½œç”¨åŸŸ</p><h4 id="æ¨¡å—åŒ–">æ¨¡å—åŒ–</h4><p>æ”¯æŒES Moduleï¼ŒCommonJS</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/38ebf34f36dc4e0299f70e0bfb5cf699~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><h4 id="å‘½åç©ºé—´namespace">å‘½åç©ºé—´namespace</h4><p>æ˜¯å°†ä¸€ä¸ªæ¨¡å—å†…éƒ¨å†è¿›è¡Œä½œç”¨åŸŸçš„åˆ’åˆ†ï¼Œé˜²æ­¢ä¸€äº›å‘½å å†²çªçš„é—®é¢˜</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸ºäº†å…¶ä»–æ–‡ä»¶èƒ½ä½¿ç”¨ï¼Œè¿™é‡Œè¿˜è¦å¯¼å‡º</span></span><br><span class="line"><span class="keyword">export</span> namespace time &#123;</span><br><span class="line">  <span class="comment">// å†…éƒ¨è¦exportå¯¼å‡ºï¼Œæ‰èƒ½åœ¨è¿™ä¸ªtsæ¨¡å—ä¸­ä½¿ç”¨</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">format</span>(<span class="params">time: string</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;2022-4-13&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…¶ä»–çš„é€»è¾‘</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">let</span> <span class="attr">name</span>: string = <span class="string">&quot;aaa&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> namespace price &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">format</span>(<span class="params">price: number</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;99.99&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>TSæ—©æœŸçš„ä¸œè¥¿ï¼Œä¸ªäººè¿˜æ˜¯é€‰æ‹©æ¨¡å—åŒ–</p></blockquote><h3 id="ç±»å‹çš„æŸ¥æ‰¾">ç±»å‹çš„æŸ¥æ‰¾</h3><p>åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬é™¤äº†è‡ªå·±ç¼–å†™ç±»å‹ï¼Œè¿˜æœ‰ç”¨åˆ°ä¸€äº›å…¶ä»–çš„ç±»å‹ï¼Œæ¯”å¦‚è¯´</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;image&quot;</span>) <span class="keyword">as</span> <span class="title class_">HTMLImageElement</span></span><br></pre></td></tr></table></figure><p>HTMLImageElement ç±»å‹æ¥è‡ªå“ªé‡Œå‘¢ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ç§tsæ–‡ä»¶ï¼š<code>.d.ts</code>ä¸ºåç¼€åçš„æ–‡ä»¶</p><ul><li>è¿™ç§æ–‡ä»¶æ˜¯ç”¨æ¥åšç±»å‹çš„å£°æ˜çš„ï¼ˆdeclareï¼‰ã€‚å®ƒä»…ä»…ç”¨æ¥åšç±»å‹æ£€æµ‹ï¼Œå‘Šè¯‰typescriptæˆ‘ä»¬æœ‰å“ªäº›ç±»å‹</li><li>è¿™ç§æ–‡ä»¶æ˜¯ä¸éœ€è¦è½¬æˆjsæ–‡ä»¶æ¥è¿è¡Œçš„</li></ul><p>é‚£ä¹ˆtypescriptä¼šåœ¨å“ªé‡ŒæŸ¥æ‰¾æˆ‘ä»¬çš„ç±»å‹å£°æ˜å‘¢ï¼Ÿ</p><p>æœ‰ä¸‰ç§ï¼š</p><ul><li><p>å†…ç½®ç±»å‹å£°æ˜</p><p>typescriptè‡ªå¸¦çš„ï¼Œå¸®åŠ©æˆ‘ä»¬å†…ç½®äº†JSè¿è¡Œæ—¶çš„ä¸€äº›æ ‡å‡†åŒ–APIçš„å£°æ˜æ–‡ä»¶</p><p>æ¯”å¦‚å¦‚Mathã€Dateç­‰å†…ç½®ç±»å‹ï¼Œä¹ŸåŒ…æ‹¬DOM APIï¼Œæ¯”å¦‚Windowã€Documentç­‰</p><p>å†…ç½®ç±»å‹å£°æ˜é€šå¸¸åœ¨æˆ‘ä»¬å®‰è£…typescriptç¯å¢ƒä¸­ä¼šå¸¦æœ‰</p><blockquote><p>github:<a href="https://github.com/microsoft/TypeScript/tree/main/lib">https://github.com/microsoft/TypeScript/tree/main/lib</a></p></blockquote></li><li><p>å¤–éƒ¨å®šä¹‰ç±»å‹å£°æ˜</p><p>é€šå¸¸æ˜¯æˆ‘ä»¬ä½¿ç”¨ä¸€äº›åº“æ—¶ï¼Œéœ€è¦çš„ä¸€äº›ç±»å‹å£°æ˜</p><p>è¿™äº›åº“æœ‰ä¸¤ç§ç±»å‹å£°æ˜æ–¹å¼</p><ol><li>åœ¨è‡ªå·±åº“ä¸­è¿›è¡Œç±»å‹å£°æ˜ï¼ˆç¼–å†™.d.tsæ–‡ä»¶ï¼‰ï¼Œæ¯”å¦‚axios</li><li>é€šè¿‡ç¤¾åŒºçš„ä¸€ä¸ªå…¬æœ‰åº“DefinitelyTypedå­˜æ”¾ç±»å‹å£°æ˜æ–‡ä»¶</li></ol><blockquote><p>githubé“¾æ¥ï¼š</p><p>è¯¥åº“çš„GitHubåœ°å€ï¼š<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/">https://github.com/DefinitelyTyped/DefinitelyTyped/</a></p><p>è¯¥åº“æŸ¥æ‰¾å£°æ˜å®‰è£…æ–¹å¼çš„åœ°å€ï¼š<a href="https://www.typescriptlang.org/dt/search?search=">https://www.typescriptlang.org/dt/search?search=</a></p><p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦å®‰è£…reactçš„ç±»å‹å£°æ˜ï¼Œå°±å¯ä»¥å»æŸ¥æ‰¾å®‰è£…æ–¹å¼</p></blockquote></li><li><p>è‡ªå®šä¹‰ç±»å‹å£°æ˜</p><p>æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“æ˜¯ä¸€ä¸ªçº¯çš„JavaScriptåº“ï¼Œæ²¡æœ‰å¯¹åº”çš„å£°æ˜æ–‡ä»¶ï¼›æ¯”å¦‚lodash</p><p>è¿™æ—¶å€™æˆ‘ä»¬è¦è‡ªå·±å£°æ˜ç±»å‹æ–‡ä»¶ï¼š</p><p>ä»»æ„ä¸€ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ä¸‹å®šä¹‰<code>.d.ts</code> æ–‡ä»¶ï¼Œtsä¼šè‡ªå·±æ‰¾åˆ°çš„</p><p>å£°æ˜æ¨¡å—å…³é”®å­—ï¼š<strong>declare</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜æ¨¡å—</span></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;lodash&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">join</span>(<span class="params">arr: any[]</span>): <span class="keyword">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>å£°æ˜å˜é‡-å‡½æ•°-ç±»</strong></p><p>åœ¨<code>.d.ts</code> æ–‡ä»¶ä¸­å£°æ˜</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">declare <span class="keyword">let</span> <span class="attr">myName</span>: string</span><br><span class="line">declare <span class="keyword">let</span> <span class="attr">myAge</span>: number</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªæ˜¯å£°æ˜ç±»å‹, ä¸éœ€è¦æ‰§è¡Œä½“</span></span><br><span class="line">declare <span class="keyword">function</span> <span class="title function_">myFoo</span>(<span class="params"></span>): <span class="keyword">void</span></span><br><span class="line"></span><br><span class="line">declare <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string</span><br><span class="line">  <span class="attr">age</span>: number</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string, age: number</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myName = <span class="string">&quot;xxx&quot;</span></span><br><span class="line"><span class="keyword">let</span> myAge = <span class="number">18</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myFoo</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;xxx&quot;</span>, <span class="number">18</span>)</span><br></pre></td></tr></table></figure><p><strong>å£°æ˜æ¨¡å—</strong></p><p>å£°æ˜æ¨¡å—çš„è¯­æ³•: declare module â€˜æ¨¡å—åâ€™ {}ã€‚</p><p>åœ¨å£°æ˜æ¨¡å—çš„å†…éƒ¨ï¼Œå¯ä»¥é€šè¿‡exportå¯¼å‡ºå¯¹åº”åº“çš„ç±»ã€å‡½æ•°ç­‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;lodash&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">join</span>(<span class="params">arr: any[]</span>): <span class="keyword">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å£°æ˜æ–‡ä»¶</strong></p><blockquote><p>æ–‡ä»¶ä¼šè¢«å½“æˆæ¨¡å—ä½¿ç”¨ï¼Œç„¶åå°±å¯ä»¥å¼•å…¥</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.jpg&#x27;</span></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.jepg&#x27;</span></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.png&#x27;</span></span><br></pre></td></tr></table></figure><p>åœ¨åˆ«çš„åœ°æ–¹<code>import</code>ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> img <span class="keyword">from</span> <span class="string">&#x27;./img/xxx.jpg&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>å£°æ˜å‘½åç©ºé—´</strong></p><p>æ¯”å¦‚åœ¨index.htmlä¸­ç›´æ¥å¼•å…¥jQuery</p><p>ç„¶ååœ¨å£°æ˜æ–‡ä»¶ä¸­ï¼ˆ<code>.d.ts</code>ï¼‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">declare namespace $ &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">settings: any</span>):any</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥åœ¨åˆ«çš„æ–‡ä»¶ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;...&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥Vue3+Typescriptå­¦ä¹ âš¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•é¢˜â€”JSæ‰‹å†™ç¯‡</title>
      <link href="/2022/04/14/%E9%9D%A2%E8%AF%95%E9%A2%98%E2%80%94JS%E6%89%8B%E5%86%99%E7%AF%87/"/>
      <url>/2022/04/14/%E9%9D%A2%E8%AF%95%E9%A2%98%E2%80%94JS%E6%89%8B%E5%86%99%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h3 id="å®ç°instanceof">å®ç°instanceof</h3><blockquote><p><strong><code>instanceof</code></strong> <strong>è¿ç®—ç¬¦</strong>ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ <code>prototype</code> å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚</p><p>Object.getPrototypeOf() æ–¹æ³•è¿”å›æŒ‡å®šå¯¹è±¡çš„åŸå‹ï¼ˆå†…éƒ¨[[Prototype]]å±æ€§çš„å€¼ï¼‰</p><p>è¦æ‡‚åŸå‹å’ŒåŸå‹é“¾</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myInstanceof</span>(<span class="params">target, origin</span>) &#123;</span><br><span class="line">  <span class="comment">// åŸºæœ¬æ•°æ®ç±»å‹ç›´æ¥è¿”å›false</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">&#x27;object&#x27;</span> || target === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment">// æ‹¿åˆ° target çš„__proto__</span></span><br><span class="line">  <span class="keyword">let</span> proto = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(target)</span><br><span class="line">  <span class="comment">// protoä¸ä¸ºnullå°±ç»§ç»­</span></span><br><span class="line">  <span class="keyword">while</span>(proto) &#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°ç›¸åŒçš„åŸå‹å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (proto == origin.<span class="property"><span class="keyword">prototype</span></span>) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">// ç»§ç»­æ²¿ç€åŸå‹é“¾æ‰¾</span></span><br><span class="line">    proto = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(proto)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">myInstanceof</span>(<span class="string">&quot;111&quot;</span>, <span class="title class_">String</span>)); <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">myInstanceof</span>(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;111&quot;</span>), <span class="title class_">String</span>));<span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">People</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_ inherited__">People</span> &#123;&#125; </span><br><span class="line"><span class="keyword">const</span> stu = <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu <span class="keyword">instanceof</span> <span class="title class_">People</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu <span class="keyword">instanceof</span> <span class="title class_">Student</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="JSå¦‚ä½•å®ç°ç»§æ‰¿ï¼Ÿ">JSå¦‚ä½•å®ç°ç»§æ‰¿ï¼Ÿ</h3><h4 id="æ–¹å¼1ï¼šå€ŸåŠ©åŸå‹é“¾">æ–¹å¼1ï¼šå€ŸåŠ©åŸå‹é“¾</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&#x27;pName&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = <span class="number">18</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">friends</span> = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç±»</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = <span class="number">1.88</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>() <span class="comment">// è·å¾—Personç±»çš„å±æ€§æ–¹æ³•</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ‘ä»¬è®©Studentçš„åŸå‹æŒ‡å‘p</span></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span> = p</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stu = <span class="keyword">new</span> <span class="title class_">Student</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu.<span class="property">name</span>); <span class="comment">// pName</span></span><br><span class="line">stu.<span class="title function_">sayHello</span>() <span class="comment">// Hello</span></span><br><span class="line"><span class="comment">// å¯è§æˆ‘ä»¬å·²ç»æ‹¿åˆ°äº†çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•</span></span><br></pre></td></tr></table></figure><p>è¿™ç§å®ç°æ–¹æ³•å­˜åœ¨çš„é—®é¢˜ï¼š</p><p>1.å½“æˆ‘ä»¬æ‰“å°å®ä¾‹stuçš„æ—¶å€™ï¼Œç»§æ‰¿çš„å±æ€§ä¸èƒ½ç›´è§‚çœ‹åˆ°ï¼Œåªèƒ½åœ¨<code>__proto__</code>å±æ€§ä¸­çœ‹åˆ°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu)<span class="comment">// StudentÂ &#123;height: 1.88&#125;</span></span><br></pre></td></tr></table></figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b22630e56f0f4495b46de38b9142b383~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:60%;" /><p>2.å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå¹¶æ”¹å˜friendså±æ€§</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">stu1.<span class="property">friends</span>.<span class="title function_">push</span>(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu2.<span class="property">friends</span>); <span class="comment">// [&#x27;aaa&#x27;]</span></span><br></pre></td></tr></table></figure><p>æ˜æ˜æ”¹å˜çš„æ˜¯stu1çš„å±æ€§ï¼Œä¸ºä»€ä¹ˆstu2ä¹Ÿå˜äº†ï¼Ÿ</p><p>å› ä¸ºæˆ‘ä»¬å®ƒä»¬çš„éšå¼åŸå‹æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œp</p><p>3.å‰é¢å®ç°çš„è¿‡ç¨‹éƒ½æ²¡æœ‰ä¼ é€’å‚æ•°</p><h4 id="æ–¹å¼2ï¼šå€ŸåŠ©æ„é€ å‡½æ•°">æ–¹å¼2ï¼šå€ŸåŠ©æ„é€ å‡½æ•°</h4><p>ä½¿ç”¨callè°ƒç”¨æ„é€ å‡½æ•°ï¼Œä¼ å…¥çš„thisä¸ºå½“å‰å®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥æŠŠå‚æ•°ä¼ ç»™çˆ¶ç±»å¤„ç†</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">friends</span> = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç±»</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name, age, height</span>) &#123;</span><br><span class="line">    <span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age) <span class="comment">// è¿™é‡Œå¯ä»¥è·å¾—çˆ¶ç±»çš„å±æ€§</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>() <span class="comment">// ä¾ç„¶éœ€è¦è¿™é‡Œæ¥è·å¾—æ–¹æ³•</span></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span> = p</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stu1 = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;aaa&#x27;</span>, <span class="number">18</span>, <span class="number">1.78</span>)</span><br><span class="line"><span class="keyword">let</span> stu2 = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;bbb&#x27;</span>, <span class="number">20</span>, <span class="number">1.88</span>)</span><br><span class="line"></span><br><span class="line">stu1.<span class="property">friends</span>.<span class="title function_">push</span>(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu2);</span><br><span class="line">stu1.<span class="title function_">sayHello</span>() <span class="comment">// Hello</span></span><br></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°çš„æ–¹æ³•å¯ä»¥è§£å†³åŸå‹é“¾æ–¹å¼çš„é—®é¢˜ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨å¼Šç«¯</p><ol><li>Person è‡³å°‘è¢«è°ƒç”¨ä¸¤æ¬¡ï¼ˆä¸€å¼€å§‹new Personä¸€æ¬¡ï¼Œåé¢Person.callåˆä¼šè°ƒç”¨Personï¼‰</li><li>stuçš„åŸå‹å¯¹è±¡ä¸Šä¼šå¤šå‡ºä¸€äº›å±æ€§, ä½†æ˜¯è¿™äº›å±æ€§æ˜¯æ²¡æœ‰å­˜åœ¨çš„å¿…è¦ï¼ˆnew Personçš„æ—¶å€™çš„ï¼‰</li></ol><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d55255c9445464c9e38514c08dd0d4c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h4 id="æ–¹å¼3ï¼šå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿-æœ€ç»ˆæ–¹æ¡ˆ">æ–¹å¼3ï¼šå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿(æœ€ç»ˆæ–¹æ¡ˆ)</h4><blockquote><p>**<code>Object.create()</code>**æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨ç°æœ‰çš„å¯¹è±¡æ¥æä¾›æ–°åˆ›å»ºçš„å¯¹è±¡çš„__proto__ã€‚</p><p>Object.create(XXX) ä¹Ÿå°±æ˜¯ä¼ å…¥çš„å¯¹è±¡XXXï¼Œä½œä¸ºæ–°å¯¹è±¡çš„åŸå‹</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age, friends</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">friends</span> = friends</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç±»</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name, age, friends, height</span>) &#123;</span><br><span class="line">    <span class="comment">// è·å–çˆ¶ç±»ä¸­çš„å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line">    <span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age, friends)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†è·å–ä¸€ä»½çˆ¶ç±»çš„prototypeä¸­çš„å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Student</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stu = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;aaa&#x27;</span>, <span class="number">18</span>, [<span class="string">&#x27;fre1&#x27;</span>], <span class="number">1.88</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu);</span><br></pre></td></tr></table></figure><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9029791227bd4b56903a268afb40c68d~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è£…ä¸€ä¸ªæ–¹æ³•æ¥ç»§æ‰¿çˆ¶ç±»prototypeä¸­çš„å±æ€§å’Œæ–¹æ³•</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inheritPrototype</span>(<span class="params">SubType, SuperType</span>) &#123;</span><br><span class="line">  <span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">SuperType</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å½“ç„¶å­ç±»çš„prototypeè¿˜éœ€è¦æœ‰constructoræŒ‡å‘å­æ„é€ å‡½æ•°æœ¬èº«</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&quot;constructor&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="title class_">SubType</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="title function_">inheritPrototype</span>(<span class="title class_">Student</span>, <span class="title class_">Person</span>)</span><br></pre></td></tr></table></figure><h3 id="JSæŸ¯é‡ŒåŒ–å®ç°">JSæŸ¯é‡ŒåŒ–å®ç°</h3><blockquote><p>è¦æ±‚ï¼Œä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæŸ¯é‡ŒåŒ–çš„å‡½æ•°</p><p>æ€è·¯ï¼šå½“å·²ç»ä¼ å…¥çš„å‚æ•° å¤§äºç­‰äº æ‰€éœ€è¦çš„å‚æ•°æ—¶ï¼Œå°±æ‰§è¡Œå‡½æ•°</p><p>æ²¡æœ‰è¾¾åˆ°ä¸ªæ•°æ—¶ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œç»§ç»­æ¥æ”¶é›†å‚æ•°ï¼Œæ¥æ”¶åˆ°å‚æ•°åï¼Œé€’å½’è°ƒç”¨curriedæ¥æ£€æŸ¥å‡½æ•°çš„ä¸ªæ•°æ˜¯å¦è¾¾åˆ°</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myCurrying</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">curried</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="comment">// å½“å·²ç»ä¼ å…¥çš„å‚æ•° å¤§äºç­‰äº éœ€è¦çš„å‚æ•°æ—¶, å°±æ‰§è¡Œå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (args.<span class="property">length</span> &gt;= fn.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="comment">// fn()</span></span><br><span class="line">      <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ²¡æœ‰è¾¾åˆ°ä¸ªæ•°æ—¶, éœ€è¦è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°,ç»§ç»­æ¥æ¥æ”¶å‚æ•°</span></span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">curried2</span>(<span class="params">...args2</span>) &#123;</span><br><span class="line">        <span class="comment">// æ¥æ”¶åˆ°å‚æ•°å, éœ€è¦é€’å½’è°ƒç”¨curriedæ¥æ£€æŸ¥å‡½æ•°çš„ä¸ªæ•°æ˜¯å¦è¾¾åˆ°</span></span><br><span class="line">        <span class="keyword">return</span> curried.<span class="title function_">apply</span>(<span class="variable language_">this</span>, [...args, ...args2])</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> curried2</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›ä¸€ä¸ªæŸ¯é‡ŒåŒ–çš„å‡½æ•°</span></span><br><span class="line">  <span class="keyword">return</span> curried</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add1</span>(<span class="params">x, y, z</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y + z</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> curryAdd = <span class="title function_">myCurrying</span>(add1)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curryAdd</span>(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curryAdd</span>(<span class="number">10</span>)(<span class="number">20</span>, <span class="number">30</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curryAdd</span>(<span class="number">10</span>)(<span class="number">20</span>)(<span class="number">30</span>));</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ğŸ˜£é¢è¯•é¢˜-jsç¯‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Proxy-Reflect-å“åº”å¼åŸç†</title>
      <link href="/2022/04/11/Proxy-Reflect-%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/"/>
      <url>/2022/04/11/Proxy-Reflect-%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1>Proxy</h1><h2 id="ç›‘å¬å¯¹è±¡çš„æ“ä½œ">ç›‘å¬å¯¹è±¡çš„æ“ä½œ</h2><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›ç›‘å¬ä¸€ä¸ªå¯¹è±¡ä¸­çš„å±æ€§è¢«è®¾ç½®æˆ–è·å–çš„è¿‡ç¨‹</p><p>åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Object.defineProperty</code> çš„å­˜å‚¨å±æ€§æè¿°ç¬¦ï¼ˆget setï¼‰æ¥ç›‘å¬åˆ°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> value = obj[key]</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ç›‘å¬åˆ°objå¯¹è±¡çš„<span class="subst">$&#123;key&#125;</span>å±æ€§è¢«è®¿é—®äº†`</span>);</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ç›‘å¬åˆ°objå¯¹è±¡çš„<span class="subst">$&#123;key&#125;</span>å±æ€§è¢«è®¾ç½®å€¼`</span>);</span><br><span class="line">      value = newValue</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;asd&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦ç›‘å¬æ›´åŠ ä¸°å¯Œçš„æ“ä½œï¼Œæ¯”å¦‚è¯´æ–°å¢å±æ€§ã€åˆ é™¤å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æ˜¯æ— èƒ½ä¸ºåŠ›çš„</p><p>è€Œä¸”æˆ‘ä»¬è¦çŸ¥é“ï¼Œè¿™ä¸ªæ–¹æ³•çš„å­˜å‚¨æè¿°ç¬¦è®¾è®¡çš„åˆè¡·ä¹Ÿä¸æ˜¯ä¸ºäº†ç›‘å¬ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡çš„</p><h2 id="Proxyçš„åŸºæœ¬ä½¿ç”¨">Proxyçš„åŸºæœ¬ä½¿ç”¨</h2><blockquote><p>è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç›‘å¬å¯¹è±¡æ“ä½œçš„ç¬¬äºŒç§æ–¹å¼</p></blockquote><p>åœ¨ ES6 ä¸­ï¼Œæ–°å¢äº†Proxy<strong>ç±»</strong>ï¼Œç”¨äºå¸®åŠ©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä»£ç†</p><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›ç›‘å¬ä¸€ä¸ªå¯¹è±¡çš„ç›¸å…³æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ ¹æ®è¿™ä¸ªå¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆProxyå¯¹è±¡ï¼‰ã€‚</p><p>ç„¶åå¯¹è¯¥å¯¹è±¡çš„æ‰€æœ‰æ“ä½œï¼Œæˆ‘ä»¬éƒ½é€šè¿‡ä»£ç†å¯¹è±¡å®Œæˆï¼Œå› ä¸ºè¿™ä¸ªä»£ç†å¯¹è±¡å¯ä»¥å¸®æˆ‘ä»¬ç›‘å¬æˆ‘ä»¬å¯¹åŸå¯¹è±¡è¿›è¡Œçš„æ“ä½œ</p><p>æ€ä¹ˆæ¥ä½¿ç”¨è¿™ä¸ªProxyä»£ç†å‘¢ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> objProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="comment">// è·å–å€¼æ—¶çš„æ•è·å™¨</span></span><br><span class="line">  <span class="comment">// target:åŸå¯¹è±¡, key:å±æ€§</span></span><br><span class="line">  <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ç›‘å¬åˆ°å¯¹è±¡çš„<span class="subst">$&#123;key&#125;</span>å±æ€§è¢«è®¿é—®äº†`</span>, target);</span><br><span class="line">    <span class="keyword">return</span> target[key]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// è®¾ç½®å€¼çš„æ•è·å™¨</span></span><br><span class="line">  <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">target, key, newValue</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ç›‘å¬åˆ°å¯¹è±¡çš„<span class="subst">$&#123;key&#125;</span>å±æ€§è¢«è®¾ç½®å€¼`</span>, target);</span><br><span class="line">    target[key] = newValue</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ç›‘å¬inçš„æ•è·å™¨</span></span><br><span class="line">  <span class="attr">has</span>: <span class="keyword">function</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ç›‘å¬åˆ°å¯¹è±¡çš„<span class="subst">$&#123;key&#125;</span>å±æ€§inæ“ä½œ`</span>, target);</span><br><span class="line">    <span class="keyword">return</span> key <span class="keyword">in</span> target</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ç›‘å¬deleteçš„æ•è·å™¨</span></span><br><span class="line">  <span class="attr">deleteProperty</span>: <span class="keyword">function</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ç›‘å¬åˆ°å¯¹è±¡çš„<span class="subst">$&#123;key&#125;</span>å±æ€§deleteæ“ä½œ`</span>, target);</span><br><span class="line">    <span class="keyword">delete</span> target[key]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(objProxy.<span class="property">name</span>);</span><br><span class="line"><span class="comment">// ç›‘å¬åˆ°å¯¹è±¡çš„nameå±æ€§è¢«è®¿é—®äº† &#123;name: &#x27;xxx&#x27;, age: 18&#125;</span></span><br><span class="line"><span class="comment">// xxx</span></span><br><span class="line"></span><br><span class="line">objProxy.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span></span><br><span class="line"><span class="comment">// ç›‘å¬åˆ°å¯¹è±¡çš„nameå±æ€§è¢«è®¾ç½®å€¼ &#123;name: &#x27;xxx&#x27;, age: 18&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>); <span class="comment">// kkk</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;name&quot;</span> <span class="keyword">in</span> objProxy); <span class="comment">// true</span></span><br><span class="line"><span class="keyword">delete</span> objProxy.<span class="property">name</span> </span><br></pre></td></tr></table></figure><blockquote><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯¹ä»£ç†å¯¹è±¡åšå‡ºçš„æ”¹å˜ï¼ŒåŸå¯¹è±¡ä¹Ÿæ˜¯ä¼šå˜çš„ï¼Ÿ</p><p>å› ä¸ºæˆ‘ä»¬è®¾ç½®å€¼çš„æ—¶å€™ï¼Œå°±æ˜¯ç›´æ¥å¯¹åŸå¯¹è±¡è®¾ç½®çš„ï¼Œtarget[key] = newValue</p></blockquote><h2 id="Proxyæ‰€æœ‰æ•è·å™¨">Proxyæ‰€æœ‰æ•è·å™¨</h2><p>æœ‰13ä¸ªæ•è·å™¨</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ced0dad1f1e422c8187a8e27703ebcb~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ddc940ec5cdc479b83241f9bf53894ae~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><p>Proxy å¯¹å‡½æ•°çš„ç›‘å¬ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fooProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(foo, &#123;</span><br><span class="line">  <span class="attr">apply</span>: <span class="keyword">function</span>(<span class="params">target, thisArg, arrArray</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¯¹fooå‡½æ•°è¿›è¡Œäº†applyè°ƒç”¨&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> target.<span class="title function_">apply</span>(thisArg, arrArray)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">construct</span>: <span class="keyword">function</span>(<span class="params">target, arrArray, newTarget</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¯¹fooå‡½æ•°è¿›è¡Œäº†newè°ƒç”¨&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">target</span>(...arrArray)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fooProxy.<span class="title function_">apply</span>(&#123;&#125;, [<span class="string">&#x27;aaa&#x27;</span>,<span class="string">&#x27;bbb&#x27;</span>])</span><br><span class="line"><span class="keyword">new</span> <span class="title function_">fooProxy</span>(<span class="string">&quot;ddd&quot;</span>, <span class="string">&quot;fff&quot;</span>)</span><br></pre></td></tr></table></figure><h1>Reflect</h1><h2 id="ç®€å•ä»‹ç»">ç®€å•ä»‹ç»</h2><ul><li><p><strong>Reflectæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>ES6 æ–°å¢çš„ä¸€ä¸ªAPIï¼Œå®ƒæ˜¯ä¸€ä¸ª<strong>å¯¹è±¡</strong>ï¼Œå­—é¢æ„æ€æ˜¯åå°„</p></li><li><p><strong>æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</strong></p><p>ä¸»è¦æ˜¯æä¾›äº†å¾ˆå¤šæ“ä½œJavaScriptå¯¹è±¡çš„æ–¹æ³•ï¼Œæœ‰ç‚¹åƒObjectä¸­æ“ä½œå¯¹è±¡çš„æ–¹æ³•</p><p>æ¯”å¦‚ï¼šReflect.getPrototype(target) ç±»ä¼¼äº Object.getPrototype(target)</p></li><li><p>é‚£æœ‰Objectå¯ä»¥åšè¿™äº›æ“ä½œï¼Œä¸ºä»€ä¹ˆè¿˜è¦æ–°å¢ Reflect å¯¹è±¡å‘¢ï¼Ÿ</p><p>å› ä¸ºåœ¨æ—©æœŸçš„ ECMA è§„èŒƒä¸­æ²¡æœ‰è€ƒè™‘åˆ°è¿™ç§å¯¹ å¯¹è±¡æœ¬èº« çš„æ“ä½œå¦‚ä½•è®¾è®¡ä¼šæ›´åŠ è§„èŒƒï¼Œæ‰€ä»¥å°†è¿™äº›APIæ”¾åœ¨ Object ä¸Š</p><p>ä½†æ˜¯Objectä½œä¸ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¿™äº›æ“ä½œæ”¾åˆ°å®ƒèº«ä¸Šå¹¶ä¸åˆé€‚</p><p>å¦å¤–è¿˜åŒ…å«ä¸€äº›ç±»ä¼¼äº inã€deleteæ“ä½œç¬¦ï¼ŒReflectè®©åŸæœ¬çš„å‘½ä»¤å¼å˜æˆå‡½æ•°å¼ .has ()ç­‰</p><p>æ‰€ä»¥åœ¨ES6ä¸­æ–°å¢äº†Reflectï¼Œè®©æˆ‘ä»¬è¿™äº›æ“ä½œéƒ½é›†ä¸­åˆ°äº†Reflectå¯¹è±¡ä¸Š</p></li><li><p>Objectå’ŒReflectå¯¹è±¡ä¹‹é—´çš„APIå…³ç³»</p><blockquote><p>MDN <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/Comparing_Reflect_and_Object_methods">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/Comparing_Reflect_and_Object_methods</a></p></blockquote></li></ul><h2 id="Reflectå¸¸è§æ–¹æ³•">Reflectå¸¸è§æ–¹æ³•</h2><blockquote><p>è·ŸProxyä¸€ä¸€å¯¹åº”çš„ï¼Œä¹Ÿæ˜¯13ä¸ª</p></blockquote><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b1901525696149e1981fe1941c906f4c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><p>Reflect å’Œ Proxy ä¸€èµ·ä½¿ç”¨</p><p>æˆ‘ä»¬å¯ä»¥å¯¹å‰é¢Proxyæ¡ˆä¾‹ä¸­ï¼Œå¯¹åŸå¯¹è±¡çš„æ“ä½œéƒ½ä¿®æ”¹ä¸ºReflectæ¥æ“ä½œ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> objProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;get---------&quot;</span>)</span><br><span class="line">    <span class="comment">// return target[key]</span></span><br><span class="line">    <span class="comment">// ä¸ç›´æ¥ä¿®æ”¹åŸå¯¹è±¡äº†</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, key, newValue, receiver</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;set---------&quot;</span>)</span><br><span class="line">    <span class="comment">// target[key] = newValue</span></span><br><span class="line">    <span class="comment">// å¯ä»¥æ‹¿åˆ°è®¾ç½®æˆåŠŸä¸å¦çš„ç»“æœ,ä¸€ä¸ªå¸ƒå°”å€¼</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, newValue)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç„¶åå°±å¯ä»¥æ ¹æ®ç»“æœåšä¸€äº›æ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">objProxy.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(objProxy.<span class="property">name</span>); <span class="comment">// kkk</span></span><br></pre></td></tr></table></figure><h2 id="Receiverå‚æ•°çš„ä½œç”¨">Receiverå‚æ•°çš„ä½œç”¨</h2><p>è®¿é—®å™¨è¿˜æœ‰ä¸€ä¸ªå‚æ•° receiver</p><p>ä½œç”¨ï¼šå¦‚æœæˆ‘ä»¬çš„æºå¯¹è±¡æœ‰setterï¼Œgetterçš„è®¿é—®å™¨å±æ€§ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡receiveræ¥æ”¹å˜é‡Œé¢çš„this</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">_name</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">name</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_name</span>  <span class="comment">// æ”¹å˜è¿™é‡Œçš„this</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">name</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_name</span> = newValue</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> objProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">    <span class="comment">// receiveræ˜¯åˆ›å»ºå‡ºæ¥çš„ä»£ç†å¯¹è±¡</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(receiver === objProxy);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getæ–¹æ³•è¢«è®¿é—®&#x27;</span>, key, receiver);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, key, newValue, receiver</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> res = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, newValue, receiver)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setæˆåŠŸ&#x27;</span>, res);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">objProxy.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(objProxy.<span class="property">name</span>);</span><br></pre></td></tr></table></figure><p>æ”¹å˜thisï¼Œè®©å®ƒæŒ‡å‘ä»£ç†å¯¹è±¡ åˆå¯¹ä»£ç†å¯¹è±¡æœ‰æ“ä½œï¼Œæ‰€ä»¥æ•è·äº†ä¸¤æ¬¡</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9c67d9919194a99b3e95124be862853~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h2 id="Reflectä¸­çš„construct">Reflectä¸­çš„construct</h2><blockquote><p>å¾ˆå°‘å¾ˆå°‘ç”¨åˆ°å­ï¼ŒryfES6æ–‡æ¡£ï¼š</p><p><strong>Reflect.construct(target, args)</strong></p><p>ç­‰åŒäº<code>new target(...args)</code>ï¼Œè¿™æä¾›äº†ä¸€ç§ä¸ä½¿ç”¨<code>new</code>ï¼Œæ¥è°ƒç”¨æ„é€ å‡½æ•°çš„æ–¹æ³•ã€‚</p></blockquote><p>åº”ç”¨åœºæ™¯ï¼Œç›´æ¥çœ‹ä¾‹å­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Teacher</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡ŒStudentå‡½æ•°ä¸­çš„å†…å®¹ï¼Œä½†æ˜¯åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡æ˜¯Teacherå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> teacher = <span class="title class_">Reflect</span>.<span class="title function_">construct</span>(<span class="title class_">Student</span>, [<span class="string">&quot;xxx&quot;</span>, <span class="number">18</span>], <span class="title class_">Teacher</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(teacher);</span><br><span class="line"><span class="comment">// TeacherÂ &#123;name: &#x27;xxx&#x27;, age: 18&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(teacher.<span class="property">__proto__</span> === <span class="title class_">Teacher</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure><h1>å“åº”å¼åŸç†</h1><h2 id="ä»€ä¹ˆæ˜¯å“åº”å¼">ä»€ä¹ˆæ˜¯å“åº”å¼</h2><p>å…ˆçœ‹ä¸€æ®µä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€æ®µä»£ç </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m * <span class="number">2</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m + <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">m = <span class="number">200</span></span><br></pre></td></tr></table></figure><p>å½“ m å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œä¸Šé¢ä¾èµ–mçš„ä¸€æ®µä»£ç è‡ªåŠ¨é‡æ–°æ‰§è¡Œ</p><p>è¿™ç§å¯ä»¥è‡ªåŠ¨å“åº”æ•°æ®å˜é‡çš„ä»£ç æœºåˆ¶ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸º<strong>å“åº”å¼</strong>çš„</p><h2 id="å®ç°å“åº”å¼">å®ç°å“åº”å¼</h2><h3 id="å“åº”å¼å‡½æ•°è®¾è®¡ä¸å°è£…">å“åº”å¼å‡½æ•°è®¾è®¡ä¸å°è£…</h3><p>é¦–å…ˆï¼Œéœ€è¦é‡æ–°æ‰§è¡Œçš„ä»£ç å¯èƒ½æœ‰å¾ˆå¤šè¡Œï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¿™äº›ä»£ç æ”¾åˆ°ä¸€ä¸ªå‡½æ•°ä¸­</p><p>å½“æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬è®©è¿™ä¸ªå‡½æ•°æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¹è±¡çš„å“åº”å¼</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾èµ–objçš„ä»£ç </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">objFn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;objå˜äº†&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span></span><br><span class="line"><span class="comment">// å½“æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™,å‡½æ•°å†æ¬¡æ‰§è¡Œ</span></span><br><span class="line"><span class="title function_">objFn</span>()</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æˆ‘ä»¬ç®€å•çš„æ€æƒ³ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªå“åº”å¼å‡½æ•°éœ€è¦å†æ¬¡æ‰§è¡Œå‘¢ï¼Ÿ</p><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠè¿™äº›å“åº”å¼å‡½æ•°éƒ½æ”¶é›†èµ·æ¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°è£…ä¸€ä¸ªå“åº”å¼çš„å‡½æ•°</span></span><br><span class="line"><span class="comment">// æŠŠå“åº”å¼å‡½æ•°æ”¶é›†åˆ°æ•°ç»„ä¸­   // æ”¹</span></span><br><span class="line"><span class="keyword">let</span> reactiveFns = []</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">watchFn</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  reactiveFns.<span class="title function_">push</span>(fn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡çš„å“åº”å¼</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ‘ä»¬æŠŠéœ€è¦å“åº”å¼çš„å‡½æ•°ä¼ å…¥watchFn</span></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;           <span class="comment">// æ”¹</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;objå˜äº†&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;nameå˜äº†&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span></span><br><span class="line"><span class="comment">// å½“æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™,æ‰§è¡Œæ”¶é›†çš„å“åº”å¼å‡½æ•°</span></span><br><span class="line">reactiveFns.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;   <span class="comment">// æ”¹</span></span><br><span class="line">  <span class="title function_">fn</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="å“åº”å¼ä¾èµ–çš„æ”¶é›†">å“åº”å¼ä¾èµ–çš„æ”¶é›†</h3><p>ç›®å‰æˆ‘ä»¬æ”¶é›†çš„ä¾èµ–å…¨éƒ½æ”¾åˆ°ä¸€ä¸ªæ•°ç»„æ¥ä¿å­˜ï¼Œè¿™å­˜åœ¨å¾ˆå¤§çš„é—®é¢˜ã€‚</p><p>å®é™…å¼€å‘ä¸­æˆ‘ä»¬éœ€è¦ç›‘å¬å¾ˆå¤šå¯¹è±¡çš„å“åº”å¼ï¼Œè¿™äº›å¯¹è±¡éœ€è¦ç›‘å¬çš„å±æ€§ä¹Ÿä¸æ­¢ä¸€ä¸ªï¼Œå®ƒä»¬éƒ½ä¼šæœ‰å¯¹åº”çš„å“åº”å¼å‡½æ•°</p><p>æ‰€ä»¥æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ç”¨äºç®¡ç†æŸä¸€ä¸ªå¯¹è±¡çš„æŸä¸€ä¸ªå±æ€§çš„æ‰€æœ‰å“åº”å¼å‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Depend</span> &#123; <span class="comment">// æ”¹</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span> = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addDepend</span>(<span class="params">reactiveFn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">push</span>(reactiveFn)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šçŸ¥æ‰§è¡Œä¾èµ–</span></span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">fn</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> depend = <span class="keyword">new</span> <span class="title class_">Depend</span>()  <span class="comment">// æ”¹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">watchFn</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  depend.<span class="title function_">addDepend</span>(fn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡çš„å“åº”å¼</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;objçš„nameå˜äº†&#x27;</span>, obj.<span class="property">name</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;nameå˜äº†&#x27;</span>, obj.<span class="property">name</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span></span><br><span class="line"><span class="comment">// å½“æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™,æ‰§è¡Œæ”¶é›†çš„å“åº”å¼å‡½æ•°</span></span><br><span class="line">depend.<span class="title function_">notify</span>()      <span class="comment">// æ”¹</span></span><br></pre></td></tr></table></figure><h3 id="è‡ªåŠ¨ç›‘å¬å¯¹è±¡å˜åŒ–">è‡ªåŠ¨ç›‘å¬å¯¹è±¡å˜åŒ–</h3><p>ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ•°æ®å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯æ‰‹åŠ¨å»è°ƒç”¨notify()è®©ä¾èµ–å‡½æ•°æ‰§è¡Œçš„</p><p>æˆ‘ä»¬éœ€è¦è‡ªåŠ¨ç›‘å¬å¯¹è±¡å˜åŒ–</p><blockquote><p>æ³¨æ„ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä»£ç†å¯¹è±¡ä¹‹åï¼Œå¯¹åŸå¯¹è±¡çš„æ“ä½œéƒ½é€šè¿‡ä»£ç†å¯¹è±¡å®Œæˆäº†</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Depend</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">addDepend</span>(<span class="params">reactiveFn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">push</span>(reactiveFn)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é€šçŸ¥æ‰§è¡Œä¾èµ–</span></span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">fn</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> depend = <span class="keyword">new</span> <span class="title class_">Depend</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">watchFn</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  depend.<span class="title function_">addDepend</span>(fn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡çš„å“åº”å¼</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªåŠ¨ç›‘å¬å¯¹è±¡çš„å±æ€§å˜åŒ–</span></span><br><span class="line"><span class="keyword">const</span> objProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;  <span class="comment">// æ”¹</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, key, newValue, receiver</span>) &#123;</span><br><span class="line">    <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, newValue, receiver)</span><br><span class="line">    depend.<span class="title function_">notify</span>() <span class="comment">// åœ¨è¿™é‡Œæ‰§è¡Œ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;objçš„nameå˜äº†&#x27;</span>, objProxy.<span class="property">name</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;nameå˜äº†&#x27;</span>, objProxy.<span class="property">name</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹ä»£ç†å¯¹è±¡æ“ä½œ</span></span><br><span class="line">objProxy.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span>   <span class="comment">// æ”¹</span></span><br></pre></td></tr></table></figure><blockquote><p>Vue3 ç”¨çš„Proxyï¼ŒVue2ç”¨Object.defineProperty() ç›‘å¬</p></blockquote><h3 id="ä¾èµ–æ”¶é›†çš„ç®¡ç†">ä¾èµ–æ”¶é›†çš„ç®¡ç†</h3><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸Šé¢åªåˆ›å»ºäº†ä¸€ä¸ªdependå¯¹è±¡æ¥ç®¡ç†obj.nameå˜åŒ–éœ€è¦ç›‘å¬çš„å“åº”å¼å‡½æ•°</p><p>å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªå¯¹è±¡ï¼Œéœ€è¦ç›‘å¬ä¸åŒçš„å±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ€ä¹ˆæ ·æ¥ç®¡ç†ä¸åŒå¯¹è±¡çš„ä¸åŒä¾èµ–å…³ç³»å‘¢ï¼Ÿ</p><p>ä¾èµ–æ”¶é›†çš„æ•°æ®ç»“æ„ï¼Œè¿™é‡Œå¿…é¡»è¦ç†æ¸…æ¥šè¿™ç§ç»“æ„çš„è®¾è®¡ï¼Œæˆ‘ä»¬ç”¨åˆ°äº† Mapï¼ŒWeakMap</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8aee3bb829143a296f7142a54ffe103~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><p>ä¼ªä»£ç ï¼šç»“æ„å¤§æ¦‚å°±æ˜¯è¿™æ ·å­</p><blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1Map = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">obj1Map.<span class="title function_">set</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;nameçš„æ‰€æœ‰depend&quot;</span>)</span><br><span class="line">obj1Map.<span class="title function_">set</span>(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;ageçš„æ‰€æœ‰depend&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2Map = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">obj2Map.<span class="title function_">set</span>(<span class="string">&quot;height&quot;</span>, <span class="string">&quot;heightçš„æ‰€æœ‰depend&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> targetMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"></span><br><span class="line"><span class="title function_">targetMap</span>(obj1, obj1Map)</span><br><span class="line"><span class="title function_">targetMap</span>(obj2, obj2Map)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“æ•°æ®å˜åŒ–</span></span><br><span class="line">obj1.<span class="property">name</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹¿åˆ°obj1çš„nameå±æ€§çš„æ‰€æœ‰ä¾èµ–</span></span><br><span class="line"><span class="comment">// æ ¹æ®å¯¹è±¡æ‹¿å¯¹åº”çš„map,å†æ ¹æ®å±æ€§æ‹¿ä¾èµ–å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> depend = targetMap.<span class="title function_">get</span>(obj).<span class="title function_">get</span>(<span class="string">&quot;name&quot;</span>)</span><br></pre></td></tr></table></figure></blockquote><p>å…·ä½“ä»£ç å®ç°ï¼š</p><p>å…ˆåˆ›å»ºä¸€ä¸ªweakMapï¼Œå¹¶å°è£…ä¸€ä¸ªè·å–dependçš„å‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Depend</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span> = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addDepend</span>(<span class="params">reactiveFn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">push</span>(reactiveFn)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šçŸ¥æ‰§è¡Œä¾èµ–</span></span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">fn</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…ä¸€ä¸ªå“åº”å¼çš„å‡½æ•°      </span></span><br><span class="line"><span class="keyword">const</span> depend = <span class="keyword">new</span> <span class="title class_">Depend</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">watchFn</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  depend.<span class="title function_">addDepend</span>(fn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…ä¸€ä¸ªè·å–dependçš„å‡½æ•°       // æ”¹</span></span><br><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDepends</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">  <span class="comment">// æ ¹æ®å¯¹è±¡è·å–map</span></span><br><span class="line">  <span class="keyword">let</span> map = targetMap.<span class="title function_">get</span>(target)</span><br><span class="line">  <span class="comment">// å¦‚æœæ²¡æœ‰è·å–åˆ°map,è¯´æ˜è¿™ä¸ªå¯¹è±¡æ˜¯ç¬¬ä¸€æ¬¡æ·»åŠ ä¾èµ–</span></span><br><span class="line">  <span class="comment">// æˆ‘ä»¬è¦ç»™è¿™ä¸ªå¯¹è±¡æ–°å»ºä¸€ä¸ªmap</span></span><br><span class="line">  <span class="keyword">if</span> (!map) &#123;</span><br><span class="line">    map = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    targetMap.<span class="title function_">set</span>( target, map)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®keyè·å–ä¾èµ–</span></span><br><span class="line">  <span class="keyword">let</span> depend = map.<span class="title function_">get</span>(key)</span><br><span class="line">  <span class="keyword">if</span> (!depend) &#123;</span><br><span class="line">    depend = <span class="keyword">new</span> <span class="title class_">Depend</span>()</span><br><span class="line">    map.<span class="title function_">set</span>(key, depend)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> depend</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡çš„å“åº”å¼</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªåŠ¨ç›‘å¬å¯¹è±¡çš„å±æ€§å˜åŒ–</span></span><br><span class="line"><span class="keyword">const</span> objProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;  </span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, key, newValue, receiver</span>) &#123;</span><br><span class="line">    <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, newValue, receiver)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•è·è·å–å€¼çš„æ“ä½œ,è·å–ä¾èµ–,ç„¶åæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">const</span> depend = <span class="title function_">getDepends</span>(target, key)   <span class="comment">// æ”¹</span></span><br><span class="line">    depend.<span class="title function_">notify</span>() <span class="comment">// åœ¨è¿™é‡Œæ‰§è¡Œ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;objçš„nameå˜äº†&#x27;</span>, objProxy.<span class="property">name</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;nameå˜äº†&#x27;</span>, objProxy.<span class="property">name</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹ä»£ç†å¯¹è±¡æ“ä½œ</span></span><br><span class="line">objProxy.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span>  </span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æ‰§è¡Œä¼šå‘ç°ï¼Œæ ¹æœ¬æ²¡æœ‰å®ç°å“åº”å¼ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>å› ä¸ºæˆ‘ä»¬åœ¨watchFnæ·»åŠ ä¾èµ–å‡½æ•°çš„æ—¶å€™ï¼Œä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€ï¼Œå…¨éƒ½æ·»åŠ åˆ°ä¸€ä¸ªdependé‡Œé¢äº†</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/799b1477919d4463ac9a400d2069f5c0~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>æ‰€ä»¥å½“æˆ‘ä»¬è·å–ä¾èµ–çš„æ—¶å€™ï¼Œæ ¹æœ¬æ— æ³•æ ¹æ®å¯¹è±¡ï¼Œkeyæ¥æ­£ç¡®çš„è·å–å¯¹åº”keyçš„ä¾èµ–å‡½æ•°</p><ul><li><p>é‚£ä¹ˆæ­£ç¡®çš„ä¾èµ–åº”è¯¥åœ¨å“ªé‡Œæ”¶é›†å‘¢ï¼Ÿ</p><p>åº”è¯¥åœ¨æˆ‘ä»¬è°ƒç”¨Proxyçš„getæ•è·å™¨çš„æ—¶å€™ã€‚å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è·å–å±æ€§å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±åº”è¯¥å¯¹è¿™ä¸ªkeyæ”¶é›†å®ƒè‡ªå·±çš„ä¾èµ–</p></li><li><p>å¦å¤–ï¼Œå½“æˆ‘ä»¬åœ¨geté‡Œé¢æ·»åŠ ä¾èµ–çš„æ—¶å€™å‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ€ä¹ˆæ‹¿åˆ°è¿™ä¸ªå“åº”å‡½æ•°å‘¢ï¼Ÿ</p><p>å®šä¹‰ä¸€ä¸ªå…¨å±€çš„å˜é‡ activeReactiveFn</p></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Depend</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span> = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addDepend</span>(<span class="params">reactiveFn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">push</span>(reactiveFn)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šçŸ¥æ‰§è¡Œä¾èµ–</span></span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">fn</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…ä¸€ä¸ªå“åº”å¼çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> activeReactiveFn = <span class="literal">null</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">watchFn</span>(<span class="params">fn</span>) &#123;       <span class="comment">// æ”¹ï¼ï¼</span></span><br><span class="line">  activeReactiveFn = fn</span><br><span class="line">  <span class="title function_">fn</span>() <span class="comment">// ç”¨åŸæ•°æ®å…ˆæ‰§è¡Œä¸€æ¬¡å‡½æ•°, æ”¶é›†ä¾èµ–</span></span><br><span class="line">  activeReactiveFn = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…ä¸€ä¸ªè·å–dependçš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDepends</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">  <span class="comment">// æ ¹æ®å¯¹è±¡è·å–map</span></span><br><span class="line">  <span class="keyword">let</span> map = targetMap.<span class="title function_">get</span>(target)</span><br><span class="line">  <span class="comment">// å¦‚æœæ²¡æœ‰è·å–åˆ°map,è¯´æ˜è¿™ä¸ªå¯¹è±¡æ˜¯ç¬¬ä¸€æ¬¡æ·»åŠ ä¾èµ–</span></span><br><span class="line">  <span class="comment">// æˆ‘ä»¬è¦ç»™è¿™ä¸ªå¯¹è±¡æ–°å»ºä¸€ä¸ªmap</span></span><br><span class="line">  <span class="keyword">if</span> (!map) &#123;</span><br><span class="line">    map = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    targetMap.<span class="title function_">set</span>( target, map)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®keyè·å–ä¾èµ–</span></span><br><span class="line">  <span class="keyword">let</span> depend = map.<span class="title function_">get</span>(key)</span><br><span class="line">  <span class="keyword">if</span> (!depend) &#123;</span><br><span class="line">    depend = <span class="keyword">new</span> <span class="title class_">Depend</span>()</span><br><span class="line">    map.<span class="title function_">set</span>(key, depend)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> depend</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡çš„å“åº”å¼</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªåŠ¨ç›‘å¬å¯¹è±¡çš„å±æ€§å˜åŒ–</span></span><br><span class="line"><span class="keyword">const</span> objProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;    </span><br><span class="line">  <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®target,keyè·å–å¯¹åº”çš„depend    // æ”¹ï¼</span></span><br><span class="line">    <span class="keyword">const</span> depend = <span class="title function_">getDepends</span>(target, key)  </span><br><span class="line">    <span class="comment">// ç»™dependå¯¹è±¡ä¸­æ·»åŠ å“åº”å¼å‡½æ•°</span></span><br><span class="line">    depend.<span class="title function_">addDepend</span>(activeReactiveFn)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">target, key, newValue, receiver</span>) &#123;</span><br><span class="line">    <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, newValue, receiver)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•è·è·å–å€¼çš„æ“ä½œ,è·å–ä¾èµ–,ç„¶åæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">const</span> depend = <span class="title function_">getDepends</span>(target, key)</span><br><span class="line">    depend.<span class="title function_">notify</span>() <span class="comment">// åœ¨è¿™é‡Œæ‰§è¡Œ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;objçš„name&#x27;</span>, objProxy.<span class="property">name</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name&#x27;</span>, objProxy.<span class="property">name</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;age&#x27;</span>, objProxy.<span class="property">age</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;----------ä¿®æ”¹å‰---&#x27;</span>);</span><br><span class="line"></span><br><span class="line">objProxy.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span></span><br><span class="line"><span class="comment">// objProxy.age = 20</span></span><br></pre></td></tr></table></figure><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8653f4e8dbab4f4da63aa84f402c1530~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><blockquote><p>ä¸€ä¸ªæ³¨æ„çš„åœ°æ–¹ï¼šåœ¨watchFn()å‡½æ•°é‡Œé¢ï¼Œæˆ‘ä»¬ä¼šå…ˆè°ƒç”¨ä¸€æ¬¡ä¼ å…¥çš„å‡½æ•°ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å› ä¸ºè¿™ä¸ªå‡½æ•°å¦‚æœæœ‰å¯¹æŸä¸ªå±æ€§æœ‰getçš„æ“ä½œçš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½æ•è·åˆ°ï¼Œè€Œæˆ‘ä»¬åœ¨geté‡Œé¢è¿›è¡Œæ”¶é›†ä¾èµ–çš„æ“ä½œï¼Œå°±å¯ä»¥æ”¶é›†åˆ°è¿™ä¸ªå±æ€§çš„ä¾èµ–äº†</p></blockquote><h3 id="å¯¹-Depend-é‡æ„">å¯¹ Depend é‡æ„</h3><p>ç°åœ¨ä¾ç„¶å­˜åœ¨é—®é¢˜ï¼š</p><ul><li><p>å¦‚æœå‡½æ•°ä¸­ç”¨åˆ°äº†ä¸¤æ¬¡keyï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™ä¸ªå‡½æ•°å°±ä¼šè¢«æ”¶é›†ä¸¤æ¬¡ï¼Œå³é‡å¤æ”¶é›†äº†ä¾èµ–ï¼Œåé¢æˆ‘ä»¬æ‰§è¡Œdependé‡Œé¢çš„å‡½æ•°çš„æ—¶å€™ï¼Œå°±ä¼šé‡å¤æ‰§è¡Œè¿™ä¸ªå‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name&#x27;</span>, objProxy.<span class="property">name</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name22&#x27;</span>, objProxy.<span class="property">name</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;----------ä¿®æ”¹å‰---&#x27;</span>);</span><br><span class="line">objProxy.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5da09599720c465c84d5d07174a4fcfd~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /></li></ul><p>â€‹è§£å†³æ–¹æ³•ï¼šä½¿ç”¨Setæ¥ä¿å­˜ä¾èµ–å‡½æ•°ï¼ˆSetå…ƒç´ ä¸é‡å¤ï¼‰</p><ul><li>è¿˜æœ‰ä¸€ä¸ªå¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼šæˆ‘ä»¬å¹¶ä¸å¸Œæœ›å°†æ·»åŠ  activeReactiveFn æ–¹æ³•æ”¾åœ¨geté‡Œé¢ï¼Œå› ä¸ºè¿™æ˜¯å±äº Depend ç±»çš„è¡Œä¸º</li></ul><p>ä¿®æ”¹åï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¿å­˜å½“å‰éœ€è¦æ”¶é›†çš„å“åº”å¼å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> activeReactiveFn = <span class="literal">null</span>   <span class="comment">// æ”¹ï¼</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Depend</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span> = <span class="keyword">new</span> <span class="title class_">Set</span>()   <span class="comment">// æ”¹ï¼</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">depend</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (activeReactiveFn) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">add</span>(activeReactiveFn) <span class="comment">// æ”¹ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">fn</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…ä¸€ä¸ªå“åº”å¼çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">watchFn</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  activeReactiveFn = fn</span><br><span class="line">  <span class="title function_">fn</span>() <span class="comment">// ç”¨åŸæ•°æ®å…ˆæ‰§è¡Œä¸€æ¬¡å‡½æ•°, æ”¶é›†ä¾èµ–</span></span><br><span class="line">  activeReactiveFn = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…ä¸€ä¸ªè·å–dependçš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDepends</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> map = targetMap.<span class="title function_">get</span>(target)</span><br><span class="line">  <span class="keyword">if</span> (!map) &#123;</span><br><span class="line">    map = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    targetMap.<span class="title function_">set</span>( target, map)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®keyè·å–ä¾èµ–</span></span><br><span class="line">  <span class="keyword">let</span> depend = map.<span class="title function_">get</span>(key)</span><br><span class="line">  <span class="keyword">if</span> (!depend) &#123;</span><br><span class="line">    depend = <span class="keyword">new</span> <span class="title class_">Depend</span>()</span><br><span class="line">    map.<span class="title function_">set</span>(key, depend)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> depend</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡çš„å“åº”å¼</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªåŠ¨ç›‘å¬å¯¹è±¡çš„å±æ€§å˜åŒ–</span></span><br><span class="line"><span class="keyword">const</span> objProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123; </span><br><span class="line">  <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®target,keyè·å–å¯¹åº”çš„depend</span></span><br><span class="line">    <span class="keyword">const</span> depend = <span class="title function_">getDepends</span>(target, key)</span><br><span class="line">    <span class="comment">// ç»™dependå¯¹è±¡ä¸­æ·»åŠ å“åº”å¼å‡½æ•°</span></span><br><span class="line">    depend.<span class="title function_">depend</span>()     <span class="comment">// æ”¹ï¼</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">target, key, newValue, receiver</span>) &#123;</span><br><span class="line">    <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, newValue, receiver)</span><br><span class="line">    <span class="keyword">const</span> depend = <span class="title function_">getDepends</span>(target, key)</span><br><span class="line">    depend.<span class="title function_">notify</span>() <span class="comment">// åœ¨è¿™é‡Œæ‰§è¡Œ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name&#x27;</span>, objProxy.<span class="property">name</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name22&#x27;</span>, objProxy.<span class="property">name</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;----------ä¿®æ”¹å‰---&#x27;</span>);</span><br><span class="line">objProxy.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39ebfc7d446f4a39a043c616e3785e3f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h3 id="å¯¹è±¡çš„å“åº”å¼æ“ä½œ">å¯¹è±¡çš„å“åº”å¼æ“ä½œ</h3><p>æœ€åä¸€ä¸ªé—®é¢˜ï¼Œå‰é¢æˆ‘ä»¬éƒ½æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡ï¼ˆobjï¼‰å®ç°å“åº”å¼ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯å¤šä¸ªå¯¹è±¡å‘¢ï¼Ÿ</p><p>æ‰€ä»¥æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªå‡½æ•°<code>reactive</code>ï¼Œé’ˆå¯¹æ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥å˜æˆå“åº”å¼å¯¹è±¡</p><p>ä¹Ÿå°±æ˜¯å®ç°å¤šä¸ªå¯¹è±¡çš„å“åº”å¼</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¿å­˜å½“å‰éœ€è¦æ”¶é›†çš„å“åº”å¼å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> activeReactiveFn = <span class="literal">null</span>   </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Depend</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span> = <span class="keyword">new</span> <span class="title class_">Set</span>()   </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">depend</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (activeReactiveFn) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">add</span>(activeReactiveFn) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reactiveFns</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">fn</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…ä¸€ä¸ªå“åº”å¼çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">watchFn</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  activeReactiveFn = fn</span><br><span class="line">  <span class="title function_">fn</span>() <span class="comment">// ç”¨åŸæ•°æ®å…ˆæ‰§è¡Œä¸€æ¬¡å‡½æ•°, æ”¶é›†ä¾èµ–</span></span><br><span class="line">  activeReactiveFn = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…ä¸€ä¸ªè·å–dependçš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDepends</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> map = targetMap.<span class="title function_">get</span>(target)</span><br><span class="line">  <span class="keyword">if</span> (!map) &#123;</span><br><span class="line">    map = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    targetMap.<span class="title function_">set</span>( target, map)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®keyè·å–ä¾èµ–</span></span><br><span class="line">  <span class="keyword">let</span> depend = map.<span class="title function_">get</span>(key)</span><br><span class="line">  <span class="keyword">if</span> (!depend) &#123;</span><br><span class="line">    depend = <span class="keyword">new</span> <span class="title class_">Depend</span>()</span><br><span class="line">    map.<span class="title function_">set</span>(key, depend)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> depend</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªå“åº”å¼å¯¹è±¡  // æ”¹ï¼ï¼ï¼</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;  </span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">      <span class="comment">// æ ¹æ®target,keyè·å–å¯¹åº”çš„depend</span></span><br><span class="line">      <span class="keyword">const</span> depend = <span class="title function_">getDepends</span>(target, key)</span><br><span class="line">      <span class="comment">// ç»™dependå¯¹è±¡ä¸­æ·»åŠ å“åº”å¼å‡½æ•°</span></span><br><span class="line">      depend.<span class="title function_">depend</span>()     <span class="comment">// æ”¹ï¼</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">target, key, newValue, receiver</span>) &#123;</span><br><span class="line">      <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, newValue, receiver)</span><br><span class="line">      <span class="keyword">const</span> depend = <span class="title function_">getDepends</span>(target, key)</span><br><span class="line">      depend.<span class="title function_">notify</span>() <span class="comment">// åœ¨è¿™é‡Œæ‰§è¡Œ</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠéœ€è¦å“åº”å¼çš„å¯¹è±¡ä¼ åˆ°reactiveå‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> obj = <span class="title function_">reactive</span>(&#123;     <span class="comment">// æ”¹ï¼ï¼</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> info = <span class="title function_">reactive</span>(&#123;    <span class="comment">// æ”¹ï¼ï¼</span></span><br><span class="line">  <span class="attr">height</span>: <span class="number">1.88</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;     </span><br><span class="line">  <span class="comment">// æ³¨æ„è¿™é‡Œ å› ä¸ºreactiveè¿”å›çš„å°±æ˜¯ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬ç”¨objæ¥æ”¶ï¼Œobjå°±æ˜¯å“åº”å¼çš„äº†,æ‰€ä»¥ç›´æ¥å¯¹objæ“ä½œ</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name&#x27;</span>, obj.<span class="property">name</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name22&#x27;</span>, obj.<span class="property">name</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchFn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;height&#x27;</span>, info.<span class="property">height</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;--------------ä¿®æ”¹å‰---&#x27;</span>);</span><br><span class="line"></span><br><span class="line">info.<span class="property">height</span> = <span class="number">1.78</span></span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;kkk&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ce8b15ee6e64351b51a599174ab05ce~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>åˆ°æ­¤ï¼æˆ‘ä»¬çš„å“åº”å¼å°±å®ç°å®Œæˆäº†</p><h3 id="Vue2å“åº”å¼åŸç†">Vue2å“åº”å¼åŸç†</h3><p>å‰é¢æ‰€å®ç°çš„å“åº”å¼çš„ä»£ç ï¼Œå…¶å®æ˜¯Vue3ä¸­çš„å“åº”å¼åŸç†</p><p>Vue3ä¸»è¦æ˜¯é€šè¿‡Proxyæ¥ç›‘å¬æ•°æ®çš„å˜åŒ–ä»¥åŠæ”¶é›†ç›¸å…³ çš„ä¾èµ–çš„</p><p>è€ŒVue2æ˜¯é€šè¿‡Object.defineProerty çš„æ–¹å¼æ¥å®ç°å¯¹è±¡å±æ€§çš„ç›‘å¬</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> value = obj[key]</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> depend = <span class="title function_">getDepends</span>(obj, key)</span><br><span class="line">        depend.<span class="title function_">depend</span>()</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> depend = <span class="title function_">getDepends</span>(obj, key) </span><br><span class="line">        value = newValue</span><br><span class="line">        depend.<span class="title function_">notify</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¼ å…¥å¯¹è±¡çš„æ—¶å€™ï¼Œéå†æ‰€æœ‰çš„keyï¼Œå¹¶ä¸”é€šè¿‡å±æ€§å­˜å‚¨æè¿°ç¬¦æ¥ç›‘å¬å±æ€§çš„è·å–å’Œä¿®æ”¹ï¼Œ</p><p>å…¶ä»–çš„é€»è¾‘å’Œå‰é¢Vue3çš„å“åº”å¼å®ç°æ˜¯ä¸€è‡´çš„</p>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>10_ES6-ES12çŸ¥è¯†ç‚¹</title>
      <link href="/2022/04/10/10_ES6-ES12%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
      <url>/2022/04/10/10_ES6-ES12%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<h2 id="ES6">ES6</h2><h3 id="å­—é¢é‡çš„å¢å¼º">å­—é¢é‡çš„å¢å¼º</h3><p>å±æ€§ï¼ˆProperty Shorthandï¼‰ã€æ–¹æ³•ï¼ˆMethod Shorthandï¼‰çš„ç®€å†™ï¼Œè®¡ç®—å±æ€§åï¼ˆComputed Property Namesï¼‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;fks&#x27;</span></span><br><span class="line"><span class="keyword">var</span> age = <span class="number">20</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="comment">// 1. å±æ€§çš„ç®€å†™</span></span><br><span class="line">  <span class="comment">// name: name</span></span><br><span class="line">  name,</span><br><span class="line">  age,</span><br><span class="line">  <span class="comment">// 2. æ–¹æ³•çš„ç®€å†™</span></span><br><span class="line">  <span class="comment">// foo: function() &#123;&#125;,</span></span><br><span class="line">  <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;, <span class="comment">// obj.foo() thisæ˜¯obj</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// è¿™æ˜¯ä¸ä¸€æ ·çš„</span></span><br><span class="line">  <span class="comment">// foo: () =&gt; &#123;&#125; // thisæ˜¯å…¨å±€</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.è®¡ç®—å±æ€§å</span></span><br><span class="line">  [name + <span class="number">123</span>]: <span class="string">&#x27;hahahah&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">foo</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); </span><br><span class="line"><span class="comment">// &#123; name: &#x27;fks&#x27;, age: 20, foo: [Function: foo], fks123: &#x27;hahahah&#x27; &#125;</span></span><br></pre></td></tr></table></figure><h3 id="è§£æ„Destructuring">è§£æ„Destructuring</h3><ul><li>è§£æ„æ•°ç»„</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> names = [<span class="string">&quot;asd&quot;</span>, <span class="string">&#x27;fgd&#x27;</span>, <span class="string">&#x27;dkb&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ¬æ¥æ ¹æ®ç´¢å¼•æ‹¿å€¼</span></span><br><span class="line"><span class="comment">// var item1 = names[0]</span></span><br><span class="line"><span class="comment">// var item2 = names[1]</span></span><br><span class="line"><span class="comment">// var item3 = names[2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ„</span></span><br><span class="line"><span class="keyword">var</span> [item1, item2, item3] = names</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(item1, item2, item3);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ„åé¢çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">var</span> [ , , itemz] = names</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(itemz);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ„ä¸€ä¸ªå…ƒç´ ï¼Œåé¢çš„å…ƒç´ æ”¾åˆ°ä¸€ä¸ªæ–°æ•°ç»„</span></span><br><span class="line"><span class="keyword">var</span> [itemx, ...newNames] = names</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(itemx, newNames) <span class="comment">// asd [ &#x27;fgd&#x27;, &#x27;dkb&#x27; ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ„çš„é»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">var</span> [itema, itemb, itemc, itemd = <span class="string">&quot;ddd&quot;</span>] = names</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(itemd);</span><br></pre></td></tr></table></figure><ul><li><p>è§£æ„å¯¹è±¡</p><p>æ ¹æ®keyè§£æ„</p></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;asd&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">1.88</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸è§„å®šé¡ºåºï¼Œåªæ ¹æ®keyæ¥è§£æ„</span></span><br><span class="line"><span class="keyword">var</span> &#123;age, name&#125; = obj</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(age, name); <span class="comment">// 20 asd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥å¯¹keyæ–°å‘½å</span></span><br><span class="line"><span class="keyword">var</span> &#123; <span class="attr">name</span>: newName &#125; = obj</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newName);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥è®¾ç½®é»˜è®¤å€¼,å¦‚æœå±æ€§ä¸å­˜åœ¨,ä¼šä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">var</span> &#123; <span class="attr">address</span>: newAddress = <span class="string">&#x27;å¹¿å·&#x27;</span> &#125; = obj</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newAddress); <span class="comment">// å¹¿å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å‡½æ•°å‚æ•°ä¸­è§£æ„</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">&#123;name, age&#125;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(name, age);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(obj) <span class="comment">// asd 20</span></span><br></pre></td></tr></table></figure><h3 id="let-const">let/const</h3><h4 id="let-constä½¿ç”¨">let/constä½¿ç”¨</h4><p>let å£°æ˜ä¸€ä¸ªå˜é‡</p><p>const å£°æ˜ä¸€ä¸ªå¸¸é‡ã€è¡¡é‡ï¼ˆconstantï¼‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="string">&#x27;foo&#x27;</span></span><br><span class="line"><span class="keyword">let</span> bar = <span class="string">&#x27;bar&#x27;</span> <span class="comment">//å®šä¹‰å˜é‡</span></span><br><span class="line"><span class="keyword">const</span> baz = <span class="string">&#x27;baz&#x27;</span> <span class="comment">// å¸¸é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„1ï¼šconst æœ¬è´¨ä¸Šæ˜¯ä¼ é€’çš„å€¼ä¸å¯ä»¥ä¿®æ”¹ï¼Œå¦‚æœä¼ é€’çš„æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼ˆå†…å­˜åœ°å€ï¼‰ï¼Œæ˜¯å¯ä»¥é€šè¿‡å¼•ç”¨æ‰¾åˆ°å¯¹åº”çš„å¯¹è±¡å»ä¿®æ”¹å†…éƒ¨çš„å±æ€§å€¼çš„</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;bbb&#x27;</span> <span class="comment">//å¯ä»¥æ”¹</span></span><br><span class="line">obj = &#123;&#125; <span class="comment">// ä¸å¯ä»¥æ”¹ TypeError: Assignment to constant variable.</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// let / const å®šä¹‰çš„å˜é‡åæ˜¯ä¸å¯ä»¥é‡å¤å®šä¹‰çš„</span></span><br><span class="line"><span class="keyword">let</span> foo = <span class="string">&#x27;foo&#x27;</span></span><br><span class="line"><span class="keyword">let</span> foo = <span class="string">&#x27;foo2&#x27;</span> <span class="comment">// Identifier &#x27;foo&#x27; has already been declared</span></span><br></pre></td></tr></table></figure><h4 id="let-constä½œç”¨åŸŸæå‡">let/constä½œç”¨åŸŸæå‡</h4><ul><li><p>ä½¿ç”¨letå£°æ˜çš„å˜é‡ï¼Œåœ¨å£°æ˜ä¹‹å‰è®¿é—®ä¼šæŠ¥é”™</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo);</span><br><span class="line"><span class="keyword">var</span> foo = <span class="string">&#x27;foo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar); <span class="comment">// å£°æ˜ä¹‹å‰è®¿é—®ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">// åœ¨è¿™é‡Œbarå·²ç»è¢«åˆ›å»ºå‡ºæ¥äº†</span></span><br><span class="line"><span class="keyword">let</span> bar = <span class="string">&#x27;bar&#x27;</span> <span class="comment">// Reference(å¼•ç”¨)Error: Cannot access &#x27;bar&#x27; before initialization</span></span><br></pre></td></tr></table></figure></li><li><p>é‚£ä¹ˆæ˜¯ä¸æ˜¯æ„å‘³ç€fooå˜é‡åªæœ‰åœ¨ä»£ç æ‰§è¡Œé˜¶æ®µæ‰ä¼šåˆ›å»ºå‘¢ï¼Ÿ</p><ul><li>äº‹å®ä¸Šå¹¶ä¸æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ECMA262å¯¹ let å’Œ const çš„æè¿°</li></ul><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0603965a6f6f4d9fb8e842bcb0f1e7f4~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><ul><li>è¿™äº›å˜é‡ä¼šè¢«åˆ›å»ºåœ¨åŒ…å«ä»–ä»¬çš„è¯æ³•ç¯å¢ƒè¢«å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œä½†æ˜¯æ˜¯ä¸å¯ä»¥è®¿é—®å®ƒä»¬çš„ï¼Œç›´åˆ°è¯æ³•ç»‘å®šè¢«æ±‚å€¼</li></ul></li><li><p>é‚£ let/constæœ‰æ²¡æœ‰ä½œç”¨åŸŸæå‡å‘¢ï¼Ÿ</p><p>ä½œç”¨åŸŸæå‡ï¼šåœ¨å£°æ˜å˜é‡çš„ä½œç”¨åŸŸä¸­ï¼Œå¦‚æœè¿™ä¸ªå˜é‡å¯ä»¥åœ¨å£°æ˜ä¹‹å‰è¢«è®¿é—®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºä½œç”¨åŸŸæå‡</p><p>æ‰€ä»¥è¢«åˆ›å»ºå‡ºæ¥äº†ï¼Œä½†ä¸èƒ½è¢«è®¿é—®ï¼Œä¸èƒ½ç§°ä¹‹ä¸ºä½œç”¨åŸŸæå‡</p><p>æ€»ç»“ï¼šletã€constæ²¡æœ‰è¿›è¡Œä½œç”¨åŸŸæå‡ï¼Œä½†æ˜¯ä¼šåœ¨è§£æé˜¶æ®µè¢«åˆ›å»ºå‡ºæ¥ã€</p></li></ul><h4 id="let-constå˜é‡ä¿å­˜">let/constå˜é‡ä¿å­˜</h4><p>let / const åœ¨å…¨å±€å£°æ˜å˜é‡ä¿å­˜åœ¨å“ªé‡Œäº†ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="string">&#x27;foo&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">foo</span>); <span class="comment">// foo</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bar = <span class="string">&#x27;bar&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">bar</span>); <span class="comment">// undefined æ‰€ä»¥ä¸åœ¨window</span></span><br></pre></td></tr></table></figure><ul><li>let, const æ˜¯ä¸ä¼šç»™windowæ·»åŠ ä»»ä½•å±æ€§çš„</li><li>æœ€æ–°çš„ECMAæ ‡å‡†ä¸­å¯¹æ‰§è¡Œä¸Šä¸‹æ–‡çš„æè¿°</li></ul><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cef4d8ab524242eb92e470879b79e1cd~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å£°æ˜çš„å˜é‡å’Œç¯å¢ƒè®°å½•æ˜¯è¢«æ·»åŠ åˆ°å˜é‡ç¯å¢ƒä¸­çš„ï¼ˆåœ¨ä¸€ä¸ªå¯¹è±¡ä¿å­˜ï¼‰</p><ul><li><p>ä½†æ˜¯æ ‡å‡†æ²¡æœ‰è§„å®šè¿™ä¸ªå¯¹è±¡æ˜¯ windowå¯¹è±¡æˆ–è€…æ˜¯å…¶ä»–å¯¹è±¡</p></li><li><p>æ‰€ä»¥JSå¼•æ“åœ¨è§£æçš„æ—¶å€™ï¼Œä¼šæœ‰è‡ªå·±çš„å®ç°</p></li><li><p>æ¯”å¦‚v8ä¸­å…¶å®æ˜¯é€šè¿‡VariableMapçš„ä¸€ä¸ªhashmapæ¥å®ç°å®ƒä»¬çš„å­˜å‚¨çš„</p></li><li><p>é‚£ä¹ˆwindowå¯¹è±¡å‘¢ï¼Ÿ</p><p>windowå¯¹è±¡æ˜¯æ—©èµ·çš„GOå¯¹è±¡ï¼Œåœ¨æœ€æ–°çš„å®ç°ä¸­å…¶å®æ˜¯æµè§ˆå™¨æ·»åŠ çš„å…¨å±€å¯¹è±¡ï¼Œå¹¶ä¸” ä¸€ç›´ä¿æŒäº†windowå’Œvarä¹‹é—´å€¼çš„ç›¸ç­‰æ€§</p></li></ul><h3 id="å—çº§ä½œç”¨åŸŸ">å—çº§ä½œç”¨åŸŸ</h3><h4 id="var-æ²¡æœ‰å—çº§ä½œç”¨åŸŸ">var æ²¡æœ‰å—çº§ä½œç”¨åŸŸ</h4><ul><li><p>ES5ä¸­ï¼ŒJSåªä¼šå½¢æˆä¸¤ä¸ªä½œç”¨åŸŸï¼š<strong>å…¨å±€ä½œç”¨åŸŸ</strong>å’Œ<strong>å‡½æ•°ä½œç”¨åŸŸ</strong></p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ff3d4f044c04d0784db93893047e23d~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /></li><li><p>var æ²¡æœ‰å—çº§ä½œç”¨åŸŸ</p><p>ES5ä¸­æ”¾åˆ°ä¸€ä¸ªä»£ç ä¸­å®šä¹‰çš„å˜é‡ï¼Œå¤–é¢æ˜¯å¯ä»¥è®¿é—®çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> foo = <span class="string">&quot;foo&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo); <span class="comment">// foo</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="let-const-çš„å—çº§ä½œç”¨åŸŸ">let / const çš„å—çº§ä½œç”¨åŸŸ</h4><p>ES6ä¸­æ–°å¢äº†å—çº§ä½œç”¨åŸŸï¼Œé€šè¿‡letã€constã€functionã€class å£°æ˜çš„æ ‡è¯†ç¬¦æ˜¯å…·å¤‡å—çº§ä½œç”¨åŸŸçš„é™åˆ¶çš„</p><p>æ³¨æ„å‡½æ•°ï¼ŒæŸäº›å¼•æ“ä¼šå¯¹å‡½æ•°çš„å£°æ˜è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå…è®¸åƒvaré‚£æ ·æå‡</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> foo = <span class="string">&quot;aaa&quot;</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">demo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;demo function&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Person</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(foo); // ReferenceError: foo is not defined\</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹äºå‡½æ•°,ä¸åŒçš„æµè§ˆå™¨æœ‰ä¸åŒå®ç°,(å¤§éƒ¨åˆ†æµè§ˆå™¨ä¸ºäº†å…¼å®¹ä»¥å‰çš„ä»£ç .è®©functionæ²¡æœ‰å—çº§ä½œç”¨åŸŸ) æ‰€ä»¥è¿™é‡Œå¯ä»¥è®¿é—®demo</span></span><br><span class="line"><span class="comment">// demo() // demo function å¯ä»¥è®¿é—®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>() <span class="comment">// ReferenceError: Person is not defined</span></span><br></pre></td></tr></table></figure><ul><li>if/switch/for è¯­å¥çš„ä»£ç å°±æ˜¯å—çº§ä½œç”¨åŸŸ</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ifè¯­å¥çš„ä»£ç å°±æ˜¯å—çº§ä½œç”¨åŸŸ</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> foo = <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo); <span class="comment">// ä¸èƒ½è®¿é—®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// switch</span></span><br><span class="line"><span class="keyword">switch</span> (color) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;red&quot;</span>: </span><br><span class="line">    <span class="keyword">let</span> bar = <span class="string">&quot;bar&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar); <span class="comment">// ä¸èƒ½è®¿é—®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// for</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¾ªç¯æ‰§è¡Œç»“æŸ, å…¨å±€ä¸­ i æ˜¯ 6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// 6 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœç”¨let</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">6</span>; j++) &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¾ªç¯ç»“æŸå, å…¨å±€ä¸­å¹¶ä¸èƒ½è®¿é—®j</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(j); <span class="comment">// j is not defined</span></span><br></pre></td></tr></table></figure><h4 id="å—çº§ä½œç”¨åŸŸçš„åº”ç”¨åœºæ™¯">å—çº§ä½œç”¨åŸŸçš„åº”ç”¨åœºæ™¯</h4><p>ä¸€ä¸ªå¾ªç¯æ‰“å°çš„é—®é¢˜</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„setTimeoutæ˜¯å®ä»»åŠ¡,å¾ªç¯ç»“æŸåæ‰æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// æ‰“å° 6 ä¸ª 6,æ‰“å°çš„æ˜¯å…¨å±€çš„ i</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€ç§è§£å†³æ–¹æ³•ï¼Œç«‹å³æ‰§è¡Œå‡½æ•°</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">  (<span class="keyword">function</span>(<span class="params">i</span>) &#123;</span><br><span class="line">    <span class="comment">// æ‰“å°çš„æ—¶å€™å¾€ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾,æ‰¾è¿™é‡Œçš„i</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// 0 1 2 3 4 5</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœç”¨let,ä¸€æ¬¡å¾ªç¯ä¸€ä¸ªå—,äº’ä¸å½±å“</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">6</span>; j++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(j); <span class="comment">// 0 1 2 3 4 5 </span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>constæ³¨æ„çš„åœ°æ–¹</strong></p><p>å› ä¸ºæœ‰ i++ï¼Œç¬¬äºŒæ¬¡å¾ªç¯éœ€è¦ç”¨åˆ°ç¬¬ä¸€æ¬¡å¾ªç¯çš„iå»++ï¼Œconstå®šä¹‰çš„æ˜¯å¸¸é‡ï¼Œæ˜¯ä¸å¯ä»¥æ”¹å˜çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TypeError: Assignment to constant variable.</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ES6æ–°å¢çš„ forâ€¦ofå¯ä»¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> names) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡éƒ½ä¼šæœ‰ä¸€ä¸ªæ–°çš„const itemï¼Œåœ¨ä¸åŒçš„å—çº§ä½œç”¨åŸŸä¸­</p><h4 id="æš‚æ—¶æ€§æ­»åŒº">æš‚æ—¶æ€§æ­»åŒº</h4><p>åœ¨ä¸€ä¸ªä»£ç ä¸­ï¼Œä½¿ç”¨letã€constå£°æ˜çš„å˜é‡ï¼Œåœ¨å£°æ˜ä¹‹å‰éƒ½æ˜¯ä¸å¯ä»¥è®¿é—®çš„</p><p>è¿™ç§ç°è±¡ç§°ä¹‹ä¸ºæš‚æ—¶æ€§æ­»åŒº</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(bar); <span class="comment">// ä¸å¯è®¿é—®</span></span><br><span class="line">  <span class="keyword">let</span> bar = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>()</span><br></pre></td></tr></table></figure><h3 id="å…³äºå­—ç¬¦ä¸²">å…³äºå­—ç¬¦ä¸²</h3><h4 id="æ¨¡æ¿å­—ç¬¦ä¸²">æ¨¡æ¿å­—ç¬¦ä¸²</h4><p>ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;sfa&#x27;</span></span><br><span class="line"><span class="keyword">const</span> age = <span class="number">18</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> message = <span class="string">`my name is <span class="subst">$&#123;name&#125;</span>, age is <span class="subst">$&#123;age&#125;</span>`</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(message); <span class="comment">// my name is sfa, age is 18</span></span><br></pre></td></tr></table></figure><p>${}é‡Œé¢ä¹Ÿå¯ä»¥æ˜¯è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">`age is <span class="subst">$&#123;age * <span class="number">2</span>&#125;</span>`</span></span><br><span class="line"><span class="keyword">const</span> str2 = <span class="string">`double age is <span class="subst">$&#123;doubleAge()&#125;</span>`</span></span><br></pre></td></tr></table></figure><h4 id="æ ‡ç­¾å­—ç¬¦ä¸²">æ ‡ç­¾å­—ç¬¦ä¸²</h4><blockquote><p>åº”è¯¥å¾ˆå°‘ç”¨åˆ°</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¨¡å—å­—ç¬¦ä¸²ä¸­çš„æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯è¢«åˆ‡æˆå¤šå—æ”¾åˆ°ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">m, n, x</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(m, n, x);</span><br><span class="line">  <span class="comment">// [ &#x27;Hello&#x27;, &#x27;World&#x27;, &#x27;aaa&#x27; ] yuzi 18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥è¿™æ ·å»è°ƒç”¨ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="comment">// foo``</span></span><br><span class="line"><span class="comment">// å½“ç„¶ä¹Ÿå¯ä»¥ä¼ å‚</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;yuzi&#x27;</span></span><br><span class="line"><span class="keyword">const</span> age = <span class="number">18</span></span><br><span class="line">foo<span class="string">`Hello<span class="subst">$&#123;name&#125;</span>World<span class="subst">$&#123;age&#125;</span>aaa`</span></span><br></pre></td></tr></table></figure><h3 id="å…³äºå‡½æ•°">å…³äºå‡½æ•°</h3><h4 id="å‡½æ•°çš„é»˜è®¤å‚æ•°">å‡½æ•°çš„é»˜è®¤å‚æ•°</h4><p>å¦‚æœæ²¡æœ‰ä¼ å‚ï¼Œå°±ä¼šç”¨é»˜è®¤å‚æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">m = <span class="string">&#x27;aaa&#x27;</span>, n = <span class="string">&#x27;bbb&#x27;</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(m, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é»˜è®¤å‚æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥å¯¹å¯¹è±¡è§£æ„ï¼Œæœ‰ä¸¤ç§è§£æ„æ–¹å¼</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">&#123;name, age&#125; = &#123;name: <span class="string">&#x27;asd&#x27;</span>, age: <span class="number">18</span>&#125;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(name, age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo2</span>(<span class="params">&#123;name = <span class="string">&#x27;asd&#x27;</span>, age = <span class="number">18</span>&#125; = &#123;&#125;</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–æ³¨æ„ï¼šé»˜è®¤å½¢å‚æœ€å¥½æ”¾åˆ°æœ€å</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params">x, y, z = <span class="number">30</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x, y, z)</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// è·å– å‡½æ•°çš„lengthå€¼çš„æ—¶å€™ï¼Œåªè·å–é»˜è®¤å½¢å‚ä¹‹å‰çš„å‚æ•°ä¸ªæ•°</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar.<span class="property">length</span>); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><h4 id="å‡½æ•°çš„å‰©ä½™å‚æ•°">å‡½æ•°çš„å‰©ä½™å‚æ•°</h4><p>å‰©ä½™å‚æ•°å¿…é¡»æ”¾åˆ°æœ€å</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b, ...args</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, args); <span class="comment">// 1 2 [ 3, 4, 5, 6 ]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br></pre></td></tr></table></figure><h4 id="ç®­å¤´å‡½æ•°çš„è¡¥å……">ç®­å¤´å‡½æ•°çš„è¡¥å……</h4><p>æ²¡æœ‰è‡ªå·±çš„thisï¼Œæ²¡æœ‰arguments</p><p>æ²¡æœ‰æ˜¾å¼åŸå‹ï¼Œæ‰€ä»¥ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨newåˆ›å»ºå¯¹è±¡</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">bar</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="keyword">new</span> <span class="title function_">bar</span>() <span class="comment">// TypeError: bar is not a constructor</span></span><br></pre></td></tr></table></figure><h3 id="å±•å¼€è¯­æ³•â€¦">å±•å¼€è¯­æ³•â€¦</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> names = [<span class="string">&#x27;aaa&#x27;</span>,<span class="string">&#x27;bbb&#x27;</span>,<span class="string">&#x27;ccc&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> name2 = <span class="string">&#x27;kkk&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x, y, z</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x, y, z);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1. å‡½æ•°è°ƒç”¨æ—¶ä½¿ç”¨</span></span><br><span class="line"><span class="title function_">foo</span>(...names) <span class="comment">// aaa bbb ccc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ„é€ æ•°ç»„æ—¶</span></span><br><span class="line"><span class="keyword">const</span> newNames = [...names, ...name2]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newNames);</span><br><span class="line"><span class="comment">// [ &#x27;aaa&#x27;, &#x27;bbb&#x27;, &#x27;ccc&#x27;, &#x27;k&#x27;, &#x27;k&#x27;, &#x27;k&#x27; ]</span></span><br><span class="line"><span class="comment">// æ³¨æ„è¿™é‡ŒæŠŠå­—ç¬¦ä¸²å±•å¼€äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.æ„å»ºå¯¹è±¡å­—é¢é‡æ—¶ ES2018(ES9)</span></span><br><span class="line"><span class="keyword">const</span> info = &#123;<span class="attr">name</span>: <span class="string">&#x27;ggg&#x27;</span>, <span class="attr">height</span>: <span class="number">1.88</span>&#125;</span><br><span class="line"><span class="comment">// æ‹·è´infoçš„å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥æ·»åŠ æ–°çš„å±æ€§</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;...info, <span class="attr">address</span>: <span class="string">&#x27;å¹¿å·å¸‚&#x27;</span>&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line"><span class="comment">// &#123; name: &#x27;ggg&#x27;, height: 1.88, address: &#x27;å¹¿å·å¸‚&#x27; &#125;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå±•å¼€è¿ç®—ç¬¦å…¶å®æ˜¯ä¸€ç§æµ…æ‹·è´</p><blockquote><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼Œæ‹·è´çš„åœ°å€ï¼ŒæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> info = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;fff&#x27;</span>,</span><br><span class="line">  <span class="attr">hobby</span>: &#123;</span><br><span class="line">    <span class="attr">h1</span>: <span class="string">&#x27;study&#x27;</span>,</span><br><span class="line">    <span class="attr">h2</span>: <span class="string">&#x27;swim&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newInfo = &#123;...info&#125;</span><br><span class="line">newInfo.<span class="property">hobby</span>.<span class="property">h1</span> = <span class="string">&#x27;sss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="property">hobby</span>.<span class="property">h1</span>); <span class="comment">// sss åŸæ¥çš„infoä¹Ÿæ”¹äº†</span></span><br></pre></td></tr></table></figure><h3 id="è¡¨ç¤ºæ•°å€¼çš„æ–¹æ³•-è¿›åˆ¶">è¡¨ç¤ºæ•°å€¼çš„æ–¹æ³•(è¿›åˆ¶)</h3><p>obå¼€å¤´(binary)ï¼šäºŒè¿›åˆ¶ï¼Œ0oå¼€å¤´(octonary)ï¼šå…«è¿›åˆ¶ï¼Œ0xå¼€å¤´(hexadecimal)ï¼šåå…­è¿›åˆ¶</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> num1 = <span class="number">100</span> <span class="comment">// åè¿›åˆ¶</span></span><br><span class="line"><span class="keyword">const</span> num2 = <span class="number">0b100</span> <span class="comment">// äºŒè¿›åˆ¶</span></span><br><span class="line"><span class="keyword">const</span> num3 = <span class="number">0o100</span> <span class="comment">// å…«è¿›åˆ¶</span></span><br><span class="line"><span class="keyword">const</span> num4 = <span class="number">0x100</span> <span class="comment">// åå…­è¿›åˆ¶</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num1, num2, num3, num4); <span class="comment">// 100 4 64 256</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œå¤§çš„æ•°å€¼æœ‰ä¸€ä¸ªè¿æ¥ç¬¦ï¼Œä¾¿äºé˜…è¯»(ES2021 ES12)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> num = <span class="number">10_000_000_000_000</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num); <span class="comment">// 10000000000000</span></span><br></pre></td></tr></table></figure><h3 id="Symbolçš„ä½¿ç”¨">Symbolçš„ä½¿ç”¨</h3><blockquote><p>ä¸»è¦æ˜¯ç”¨æ¥åˆ›å»ºç‹¬ä¸€æ— äºŒçš„keyå€¼ï¼Œæ³¨æ„ä½¿ç”¨çš„æ—¶å€™ä¸è¦ç”¨new</p></blockquote><p>åˆ›å»ºSymbol</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> s1 = <span class="title class_">Symbol</span>()</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="title class_">Symbol</span>() <span class="comment">// s1,s2æ˜¯ä¸ä¸€æ ·çš„</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s1 === s2); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES2019(ES10)ä¸­, Symbolè¿˜æœ‰ä¸€ä¸ªæè¿°(description)</span></span><br><span class="line"><span class="comment">// ä¾¿äºæ ‡è®°æ˜¯å“ªä¸ªsymbolï¼Œå°±åƒæ˜¯æ ‡ç­¾</span></span><br><span class="line"><span class="keyword">const</span> s3 = <span class="title class_">Symbol</span>(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s3); <span class="comment">// Symbol(aaa)</span></span><br><span class="line"><span class="comment">// å¯ä»¥æ‹¿åˆ°è¿™ä¸ªæè¿°</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s3.<span class="property">description</span>); <span class="comment">// &#x27;aaa&#x27;</span></span><br></pre></td></tr></table></figure><p>åœ¨å¯¹è±¡ä¸­ä½œä¸ºkeyä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  [s1]: <span class="string">&#x27;yyy&#x27;</span>,</span><br><span class="line">  [s2]: <span class="string">&#x27;mmm&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å±æ€§å€¼</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj[s1]); <span class="comment">// &#x27;yyy&#x27;</span></span><br><span class="line"><span class="comment">// æ–°å¢å±æ€§å€¼</span></span><br><span class="line">obj[s3] = <span class="string">&#x27;kkk&#x27;</span></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥Object.defineProperty()æ–¹æ³•æ·»åŠ å±æ€§</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, s4, &#123;&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šè·å–å±æ€§å€¼çš„æ—¶å€™ä¸èƒ½é€šè¿‡ . è¯­æ³•è·å–ï¼Œå› ä¸º . åé¢çš„æ˜¯ä¼šè¢«å½“åšå­—ç¬¦ä¸²</p><p>obj.s1ï¼Œé‚£ä¹ˆå°±ä¼šå»æ‰¾objä¸Škeyä¸ºâ€™s1â€™è¿™ä¸ªå±æ€§å€¼</p></blockquote><p>ä½¿ç”¨Symbolä½œä¸ºkeyçš„å±æ€§åï¼Œåœ¨éå†çš„æ—¶å€™æ˜¯è·å–ä¸åˆ°çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(obj)); <span class="comment">// []</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(obj)); <span class="comment">// []</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦è·å–çš„è¯å¯ä»¥ä½¿ç”¨ Object.getOwnPropertySymbols()æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sKeys = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertySymbols</span>(obj)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sKeys); <span class="comment">// [ Symbol(), Symbol(), Symbol(aaa) ]</span></span><br></pre></td></tr></table></figure><p>æ€ä¹ˆè®©ä¸¤ä¸ªSymbolç›¸ç­‰ï¼Ÿ</p><blockquote><p><code>Symbol.for(key)</code> æ–¹æ³•ä¼šæ ¹æ®ç»™å®šçš„é”® <code>key</code>ï¼Œæ¥ä»è¿è¡Œæ—¶çš„ symbol æ³¨å†Œè¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„ symbol</p><p>æ³¨æ„è¿™è·Ÿ Symbol(â€˜aaaâ€™) æ ‡ç­¾æ˜¯ä¸ä¸€æ ·çš„å“¦</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¹Ÿå°±æ˜¯ç»™symbolä¸€ä¸ªkey</span></span><br><span class="line"><span class="keyword">const</span> sa = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&quot;aaa&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> sb = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&quot;aaa&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sa === sb); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>æ ¹æ® symbolå€¼è·å–key</p><blockquote><p><code>Symbol.keyFor(sym)</code> æ–¹æ³•ç”¨æ¥è·å–å…¨å±€symbol æ³¨å†Œè¡¨ä¸­ä¸æŸä¸ª symbol å…³è”çš„é”®</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> key = <span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(sa)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// aaa</span></span><br></pre></td></tr></table></figure><h3 id="Set">Set</h3><blockquote><p>æ–°å¢çš„ä¸€ç§æ•°æ®ç»“æ„ï¼ˆå­˜å‚¨æ•°æ®çš„æ–¹å¼ï¼‰</p><p>æ˜¯é›†åˆï¼Œé‡Œé¢çš„å…ƒç´ ä¸é‡å¤</p></blockquote><ul><li>åˆ›å»ºsetå’Œæ·»åŠ å…ƒç´ </li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. åˆ›å»º</span></span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ å…ƒç´ </span></span><br><span class="line">set.<span class="title function_">add</span>(<span class="number">10</span>)</span><br><span class="line">set.<span class="title function_">add</span>(<span class="number">20</span>)</span><br><span class="line">set.<span class="title function_">add</span>(<span class="number">30</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set); <span class="comment">// Set(3) &#123; 10, 20, 30 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸é‡å¤</span></span><br><span class="line">set.<span class="title function_">add</span>(<span class="number">10</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set);<span class="comment">// Set(3) &#123; 10, 20, 30 &#125;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„æ·»åŠ å¯¹è±¡æ—¶å€™çš„ä¸€ç§æƒ…å†µï¼Œå› ä¸ºæ·»åŠ çš„å¯¹è±¡çš„åœ°å€æ˜¯ä¸ä¸€æ ·çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">set.<span class="title function_">add</span>(&#123;&#125;)</span><br><span class="line">set.<span class="title function_">add</span>(&#123;&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set); <span class="comment">// &#123; &#123;&#125;, &#123;&#125; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹æ·»åŠ çš„æ‰æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line">set.<span class="title function_">add</span>(obj)</span><br><span class="line">set.<span class="title function_">add</span>(obj)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set); <span class="comment">// &#123; &#123;&#125; &#125;</span></span><br></pre></td></tr></table></figure><ul><li>æœ€å¸¸è§çš„åº”ç”¨ï¼šå¯¹æ•°ç»„å»é‡</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å»é‡(æŠŠæ•°ç»„æ”¾è¿›é›†åˆ)</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">10</span>, <span class="number">20</span>]</span><br><span class="line"><span class="keyword">const</span> arrSet = <span class="keyword">new</span> <span class="title class_">Set</span>(arr)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arrSet); <span class="comment">// Set(4) &#123; 10, 20, 30, 40 &#125;</span></span><br></pre></td></tr></table></figure><ul><li>Setçš„å±æ€§</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">set.<span class="property">size</span> è¿”å›å…ƒç´ ä¸ªæ•°</span><br></pre></td></tr></table></figure><ul><li>Setçš„æ–¹æ³•</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">add</span>() æ·»åŠ å…ƒç´ </span><br><span class="line"><span class="title function_">clear</span>() æ¸…ç©ºé›†åˆå…ƒç´ </span><br><span class="line"><span class="title function_">delete</span>(x) åˆ é™¤æŸå…ƒç´ </span><br><span class="line"><span class="title function_">has</span>(x) æ˜¯å¦åŒ…å«xå…ƒç´ </span><br><span class="line"></span><br><span class="line">éå†ï¼šforEach</span><br><span class="line">arrSet.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> arrSet) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="WeakSet">WeakSet</h4><blockquote><p>ç”¨çš„å¾ˆå°‘ï¼Œå¯¹äºWeakSetçš„åº”ç”¨æˆ‘å°±ä¸çº ç»“äº†</p></blockquote><p>WeakSetè·Ÿsetçš„åŒºåˆ«ï¼šWeakSetåªèƒ½å­˜æ”¾å¯¹è±¡ç±»å‹</p><p>WeakSetå¯¹å…ƒç´ çš„å¼•ç”¨æ˜¯å¼±å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–å¼•ç”¨å¯¹æŸä¸ªå¯¹è±¡è¿›è¡Œå¼•ç”¨ï¼Œé‚£ä¹ˆGCå¯ä»¥å¯¹è¯¥å¯¹è±¡è¿›è¡Œå›æ”¶</p><p>å¦å¤–ï¼ŒWeakSetä¸èƒ½éå†ï¼Œå› ä¸ºWeakSetåªæ˜¯å¯¹å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œå¦‚æœæˆ‘ä»¬éå†è·å–åˆ°å…¶ä¸­çš„å…ƒç´ é‚£ä¹ˆæœ‰å¯èƒ½é€ æˆå¯¹è±¡ä¸èƒ½æ­£å¸¸é”€æ¯ï¼Œæ‰€ä»¥å­˜å‚¨åˆ°WeakSetä¸­çš„å¯¹è±¡æ˜¯æ²¡åŠæ³•è·å–çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> weakSet = <span class="keyword">new</span> <span class="title class_">WeakSet</span>()</span><br><span class="line"></span><br><span class="line">weakSet.<span class="title function_">add</span>(<span class="params">&#123;name: <span class="string">&#x27;asd&#x27;</span>&#125;, &#123;&#125;</span>)  &#123; åœ°å€<span class="number">1</span>, åœ°å€<span class="number">2</span> &#125;  å¼±å¼•ç”¨</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(weakSet); <span class="comment">// WeakSet &#123; &lt;items unknown&gt; &#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘å¯¹å¼±å¼•ç”¨çš„ç†è§£</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/18a83978d3d642d1b3d403b13968fb58~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /></blockquote><blockquote><p>å…³äºå¼ºå¼•ç”¨å¼±å¼•ç”¨çš„ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://juejin.cn/post/6993101968545677319#heading-21">https://juejin.cn/post/6993101968545677319#heading-21</a></p></blockquote><h3 id="Map">Map</h3><blockquote><p>ä¸€ç§æ•°æ®ç»“æ„ï¼Œé”®å€¼å¯¹çš„å½¢å¼ï¼Œå¹¶ä¸”é”®å¯ä»¥æ˜¯å¯¹è±¡</p></blockquote><p>æ™®é€šå¯¹è±¡çš„é”®ä¸èƒ½æ˜¯å¯¹è±¡ï¼Ÿä¸èƒ½</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123; <span class="attr">name</span>: <span class="string">&#x27;aaa&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">const</span> obj2 = &#123; <span class="attr">name</span>: <span class="string">&#x27;bbb&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> info = &#123;</span><br><span class="line">  [obj1]: <span class="string">&#x27;qqq&#x27;</span>,</span><br><span class="line">  [obj2]: <span class="string">&#x27;kkk&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info);</span><br><span class="line"><span class="comment">// &#123; &#x27;[object Object]&#x27;: &#x27;kkk&#x27; &#125;</span></span><br><span class="line"><span class="comment">// è¿™ä¸‹æ‡‚äº†å§ï¼Œè¿™ä¸ªé”®ä¼šè¢«è½¬æˆå­—ç¬¦ä¸²&#x27;[object Object]&#x27;,keyé‡å¤äº†ï¼Œå€¼è¦†ç›–äº†</span></span><br></pre></td></tr></table></figure><p>æ€ä¹ˆä½¿ç”¨Mapï¼Ÿ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line"><span class="comment">// æ·»åŠ é”®å€¼</span></span><br><span class="line">map.<span class="title function_">set</span>(obj1, <span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">map.<span class="title function_">set</span>(obj2, <span class="string">&#x27;bbb&#x27;</span>)</span><br><span class="line">map.<span class="title function_">set</span>(<span class="number">1</span>, <span class="string">&#x27;ccc&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map);</span><br><span class="line"><span class="comment">// æ‰“å°</span></span><br><span class="line"><span class="comment">// Map(3) &#123;</span></span><br><span class="line"><span class="comment">//   &#123; name: &#x27;aaa&#x27; &#125; =&gt; &#x27;aaa&#x27;,</span></span><br><span class="line"><span class="comment">//   &#123; name: &#x27;bbb&#x27; &#125; =&gt; &#x27;bbb&#x27;,</span></span><br><span class="line"><span class="comment">//   1 =&gt; &#x27;ccc&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦ä¸€ç§æ·»åŠ ,æŠŠé”®å€¼å¯¹æ”¾åˆ°æ•°ç»„</span></span><br><span class="line"><span class="keyword">const</span> map2 = <span class="keyword">new</span> <span class="title class_">Map</span>([[obj1, <span class="string">&#x27;aaa&#x27;</span>], [obj2, <span class="string">&#x27;bbb&#x27;</span>]])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map2);</span><br><span class="line"><span class="comment">// Map(2) &#123; &#123; name: &#x27;aaa&#x27; &#125; =&gt; &#x27;aaa&#x27;, &#123; name: &#x27;bbb&#x27; &#125; =&gt; &#x27;bbb&#x27; &#125;</span></span><br></pre></td></tr></table></figure><p>æœ‰ä»€ä¹ˆå±æ€§å’Œæ–¹æ³•ï¼Ÿ</p><p>å±æ€§ï¼šsizeï¼šè¿”å›mapå¯¹è±¡çš„æˆå‘˜æ•°é‡</p><p>æ–¹æ³•ï¼š</p><ul><li><p>set(key, value) ï¼šæ·»åŠ ï¼Œè®¾ç½®é”®å€¼ï¼Œè¿”å›æ•´ä¸ªMapå¯¹è±¡</p></li><li><p>get(key)ï¼šæ ¹æ®keyè·å–å€¼</p></li><li><p>has(key)ï¼šæ˜¯å¦å­˜åœ¨æŸä¸€ä¸ªkeyï¼Œè¿”å›å¸ƒå°”å€¼</p></li><li><p>delete(key)ï¼šåˆ é™¤ä¸€ä¸ªé”®å€¼å¯¹ï¼Œè¿”å›å¸ƒå°”å€¼</p></li><li><p>clear()ï¼šæ¸…ç©ºå…ƒç´ </p></li><li><p>éå† forEach()</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// éå†</span></span><br><span class="line">map.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, key</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item, key);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// for..oféå†æ³¨æ„</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="comment">// console.log(item); // è¿™é‡ŒæŠŠä¸€ä¸ªé”®å€¼å¯¹æ”¾åˆ°ä¸€ä¸ªæ•°ç»„äº†</span></span><br><span class="line">  <span class="comment">// [ &#123; name: &#x27;bbb&#x27; &#125;, &#x27;bbb&#x27; ]</span></span><br><span class="line">  <span class="comment">// æ‰€ä»¥å¯ä»¥æ ¹æ®ç´¢å¼•å€¼åˆ†åˆ«æ‹¿ key, value</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item[<span class="number">0</span>], item[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…è¿›è¡Œè§£æ„</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="WeakMap">WeakMap</h4><p>å’ŒMapæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><ul><li>WeakMapçš„keyåªèƒ½ä½¿ç”¨å¯¹è±¡</li><li>WeakMapçš„keyå¯¹å¯¹è±¡çš„å¼•ç”¨æ˜¯å¼±å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–å¼•ç”¨å¼•ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆGCå¯ä»¥å›æ”¶</li></ul><p>å¸¸è§æ–¹æ³•ï¼š</p><ul><li>set(key, value)ï¼šæ·»åŠ é”®å€¼ï¼Œè¿”å›æ•´ä¸ªå¯¹è±¡</li><li>get(key)ï¼šæ ¹æ®keyè·å–å€¼</li><li>has(key)ï¼šæ˜¯å¦åŒ…å«æŸä¸ªkeyï¼Œè¿”å›å¸ƒå°”å€¼</li><li>delete(key)ï¼šæ ¹æ®keyåˆ é™¤é”®å€¼å¯¹ï¼Œè¿”å›å¸ƒå°”å€¼</li></ul><p>WeakMapä¸èƒ½éå†</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;asd&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> weakMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line">weakMap.<span class="title function_">set</span>(obj, <span class="string">&#x27;123&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(weakMap); <span class="comment">// WeakMap &#123; &lt;items unknown&gt; &#125;</span></span><br></pre></td></tr></table></figure><p><strong>å“åº”å¼åŸç†ä¸­çš„WeakMapä½¿ç”¨</strong></p><blockquote><p>å¯ä»¥çœ‹çœ‹Vue3çš„å“åº”å¼åŸç†ï¼Œä¹‹å‰å®ç°mini-vueçš„æ—¶å€™å®ç°è¿‡å“åº”å¼ç³»ç»Ÿ</p></blockquote><blockquote><p>ç®€å•çš„æ€æƒ³å°±æ˜¯ï¼š</p><p>åˆ›å»ºä¸€ä¸ªWeakMap, keyæ˜¯obj1ï¼Œå€¼æ˜¯ä¸€ä¸ªMapç»“æ„,</p><p>è¿™ä¸ªMapï¼Œé”®æ˜¯å¯¹è±¡çš„å±æ€§ï¼Œå€¼æ˜¯æœ‰ä¾èµ–è¿™ä¸ªå±æ€§çš„å‡½æ•°ï¼Œ</p><p>å½“è¿™ä¸ªå±æ€§å‘ç”Ÿä»€ä¹ˆæ”¹å˜çš„æ—¶å€™ï¼Œå°±æ‰§è¡Œè¿™ä¸ªå±æ€§æ‰€æœ‰ä¾èµ–çš„å‡½æ•°</p></blockquote><p>ä¸€ä¸ªç®€å•çš„å“åº”å¼æ¨¡æ‹Ÿå®ç°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åº”ç”¨åœºæ™¯ï¼ˆvue3å“åº”å¼åŸç†ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;qwe&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">obj1NameFn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;obj1NameFn1è¢«æ‰§è¡Œ&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">obj1NameFn2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;obj1NameFn2è¢«æ‰§è¡Œ&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">obj1AgeFn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;obj1AgeFn1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">obj1AgeFn2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;obj1AgeFn2&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åˆ›å»ºWeakMap</span></span><br><span class="line"><span class="keyword">const</span> weakMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"><span class="comment">// 2.æ”¶é›†ä¾èµ–ç»“æ„</span></span><br><span class="line"><span class="comment">// 2.1.å¯¹obj1æ”¶é›†çš„æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="keyword">const</span> obj1Map = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">obj1Map.<span class="title function_">set</span>(<span class="string">&#x27;name&#x27;</span>, [obj1NameFn1, obj1NameFn2])</span><br><span class="line">obj1Map.<span class="title function_">set</span>(<span class="string">&#x27;age&#x27;</span>, [obj1AgeFn1, obj1AgeFn2])</span><br><span class="line"></span><br><span class="line">weakMap.<span class="title function_">set</span>(obj1, obj1Map)</span><br><span class="line"><span class="comment">// å¦‚æœobj1.nameå‘ç”Ÿæ”¹å˜</span></span><br><span class="line">obj1.<span class="property">name</span> = <span class="string">&#x27;ggg&#x27;</span></span><br><span class="line"><span class="keyword">const</span> targetMap = weakMap.<span class="title function_">get</span>(obj1)</span><br><span class="line"><span class="keyword">const</span> fns = targetMap.<span class="title function_">get</span>(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">fns.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">fn</span>()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ES7">ES7</h2><h3 id="Array-Includes">Array Includes</h3><p>åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ </p><p>åœ¨ä¹‹å‰æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ indexOf() åˆ¤æ–­ï¼Œè¯¥æ–¹æ³•è¿”å›å…ƒç´ æ‰€åœ¨çš„ç´¢å¼•å€¼ï¼Œæ²¡æœ‰å°±è¿”å›-1</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> names = [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>, <span class="string">&#x27;ddd&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (names.<span class="title function_">indexOf</span>(<span class="string">&#x27;bbb&#x27;</span>) !== -<span class="number">1</span>) &#123; </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åŒ…å«bbbå…ƒç´ &#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ES7 æ–°å¢ Includes æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (names.<span class="title function_">includes</span>(<span class="string">&#x27;bbb&#x27;</span>)) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åŒ…å«bbbå…ƒç´ &#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº NaNçš„å¤„ç†ï¼ŒindexOf()ä¸èƒ½åˆ¤æ–­ï¼Œincludeså¯ä»¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> names = [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>, <span class="string">&#x27;ddd&#x27;</span>, <span class="title class_">NaN</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(names.<span class="title function_">indexOf</span>(<span class="title class_">NaN</span>)); <span class="comment">// -1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(names.<span class="title function_">includes</span>(<span class="title class_">NaN</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="æŒ‡æ•°çš„è¿ç®—æ–¹æ³•">æŒ‡æ•°çš„è¿ç®—æ–¹æ³•</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨ä¹‹å‰,æŒ‡æ•°è¿ç®—é€šè¿‡ Math.pow()</span></span><br><span class="line"><span class="keyword">const</span> res1 = <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">3</span>, <span class="number">3</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">// ES7æ–°å¢ï¼š**</span></span><br><span class="line"><span class="keyword">const</span> res2 = <span class="number">3</span> ** <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res1, res2); <span class="comment">// 27 27</span></span><br></pre></td></tr></table></figure><h2 id="ES8">ES8</h2><h3 id="Object-values">Object.values</h3><p>ä¹‹å‰æˆ‘ä»¬å¯ä»¥é€šè¿‡ Object.keys()æ¥è·å–ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰keyï¼ŒES8æä¾›Object.values() è·å–æ‰€æœ‰å€¼</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;aaa&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(obj)); <span class="comment">// [ &#x27;name&#x27;, &#x27;age&#x27; ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">values</span>(obj)); <span class="comment">// [ &#x27;aaa&#x27;, 18 ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨çš„éå¸¸å°‘</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">values</span>([<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>]));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">values</span>(<span class="string">&#x27;asd&#x27;</span>)); <span class="comment">// [ &#x27;a&#x27;, &#x27;s&#x27;, &#x27;d&#x27; ]</span></span><br></pre></td></tr></table></figure><h3 id="Object-entries">Object.entries</h3><p>è·å–åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­å­˜æ”¾å¯æšä¸¾å±æ€§çš„é”®å€¼å¯¹æ•°ç»„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;asdf&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> objEntries = <span class="title class_">Object</span>.<span class="title function_">entries</span>(obj)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(objEntries); <span class="comment">// [ [ &#x27;name&#x27;, &#x27;asdf&#x27; ], [ &#x27;age&#x27;, 20 ] ]</span></span><br><span class="line"><span class="comment">// ç„¶åå¯ä»¥ç»§ç»­éå†è¿™ä¸ªæ•°ç»„ï¼Œè·å¾—å±æ€§,å€¼</span></span><br><span class="line">objEntries.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item[<span class="number">0</span>], item[<span class="number">1</span>]);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">entries</span>([<span class="string">&#x27;aaa&#x27;</span>,<span class="string">&#x27;bbb&#x27;</span>,<span class="string">&#x27;ccc&#x27;</span>]));</span><br><span class="line"><span class="comment">// [ [ &#x27;0&#x27;, &#x27;aaa&#x27; ], [ &#x27;1&#x27;, &#x27;bbb&#x27; ], [ &#x27;2&#x27;, &#x27;ccc&#x27; ] ]  ç´¢å¼•å€¼å½“åškeyäº†</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">entries</span>(<span class="string">&#x27;sdf&#x27;</span>)); <span class="comment">// [ [ &#x27;0&#x27;, &#x27;s&#x27; ], [ &#x27;1&#x27;, &#x27;d&#x27; ], [ &#x27;2&#x27;, &#x27;f&#x27; ] ]</span></span><br></pre></td></tr></table></figure><h3 id="padStartå’ŒpadEnd">padStartå’ŒpadEnd</h3><p>æ ¹æ®æ‰€ç»™é•¿åº¦,å’Œå¡«å……å…ƒç´ æ¥å¾€å‰æˆ–å¾€åå¡«å……æ•°ç»„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> message = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newMessage = message.<span class="title function_">padStart</span>(<span class="number">15</span>, <span class="string">&quot;*&quot;</span>).<span class="title function_">padEnd</span>(<span class="number">20</span>, <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newMessage); <span class="comment">// ****hello world-----</span></span><br></pre></td></tr></table></figure><p>å°æ¡ˆä¾‹ï¼šå‡è®¾è¦å¯¹é“¶è¡Œå¡å·ç”¨*éšè—</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¡ˆä¾‹</span></span><br><span class="line"><span class="keyword">const</span> cardNumber = <span class="string">&quot;123456781231548564321&quot;</span></span><br><span class="line"><span class="keyword">const</span> lastFourCard = cardNumber.<span class="title function_">slice</span>(-<span class="number">4</span>) </span><br><span class="line"><span class="keyword">const</span> finalCard = lastFourCard.<span class="title function_">padStart</span>(cardNumber.<span class="property">length</span>, <span class="string">&quot;*&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(finalCard); <span class="comment">// *****************4321</span></span><br></pre></td></tr></table></figure><blockquote><p>slice å¯ä»¥ä¼ å…¥è´Ÿæ•°çš„å“¦ï¼Œ-4ï¼Œå€’æ•°4ä½</p></blockquote><h3 id="Trailing-Commas">Trailing-Commas</h3><p>ES8ï¼Œå…è®¸åœ¨å‡½æ•°å®šä¹‰å’Œè°ƒç”¨æ—¶å¤šåŠ ä¸€ä¸ªé€—å·</p><blockquote><p>æ²¡ä»€ä¹ˆï¼Œåæ­£æˆ‘ä»¬å¹³æ—¶ä¹Ÿä¸ä¼šåŠ ã€‚trailingï¼šåé¢çš„ï¼Œcommasï¼šé€—å·</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b,</span>) &#123;&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="number">10</span>, <span class="number">20</span>,)</span><br></pre></td></tr></table></figure><h3 id="Object-Descriptors">Object Descriptors</h3><p>ES8ä¸­æ–°å¢å¯¹å¯¹è±¡çš„æ“ä½œï¼Œ<strong>Object.getOwnPropertyDescriptors()</strong></p><p>è·å–ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰<strong>è‡ªèº«å±æ€§</strong>çš„æè¿°ç¬¦</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(obj));</span><br><span class="line"><span class="comment">// æ‰“å°</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">age</span>: &#123; <span class="attr">value</span>: <span class="number">18</span>, <span class="attr">writable</span>: <span class="literal">true</span>, <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">configurable</span>: <span class="literal">true</span> &#125;,      </span><br><span class="line">  <span class="attr">name</span>: &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ES8 æ–°å¢async await çš„å‡½æ•°ä½¿ç”¨ï¼Œåé¢å¦å¤–è®°</p></blockquote><h2 id="ES9">ES9</h2><blockquote><p>Async iteratorsï¼šè¿­ä»£å™¨ï¼Œåç»­å¦å¤–ç¬”è®°</p><p>Object spread operatorsï¼šå¯¹è±¡å±•å¼€è¿ç®—ç¬¦ <code>const newObj = &#123;...obj, age:18&#125;</code></p><p>Promise finallyï¼šåç»­Promiseç»Ÿä¸€è®°</p></blockquote><h2 id="ES10">ES10</h2><h3 id="flat-flatMap">flat flatMap</h3><p>flat() æ–¹æ³•ä¼šæŒ‰ç…§ä¸€ä¸ªå¯æŒ‡å®šçš„æ·±åº¦é€’å½’éå†æ•°ç»„ï¼Œå¹¶å°†æ‰€æœ‰å…ƒç´ ä¸éå†åˆ°çš„å­æ•°ç»„ä¸­çš„å…ƒç´ åˆå¹¶ä¸ºä¸€ä¸ªæ–°æ•°ç»„è¿”å›</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// flat</span></span><br><span class="line"><span class="keyword">const</span> nums = [<span class="number">10</span>, <span class="number">20</span>, [<span class="number">30</span>, <span class="number">40</span>],[[<span class="number">1</span>, <span class="number">2</span>],[<span class="number">3</span>, <span class="number">4</span>]]]</span><br><span class="line"><span class="keyword">const</span> newNums = nums.<span class="title function_">flat</span>()</span><br><span class="line"><span class="comment">// é»˜è®¤æ·±åº¦ä¸º1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newNums); <span class="comment">// [ 10, 20, 30, 40, [ 1, 2 ], [ 3, 4 ] ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newNums2 = nums.<span class="title function_">flat</span>(<span class="number">2</span>) <span class="comment">//</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newNums2); <span class="comment">// [10, 20, 30, 40,1,  2,  3,  4]</span></span><br></pre></td></tr></table></figure><p>flatMap() æ–¹æ³•é¦–å…ˆä½¿ç”¨æ˜ å°„å‡½æ•°æ˜ å°„æ¯ä¸ªå…ƒç´ ï¼Œç„¶åå°†ç»“æœå‹ç¼©æˆä¸€ä¸ªæ–°æ•°ç»„</p><blockquote><p>å…ˆè¿›è¡Œmapï¼Œå†flatï¼Œå¹¶ä¸”flatçš„<strong>æ·±åº¦ä¸º1</strong></p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> nums2 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="keyword">const</span> newNums2 = nums2.<span class="title function_">flatMap</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> item * <span class="number">2</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newNums2); <span class="comment">// [ 2, 4, 6, 8, 10 ]</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·çœ‹èµ·æ¥è·Ÿmapæ²¡ä»€ä¹ˆåŒºåˆ«å‘€ï¼Ÿé‚£flatMapæœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯å—ï¼Ÿ</p><blockquote><p>å¤„ç†è¿™æ ·çš„å­—ç¬¦ä¸²æ•°ç»„ï¼ŒæŠŠå­—ç¬¦ä¸²åˆ†æˆä¸€ä¸ªä¸ªæ”¾åˆ°æ•°ç»„</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> message = [<span class="string">&quot;Hello World&quot;</span>, <span class="string">&quot;hello kk&quot;</span>, <span class="string">&quot;my name is xxx&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> words = message.<span class="title function_">flatMap</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> item.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(words);</span><br><span class="line"><span class="comment">// [&#x27;Hello&#x27;, &#x27;World&#x27;,&#x27;hello&#x27;, &#x27;kk&#x27;,&#x27;my&#x27;,&#x27;name&#x27;,&#x27;is&#x27;,&#x27;xxx&#x27;]</span></span><br></pre></td></tr></table></figure><h3 id="Object-fromEntries">Object fromEntries</h3><p>ES8æœ‰Object.entrieså°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆentries</p><p>ES10æœ‰Object.fromEntries å°†entriesè½¬æ¢æˆå¯¹è±¡</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;qws&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ES8 entries</span></span><br><span class="line"><span class="keyword">const</span> entries = <span class="title class_">Object</span>.<span class="title function_">entries</span>(obj)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(entries); <span class="comment">// [ [ &#x27;name&#x27;, &#x27;qws&#x27; ], [ &#x27;age&#x27;, 18 ] ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newObj = <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(entries)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newObj); <span class="comment">// &#123; name: &#x27;qws&#x27;, age: 18 &#125;</span></span><br></pre></td></tr></table></figure><p>æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯å—ï¼Ÿ</p><p>å¯ä»¥å¤„ç†queryå‚æ•°ï¼Œæœ€ç»ˆè½¬æ¢æˆå¯¹è±¡ä½¿ç”¨</p><blockquote><p>çœ‹åˆ°é”®å€¼å¯¹çš„æ•°ç»„å¯ä»¥æƒ³åˆ°è¿™ä¸ªæ–¹æ³•</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> queryString = <span class="string">&#x27;name=xxx&amp;age=18&amp;height=1.88&#x27;</span></span><br><span class="line"><span class="keyword">const</span> queryParams = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(queryString)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(queryParams);</span><br><span class="line"><span class="comment">// URLSearchParams &#123; &#x27;name&#x27; =&gt; &#x27;xxx&#x27;, &#x27;age&#x27; =&gt; &#x27;18&#x27;, &#x27;height&#x27; =&gt; &#x27;1.88&#x27; &#125;</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> param <span class="keyword">of</span> queryParams) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(param);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰“å°</span></span><br><span class="line"><span class="comment">// [ &#x27;name&#x27;, &#x27;xxx&#x27; ]</span></span><br><span class="line"><span class="comment">// [ &#x27;age&#x27;, &#x27;18&#x27; ]</span></span><br><span class="line"><span class="comment">// [ &#x27;height&#x27;, &#x27;1.88&#x27; ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç„¶åå°±å¯ä»¥åˆ©ç”¨fromEntriesè½¬æˆå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> paramObj = <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(queryParams)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(paramObj);</span><br><span class="line"><span class="comment">// &#123; name: &#x27;xxx&#x27;, age: &#x27;18&#x27;, height: &#x27;1.88&#x27; &#125;</span></span><br></pre></td></tr></table></figure><h3 id="trimStart-trimEnd">trimStart trimEnd</h3><p>å•ç‹¬å»é™¤å‰é¢æˆ–åé¢çš„ç©ºæ ¼</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;  hello world   &#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">trim</span>()); <span class="comment">// å»é™¤å‰åçš„ç©ºæ ¼</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">trimStart</span>()); <span class="comment">// å»é™¤å‰é¢çš„ç©ºæ ¼</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">trimEnd</span>()); <span class="comment">// å»é™¤åé¢çš„ç©ºæ ¼</span></span><br></pre></td></tr></table></figure><h3 id="Symbol-description">Symbol description</h3><blockquote><p>s1.description è¿™ä¸ªå±æ€§å¯ä»¥è·å–symbolçš„æè¿°ï¼ˆæ ‡ç­¾ï¼‰ï¼Œå‰é¢symbolçš„ç¬”è®°æœ‰å†™åˆ°</p></blockquote><h3 id="Optional-catch-binding">Optional catch binding</h3><blockquote><p>åç»­åœ¨try catchéƒ¨åˆ†ç¬”è®°</p></blockquote><h2 id="ES11">ES11</h2><h3 id="BigInt">BigInt</h3><p>ES11å¼•å…¥çš„æ–°çš„æ•°æ®ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºå¤§çš„æ•´æ•°</p><p>ä½¿ç”¨ï¼šåŠ ä¸ªnï¼Œæˆ–è€… BigInt(num)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES11å‰ æœ€å¤§çš„å®‰å…¨æ•´æ•°</span></span><br><span class="line"><span class="keyword">const</span> maxInt = <span class="title class_">Number</span>.<span class="property">MAX_SAFE_INTEGER</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(maxInt); <span class="comment">// 9007199254740991</span></span><br><span class="line"><span class="comment">// è¶…è¿‡è¿™ä¸ªå®‰å…¨æ•´æ•°å°±å¯èƒ½å‡ºç°è¡¨ç¤ºé”™è¯¯</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(maxInt + <span class="number">1</span>); <span class="comment">// 9007199254740992</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(maxInt + <span class="number">2</span>); <span class="comment">// 9007199254740992 (é”™äº†)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES11ä¹‹å: BigInt</span></span><br><span class="line"><span class="keyword">const</span> bigInt = <span class="number">900719925474099100n</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bigInt + <span class="number">10n</span>); <span class="comment">// 900719925474099110n</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">BigInt</span>(<span class="number">100</span>)); <span class="comment">// 100n</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bigInt + <span class="title class_">BigInt</span>(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥æŠŠbigIntç±»å‹è½¬Number</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(bigInt)); <span class="comment">// 900719925474099100</span></span><br></pre></td></tr></table></figure><h3 id="Nullish-Coalescing-Operator">Nullish Coalescing Operator</h3><p>ç©ºå€¼ åˆå¹¶ è¿ç®—</p><p>æ–°å¢çš„æ“ä½œç¬¦ï¼š??</p><blockquote><p>å¤„ç†å¦‚æœä¸ºç©ºï¼Œé‚£ä¹ˆä½¿ç”¨é»˜è®¤å€¼çš„åˆ¤æ–­</p><p>ä¹‹å‰çš„ || ä¸èƒ½å¾ˆå¥½çš„å¤„ç†ç©ºå­—ç¬¦ä¸²ï¼Œç©ºä¸²è½¬ä¸ºfalseï¼Œæ‰§è¡Œåé¢çš„è¯­å¥</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">const</span> res1 = foo || <span class="string">&#x27;default value&#x27;</span></span><br><span class="line"><span class="keyword">const</span> res2 = foo ?? <span class="string">&#x27;default value&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res1); <span class="comment">// default value</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res2); <span class="comment">// &#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Optional-Chaining">Optional Chaining</h3><p>å¯é€‰é“¾ï¼šè®©æˆ‘ä»¬çš„ä»£ç åœ¨è¿›è¡Œ null å’Œ undefined åˆ¤æ–­æ—¶æ›´åŠ æ¸…æ™°å’Œç®€æ´</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> info = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="comment">// friend: &#123;</span></span><br><span class="line">  <span class="comment">//   f1: &#123;</span></span><br><span class="line">  <span class="comment">//     name: &#x27;mm&#x27;</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœ¨ä¹‹å‰ï¼Œå¦‚æœè·å–ä¸å­˜åœ¨çš„å±æ€§å€¼</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="property">name</span>.<span class="property">friend</span>); <span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬ä¼šåšè¿™æ ·çš„åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span> (info &amp;&amp; info.<span class="property">friend</span> &amp;&amp; info.<span class="property">friend</span>.<span class="property">f1</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="property">friend</span>.<span class="property">f1</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES11çš„å¯é€‰é“¾</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="property">friend</span>?.<span class="property">f1</span>?.<span class="property">name</span>);</span><br><span class="line"><span class="comment">// info.friendå­˜åœ¨å—?å­˜åœ¨å†ç»§ç»­ .f1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å…¶ä»–ä»£ç é€»è¾‘&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="Global-This">Global This</h3><p>åœ¨ä¹‹å‰æˆ‘ä»¬æƒ³è·å–JSç¯å¢ƒçš„å…¨å±€å¯¹è±¡ï¼Œä¸åŒç¯å¢ƒè·å–çš„æ–¹å¼åˆä¸ä¸€æ ·</p><p>æ¯”å¦‚åœ¨æµè§ˆå™¨ä¸­ï¼Œé€šè¿‡ thisï¼Œwindowæ¥è·å–</p><p>Nodeä¸­ï¼Œé€šè¿‡globalè·å–</p><p>æ‰€ä»¥ ES11 ä¸­å¯¹è·å–å…¨å±€å¯¹è±¡è¿›è¡Œç»Ÿä¸€çš„è§„èŒƒï¼šglobalThis</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æµè§ˆå™¨ä¸‹</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// Window</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>); <span class="comment">// Window</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Nodeä¸‹</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">global</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES11 å„ç§ç¯å¢ƒè·å–å…¨å±€å¯¹è±¡</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(globalThis);</span><br></pre></td></tr></table></figure><h3 id="forâ€¦inæ ‡å‡†åŒ–">forâ€¦inæ ‡å‡†åŒ–</h3><p>åœ¨ES11ä¹‹å‰ï¼Œè™½ç„¶å¾ˆå¤šæµè§ˆå™¨æ”¯æŒ forâ€¦in æ¥éå†å¯¹è±¡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¢«ECMAæ ‡å‡†åŒ–</p><p>ES11ä¸­ï¼Œå¯¹å…¶è¿›è¡Œæ ‡å‡†åŒ–ï¼Œforâ€¦in ç”¨äºéå†å¯¹è±¡çš„ key</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// name // age</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Dynamic-Import">Dynamic Import</h3><blockquote><p>åç»­åœ¨ ES Module æ¨¡å—åŒ–ä¸­ç¬”è®°</p></blockquote><h3 id="Promise-allSettled">Promise.allSettled</h3><blockquote><p>åç»­Promiseä¸­ç¬”è®°</p></blockquote><h3 id="import-meta">import meta</h3><blockquote><p>åç»­åœ¨ ES Module æ¨¡å—åŒ–ä¸­ç¬”è®°</p></blockquote><h2 id="ES12">ES12</h2><h3 id="FinalizationRegistry">FinalizationRegistry</h3><p>FinalizationRegistryå¯¹è±¡å¯ä»¥è®©ä½ åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶è¯·æ±‚ä¸€ä¸ªå›è°ƒ</p><p>å½“ä¸€ä¸ªåœ¨æ³¨å†Œè¡¨ä¸­æ³¨å†Œçš„å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œå¯ä»¥è¯·æ±‚åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šè°ƒç”¨ä¸€ä¸ªæ¸…ç†å›è°ƒï¼ˆæ¸…ç†å›è°ƒæœ‰æ—¶è¢«ç§°ä¸º finalizerï¼‰</p><p>æ³¨å†Œï¼šregisteræ–¹æ³•ï¼Œæ³¨å†Œä»»ä½•æƒ³è¦æ¸…ç†åæ‰§è¡Œå›è°ƒçš„å¯¹è±¡ï¼Œä¼ å…¥è¯¥å¯¹è±¡ï¼Œå’Œæ‰€å«çš„å€¼</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> finalRegistry = <span class="keyword">new</span> <span class="title class_">FinalizationRegistry</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ³¨å†Œåœ¨finalRegistryçš„å¯¹è±¡,æŸä¸ªè¢«é”€æ¯&quot;</span>, value);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;asd&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">let</span> info = &#123; <span class="attr">age</span>: <span class="number">15</span> &#125;</span><br><span class="line"></span><br><span class="line">finalRegistry.<span class="title function_">register</span>(obj, <span class="string">&#x27;obj&#x27;</span>)</span><br><span class="line">finalRegistry.<span class="title function_">register</span>(info, <span class="string">&#x27;val&#x27;</span>)</span><br><span class="line"></span><br><span class="line">obj = <span class="literal">null</span></span><br><span class="line">info = <span class="literal">null</span></span><br><span class="line"><span class="comment">// æ³¨å†Œåœ¨finalRegistryçš„å¯¹è±¡,æŸä¸ªè¢«é”€æ¯ val</span></span><br><span class="line"><span class="comment">// æ³¨å†Œåœ¨finalRegistryçš„å¯¹è±¡,æŸä¸ªè¢«é”€æ¯ obj</span></span><br></pre></td></tr></table></figure><h3 id="WeakRefs">WeakRefs</h3><p>å¦‚æœæˆ‘ä»¬é»˜è®¤å°†ä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™å¦ä¸€ä¸ªå¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨æ˜¯å¼ºå¼•ç”¨</p><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›æ˜¯å¼±å¼•ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ WeakRef</p><blockquote><p>æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ª deref æ–¹æ³•è·å–å¼±å¼•ç”¨çš„å€¼</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> finalRegistry = <span class="keyword">new</span> <span class="title class_">FinalizationRegistry</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ³¨å†Œåœ¨finalRegistryçš„å¯¹è±¡,æŸä¸ªè¢«é”€æ¯&quot;</span>, value);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;asd&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">let</span> info = <span class="keyword">new</span> <span class="title class_">WeakRef</span>(obj)</span><br><span class="line"></span><br><span class="line">finalRegistry.<span class="title function_">register</span>(obj, <span class="string">&#x27;obj&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// obj = null</span></span><br><span class="line"><span class="comment">// æ³¨å†Œåœ¨finalRegistryçš„å¯¹è±¡,æŸä¸ªè¢«é”€æ¯ obj</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é‚£è¿˜èƒ½è·å–infoå—ï¼Ÿ</span></span><br><span class="line"><span class="comment">// å› ä¸ºå›æ”¶è¦æ—¶é—´ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿåšä¸€ä¸ªå»¶è¿Ÿæ‰è·å–å±æ€§å€¼</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="property">name</span>); <span class="comment">// undefined(ä¸èƒ½è¿™æ ·è·å–)</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="title function_">deref</span>()?.<span class="property">name</span>);</span><br><span class="line">  <span class="comment">// å¦‚æœåŸå¯¹è±¡objæ²¡æœ‰è¢«é”€æ¯, å¯ä»¥ä½¿ç”¨deref()æ¥è·å–</span></span><br><span class="line">  <span class="comment">// å¦‚æœè¢«é”€æ¯äº†,è·å–åˆ°çš„æ˜¯ undefined</span></span><br><span class="line">&#125;, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure><h3 id="logical-assignment-operators">logical assignment operators</h3><blockquote><p>logicalï¼šé€»è¾‘çš„</p><p>å‡ ä¸ªé€»è¾‘èµ‹å€¼è¿ç®—ç¬¦ ||=ï¼Œ&amp;&amp;=ï¼ˆå¾ˆå°‘ç”¨ï¼‰ï¼Œ??=</p><p>å¯è¯»æ€§ä¸æ˜¯å¾ˆå¥½</p></blockquote><ul><li>||= é€»è¾‘æˆ–èµ‹å€¼è¿ç®—</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> message = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment">// message = message || &#x27;default value&#x27;</span></span><br><span class="line">message ||= <span class="string">&#x27;default value&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(message); <span class="comment">// default value</span></span><br><span class="line"><span class="comment">// ä¹Ÿæ˜¯ä¸èƒ½åˆ¤æ–­ç©ºä¸²çš„</span></span><br></pre></td></tr></table></figure><ul><li>&amp;&amp;= é€»è¾‘ä¸èµ‹å€¼è¿ç®—ï¼ˆå¾ˆå°‘ç”¨ï¼‰</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰å€¼å–å€¼</span></span><br><span class="line">info = obj &amp;&amp; obj.<span class="property">name</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info); <span class="comment">// xxx</span></span><br><span class="line"></span><br><span class="line">obj &amp;&amp;= obj.<span class="property">name</span> </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">// xxx</span></span><br></pre></td></tr></table></figure><ul><li>??= é€»è¾‘ç©ºèµ‹å€¼è¿ç®—  0 â€œâ€</li></ul><blockquote><p>æ„Ÿè§‰æ˜¯å¯ä»¥å¡«è¡¥ || ä¸èƒ½å¾ˆå¥½çš„åˆ¤æ–­&quot;&quot; 0</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> message = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">let</span> msg = <span class="number">0</span></span><br><span class="line">message ??= <span class="string">&quot;default value&quot;</span></span><br><span class="line">msg ??= <span class="string">&quot;default val&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(message); <span class="comment">// &quot;&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(msg); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><h3 id="Numeric-Separator">Numeric Separator</h3><blockquote><p>Numeric æ•°å€¼çš„  Separator åˆ†ç¦»å™¨</p></blockquote><p>å¤§çš„æ•°å€¼æœ‰ä¸€ä¸ªè¿æ¥ç¬¦ _ ï¼Œä¾¿äºé˜…è¯»</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> num = <span class="number">10_000_000_000_000</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num); <span class="comment">// 10000000000000</span></span><br></pre></td></tr></table></figure><h3 id="String-replaceAll">String.replaceAll</h3><blockquote><p>å­—ç¬¦ä¸²æ›¿æ¢ï¼Œæ›¿æ¢æ‰€æœ‰åŒ¹é…æ¡ä»¶çš„åœ°æ–¹</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> res = <span class="string">&#x27;aabbcc&#x27;</span>.<span class="title function_">replaceAll</span>(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res);<span class="comment">// &#x27;aa..cc&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¹‹å‰replaceåªæ¢ç¬¬ä¸€å¤„åŒ¹é…çš„åœ°æ–¹</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> res = <span class="string">&#x27;aabbcc&#x27;</span>.<span class="title function_">replace</span>(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res);<span class="comment">// aa.bcc</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>09_classå®šä¹‰ç±»_ES6</title>
      <link href="/2022/04/08/09_class%E5%AE%9A%E4%B9%89%E7%B1%BB-ES6/"/>
      <url>/2022/04/08/09_class%E5%AE%9A%E4%B9%89%E7%B1%BB-ES6/</url>
      
        <content type="html"><![CDATA[<h2 id="ES6ä¸­ç±»çš„ä½¿ç”¨">ES6ä¸­ç±»çš„ä½¿ç”¨</h2><h3 id="è®¤è¯†classå®šä¹‰ç±»">è®¤è¯†classå®šä¹‰ç±»</h3><p>æŒ‰ç…§æ„é€ å‡½æ•°çš„å½¢å¼åˆ›å»ºç±»ï¼Œä¸ä»…ä»…å’Œç¼–å†™æ™®é€šçš„å‡½æ•°è¿‡äºç›¸ä¼¼ï¼Œè€Œä¸”ä»£ç å¹¶ä¸å®¹æ˜“ç†è§£</p><ul><li>åœ¨ES6(ECMAScript2015)æ–°çš„æ ‡å‡†ä¸­ä½¿ç”¨äº†classå…³é”®å­—æ¥ç›´æ¥å®šä¹‰ç±»</li><li>ä½†æ˜¯ç±»çš„æœ¬è´¨ä¸Šåªæ˜¯æ„é€ å‡½æ•°ï¼ŒåŸå‹é“¾çš„è¯­æ³•ç³–</li><li>æœ€ç»ˆè¿˜æ˜¯ä¼šè¢« babel å·¥å…·è½¬æ¢ä¸ºES5çš„ä»£ç </li></ul><h3 id="å®šä¹‰ç±»çš„æ–¹å¼">å®šä¹‰ç±»çš„æ–¹å¼</h3><p>å¯ä»¥å‘ç°ç±»å’Œæ„é€ å‡½æ•°çš„ç‰¹æ€§æ˜¯ä¸€è‡´çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç±»çš„å£°æ˜</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»çš„è¡¨è¾¾å¼(ä¸æ€ä¹ˆç”¨)</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Student</span> = <span class="keyword">class</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»çš„ç‰¹æ€§</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>) <span class="comment">// [class Person]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>);<span class="comment">// &#123;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>); <span class="comment">// [Object: null prototype] &#123;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span>); <span class="comment">// [class Person]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Person</span>); <span class="comment">// function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå®ä¾‹</span></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">__proto__</span> === <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="ç±»çš„æ„é€ æ–¹æ³•">ç±»çš„æ„é€ æ–¹æ³•</h3><p>ä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªæ„é€ å‡½æ•° constructorï¼Œå¦‚æœåŒ…å«å¤šä¸ªä¼šæŠ¥é”™</p><p>new çš„æ—¶å€™ï¼š</p><ol><li>åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ moni = { }</li><li>å°†ç±»çš„åŸå‹prototypeèµ‹å€¼ç»™åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡çš„[[prototype]]ï¼Œ<code>moni.__ptoto__ = Person.prototype</code></li><li>å°†å¯¹è±¡å¤åˆ¶ç»™å‡½æ•°çš„thisï¼šnewç»‘å®š this = moni</li><li>æ‰§è¡Œå‡½æ•°ä½“ä¸­çš„ä»£ç </li><li>è‡ªåŠ¨è¿”å›åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡</li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;kac&quot;</span>, <span class="number">12</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;awe&quot;</span>, <span class="number">20</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1, p2);</span><br><span class="line"><span class="comment">// Person &#123; name: &#x27;kac&#x27;, age: 12 &#125; Person &#123; name: &#x27;awe&#x27;, age: 20 &#125;</span></span><br></pre></td></tr></table></figure><h3 id="ç±»ä¸­çš„æ–¹æ³•å®šä¹‰">ç±»ä¸­çš„æ–¹æ³•å®šä¹‰</h3><p>ä¸‰ç§å®šä¹‰æ–¹æ³•</p><ol><li><p>æ™®é€šçš„å®ä¾‹æ–¹æ³•ï¼šå®é™…ä¸Šæ˜¯æ”¾åˆ°åŸå‹ä¸Šçš„ï¼Œå¯ä»¥è¢«å¤šä¸ªå®ä¾‹å…±äº«</p></li><li><p>ç±»çš„è®¿é—®å™¨æ–¹æ³•ï¼šsetterï¼Œgetter</p></li><li><p>ç±»çš„é™æ€æ–¹æ³•ï¼šç›´æ¥ä½¿ç”¨ç±»æ¥è°ƒç”¨çš„æ–¹æ³• <a href="http://Person.xxx">Person.xxx</a>()ï¼Œä¸éœ€è¦å€ŸåŠ©å®ä¾‹æ¥è°ƒç”¨ï¼Œä¾‹å¦‚Promise.all()ï¼Œä¹Ÿæ˜¯ç±»æ–¹æ³•</p><p>ä½¿ç”¨ staticå…³é”®å­—æ¥å®šä¹‰</p></li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> names = [<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;cba&quot;</span>, <span class="string">&quot;nba&quot;</span>]</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_address</span> = <span class="string">&quot;å¹¿å·å¸‚&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1.æ™®é€šçš„å®ä¾‹æ–¹æ³•</span></span><br><span class="line">  <span class="title function_">eating</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot; eating~&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.ç±»çš„è®¿é—®å™¨æ–¹æ³•ï¼ˆä¸æ€ä¹ˆç”¨ï¼‰</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">address</span>() &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ‹¦æˆªè®¿é—®æ“ä½œ&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_address</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">address</span>(<span class="params">newAddress</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ‹¦æˆªè®¾ç½®æ“ä½œ&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_address</span> = newAddress</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.ç±»çš„é™æ€æ–¹æ³•ï¼ˆç±»æ–¹æ³•ï¼‰ï¼šç›´æ¥é€šè¿‡ç±»æ¥è®¿é—®çš„æ–¹æ³•</span></span><br><span class="line">  <span class="comment">// Person.xxx()</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">randomPerson</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> nameIndex = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * names.<span class="property">length</span>)</span><br><span class="line">    <span class="keyword">var</span> name = names[nameIndex]</span><br><span class="line">    <span class="keyword">var</span> age = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(name, age)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;axf&quot;</span>, <span class="number">18</span>)</span><br><span class="line">p.<span class="title function_">eating</span>() <span class="comment">// axf eating~</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">address</span>);</span><br><span class="line">p.<span class="property">address</span> = <span class="string">&quot;åŒ—äº¬å¸‚&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">address</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="title function_">randomPerson</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç±»çš„ç»§æ‰¿extends">ç±»çš„ç»§æ‰¿extends</h3><p>ES6ä¸­æ–°å¢äº† <strong>extends</strong> å…³é”®å­—ï¼Œå¯ä»¥æ–¹ä¾¿çš„å¸®åŠ©æˆ‘ä»¬å®ç°ç»§æ‰¿</p><p><strong>super</strong>å…³é”®å­—ï¼Œä¸‰ä¸ªä½¿ç”¨ä½ç½®ï¼šå­ç±»çš„æ„é€ å‡½æ•°ã€å®ä¾‹æ–¹æ³•ã€é™æ€æ–¹æ³•</p><ul><li><p>å­ç±»çš„æ„é€ å‡½æ•°ï¼šJSå¼•æ“åœ¨è§£æå­ç±»çš„æ—¶å€™å°±æœ‰è¦æ±‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å®ç°ç»§æ‰¿ï¼Œé‚£ä¹ˆå­ç±»çš„æ„é€ æ–¹æ³•ä¸­,åœ¨ä½¿ç”¨thisä¹‹å‰,è¦è°ƒç”¨super()</p><p>å¦åˆ™æŠ¥é”™</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">ReferenceError</span>: <span class="title class_">Must</span> call <span class="variable language_">super</span> constructor <span class="keyword">in</span> derived <span class="keyword">class</span> <span class="title class_">before</span> accessing <span class="string">&#x27;this&#x27;</span> or returning <span class="keyword">from</span> derived constructor</span><br></pre></td></tr></table></figure></li><li><p>å­ç±»å¯ä»¥<strong>é‡å†™çˆ¶ç±»çš„æ–¹æ³•</strong>ï¼Œåœ¨é‡å†™æ–¹æ³•ä¸­ä½¿ç”¨ super æ¥å¤ç”¨çˆ¶ç±»ä¸­çš„é€»è¾‘</p></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">running</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;é€»è¾‘1&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;é€»è¾‘2&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;é€»è¾‘3&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; running~&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">staticMethod</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;person staticMethod&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age, sno</span>) &#123;</span><br><span class="line">    <span class="comment">// åœ¨ä½¿ç”¨thiså‰ï¼Œè¿™é‡Œå¿…é¡»ä½¿ç”¨super()</span></span><br><span class="line">    <span class="variable language_">super</span>(name, age)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sno</span> = sno</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é‡å†™æ–¹æ³•ä¸€èˆ¬å®ä¾‹æ–¹æ³•</span></span><br><span class="line">  <span class="title function_">running</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// å¤ç”¨çˆ¶ç±»ä¸­çš„é€»è¾‘</span></span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">running</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;é€»è¾‘4&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;é€»è¾‘5&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;é€»è¾‘6&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;student &quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot; running&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é‡å†™çˆ¶ç±»ä¸­çš„é™æ€æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">staticMethod</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">staticMethod</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;student staticMethod&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;asx&quot;</span>, <span class="number">12</span>, <span class="number">111</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p);</span><br><span class="line"><span class="comment">// p.running()</span></span><br><span class="line"><span class="title class_">Student</span>.<span class="title function_">staticMethod</span>()</span><br></pre></td></tr></table></figure><h3 id="ç»§æ‰¿å†…ç½®ç±»">ç»§æ‰¿å†…ç½®ç±»</h3><p>è®©æˆ‘ä»¬çš„ç±»ç»§æ‰¿å†…ç½®ç±»ï¼Œæ¯”å¦‚ï¼šArray</p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°Arrayçš„æ–¹æ³•äº†</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyArray</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Array</span>&#123;</span><br><span class="line">  <span class="title function_">firstItem</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">lastItem</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>[<span class="variable language_">this</span>.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="title class_">MyArray</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">firstItem</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">concat</span>([<span class="number">33</span>])) <span class="comment">// MyArray(4) [ 1, 2, 3, 33 ]</span></span><br></pre></td></tr></table></figure><h3 id="ç±»çš„æ··å…¥-å°‘ç”¨">ç±»çš„æ··å…¥(å°‘ç”¨)</h3><p>JavaScript çš„ç±»åªæ”¯æŒå•ç»§æ‰¿ï¼Œä¹Ÿå°±æ˜¯åªèƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»</p><p>å¦‚æœæƒ³åœ¨ä¸€ä¸ªç±»ä¸­æ·»åŠ æ›´å¤šç›¸ä¼¼çš„åŠŸèƒ½æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ··å…¥</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡å‡½æ•°å»ç»§æ‰¿ä¸€äº›å…¬å…±æ–¹æ³•</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mixinRunner</span>(<span class="params">BaseClass</span>) &#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">NewClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseClass</span> &#123;</span><br><span class="line">    <span class="title function_">running</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;I am running~&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">NewClass</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mixinEater</span>(<span class="params">BaseClass</span>) &#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">NewClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseClass</span> &#123;</span><br><span class="line">    <span class="title function_">eating</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;I am eating~&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">NewClass</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§æ‰¿çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// var NewStudent = mixinRunner(Student) // è¿”å›ä¸€ä¸ªå·²ç»ç»§æ‰¿äº†runæ–¹æ³•çš„æ–°çš„ç±»</span></span><br><span class="line"><span class="comment">// åœ¨ç»§æ‰¿äº†runçš„åŸºç¡€ä¸Šç»§ç»­ç»§æ‰¿eat</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">NewStudent</span> = <span class="title function_">mixinEater</span>(<span class="title function_">mixinRunner</span>(<span class="title class_">Student</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stu = <span class="keyword">new</span> <span class="title class_">NewStudent</span>()</span><br><span class="line">stu.<span class="title function_">running</span>()</span><br><span class="line">stu.<span class="title function_">eating</span>() </span><br></pre></td></tr></table></figure><h3 id="JavaScriptä¸­çš„å¤šæ€">JavaScriptä¸­çš„å¤šæ€</h3><blockquote><p>ç»´åŸºç™¾ç§‘ï¼šå¤šæ€ï¼ˆè‹±è¯­ï¼špolymorphismï¼‰æŒ‡ä¸ºä¸åŒæ•°æ®ç±»å‹çš„å®ä½“æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œæˆ–ä½¿ç”¨ä¸€ ä¸ªå•ä¸€çš„ç¬¦å·æ¥è¡¨ç¤ºå¤šä¸ªä¸åŒçš„ç±»å‹</p><p>æ€»ç»“ï¼šä¸åŒçš„æ•°æ®ç±»å‹è¿›è¡ŒåŒä¸€ä¸ªæ“ä½œï¼Œè¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºï¼Œå°±æ˜¯å¤šæ€çš„ä½“ç°</p><p>æ‰€ä»¥è¯´ï¼ŒJSä¹Ÿæ˜¯æœ‰å¤šæ€çš„ï¼Œè™½ç„¶è·Ÿåˆ«çš„ä¸€äº›é¢å‘å¯¹è±¡è¯­è¨€æœ‰äº›åŒºåˆ«</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">calcArea</span>(<span class="params">foo</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="title function_">getArea</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;sfr&quot;</span>,</span><br><span class="line">  <span class="attr">getArea</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1000</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">getArea</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"></span><br><span class="line"><span class="title function_">calcArea</span>(obj1)</span><br><span class="line"><span class="title function_">calcArea</span>(p)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹ä¹Ÿæ˜¯å¤šæ€çš„ä½“ç°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">m, n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> m + n</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sum</span>(<span class="number">20</span>, <span class="number">30</span>) <span class="comment">// ä¸åŒæ•°æ®ç±»å‹ï¼Œä¸åŒå½¢æ€</span></span><br><span class="line"><span class="title function_">sum</span>(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;asf&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="ES6è½¬ES5">ES6è½¬ES5</h3><blockquote><p>å¯ä»¥åœ¨ <a href="http://babeljs.io">babeljs.io</a> ä¸­çœ‹es6é€šè¿‡babelè½¬es5åçš„ä»£ç </p><p>æœ‰ç‚¹éš¾åº¦ï¼Œä¸è¦æµ®èºï¼Œæ…¢æ…¢çœ‹</p><p>å¯ä»¥æ‰“ debug ä¸€ç‚¹ç‚¹çœ‹</p></blockquote><p>ä¾‹å¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">eating</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot; eating~&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// babelè½¬æ¢</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_classCallCheck</span>(<span class="params">instance, Constructor</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> <span class="title class_">Constructor</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Cannot call a class as a function&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// target: Person.prototype</span></span><br><span class="line"><span class="comment">// props: [&#123;key, value&#125;]</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_defineProperties</span>(<span class="params">target, props</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; props.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> descriptor = props[i];</span><br><span class="line">    descriptor.<span class="property">enumerable</span> = descriptor.<span class="property">enumerable</span> || <span class="literal">false</span>;</span><br><span class="line">    descriptor.<span class="property">configurable</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;value&quot;</span> <span class="keyword">in</span> descriptor) descriptor.<span class="property">writable</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, descriptor.<span class="property">key</span>, descriptor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Constructor: Person</span></span><br><span class="line"><span class="comment">// protoProps: [&#123;key, value&#125;]</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_createClass</span>(<span class="params">Constructor, protoProps, staticProps</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (protoProps) </span><br><span class="line">    <span class="title function_">_defineProperties</span>(<span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span>, protoProps);</span><br><span class="line">  <span class="keyword">if</span> (staticProps) </span><br><span class="line">    <span class="title function_">_defineProperties</span>(<span class="title class_">Constructor</span>, staticProps);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Constructor</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /*#__PURE__*/ çº¯å‡½æ•°</span></span><br><span class="line"><span class="comment">// webpack å‹ç¼© tree-shaking</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªå‡½æ•°æ²¡å‰¯ä½œç”¨</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Person</span> = <span class="comment">/*#__PURE__*/</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_createClass</span>(<span class="title class_">Person</span>, [&#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&quot;eating&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="keyword">function</span> <span class="title function_">eating</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot; eating~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Person</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ Vuex</title>
      <link href="/2022/04/07/%E5%AD%A6%E4%B9%A0Vuex/"/>
      <url>/2022/04/07/%E5%AD%A6%E4%B9%A0Vuex/</url>
      
        <content type="html"><![CDATA[<h2 id="Vuexçš„çŠ¶æ€ç®¡ç†">Vuexçš„çŠ¶æ€ç®¡ç†</h2><h3 id="vuexä»‹ç»">vuexä»‹ç»</h3><ul><li><p>ä»€ä¹ˆæ˜¯çŠ¶æ€ç®¡ç†ï¼Ÿ</p><p>åº”ç”¨ç¨‹åºçš„å„ç§æ•°æ®ä¿å­˜åˆ°æŸä¸ªä½ç½®è¿›è¡Œç®¡ç†</p></li></ul><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a797ec53c22b488b8b169c6c80daab85~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>â€‹ stateï¼šæ•°æ®viewï¼šæœ€ç»ˆæ¨¡å—æ¸²æŸ“æˆDOMactionsï¼šä¿®æ”¹stateçš„è¡Œä¸ºäº‹ä»¶</p><ul><li><p>å¤æ‚çš„çŠ¶æ€ç®¡ç†</p><p>å¤šä¸ªç»„ä»¶å…±äº«çŠ¶æ€</p></li><li><p>Vuexçš„çŠ¶æ€ç®¡ç†</p><p>å°†ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€æŠ½ç¦»å‡ºæ¥</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a54e89c5272448eb9c1850ee729526cb~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /></li><li><p>Vuexä½¿ç”¨å•ä¸€çŠ¶æ€æ ‘</p><p>SSOTï¼šSingle Source of Truthï¼Œå•ä¸€æ•°æ®æº</p><p>æ¯ä¸ªåº”ç”¨ä»…ä»…åŒ…å«ä¸€ä¸ªstoreå®ä¾‹</p></li></ul><h4 id="å®‰è£…">å®‰è£…</h4><p><code>npm install vuex@next</code></p><p>ä½¿ç”¨vuex4.xï¼Œéœ€è¦æ·»åŠ nextæŒ‡å®šç‰ˆæœ¬</p><h4 id="ä½¿ç”¨">ä½¿ç”¨</h4><h4 id="åˆ›å»ºstoreï¼ˆä»“åº“ï¼‰">åˆ›å»ºstoreï¼ˆä»“åº“ï¼‰</h4><ul><li><p>Vuexå’Œå•çº¯çš„å…¨å±€å¯¹è±¡æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><p>Vuexçš„çŠ¶æ€å­˜å‚¨æ˜¯å“åº”å¼çš„</p></li><li><p>ä¸èƒ½ç›´æ¥æ”¹å˜storeä¸­çš„çŠ¶æ€</p><p>æ”¹å˜storeä¸­çš„çŠ¶æ€çš„å”¯ä¸€é€”å¾„å°±æ˜¯<strong>æäº¤(commit) mutation</strong></p><p>è¿™æ ·æ–¹ä¾¿æˆ‘ä»¬è·Ÿè¸ªæ¯ä¸€ä¸ªçŠ¶æ€çš„å˜åŒ–ï¼Œä»è€Œè®©æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ä¸€äº›å·¥å…·å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ç®¡ç†åº”ç”¨çš„çŠ¶æ€</p></li><li><p>å…·ä½“æ­¥éª¤ï¼š</p><ol><li>store/index</li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„storeå®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="title function_">state</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span> <span class="comment">// æ•°æ®</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123; <span class="comment">// æ–¹æ³•</span></span><br><span class="line">    <span class="title function_">increment</span>(<span class="params">state</span>) &#123;</span><br><span class="line">       state.<span class="property">counter</span>++</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">decrement</span>(<span class="params">state</span>) &#123;</span><br><span class="line">       state.<span class="property">counter</span>--</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨å…¨å±€å°† store å®ä¾‹ä½œä¸ºæ’ä»¶å®‰è£…</li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store/index&#x27;</span></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(store).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul><h3 id="ç»„ä»¶ä¸­ä½¿ç”¨store">ç»„ä»¶ä¸­ä½¿ç”¨store</h3><h3 id="state">state</h3><p>ä½¿ç”¨storeä¸­çš„stateæ•°æ®</p><ul><li><p>åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.count&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>åœ¨options api ä¸­ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="title function_">counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">counter</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨setupä¸­ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line">    <span class="keyword">const</span> counter = store.<span class="property">state</span>.<span class="property">counter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="mapState">mapState</h4><p>å¦‚æœéœ€è¦æ‹¿stateä¸­çš„å¤šä¸ªæ•°æ®ï¼Œåœ¨å¯ä»¥å€ŸåŠ©è¾…åŠ©å‡½æ•° mapStateï¼Œ</p><ul><li><p>setupä¸­ä½¿ç”¨mapState</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒVuexæ²¡æœ‰æä¾›éå¸¸æ–¹ä¾¿çš„çš„ä½¿ç”¨mapStateçš„æ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿›è¡Œäº†ä¸€ä¸ªå‡½æ•°çš„å°è£…</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;Home: &#123;&#123;sCounter&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;h2&gt;Home: &#123;&#123;counter&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;h2&gt;Home: &#123;&#123;name&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;h2&gt;Home: &#123;&#123;age&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;h2&gt;Home: &#123;&#123;height&#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState, useStore &#125; from &quot;vuex&quot;</span><br><span class="line">import &#123; computed &#125; from &#x27;vue&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  // options apiä½¿ç”¨mapState</span><br><span class="line">  computed: &#123;</span><br><span class="line">    // fullName: function() &#123; return xxx&#125;, </span><br><span class="line">    ...mapState([&quot;counter&quot;, &quot;name&quot;])</span><br><span class="line">  &#125;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const store = useStore()</span><br><span class="line">    const sCounter = computed(() =&gt; store.state.counter)</span><br><span class="line"></span><br><span class="line">    // å®é™…ä¸Šæ”¾å…¥mapStateè¿™é‡Œæ‹¿åˆ°çš„æ˜¯è¿™æ ·å½¢å¼çš„ä¸€ä¸ªä¸ªå‡½æ•°</span><br><span class="line">    // &#123;counter: function(), name: function() ...&#125;</span><br><span class="line">    const storeStateFns = mapState([&quot;counter&quot;, &quot;name&quot;, &quot;age&quot;, &quot;height&quot;])</span><br><span class="line">    </span><br><span class="line">    // å°è£…ä¸€ä¸ªå‡½æ•°è½¬åŒ–ä¸€ä¸‹,ä¸»è¦æ€æƒ³æ˜¯æŠŠè¿™ä¸€ä¸ªä¸ªçš„å‡½æ•°æ”¾åˆ°computedé‡Œé¢</span><br><span class="line">    // å› ä¸ºcomputedå°±æ˜¯ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åä¼šç»™æˆ‘ä»¬è¿”å›ä¸€ä¸ªref</span><br><span class="line">    // &#123;counter: ref, age: ref, ...&#125;</span><br><span class="line">    const storeState = &#123;&#125;</span><br><span class="line">    Object.keys(storeStateFns).forEach(fnKey =&gt; &#123;</span><br><span class="line">      // å› ä¸ºå†…éƒ¨çš„computedå–æ•°æ®çš„æ—¶å€™æ˜¯é€šè¿‡this.$store...</span><br><span class="line">      // ä½†æˆ‘ä»¬è¿™é‡Œçš„fnæ²¡æœ‰this, undefined.$store æ˜¯é”™çš„</span><br><span class="line">      // ç”¨bindç»™æ¯ä¸ªå‡½æ•°ç»‘å®šthisä¸ºä¸€ä¸ªå¯¹è±¡,é‡Œé¢éœ€è¦æœ‰$storeè¿™ä¸ªå±æ€§</span><br><span class="line">      // &#123;$store: store&#125;</span><br><span class="line">      const fn = storeStateFns[fnKey].bind(&#123; $store: store&#125;)</span><br><span class="line">      // ç„¶åæŠŠå‡½æ•°ä¸€ä¸ªæ–¹æ³•computed, ä»¥é”®å€¼å¯¹çš„æ–¹å¼å­˜å‚¨èµ·æ¥</span><br><span class="line">      storeState[fnKey] = computed(fn)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    return &#123;</span><br><span class="line">      sCounter,</span><br><span class="line">      // æœ€ç»ˆåœ¨è¿™é‡Œç”¨å±•å¼€è¿ç®—ç¬¦å±•å¼€</span><br><span class="line">      ...storeState</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>æŠŠå‡½æ•°çš„å°è£…æŠ½ç¦»åˆ° hooks/useState.js</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState, useStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useState</span>(<span class="params">mapper</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–åˆ°å¯¹åº”çš„å¯¹è±¡çš„functions: &#123;name: function, age: function&#125;</span></span><br><span class="line">  <span class="keyword">const</span> storeStateFns = <span class="title function_">mapState</span>(mapper)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯¹æ•°æ®è¿›è¡Œè½¬æ¢</span></span><br><span class="line">  <span class="keyword">const</span> storeState = &#123;&#125;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(storeStateFns).<span class="title function_">forEach</span>(<span class="function"><span class="params">fnKey</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fn = storeStateFns[fnKey].<span class="title function_">bind</span>(&#123; <span class="attr">$store</span>: store &#125;)</span><br><span class="line">    storeState[fnKey] = <span class="title function_">computed</span>(fn)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> storeState</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ç»„ä»¶ä½¿ç”¨å°±ä¼šç®€ä¾¿å¾ˆå¤š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;../hooks/useState&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> storeState = <span class="title function_">useState</span>([<span class="string">&quot;counter&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;height&quot;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“ç„¶ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡å½¢å¼(æƒ³è¦é‡å‘½åçš„æ—¶å€™ä½¿ç”¨)</span></span><br><span class="line">    <span class="keyword">const</span> storeState2 = <span class="title function_">useState</span>(&#123;</span><br><span class="line">      <span class="attr">sCounter</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">counter</span>,</span><br><span class="line">      <span class="attr">sName</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">name</span></span><br><span class="line">    &#125;) </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...storeState,</span><br><span class="line">      ...storeState2</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="getters">getters</h3><ul><li><p>getters çš„åŸºæœ¬ä½¿ç”¨</p><p>æŸäº›å±æ€§å¯èƒ½éœ€è¦ç»è¿‡å˜åŒ–åæ‰ä½¿ç”¨ï¼Œï¼ˆå°±åƒstoreä¸­çš„è®¡ç®—å±æ€§ï¼‰</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5234df35d8b42a3a105bf9573c66885~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:70%;" /></li><li><p>getters ç¬¬äºŒä¸ªå‚æ•°</p><p>getterså¯ä»¥æ¥æ”¶ç¬¬2ä¸ªå‚æ•°gettersï¼Œä½¿ç”¨gettersæœ¬èº«çš„å±æ€§</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">getters</span>: &#123;</span><br><span class="line">  <span class="title function_">totalPrice</span>(<span class="params">state, getters</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">books</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">pre, cur</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> pre + cur.<span class="property">count</span> * cur.<span class="property">price</span></span><br><span class="line">    &#125;, <span class="number">0</span>) + <span class="string">&quot; &quot;</span> + getters.<span class="property">myName</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">myName</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">name</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>getters çš„è¿”å›å‡½æ•°</p><p>gettersä¸­çš„å‡½æ•°æœ¬èº«ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨çš„åœ°æ–¹ç›¸å½“äºå¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">totalPrice</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">price</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> totalPrice = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> book <span class="keyword">of</span> state.<span class="property">books</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (book.<span class="property">price</span> &lt; price) <span class="keyword">continue</span></span><br><span class="line">            totalPrice += book.<span class="property">count</span> * book.<span class="property">price</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalPrice</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li></ul><h4 id="mapGetters">mapGetters</h4><p>ä¸mapStateç±»ä¼¼</p><ul><li><p>åœ¨setupä¸­ä½¿ç”¨mapGetters</p><p>å°è£…å¥½çš„ /useGetters</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useStore, mapGetters &#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useGetters</span>(<span class="params">mapper</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stateFns = <span class="title function_">mapGetters</span>(mapper)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> state = &#123;&#125;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(stateFns).<span class="title function_">forEach</span>(<span class="function"><span class="params">fnKey</span> =&gt;</span> &#123;</span><br><span class="line">    state[fnKey] = <span class="title function_">computed</span>(stateFns[fnKey].<span class="title function_">bind</span>(&#123; <span class="attr">$store</span>: store &#125;))</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> storeGetters = <span class="title function_">useGetters</span>([<span class="string">&quot;nameInfo&quot;</span>, <span class="string">&quot;ageInfo&quot;</span>, <span class="string">&quot;heightInfo&quot;</span>])</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...storeGetters</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å°è£…useMapper">å°è£…useMapper</h3><p>æˆ‘ä»¬å‘ç°å‰é¢ useStateï¼ŒuseGettersçš„é€»è¾‘å¤§éƒ¨åˆ†ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œæ ¹æ®ä½¿ç”¨çš„æ—¶å€™çš„ mapStateè¿˜æ˜¯mapGetters æ¥è°ƒç”¨å‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// mapFn:ä½¿ç”¨çš„mapXXX</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useMapper</span>(<span class="params">mapper, mapFn</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> storeStateFns = <span class="title function_">mapFn</span>(mapper)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> storeState = &#123;&#125;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(storeStateFns).<span class="title function_">forEach</span>(<span class="function"><span class="params">fnKey</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fn = storeStateFns[fnKey].<span class="title function_">bind</span>(&#123; <span class="attr">$store</span>: store &#125;)</span><br><span class="line">    storeState[fnKey] = <span class="title function_">computed</span>(fn)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> storeState</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f546da191e74eb8928f81fab5c259b7~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><h3 id="Mutations">Mutations</h3><p>æ›´æ”¹ Vuex çš„storeä¸­çš„çŠ¶æ€çš„å”¯ä¸€æ–¹æ³•æ˜¯æäº¤mutation</p><ul><li><p>mutations åŸºæœ¬ä½¿ç”¨</p><p>åœ¨storeä¸­å®šä¹‰æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">  <span class="title function_">increment</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    state.<span class="property">counter</span>++</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">decrement</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    state.<span class="property">counter</span>--</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨setupä¸­commitäº‹ä»¶ï¼Œæäº¤çš„æ˜¯mutationsä¸­çš„æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&quot;increment&quot;</span>, xxx) <span class="comment">// å¯ä»¥ä¼ å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>mutationæºå¸¦æ•°æ®</p><p>å¾ˆå¤šæ—¶å€™æäº¤mutationä¼šæºå¸¦ä¸€äº›æ•°æ®ï¼Œåœ¨mutationä¸­ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ¥æ”¶</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">addNumber</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">        state.<span class="property">counter</span> += payload</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payloadä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ç±»å‹</p><p>æäº¤çš„æ—¶å€™ï¼šå¯ä»¥ç”¨typeï¼ŒæŒ‡å®šæäº¤çš„æ–¹æ³•å</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$store.<span class="title function_">commit</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;addNumber&quot;</span>,</span><br><span class="line">    <span class="attr">count</span>: <span class="number">100</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">addNumber</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">        state.<span class="property">counter</span> += payload.<span class="property">count</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>mutation å¸¸é‡ç±»å‹</p><p>ä¸»è¦æ˜¯é¢„é˜²ç²—å¿ƒçš„æ—¶å€™ï¼Œcommitçš„æ–¹æ³•åå­—å’Œmutationå®šä¹‰çš„æ–¹æ³•åä¸ä¸€è‡´</p><ul><li><p>å®šä¹‰å¸¸é‡</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// mutation-types.js</span></span><br><span class="line"><span class="comment">// å®šä¹‰å¸¸é‡</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">INCREMENT_N</span> = <span class="string">&quot;INCREMENT_N&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>storeä¸­ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">INCREMENT_N</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../store/mutation-types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="title function_">state</span>(<span class="params"></span>) &#123;...&#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    [<span class="variable constant_">INCREMENT_N</span>](state, payload) &#123;</span><br><span class="line">      state.<span class="property">counter</span> += payload</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>ç»„ä»¶ä¸­æäº¤äº‹ä»¶çš„æ—¶å€™ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">INCREMENT_N</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../store/mutation-types&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">      ...</span><br><span class="line">      store.<span class="title function_">commit</span>(<span class="variable constant_">INCREMENT_N</span>, <span class="number">10</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>mutationé‡è¦åŸåˆ™</p><p>mutation å¿…é¡»æ˜¯åŒæ­¥å‡½æ•°</p><ul><li>è¿™æ˜¯å› ä¸ºdevtoolå·¥å…·ä¼šè®°å½•mutationçš„æ—¥è®°</li><li>æ¯ä¸€æ¡mutationè¢«è®°å½•ï¼Œdevtoolséƒ½éœ€è¦æ•æ‰åˆ°å‰ä¸€çŠ¶æ€å’Œåä¸€çŠ¶æ€çš„å¿«ç…§</li><li>ä½†æ˜¯åœ¨mutationä¸­æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œå°±æ— æ³•è¿½è¸ªåˆ°æ•°æ®çš„å˜åŒ–</li><li>æ‰€ä»¥Vuexçš„é‡è¦åŸåˆ™ä¸­è¦æ±‚ mutationå¿…é¡»æ˜¯åŒæ­¥å‡½æ•°ï¼›</li></ul></li></ul><h4 id="mapMutations">mapMutations</h4><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å€ŸåŠ©äºè¾…åŠ©å‡½æ•°ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ˜ å°„åˆ°å¯¹åº”çš„æ–¹æ³•ä¸­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mutations = <span class="title function_">mapMutations</span>([<span class="string">&quot;increment&quot;</span>, <span class="string">&quot;decrement&quot;</span>])</span><br><span class="line"><span class="keyword">const</span> mutations2 = <span class="title function_">mapMutations</span>(&#123;</span><br><span class="line">    <span class="attr">addNumber</span>: <span class="variable constant_">ADD_NUMBER</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="actions">actions</h3><ul><li><p>actionæäº¤mutation</p><ul><li><p>actions ç±»ä¼¼äºmutationsï¼Œä½†æ˜¯actionæäº¤çš„æ˜¯mutationï¼Œè€Œä¸æ˜¯ç›´æ¥å˜æ›´çŠ¶æ€</p></li><li><p>actions å¯ä»¥åŒ…å«ä»»æ„<strong>å¼‚æ­¥æ“ä½œ</strong></p></li><li><p>actionsæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å‚æ•° <strong>context</strong>ï¼Œé‡Œé¢æœ‰å¾ˆå¤šå±æ€§ï¼Œæˆ‘ä»¬ç”¨çš„æ—¶å€™é™¤äº†context.xxxä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è§£æ„å‡ºæ¥ä½¿ç”¨</p></li><li><p>ä»contextè·å–<strong>commit</strong>æ–¹æ³•æ¥æäº¤ä¸€ä¸ªmutation</p></li></ul></li><li><p>actionsçš„åˆ†å‘æ“ä½œï¼ˆè§¦å‘actionsä¸­çš„æ–¹æ³•ï¼‰</p><p>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨storeä¸Šçš„<strong>dispatch</strong>è¿›è¡Œåˆ†å‘ï¼Œå¹¶ä¸”å¯ä»¥ä¼ é€’å‚æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store.js</span></span><br><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params">state</span>) &#123;</span><br><span class="line">        state.<span class="property">counter</span>++</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 1. å¯ä»¥æ¥æ”¶å‚æ•°</span></span><br><span class="line">    <span class="title function_">incrementAction</span>(<span class="params">context, payload</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(payload)  <span class="comment">// payloadä¸ºæ¥æ”¶åˆ°çš„å‚æ•°</span></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå¼‚æ­¥ï¼š1sä¹‹åå†æäº¤äº‹ä»¶</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          context.<span class="title function_">commit</span>(<span class="string">&quot;increment&quot;</span>) <span class="comment">// æäº¤mutation</span></span><br><span class="line">        &#125;)</span><br><span class="line">&#125;,</span><br><span class="line">        <span class="comment">// 2. context çš„å±æ€§</span></span><br><span class="line">    <span class="title function_">decrementAction</span>(<span class="params">&#123; commit, dispatch, state, rootState, getters, rootGetters &#125;</span>) &#123;</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&quot;decrement&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç»„ä»¶çš„setupä¸­</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">   <span class="comment">// åˆ†å‘actionsï¼Œå¹¶æºå¸¦å‚æ•°</span></span><br><span class="line">   store.<span class="title function_">dispatch</span>(<span class="string">&quot;incrementAction&quot;</span>, &#123;<span class="attr">count</span>: <span class="number">100</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä»¥å¯¹è±¡çš„å½¢å¼è¿›è¡Œåˆ†å‘</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç»„ä»¶çš„setupä¸­</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  store.<span class="title function_">dispatch</span>(&#123;</span><br><span class="line">     <span class="attr">type</span>: <span class="string">&quot;incrementAction&quot;</span>,</span><br><span class="line">     <span class="attr">count</span>: <span class="number">100</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="mapActions">mapActions</h4><p>actions ä¹Ÿæœ‰å¯¹åº”çš„è¾…åŠ©å‡½æ•° mapActions</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™æ ·ç”¨ä¸è¡Œ..</span></span><br><span class="line"><span class="keyword">const</span> actions = mapActions[<span class="string">&quot;incrementAction&quot;</span>, <span class="string">&quot;decrementAction&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡å†™æ³•(é‡å‘½å)</span></span><br><span class="line"><span class="keyword">const</span> actions2 = <span class="title function_">mapActions</span>(&#123;</span><br><span class="line">  <span class="attr">add</span>: <span class="string">&quot;incrementAction&quot;</span>,</span><br><span class="line">  <span class="attr">sub</span>: <span class="string">&quot;decrementAction&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="actionsçš„å¼‚æ­¥æ“ä½œ">actionsçš„å¼‚æ­¥æ“ä½œ</h4><p>actionså¾ˆå¤šæ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç»„ä»¶æ´¾å‘actionsçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿæƒ³æ”¶åˆ°ç»“æœï¼Œæ˜¯è¯·æ±‚æˆåŠŸäº†è¿˜æ˜¯å¤±è´¥äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨actionså¯¹åº”æ–¹æ³•ä¸­è¿”å› Promiseï¼Œå¹¶å¯¹æˆåŠŸå¤±è´¥åšå¤„ç†</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">   <span class="title function_">getHomeMultidata</span>(<span class="params">context</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        axios.<span class="title function_">get</span>(<span class="string">&quot;http://123.207.32.32:8000/home/multidata&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">          context.<span class="title function_">commit</span>(<span class="string">&quot;addBannerData&quot;</span>, res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">banner</span>.<span class="property">list</span>)</span><br><span class="line">          <span class="title function_">resolve</span>(<span class="string">&quot;okok&quot;</span>)</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> promise = store.<span class="title function_">dispatch</span>(<span class="string">&quot;getHomeMultidata&quot;</span>)</span><br><span class="line">    promise.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="module">module</h3><h4 id="moduleçš„åŸºæœ¬ä½¿ç”¨">moduleçš„åŸºæœ¬ä½¿ç”¨</h4><p>ä»€ä¹ˆæ˜¯moduleï¼Ÿ</p><ul><li>ç”±äºä½¿ç”¨å•ä¸€çŠ¶æ€æ ‘ï¼Œåº”ç”¨çš„æ‰€æœ‰çŠ¶æ€éƒ½é›†ä¸­åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å¯¹è±¡ï¼Œå½“åº”ç”¨å˜å¾—å¤æ‚æ—¶ï¼Œstoreå¯¹è±¡å°±å˜å¾—ç›¸å½“è‡ƒè‚¿ï¼Œä¸åˆ©äºç®¡ç†</li><li>æ‰€ä»¥Vuexå…è®¸æˆ‘ä»¬å°†storeåˆ†æ¨¡å—</li><li>æ¯ä¸ªæ¨¡å—æ‹¥æœ‰è‡ªå·±çš„stateï¼Œmutationï¼Œactionï¼Œgetterï¼Œç”šè‡³æ˜¯åµŒå¥—å­æ¨¡å—</li></ul><p>ä½¿ç”¨ï¼š</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c755defa77b4c7fa9c8bd2d4a36217c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><ul><li>æ¨¡å—å†…éƒ¨çš„mutationå’Œgetterçš„ç¬¬ä¸€ä¸ªå‚æ•°stateæ˜¯æ¨¡å—çš„å±€éƒ¨çŠ¶æ€å¯¹è±¡</li></ul><h4 id="moduleçš„å‘½åç©ºé—´">moduleçš„å‘½åç©ºé—´</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å—å†…éƒ¨çš„actionï¼Œmutationä»ç„¶æ˜¯æ³¨å†Œåœ¨å…¨å±€çš„å‘½åç©ºé—´ä¸­çš„</p><p>å¦‚æœå¸Œæœ›æ¨¡å—å…·æœ‰æ›´é«˜çš„å°è£…åº¦å’Œå¤ç”¨æ€§ï¼Œå¯ä»¥åœ¨æ¨¡å—ä¸­æ·»åŠ <code>namespaced: true</code></p><p>ä½¿æ¨¡å—æ›´ç‹¬ç«‹</p><p>ä¹‹åï¼Œå½“æ¨¡å—è¢«æ³¨å†Œåå®ƒçš„æ‰€æœ‰getterã€actionåŠmutationéƒ½ä¼šè‡ªåŠ¨æ ¹æ®æ¨¡å—æ³¨å†Œçš„è·¯å¾„è°ƒæ•´å‘½å</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/827e0697e09d426699b684bf4bbdc59e~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h4 id="moduleä¿®æ”¹æˆ–æ´¾å‘æ ¹ç»„ä»¶">moduleä¿®æ”¹æˆ–æ´¾å‘æ ¹ç»„ä»¶</h4><p>{root: true}</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">incrementAction</span>(<span class="params">&#123;commit, dispatch,state&#125;</span>) &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&quot;rootIncrement&quot;</span>, <span class="literal">null</span>, &#123;<span class="attr">root</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">        <span class="title function_">dispatch</span>(<span class="string">&quot;rootIncrementAction&quot;</span>, <span class="literal">null</span>, &#123;<span class="attr">root</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="moduleçš„è¾…åŠ©å‡½æ•°">moduleçš„è¾…åŠ©å‡½æ•°</h4><p>å†™æ³•ä¸€ï¼šé€šè¿‡å®Œæ•´çš„æ¨¡å—ç©ºé—´åæ¥æŸ¥æ‰¾(ä¸æ˜¯å¾ˆæ¨èä½¿ç”¨)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">  ...<span class="title function_">mapState</span>(&#123;</span><br><span class="line">    <span class="attr">homeCounter</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">home</span>.<span class="property">homeCounter</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  ...<span class="title function_">mapGetters</span>(&#123;</span><br><span class="line">    <span class="attr">doubleHomeCounter</span>: <span class="string">&quot;home/doubleHomeCounter&quot;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å†™æ³•äºŒï¼šç¬¬ä¸€ä¸ªå‚æ•°å†™æ¨¡å—åï¼Œç¬¬äºŒä¸ªå‚æ•°å†™å±æ€§</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">   ...<span class="title function_">mapState</span>(<span class="string">&quot;home&quot;</span>, [<span class="string">&quot;homeCounter&quot;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™æ³•ä¸‰ï¼š<code>createNamespacedHelpers</code>è¾…åŠ©å‡½æ•°</p><p>åˆ›å»ºåŸºäºæŸä¸ªå‘½åç©ºé—´è¾…åŠ©å‡½æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡é‡Œæœ‰æ–°çš„ç»‘å®šåœ¨ç»™å®šå‘½åç©ºé—´å€¼ä¸Šçš„ç»„ä»¶ç»‘å®šè¾…åŠ©å‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createNamespacedHelpers &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">const</span> &#123; mapState, mapGetters&#125; = <span class="title function_">createNamespacedHelpers</span>(<span class="string">&quot;home&quot;</span>)</span><br><span class="line"></span><br><span class="line">...<span class="title function_">mapState</span>([<span class="string">&quot;homeCounter&quot;</span>])</span><br></pre></td></tr></table></figure><p><strong>setupä¸­ä½¿ç”¨</strong></p><p>ä¿®æ”¹ä¹‹å‰çš„ hooksï¼Œ<strong>useState</strong>ï¼Œ<strong>useGetters</strong>ï¼Œè€ƒè™‘æ¨¡å—çš„æƒ…å†µ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState, createNamespacedHelpers&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useMapper &#125; <span class="keyword">from</span> <span class="string">&#x27;./useMapper&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useState</span>(<span class="params">moduleName, mapper</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> mapperFn = mapState</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> moduleName === <span class="string">&#x27;string&#x27;</span> &amp;&amp; moduleName.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    mapperFn = <span class="title function_">createNamespacedHelpers</span>(moduleName).<span class="property">mapState</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mapper = moduleName</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useMapper</span>(mapper, mapperFn)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>// useGettersåŒç†</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapGetters, createNamespacedHelpers &#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useMapper &#125; <span class="keyword">from</span> <span class="string">&quot;./useMapper&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useGetters</span>(<span class="params">moduleName, mapper</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> mapperFn = mapGetters</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> moduleName === <span class="string">&#x27;string&#x27;</span> &amp;&amp; moduleName.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    mapperFn = <span class="title function_">createNamespacedHelpers</span>(moduleName).<span class="property">mapGetters</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mapper = moduleName</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useMapper</span>(mapper, mapperFn)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> state = <span class="title function_">useState</span>([<span class="string">&quot;rootCounter&quot;</span>])</span><br><span class="line">  <span class="keyword">const</span> rootGetters = <span class="title function_">useGetters</span>([<span class="string">&quot;doubleRootCounter&quot;</span>])</span><br><span class="line">  <span class="keyword">const</span> getters = <span class="title function_">useGetters</span>(<span class="string">&quot;home&quot;</span>, [<span class="string">&quot;doubleHomeCounter&quot;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥Vue3+Typescriptå­¦ä¹ âš¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> vuex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯äººçš„æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹è·¯</title>
      <link href="/2022/04/04/%E5%89%8D%E7%AB%AF%E4%BA%BA%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E4%B9%8B%E8%B7%AF/"/>
      <url>/2022/04/04/%E5%89%8D%E7%AB%AF%E4%BA%BA%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E4%B9%8B%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<h3 id="å­¦ä¹ èµ„æ–™">å­¦ä¹ èµ„æ–™</h3><blockquote><ol><li><p>[å‰ç«¯ç®—æ³•ä¸æ•°æ®ç»“æ„é¢è¯•ï¼šåº•å±‚é€»è¾‘è§£è¯»ä¸å¤§å‚çœŸé¢˜è®­ç»ƒ]</p><p>é“¾æ¥ï¼š<a href="https://juejin.cn/book/6844733800300150797">https://juejin.cn/book/6844733800300150797</a></p><p>å¤§çº²ï¼š</p></li></ol><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/24/171ac6e4faf30ecf~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img" style="zoom:67%;" /></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³•ğŸ˜¥ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VueRouter</title>
      <link href="/2022/04/04/VueRouter/"/>
      <url>/2022/04/04/VueRouter/</url>
      
        <content type="html"><![CDATA[<p>VueRouterè·¯ç”±ä½¿ç”¨</p><h3 id="ç®€å•çš„ä»‹ç»ğŸ˜">ç®€å•çš„ä»‹ç»ğŸ˜</h3><blockquote><p>è¿™ä¸€éƒ¨åˆ†äº†è§£ã€ç†è§£ä¸€ä¸‹ï¼ŒçŸ¥é“æœ‰å°±è¡Œ</p></blockquote><p>åç«¯è·¯ç”±é˜¶æ®µï¼š</p><ul><li>æœåŠ¡å™¨æ¸²æŸ“å¥½æ•´ä¸ªé¡µé¢ï¼Œå¹¶ä¸”å°†é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯</li><li>ä¸éœ€è¦å•ç‹¬åŠ è½½ä»»ä½•çš„jså’Œcss, å¯ä»¥ç›´æ¥äº¤ç»™æµè§ˆå™¨å±•ç¤º, è¿™æ ·ä¹Ÿæœ‰åˆ©äºSEOçš„ä¼˜åŒ–</li><li>ä¸åˆ©äºç»´æŠ¤</li></ul><p>å‰åç«¯åˆ†ç¦»é˜¶æ®µï¼š</p><ul><li>åç«¯åªæä¾›APIæ¥è¿”å›æ•°æ®ï¼Œå‰ç«¯é€šè¿‡Ajaxè·å–æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡JavaScriptå°†æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­</li><li>å‰åç«¯è´£ä»»æ¸…æ™°ï¼Œåç«¯ä¸“æ³¨äºæ•°æ®ä¸Šï¼Œå‰ç«¯ä¸“æ³¨äºäº¤äº’å’Œå¯è§†åŒ–ä¸Š</li></ul><p>å‰ç«¯è·¯ç”±æ˜¯å¦‚ä½•åšåˆ°URLå’Œå†…å®¹è¿›è¡Œæ˜ å°„å‘¢ï¼Ÿç›‘å¬URLçš„æ”¹å˜</p><h4 id="URLçš„hash">URLçš„hash</h4><p>URLçš„hashä¹Ÿå°±æ˜¯é”šç‚¹(#), æœ¬è´¨ä¸Šæ˜¯æ”¹å˜window.locationçš„hrefå±æ€§</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥èµ‹å€¼location.hashæ¥æ”¹å˜href, ä½†æ˜¯é¡µé¢ä¸å‘ç”Ÿåˆ·æ–°</p><p>(é¡µé¢ä¸€æ—¦åˆ·æ–°ï¼Œåˆä¼šå‘æœåŠ¡å™¨å‘è¯·æ±‚)</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/home&quot;</span>&gt;</span>home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/about&quot;</span>&gt;</span>about<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>Default<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> contentEl = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.content&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;hashchange&quot;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">switch</span>(location.<span class="property">hash</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">case</span> <span class="string">&quot;#/home&quot;</span>: </span></span><br><span class="line"><span class="language-javascript">                contentEl.<span class="property">innerHTML</span> = <span class="string">&quot;Home&quot;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">break</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">case</span> <span class="string">&quot;#/about&quot;</span>: </span></span><br><span class="line"><span class="language-javascript">                contentEl.<span class="property">innerHTML</span> = <span class="string">&quot;About&quot;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">break</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br></pre></td></tr></table></figure><p>hashçš„ä¼˜åŠ¿å°±æ˜¯å…¼å®¹æ€§æ›´å¥½ï¼Œåœ¨è€ç‰ˆIEä¸­éƒ½å¯ä»¥è¿è¡Œï¼Œä½†æ˜¯ç¼ºé™·æ˜¯æœ‰ä¸€ä¸ª#ï¼Œæ˜¾å¾—ä¸åƒä¸€ä¸ªçœŸå®çš„è·¯å¾„</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2338dd9e294d475d98d18814fc6a9759~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:50%;" /><h4 id="HTML5çš„History">HTML5çš„History</h4><p>historyæ¥å£æ˜¯HTML5æ–°å¢çš„, å®ƒæœ‰å…­ç§æ¨¡å¼æ”¹å˜URLè€Œä¸åˆ·æ–°é¡µé¢ï¼š</p><p>replaceStateï¼šæ›¿æ¢åŸæ¥çš„è·¯å¾„</p><p>pushStateï¼šä½¿ç”¨æ–°çš„è·¯å¾„ï¼ˆå‹æ ˆï¼‰</p><p>popStateï¼šè·¯å¾„çš„å›é€€ï¼ˆå¼¹æ ˆï¼‰</p><p>goï¼šå‘å‰æˆ–å‘åæ”¹å˜è·¯å¾„ go(1)å‰è¿›1æ­¥ï¼Œgo(2)ï¼Œå‰è¿›ä¸¤æ­¥ï¼Œgo(-1)ï¼Œåé€€ä¸€æ­¥</p><p>forwardï¼šå‘å‰ä¸€æ­¥</p><p>backï¼šåé€€ä¸€æ­¥</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>about<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>Default<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> contentEl = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.content&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> <span class="title function_">changeContent</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">switch</span>(location.<span class="property">pathname</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">case</span> <span class="string">&quot;/home&quot;</span>:</span></span><br><span class="line"><span class="language-javascript">        contentEl.<span class="property">innerHTML</span> = <span class="string">&quot;Home&quot;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">break</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">case</span> <span class="string">&quot;/about&quot;</span>:</span></span><br><span class="line"><span class="language-javascript">        contentEl.<span class="property">innerHTML</span> = <span class="string">&quot;About&quot;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">break</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: </span></span><br><span class="line"><span class="language-javascript">        contentEl.<span class="property">innerHTML</span> = <span class="string">&quot;Default&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> aEls = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;a&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">for</span> (<span class="keyword">let</span> aEl <span class="keyword">of</span> aEls) &#123;</span></span><br><span class="line"><span class="language-javascript">    aEl.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      e.<span class="title function_">preventDefault</span>() <span class="comment">// é˜»æ­¢é»˜è®¤è¡Œä¸º</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> href = aEl.<span class="title function_">getAttribute</span>(<span class="string">&quot;href&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// history.replaceState(&#123;&#125;, &quot;&quot;, href)</span></span></span><br><span class="line"><span class="language-javascript">      history.<span class="title function_">pushState</span>(&#123;&#125;, <span class="string">&quot;&quot;</span>, href)</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">changeContent</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;popstate&quot;</span>, changeContent)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dce1fff5aaeb47de851682528df97530~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:50%;" /><h3 id="vue-routerğŸ“±">vue-routerğŸ“±</h3><p>Vue Router æ˜¯ Vue.js çš„å®˜æ–¹è·¯ç”±ï¼Œä¾¿äºæ„å»ºå•é¡µé¢åº”ç”¨</p><h4 id="ä½¿ç”¨vue-router">ä½¿ç”¨vue-router</h4><ul><li>å®‰è£… Vue Router</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install vue-router</span><br></pre></td></tr></table></figure><ul><li>è·¯ç”±çš„ä½¿ç”¨æ­¥éª¤</li></ul><ol><li><p>åˆ›å»ºè·¯ç”±ç»„ä»¶</p></li><li><p>é…ç½®è·¯ç”±æ˜ å°„ã€åˆ›å»ºè·¯ç”±å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;../pages/Home.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">About</span> <span class="keyword">from</span> <span class="string">&#x27;../pages/About.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é…ç½®æ˜ å°„å…³ç³»</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Home</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">About</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªè·¯ç”±å¯¹è±¡router</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  routes,</span><br><span class="line">  <span class="comment">// ä½¿ç”¨è·¯ç”±çš„æ¨¡å¼ï¼Œhash / history</span></span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€åå¯¼å‡º</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure></li><li><p>åœ¨å…¨å±€main.jsä¸­æ³¨å†Œè·¯ç”±</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="comment">// æ³¨å†Œè·¯ç”±</span></span><br><span class="line">vue.<span class="title function_">use</span>(router)</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨è·¯ç”±ï¼š<code>&lt;router-link&gt;</code> <code>&lt;router-view&gt;</code></p><p>è¿™ç§<code>&lt;router-link to&gt;</code>å« <strong>å£°æ˜å¼å¯¼èˆª</strong></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>å…³äº<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="è·¯ç”±é‡å®šå‘">è·¯ç”±é‡å®šå‘</h4><p>å¯¹ â€˜/â€™ è¿™ä¸ªè·¯å¾„ï¼Œé‡å®šå‘åˆ°â€™/homeâ€™</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, </span><br><span class="line">  <span class="comment">// é‡å®šå‘</span></span><br><span class="line">  <span class="attr">redirect</span>: <span class="string">&#x27;/home&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>è·¯ç”±è¿˜æœ‰å…¶ä»–å±æ€§</p><ul><li>nameï¼šç»™æŸä¸ªè·¯ç”±èµ·ç‹¬ä¸€æ— äºŒçš„åå­—</li><li>metaï¼šé…ç½®ä¸€äº›å‚æ•°ï¼Œè¢«ä¸€èµ·å¸¦åˆ°routerå¯¹è±¡ä¸­</li></ul><h4 id="è·¯ç”±æ‡’åŠ è½½">è·¯ç”±æ‡’åŠ è½½</h4><p>æŠŠä¸åŒè·¯ç”±å¯¹åº”çš„ç»„ä»¶åˆ†å‰²æˆä¸åŒçš„ä»£ç å—ï¼Œç„¶åå½“è·¯ç”±è¢«è®¿é—®çš„æ—¶å€™æ‰åŠ è½½å¯¹åº”ç»„ä»¶</p><p>å¥½å¤„ï¼šæé«˜é¦–å±çš„æ¸²æŸ“æ•ˆç‡</p><p>å®é™…å°±æ˜¯webpackçš„åˆ†åŒ…ï¼Œè€ŒVue Routeré»˜è®¤å°±æ”¯æŒåŠ¨æ€æ¥å¯¼å…¥ç»„ä»¶</p><ul><li>è¿™æ˜¯å› ä¸ºcomponentå¯ä»¥ä¼ å…¥ä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°éœ€è¦è¿”å›ä¸€ä¸ªPromise</li><li>è€Œimportå‡½æ•°å°±æ˜¯è¿”å›ä¸€ä¸ªPromise</li></ul><p>ä¸é‡‡ç”¨ç›´æ¥<code>import Home from '../pages/Home.vue'</code>çš„æ–¹å¼</p><p>å¦å¤–è¿˜å¯ä»¥å¯¹åˆ†åŒ…å‘½åï¼š<code>/*webpackChunkName: &quot;xxx&quot;*/</code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;../pages/Home.vue&quot;</span>)</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    <span class="comment">// è¿˜å¯ä»¥å¯¹åˆ†åŒ…å‘½å</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="comment">/*webpackChunkName: &quot;ahout-chunk&quot; */</span><span class="string">&quot;../pages/About.vue&quot;</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>æ‰“åŒ…åçš„æ•ˆæœ</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd0fdef2422c405388ab51b6a851eabc~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h4 id="router-linkçš„å±æ€§">router-linkçš„å±æ€§</h4><ul><li><p>toï¼šå­—ç¬¦ä¸²ï¼ˆâ€˜/homeâ€™ï¼‰æˆ–è€…å¯¹è±¡ï¼ˆé…ç½®è·¯å¾„+å‚æ•°ï¼‰</p></li><li><p>replaceï¼šæ›¿ä»£</p><p>è®¾ç½® replace å±æ€§çš„è¯ï¼Œå½“ç‚¹å‡»æ—¶ï¼Œä¼šè°ƒç”¨ router.replace()ï¼Œè€Œä¸æ˜¯ router.push()</p></li><li><p>active-classå±æ€§ï¼šå¯ä»¥åœ¨è¿™ä¸ªclassåŠ æ ·å¼å•¥çš„</p><p>è®¾ç½®æ¿€æ´»aå…ƒç´ ååº”ç”¨çš„classï¼Œé»˜è®¤æ˜¯router-link-active(ä¸€èˆ¬ ä¸å»ä¿®æ”¹)</p></li><li><p>exact-active-classå±æ€§</p><p>é“¾æ¥ç²¾å‡†æ¿€æ´»æ—¶ï¼Œåº”ç”¨äºæ¸²æŸ“çš„  çš„ classï¼Œé»˜è®¤æ˜¯router-link-exact-active</p><p>åœ¨åµŒå¥—è·¯ç”±ä¸­ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªåµŒå¥—è·¯ç”±æ˜¯ï¼š/home/message é‚£ä¹ˆè¿™ä¸ªclassåªä¼šåœ¨messageé‚£ä¸ªå­è·¯ç”±ä¸­</p></li></ul><h4 id="åŠ¨æ€è·¯ç”±">åŠ¨æ€è·¯ç”±</h4><p>åŠ¨æ€ï¼Œå³è¿™ä¸ªè·¯ç”±çš„è·¯å¾„æ˜¯åŠ¨æ€æ”¹å˜çš„</p><p>åœ¨Vue Routerä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è·¯å¾„ä¸­ä½¿ç”¨ä¸€ä¸ªåŠ¨æ€å­—æ®µæ¥å®ç°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè·¯å¾„å‚æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">path</span>: <span class="string">&#x27;/user/:username/id/:id&#x27;</span>,</span><br><span class="line">   <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;../pages/User.vue&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>:username? åŠ ï¼Ÿè¡¨ç¤ºå¯æœ‰å¯æ— ï¼Œå¦åˆ™å¿…é¡»æœ‰</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/82dd5687c9ad49d7932878f443e5319d~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:60%;" /><p>å¦‚ä½•è·å–åŠ¨æ€è·¯ç”±çš„å€¼ï¼Ÿ</p><p>åœ¨templateä¸­ï¼š<code>$route.params</code></p><p>åœ¨createdä¸­ï¼š<code>this.$route.params</code></p><p>åœ¨setupä¸­ï¼šè¦ä½¿ç”¨ vue-routeråº“ç»™æˆ‘ä»¬æä¾›çš„ä¸€ä¸ªhook <strong>useRoute</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRoute&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥è°ƒç”¨useRoute()ï¼Œä¼šè¿”å›ä¸€ä¸ªè·¯ç”±å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">const</span> route = <span class="title function_">useRoute</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(route);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(route.<span class="property">params</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="NotFound">NotFound</h4><p>å¯¹äºé‚£äº›æ²¡æœ‰åŒ¹é…åˆ°çš„è·¯ç”±ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåŒ¹é…åˆ°å›ºå®šçš„æŸä¸ªé¡µé¢</p><p>å¯ç¼–å†™ä¸€ä¸ªåŠ¨æ€è·¯ç”±ç”¨äºåŒ¹é…æ‰€æœ‰çš„é¡µé¢</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">path</span>: <span class="string">&#x27;/:pathMath(.*)&#x27;</span>, <span class="comment">// ç”¨åˆ°æ­£åˆ™ .*åŒ¹é…ä»»æ„å­—ç¬¦0æˆ–å¤šä¸ª</span></span><br><span class="line">   <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;../pages/NotFound.vue&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡<code>$route.params.pathMath</code>è·å–ä¼ å…¥çš„å‚æ•°</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ad95ddeb9fd4b9fbf2cf6d647adb023~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>è¿˜æœ‰ä¸€ç§å†™æ³•</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/:pathMath(.*)*&#x27;</span> <span class="comment">// è¿™é‡Œå¤šåŠ ä¸€ä¸ª*</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;../pages/NotFound.vue&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒºåˆ«åœ¨äºè§£æçš„æ—¶å€™ï¼Œæ˜¯å¦è§£æ /ï¼š</p><p>æŠŠè·¯å¾„ä¸­çš„/â€¦/ åˆ†æˆä¸€ä¸ªä¸ªçš„</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7701324e163b43c9a42c24b89deefe4f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h4 id="è·¯ç”±çš„åµŒå¥—">è·¯ç”±çš„åµŒå¥—</h4><p>æŸä¸ªè·¯ç”±é¡µé¢æœ¬èº«ä¹Ÿå­˜åœ¨è·¯ç”±çš„æ¥å›åˆ‡æ¢</p><p>é…ç½®å­è·¯ç”±ï¼ŒåŒæ ·åœ¨homeä¸­ä½¿ç”¨router-link,router-view</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;../pages/Home.vue&quot;</span>),</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;message&#x27;</span>, <span class="comment">// è¿™é‡Œä¸éœ€è¦/</span></span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;../pages/Message.vue&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;goods&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;../pages/Goods.vue&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–ç¨‹å¼è·¯ç”±">ç¼–ç¨‹å¼è·¯ç”±</h4><p>ä¸é€šè¿‡router-linkçš„æ–¹å¼å®ç°è·³è½¬ï¼Œæ¯”å¦‚ç‚¹å‡»çš„æ˜¯ä¸€ä¸ªæŒ‰é’®ç­‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// è·å–routerå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">gotoMessage</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    router.<span class="title function_">push</span>(<span class="string">&#x27;/home/message&#x27;</span>) <span class="comment">// å¯ä»¥ç›´æ¥ä¼ å­—ç¬¦ä¸²</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">gotoGoods</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    router.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/home/goods&#x27;</span> <span class="comment">// ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–è¿˜æœ‰ router.replaceã€router.goã€backã€forward</p><p>vue2ä¸­ï¼š<code>this.$router.push</code></p><h4 id="query-æŸ¥è¯¢-æ–¹å¼çš„å‚æ•°">query(æŸ¥è¯¢)æ–¹å¼çš„å‚æ•°</h4><p>ä¼ é€’queryå‚æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.<span class="title function_">push</span>(&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/home/goods&#x27;</span>,</span><br><span class="line">    <span class="attr">query</span>:&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åœ¨å¯¹åº”é¡µé¢ä¸­è·å–queryå‚æ•°ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$route.query.name&#125;&#125;---&#123;&#123;$route.query.age&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="router-linkçš„v-slot">router-linkçš„v-slot</h4><blockquote><p>ç”¨åˆ°æŸ¥æ–‡æ¡£å°±å¥½</p></blockquote><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- v-slotå¯ä»¥æ‹¿åˆ°router-linkç»™æˆ‘ä»¬ä¼ é€’è¿‡æ¥çš„å±æ€§(å¯ä»¥è‡ªå·±å‘½å props)</span></span><br><span class="line"><span class="comment">custom:è¡¨ç¤ºè‡ªå®šä¹‰router-linkï¼Œå¤–éƒ¨ä¸ä¼šç»™æˆ‘ä»¬åŒ…è£¹aå…ƒç´ äº†</span></span><br><span class="line"><span class="comment">props.navigateï¼šæ‰€ä»¥å½“æˆ‘ä»¬æƒ³ç‚¹å‡»æŸä¸ªå…ƒç´ è·³è½¬çš„æ—¶å€™å¯ä»¥ä½¿ç”¨navigate(å½“ç„¶ç”¨ç¼–ç¨‹å¼å¯¼èˆªä¹Ÿæ˜¯å¯ä»¥çš„)</span></span><br><span class="line"><span class="comment">props.routeï¼šè·¯ç”±å¯¹è±¡</span></span><br><span class="line"><span class="comment">props.href: è§£æåçš„url</span></span><br><span class="line"><span class="comment">props: isActive æ˜¯å¦å½“å‰å¤„äºæ´»è·ƒçš„çŠ¶æ€ (true,false)</span></span><br><span class="line"><span class="comment">props: isExactActive æ˜¯å¦å½“å‰å¤„äºç²¾ç¡®çš„æ´»è·ƒçŠ¶æ€ </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">v-slot</span>=<span class="string">&quot;props&quot;</span> <span class="attr">custom</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>href: &#123;&#123;props.href&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;props.navigate&quot;</span>&gt;</span>è·³è½¬home<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;props.route&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;active&#x27;: props.isActive&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;active&#x27;: props.isActive&#125;&quot;</span>&gt;</span>&#123;&#123;props.isExactActive&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="router-viewçš„v-slot">router-viewçš„v-slot</h4><p>router-viewä¹Ÿæä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªæ’æ§½ï¼Œå¯ä»¥ç”¨äº<code>&lt;transition&gt;</code>å’Œ<code>&lt;keep-alive&gt;</code>ç»„ä»¶æ¥åŒ…è£¹ä½ çš„è·¯ç”±ç»„ä»¶ï¼ˆç”¨äºåŠ åŠ¨ç”»ï¼Œç¼“å­˜ï¼‰</p><p>Componentï¼šè¦æ¸²æŸ“çš„ç»„ä»¶</p><p>routeï¼šè§£æå‡ºçš„æ ‡å‡†åŒ–è·¯ç”±å¯¹è±¡</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-view</span> <span class="attr">v-slot</span>=<span class="string">&quot;props&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">&quot;abc&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¯ä»¥æ‹¿åˆ°router-viewç»™æˆ‘ä»¬ä¼ è¿‡æ¥çš„ç»„ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;props.Component&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€æ·»åŠ è·¯ç”±">åŠ¨æ€æ·»åŠ è·¯ç”±</h4><p>æ¯”å¦‚è¯´æˆ‘ä»¬è¦æ ¹æ®ä¸åŒçš„æƒé™æ¥å†³å®šæ˜¯å¦æ·»åŠ è·¯ç”±</p><p>è·¯ç”±å¯¹è±¡routerä¸Šæœ‰æ–¹æ³•ï¼šaddRoute()åŠ¨æ€æ·»åŠ è·¯ç”±</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰è¦æ·»åŠ çš„åŠ¨æ€è·¯ç”±ï¼ˆå¯ä»¥å…ˆå®šä¹‰</span></span><br><span class="line"><span class="keyword">const</span> momentRoute = &#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/moment&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;../pages/HomeMoment.vue&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">router.<span class="title function_">addRoute</span>(momentRoute)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥æ·»åŠ çš„æ—¶å€™ä½œä¸ºaddRouteçš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰</span></span><br><span class="line"><span class="comment">// ç»™homeåŠ¨æ€æ·»åŠ å­è·¯ç”±cart è·¯å¾„:/home/cart</span></span><br><span class="line">router.<span class="title function_">addRoute</span>(<span class="string">&#x27;home&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;cart&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;../pages/Cart.vue&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€åˆ é™¤è·¯ç”±">åŠ¨æ€åˆ é™¤è·¯ç”±</h4><p>ä¸‰ç§æ–¹å¼ï¼š</p><ul><li>æ·»åŠ ä¸€ä¸ªåŒåè·¯ç”±ï¼Œç›¸å½“äºè¦†ç›–</li><li>é€šè¿‡removeRouteæ–¹æ³•ï¼Œä¼ å…¥è·¯ç”±çš„åç§°</li><li>é€šè¿‡addRouteæ–¹æ³•çš„è¿”å›å€¼å›è°ƒ</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.<span class="title function_">addRoute</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">component</span>: <span class="title class_">About</span>&#125;)</span><br><span class="line"><span class="comment">// æ–¹å¼1</span></span><br><span class="line">router.<span class="title function_">addRoute</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/other&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Other</span>&#125;)</span><br><span class="line"><span class="comment">// æ–¹å¼2</span></span><br><span class="line">router.<span class="title function_">removeRoute</span>(<span class="string">&#x27;about&#x27;</span>)</span><br><span class="line"><span class="comment">// æ–¹å¼3</span></span><br><span class="line"><span class="keyword">const</span> removeRoute = router.<span class="title function_">addRoute</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">component</span>: <span class="title class_">About</span>&#125;)</span><br><span class="line"><span class="title function_">removeRoute</span>()</span><br></pre></td></tr></table></figure><p><strong>è·¯ç”±å…¶ä»–æ–¹æ³•è¡¥å……</strong></p><ul><li>router.hasRoute()ï¼šæ£€æŸ¥è·¯ç”±æ˜¯å¦å­˜åœ¨ã€‚</li><li>router.getRoutes()ï¼šè·å–ä¸€ä¸ªåŒ…å«æ‰€æœ‰è·¯ç”±è®°å½•çš„æ•°ç»„</li></ul><h3 id="è·¯ç”±å¯¼èˆªå®ˆå«ğŸ‘®">è·¯ç”±å¯¼èˆªå®ˆå«ğŸ‘®</h3><p>vue-router æä¾›çš„å¯¼èˆªå®ˆå«ä¸»è¦ç”¨æ¥é€šè¿‡è·³è½¬æˆ–å–æ¶ˆçš„æ–¹å¼å®ˆå«å¯¼èˆª</p><h4 id="å…¨å±€å‰ç½®å®ˆå«beforeEach">å…¨å±€å‰ç½®å®ˆå«beforeEach</h4><p>åœ¨å¯¼èˆªè§¦å‘æ—¶ä¼šè¢«å›è°ƒ</p><p>å®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li>toï¼šå³å°†è¿›å…¥çš„è·¯ç”±å¯¹è±¡</li><li>fromï¼šå³å°†ç¦»å¼€çš„Routeå¯¹è±¡</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>falseï¼šå–æ¶ˆå½“å‰å¯¼èˆª</li><li>ä¸è¿”å›æˆ–è€…è¿”å›undefinedï¼šè¿›è¡Œé»˜è®¤å¯¼èˆª</li><li>è¿”å›ä¸€ä¸ªè·¯ç”±åœ°å€ï¼š<ul><li>è·¯å¾„å­—ç¬¦ä¸²ï¼šâ€˜/homeâ€™</li><li>å¯¹è±¡ï¼šç±»ä¼¼äº router.push({path: â€œ/loginâ€, query: â€¦})</li></ul></li></ul><p>å°æ¡ˆä¾‹ï¼šå¦‚æœæ²¡ç™»å½•å°±è·³è½¬åˆ°ç™»å½•é¡µé¢</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">path</span> !== <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> token = <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(!token) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;/login&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure><blockquote><p>æ›´å¤šå¯¼èˆªå®ˆå«çœ‹å®˜ç½‘</p><p><a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html">https://router.vuejs.org/zh/guide/advanced/navigation-guards.html</a></p></blockquote><p><strong>å®Œæ•´çš„å¯¼èˆªè§£ææµç¨‹</strong></p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1054c2d5ce484b73bb273502b22db54b~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h3 id="å…¶ä»–è¡¥å……-2">å…¶ä»–è¡¥å……</h3><h4 id="historyApiFallback">historyApiFallback</h4><p>å¼€å‘ä¸­ä¸€ä¸ªéå¸¸å¸¸è§çš„å±æ€§ï¼Œä¸»è¦ä½œç”¨æ˜¯è§£å†³SPAé¡µé¢åœ¨è·¯ç”±è·³è½¬ä¹‹åï¼Œè¿›è¡Œé¡µé¢åˆ·æ–°æ—¶ï¼Œè¿”å›404çš„é”™è¯¯</p><p>å¦‚æœè®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆåœ¨åˆ·æ–°æ—¶ï¼Œè¿”å›404é”™è¯¯æ—¶ï¼Œä¼šè‡ªåŠ¨è¿”å› index.html çš„å†…å®¹</p><blockquote><p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å‰ç«¯è·¯ç”±ï¼Œåˆ·æ–°é¡µé¢æ—¶è®¿é—®çš„èµ„æºåœ¨æœåŠ¡ç«¯æ‰¾ä¸åˆ°ï¼Œå› ä¸ºvue-routerè®¾ç½®çš„è·¯å¾„ä¸æ˜¯çœŸå®å­˜åœ¨çš„è·¯å¾„ã€‚</p></blockquote><blockquote><p>æ³¨ï¼šæˆ‘ä»¬ä½¿ç”¨ vue-cliçš„æ—¶å€™ï¼Œé»˜è®¤å·²ç»å¸®æˆ‘ä»¬è®¾ç½®ä¸ºtrueäº†</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">historyApiFallback</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://webpack.js.org/configuration/dev-server/#devserverhistoryapifallback">https://webpack.js.org/configuration/dev-server/#devserverhistoryapifallback</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥Vue3+Typescriptå­¦ä¹ âš¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vueè·¯ç”± </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éšç¬”âœ</title>
      <link href="/2022/04/03/%E9%9A%8F%E7%AC%94/"/>
      <url>/2022/04/03/%E9%9A%8F%E7%AC%94/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¾…å®Œå–„â€¦</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºJSæ•°æ®ç±»å‹</title>
      <link href="/2022/04/03/%E5%85%B3%E4%BA%8EJS%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2022/04/03/%E5%85%B3%E4%BA%8EJS%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="JS-æ•°æ®ç±»å‹è½¬æ¢">JS æ•°æ®ç±»å‹è½¬æ¢</h3><p>ç±»å‹è½¬æ¢å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š<strong>éšå¼ç±»å‹è½¬æ¢</strong> å’Œ <strong>æ˜¾å¼ç±»å‹è½¬æ¢</strong></p><p><strong>æ˜¾å¼</strong>ï¼šæ¯”å¦‚ Number(value) String(value) â€¦</p><p><strong>éšå¼</strong>ï¼šå¯¹ä¸åŒç±»å‹çš„å€¼ä½¿ç”¨è¿ç®—ç¬¦æ—¶ï¼Œå€¼å¯ä»¥è‡ªåŠ¨è½¬æ¢ï¼Œæ¯”å¦‚ 1 == null</p><p>æˆ‘ä»¬éœ€è¦çŸ¥é“ï¼šåœ¨ JS ä¸­åªæœ‰3ä¸­ç±»å‹çš„è½¬æ¢ï¼šè½¬æ¢ä¸º Numberï¼ŒStringï¼ŒBooleanç±»å‹</p><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å¼„æ¸…æ¥šåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹åº”è¯¥è½¬æˆå“ªç§ç±»å‹å°±å¯ä»¥äº†</p><h4 id="è½¬æ¢ä¸ºboolean"><strong>è½¬æ¢ä¸ºboolean</strong></h4><p><strong>æ˜¾å¼</strong>ï¼š<code>Boolean() </code>æ–¹æ³•å¯ä»¥ç›´æ¥ç”¨æ¥å°†å€¼è½¬æ¢æˆå¸ƒå°”å‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Boolean</span>(<span class="number">2</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><strong>éšå¼</strong>ï¼šé€šå¸¸åœ¨é€»è¾‘åˆ¤æ–­æˆ–è€…æœ‰é€»è¾‘è¿ç®—ç¬¦æ—¶è¢«è§¦å‘</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="number">2</span>) &#123;&#125; <span class="comment">// é€»è¾‘åˆ¤æ–­</span></span><br><span class="line">!!<span class="number">2</span> <span class="comment">// é€»è¾‘è¿ç®—</span></span><br><span class="line"><span class="number">2</span> || <span class="string">&#x27;hello&#x27;</span> <span class="comment">// é€»è¾‘è¿ç®—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x = <span class="string">&#x27;hello&#x27;</span> &amp;&amp; <span class="number">123</span> <span class="comment">// x === 123</span></span><br><span class="line"><span class="comment">// é€»è¾‘è¿ç®—ç¬¦ï¼ˆæ¯”å¦‚ || å’Œ &amp;&amp;ï¼‰æ˜¯åœ¨å†…éƒ¨åšäº† boolean ç±»å‹è½¬æ¢ï¼Œä½†å®é™…ä¸Šè¿”å›çš„æ˜¯åŸå§‹æ“ä½œæ•°çš„å€¼</span></span><br></pre></td></tr></table></figure><p>booleanç±»å‹è½¬æ¢åªæœ‰ trueï¼Œfalseä¸¤ç§ç»“æœã€‚</p><p>é™¤äº† <strong>0ã€NaNã€ç©ºå­—ç¬¦ä¸²ã€nullã€undefined</strong>äº”ä¸ªå€¼æ˜¯falseï¼Œå…¶ä½™éƒ½æ˜¯true</p><blockquote><p>é¢å¤–è¡¥å……ï¼š</p><p>é€»è¾‘æˆ– ||ï¼šä¸€çœŸä¸ºçœŸï¼Œa || bï¼Œåªè¦aä¸ºçœŸå°±è¿”å›açš„æ‰§è¡Œç»“æœï¼Œbä¸æ‰§è¡Œï¼›aä¸ºå‡åˆ™æ‰§è¡Œbï¼Œå¹¶è¿”å›bæ‰§è¡Œåçš„ç»“æœ</p><p>é€»è¾‘ä¸ &amp;&amp;ï¼šä¸€å‡ä¸ºå‡ï¼Œa &amp;&amp; bï¼Œåªè¦aä¸ºå‡å°±è¿”å›açš„æ‰§è¡Œç»“æœï¼Œbä¸æ‰§è¡Œï¼›aä¸ºçœŸåˆ™æ‰§è¡Œbï¼Œå¹¶è¿”å›bæ‰§è¡Œåçš„ç»“æœ</p></blockquote><h4 id="è½¬æ¢ä¸ºä¸ºstring">è½¬æ¢ä¸ºä¸ºstring</h4><ul><li>æ˜¾å¼ï¼š<code>String() </code>æ–¹æ³•å¯ä»¥ç”¨æ¥æ˜¾å¼å°†å€¼è½¬ä¸ºå­—ç¬¦ä¸²ã€‚</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">String</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">// &quot;1,2,3&quot;</span></span><br><span class="line"><span class="title class_">String</span>(&#123;&#125;) <span class="comment">// &#x27;[object Object]&#x27;</span></span><br><span class="line"><span class="title class_">String</span>(<span class="literal">true</span>) <span class="comment">// &#x27;true&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>éšå¼ï¼šéšå¼è½¬æ¢é€šå¸¸åœ¨æœ‰ <code>+</code> è¿ç®—ç¬¦å¹¶ä¸”åªæ˜¯è‡³å°‘æœ‰ä¸€ä¸ªæ“ä½œæ•°æ˜¯ string ç±»å‹æ—¶è¢«è§¦å‘ï¼Œå³å­—ç¬¦ä¸²æ‹¼æ¥</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="string">&#x27;123&#x27;</span>  <span class="comment">//&quot;1123&quot; </span></span><br><span class="line"><span class="number">1</span> + &#123;&#125; <span class="comment">// &#x27;1[object Object]&#x27;</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> + <span class="literal">null</span> <span class="comment">// &#x27;1null&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><ul><li><p>æŠŠå¼•ç”¨ç±»å‹è½¬æ¢ä¸ºStringæ—¶å°±ä¼šè°ƒç”¨Object.prototype.toString(), è¾“å‡ºçš„æ ¼å¼æ˜¯[object å¯¹è±¡çš„ç±»å‹]</p></li><li><p>null ä¸å­—ç¬¦ä¸²æ‹¼æ¥æ—¶nullç›´æ¥è½¬ä¸º â€˜nullâ€™ (å†…éƒ¨çš„å®ç°)</p></li></ul></blockquote><h4 id="è½¬æ¢ä¸ºnumber">è½¬æ¢ä¸ºnumber</h4><p><strong>æ˜¾å¼</strong>ï¼š<code>Number()</code>æ–¹æ³•å¯ä»¥ç”¨æ¥æ˜¾å¼å°†å€¼è½¬æ¢æˆæ•°å­—ç±»å‹</p><ul><li>å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼šç©ºå­—ç¬¦ä¸²å˜ä¸º0ï¼Œå¦‚æœå‡ºç°ä»»ä½•ä¸€ä¸ªéæœ‰æ•ˆæ•°å­—å­—ç¬¦ï¼Œç»“æœéƒ½æ˜¯NaN</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Number</span>(<span class="string">&quot;&quot;</span>)           <span class="comment">//0</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="string">&quot;10px&quot;</span>)       <span class="comment">//NaN</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="string">&quot;10&quot;</span>)         <span class="comment">//10</span></span><br></pre></td></tr></table></figure><ul><li>å¸ƒå°”è½¬æ¢ä¸ºæ•°å­—</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Number</span>(<span class="literal">true</span>) <span class="comment">// 1</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="literal">false</span>) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><ul><li>null å’Œ undefined è½¬æ¢æˆæ•°å­—</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Number</span>(<span class="literal">null</span>) <span class="comment">// 0</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="literal">undefined</span>) <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure><ul><li>Symbolæ— æ³•è½¬æ¢ä¸ºæ•°å­—</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Number</span>(<span class="title class_">Symbol</span>()) <span class="comment">// Cannot convert a Symbol value to a number</span></span><br></pre></td></tr></table></figure><ul><li>BigInt</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Number</span>(<span class="title class_">BigInt</span>(<span class="number">10</span>)) <span class="comment">// 10</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="number">10n</span>) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure><blockquote><p><strong><code>BigInt</code></strong> æ˜¯ä¸€ç§å†…ç½®å¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹æ³•æ¥è¡¨ç¤ºå¤§äº <code>2^53 - 1</code> çš„æ•´æ•°ã€‚<strong><code>BigInt</code></strong> å¯ä»¥è¡¨ç¤ºä»»æ„å¤§çš„æ•´æ•°ã€‚</p><p>å¯ä»¥ç”¨åœ¨ä¸€ä¸ªæ•´æ•°å­—é¢é‡åé¢åŠ  <code>n</code> çš„æ–¹å¼å®šä¹‰ä¸€ä¸ª <code>BigInt</code> ï¼Œå¦‚ï¼š<code>10n</code>ï¼Œæˆ–è€…è°ƒç”¨å‡½æ•° <code>BigInt()</code>ï¼ˆä½†ä¸åŒ…å« <code>new</code> è¿ç®—ç¬¦ï¼‰å¹¶ä¼ é€’ä¸€ä¸ªæ•´æ•°å€¼æˆ–å­—ç¬¦ä¸²å€¼,å¦‚<code>BigInt(10)</code></p></blockquote><ul><li>å¯¹è±¡è½¬æ¢ä¸ºæ•°å­—ï¼Œä¼šæŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ‰§è¡Œ</li></ul><ol><li><p>å…ˆè°ƒç”¨å¯¹è±¡çš„ <code>Symbol.toPrimitive</code> è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ä¸ªæ–¹æ³•</p><blockquote><p>MDNï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol/toPrimitive">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol/toPrimitive</a></p></blockquote></li><li><p>å†è°ƒç”¨å¯¹è±¡çš„ <code>valueOf()</code> è·å–åŸå§‹å€¼ï¼Œå¦‚æœè·å–çš„å€¼ä¾ç„¶ä¸æ˜¯æ•°å­—</p><blockquote><p><code>valueOf()</code> æ–¹æ³•è¿”å›æŒ‡å®šå¯¹è±¡çš„åŸå§‹å€¼ã€‚</p></blockquote></li><li><p>å†è°ƒç”¨å¯¹è±¡çš„ <code>toString()</code> æŠŠå…¶å˜ä¸ºå­—ç¬¦ä¸²</p><blockquote><p>æŠŠå¼•ç”¨ç±»å‹è½¬æ¢ä¸ºStringæ—¶å°±ä¼šè°ƒç”¨Object.prototype.toString(), è¾“å‡ºçš„æ ¼å¼æ˜¯[object å¯¹è±¡çš„ç±»å‹]</p></blockquote></li><li><p>æœ€åå†æŠŠå­—ç¬¦ä¸²åŸºäº<code>Number()</code>æ–¹æ³•è½¬æ¢ä¸ºæ•°å­—</p></li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj-<span class="number">10</span>) <span class="comment">// æ•°å­¦è¿ç®—ï¼šå…ˆæŠŠobjéšå¼è½¬æ¢ä¸ºæ•°å­—ï¼Œå†è¿›è¡Œè¿ç®—</span></span><br><span class="line"><span class="comment">//è¿è¡Œæœºåˆ¶</span></span><br><span class="line">obj[<span class="title class_">Symbol</span>.<span class="property">toPrimitive</span>] <span class="comment">//undifined </span></span><br><span class="line">obj.<span class="title function_">valueof</span>() <span class="comment">// &#123;name:xxx&#125;</span></span><br><span class="line">obj.<span class="title function_">toString</span>() <span class="comment">// &#x27;[object Object]&#x27;</span></span><br><span class="line"><span class="title class_">Number</span> (<span class="string">&quot;[object object]&quot;</span>) <span class="comment">// NaN</span></span><br><span class="line"><span class="title class_">NaN</span>-<span class="number">10</span> <span class="comment">// NaN </span></span><br></pre></td></tr></table></figure><p><strong>éšå¼</strong></p><p>number çš„éšå¼ç±»å‹è½¬æ¢æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨ä¸‹é¢å¤šç§æƒ…å†µä¸‹è¢«è§¦å‘</p><ul><li><p>æ¯”è¾ƒæ“ä½œï¼ˆ&gt;, &lt;, &lt;=, &gt;=ï¼‰</p></li><li><p>æŒ‰ä½æ“ä½œï¼ˆ| &amp; ^ ~ï¼‰</p></li><li><p>ç®—æ•°æ“ä½œï¼ˆ- + * / %ï¼‰ï¼Œ</p><p><strong>æ³¨æ„</strong>ï¼šå½“ <code>+</code>å­˜åœ¨ä»»æ„çš„æ“ä½œæ•°æ˜¯ string ç±»å‹æ—¶ï¼Œè½¬æ¢åˆ°stringç±»å‹ä¸ºæ­¢ï¼Œä¸ä¼šè§¦å‘ number ç±»å‹çš„éšå¼è½¬æ¢</p></li><li><p>ä¸€å…ƒ + æ“ä½œ</p><blockquote><p>ä¸€å…ƒå°±æ˜¯åªæœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼Œ+5    +[]</p><p>+[]  --&gt; 0 ç›¸å½“äºNumber([])</p><p>+{} --&gt; NaN  ç›¸å½“äºString({})=â€˜[object,Object]â€™ï¼›Number(â€˜[object,Object]â€™) --&gt;NaN</p></blockquote></li></ul><p><strong>éœ€è¦æ³¨æ„çš„æƒ…å†µ</strong></p><blockquote><p>javascriptä¸­åŠ æ³•ä¼šè§¦å‘3ç§ç±»å‹è½¬æ¢ï¼Œå³å°†å€¼è½¬æ¢ä¸ºåŸå§‹å€¼ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè½¬æ¢ä¸ºæ•°å­—ã€‚è¿™åˆšå¥½å¯¹åº”äº†javascriptå¼•æ“å†…éƒ¨çš„è½¬æ¢æ“ä½œï¼šToPrimitive(),toString(),toNumber()</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;&#125; + [] === <span class="number">0</span> <span class="comment">// true</span></span><br><span class="line">[] + &#123;&#125; === <span class="number">0</span> <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;&#125; + []ï¼Œå¯¹äºç¼–è¯‘å™¨æ¥è¯´,&#123;&#125;åœ¨å¼€å¤´ï¼Œè¢«è§£ææˆä»£ç å—ï¼Œä¸ä¼šè¿”å›ä»»ä½•å€¼</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥&#123;&#125; + []å®é™…ä¸Šå°±æ˜¯ +[]</span></span><br><span class="line"><span class="comment">// []é€šè¿‡ToPrimitive(),toString() å˜æˆ &quot;&quot;</span></span><br><span class="line"><span class="comment">// æœ€å toNumber() --&gt; 0</span></span><br><span class="line"></span><br><span class="line">[] + &#123;&#125; <span class="comment">// è¿™é‡Œ&#123;&#125;å°±æ˜¯ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">// String([])=&#x27;&#x27; String(&#123;&#125;)=&#x27;[object Object]&#x27; </span></span><br><span class="line"><span class="comment">// æœ‰stringç±»å‹ä¸ä¼šè§¦å‘numberè½¬æ¢äº†,ä¸¤è¾¹éƒ½æ˜¯stringç›´æ¥æ‹¼æ¥</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥ &#x27;&#x27; + &#x27;[object Object]&#x27; --&gt; &#x27;[object Object]&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>æ“ä½œç¬¦ == ä¸¤è¾¹çš„éšå¼è½¬æ¢</strong></p><p>å¦‚æœä¸¤è¾¹çš„æ•°æ®ç±»å‹ä¸åŒï¼Œéœ€è¦å…ˆè½¬ä¸ºç›¸åŒç±»å‹å†è¿›è¡Œæ¯”è¾ƒ</p><ul><li>å¯¹è±¡ == å­—ç¬¦ä¸²</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] == <span class="string">&#x27;1,2,3&#x27;</span>  <span class="comment">// true</span></span><br><span class="line"><span class="comment">// è½¬ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">// [1,2,3].toString() --&gt; &#x27;1,2,3&#x27;</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="attr">name</span>:<span class="string">&#x27;helo&#x27;</span>&#125; == <span class="string">&quot;&#123;name:&#x27;helo&#x27;&#125;&quot;</span> <span class="comment">// false</span></span><br><span class="line"><span class="comment">// &#123;name:&#x27;helo&#x27;&#125;.valueOf().toString() --&gt; &#x27;[object Object]&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>null/ undefined</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="literal">null</span> == <span class="literal">undefined</span> <span class="comment">// true</span></span><br><span class="line"><span class="literal">null</span> === <span class="literal">undefined</span> <span class="comment">// false</span></span><br><span class="line"><span class="comment">//null/undefinedå’Œå…¶ä»–ä»»ä½•å€¼éƒ½ä¸ç›¸ç­‰</span></span><br></pre></td></tr></table></figure><ul><li>å¯¹è±¡ == å¯¹è±¡</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;&#125; == &#123;&#125; <span class="comment">// false æ¯”è¾ƒçš„æ˜¯å †å†…å­˜åœ°å€ï¼Œåœ°å€ç›¸åŒæ‰ç›¸ç­‰</span></span><br></pre></td></tr></table></figure><ul><li>NaN</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">NaN</span> == xxx  éƒ½æ˜¯<span class="literal">false</span></span><br></pre></td></tr></table></figure><p>é™¤äº†ä»¥ä¸Šçš„å››ç§æƒ…å†µï¼Œåªè¦ä¸¤è¾¹ç±»å‹ä¸ä¸€è‡´ï¼Œéƒ½æ˜¯è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œæ¯”è¾ƒ</p><p>æœ€åï¼Œçœ‹é¢˜ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="number">100</span> + <span class="literal">true</span> + <span class="number">21.2</span> + <span class="literal">null</span> + <span class="literal">undefined</span> + <span class="string">&quot;Tencent&quot;</span> + [] + <span class="literal">null</span> + <span class="number">9</span> + <span class="literal">false</span></span><br></pre></td></tr></table></figure><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2cd196b1f2e24fae861c5137e543c817~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://juejin.cn/post/6956170676327677966">https://juejin.cn/post/6956170676327677966</a></p></blockquote><h3 id="æ•°æ®ç±»å‹çš„åˆ¤æ–­">æ•°æ®ç±»å‹çš„åˆ¤æ–­</h3><blockquote><p><a href="https://juejin.cn/post/7061588533214969892#heading-29">https://juejin.cn/post/7061588533214969892#heading-29</a></p><p>æŠŠå¼•ç”¨ç±»å‹è½¬æ¢ä¸ºStringæ—¶å°±ä¼šè°ƒç”¨Object.prototype.toString(), è¾“å‡ºçš„æ ¼å¼æ˜¯[object å¯¹è±¡çš„ç±»å‹]</p><p>Object.prototype.toString.call() æœ‰æ˜¾å¼ç»‘å®šï¼Œ</p><p>å› æ­¤ Object.prototype.toString.call(xxx)å°±æ˜¯ æ‰¾åˆ°xxxä¸­çš„toStringæ–¹æ³•ï¼Œè¾“å‡ºçš„å¯¹è±¡çš„ç±»å‹å°±æ˜¯æ ¹æ®xxxæ¥çš„</p></blockquote><h3 id="ç¥å¥‡çš„åŠ æ³•">ç¥å¥‡çš„åŠ æ³•</h3><blockquote><p><a href="https://blog.csdn.net/dk2290/article/details/86534595">https://blog.csdn.net/dk2290/article/details/86534595</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>08_JSé¢å‘å¯¹è±¡</title>
      <link href="/2022/04/02/08-JS%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"/>
      <url>/2022/04/02/08-JS%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="æ·±å…¥JSé¢å‘å¯¹è±¡">æ·±å…¥JSé¢å‘å¯¹è±¡</h2><h2 id="é¢å‘å¯¹è±¡åˆè¯†">é¢å‘å¯¹è±¡åˆè¯†</h2><h2 id="åˆ›å»ºå¯¹è±¡çš„æ–¹å¼">åˆ›å»ºå¯¹è±¡çš„æ–¹å¼</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼ä¸€ï¼šé€šè¿‡new Object()åˆ›å»º</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&quot;hill&quot;</span></span><br><span class="line">obj.<span class="property">age</span> = <span class="number">18</span></span><br><span class="line">obj.<span class="property">running</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot; is running&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼äºŒï¼šå­—é¢é‡å½¢å¼</span></span><br><span class="line"><span class="keyword">var</span> info = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;hill&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">eating</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;is&#x27;</span> + <span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯¹å±æ€§çš„æ“ä½œ">å¯¹å±æ€§çš„æ“ä½œ</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;yuzi&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.è·å–å±æ€§</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>); <span class="comment">// yuzi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.ç»™å±æ€§èµ‹å€¼</span></span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&quot;jackson&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>); <span class="comment">// jackson</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.åˆ é™¤å±æ€§</span></span><br><span class="line"><span class="comment">// delete obj.name</span></span><br><span class="line"><span class="comment">// console.log(obj); // &#123;age: 18&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.éå†å±æ€§</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// name age</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§ç›´æ¥å®šä¹‰åœ¨å¯¹è±¡å†…éƒ¨æˆ–è€…ç›´æ¥æ·»åŠ åˆ°å¯¹è±¡å†…éƒ¨çš„å±æ€§ï¼Œæˆ‘ä»¬ä¸èƒ½å¯¹å…¶åšå‡ºé™åˆ¶ï¼šæ¯”å¦‚è¿™ä¸ªå±æ€§æ˜¯å¦å¯ä»¥é€šè¿‡deleteåˆ é™¤ï¼Œæ˜¯å¦å¯ä»¥åœ¨for-inéå†çš„æ—¶å€™è¢«éå†å‡ºæ¥</p><h2 id="Object-defineProperty">Object.defineProperty()</h2><ul><li><p>å¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹ä¸€ä¸ªå±æ€§è¿›è¡Œæ¯”è¾ƒç²¾å‡†çš„æ“ä½œæ§åˆ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å±æ€§æè¿°ç¬¦</p><ul><li><p>é€šè¿‡å±æ€§æè¿°ç¬¦å¯ä»¥ç²¾å‡†çš„æ·»åŠ æˆ–ä¿®æ”¹å¯¹è±¡çš„å±æ€§</p></li><li><p>å±æ€§æè¿°ç¬¦éœ€è¦ä½¿ç”¨ Object.defineProperty æ¥å¯¹å±æ€§è¿›è¡Œæ·»åŠ æˆ–ä¿®æ”¹</p></li></ul></li><li><p>Object.defineProperty() æ–¹æ³•ä¼šç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡</p></li><li><p>æ¥æ”¶ä¸‰ä¸ªå‚æ•°</p><ul><li>obj:è¦å®šä¹‰å±æ€§çš„å¯¹è±¡</li><li>prop: è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„åç§°æˆ–Symbol</li><li>descriptorï¼šè¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§æè¿°ç¬¦</li></ul></li><li><p>ç¬¬ä¸‰ä¸ªå‚æ•°çš„å±æ€§æè¿°ç¬¦åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>æ•°æ®å±æ€§æè¿°ç¬¦<br>configurableï¼Œenumerableï¼Œwritableï¼Œvalue</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰æŸä¸ªå±æ€§æ—¶ï¼Œæè¿°ç¬¦çš„é»˜è®¤å€¼ä¸º</span></span><br><span class="line"><span class="comment">// value: èµ‹å€¼çš„value</span></span><br><span class="line"><span class="comment">// configurable: true</span></span><br><span class="line"><span class="comment">// enumerable: true</span></span><br><span class="line"><span class="comment">// writable: true</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;jackson&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&quot;height&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">1.88</span>, <span class="comment">// å±æ€§å€¼(é»˜è®¤ä¸º undefined)</span></span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span>,  <span class="comment">// å¯¹åº”å±æ€§æ˜¯å¦å¯ä»¥æšä¸¾(é»˜è®¤ä¸ºfalse)</span></span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦å¯ä»¥ä¿®æ”¹å±æ€§å€¼(é»˜è®¤ä¸ºfalse)</span></span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>, <span class="comment">// å±æ€§èƒ½å¦è¢«åˆ é™¤(é»˜è®¤ä¸ºfalse),å±æ€§çš„æè¿°ç¬¦èƒ½å¦è¢«æ”¹å˜</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æšä¸¾</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// name age height å¯æšä¸¾</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(obj)); <span class="comment">// [ &#x27;name&#x27;, &#x27;age&#x27;, &#x27;height&#x27; ] å¯æšä¸¾</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹å±æ€§å€¼</span></span><br><span class="line">obj.<span class="property">height</span> = <span class="number">2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">height</span>); <span class="comment">// 2 å¯ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤å±æ€§</span></span><br><span class="line"><span class="keyword">delete</span> obj.<span class="property">height</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">height</span>); <span class="comment">// undefined åˆ é™¤æˆåŠŸ</span></span><br></pre></td></tr></table></figure><ul><li><p>å­˜å–å±æ€§æè¿°ç¬¦<br>enumerableï¼Œconfigurableï¼Œgetï¼Œset</p><p>ä¸ç”¨value,writableï¼Œè€Œæ˜¯ç”¨ get,set</p></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;jackson&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">_address</span>: <span class="string">&quot;å¹¿ä¸œ&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç§æœ‰å±æ€§ï¼Œjsé‡Œé¢æ˜¯æ²¡æœ‰ä¸¥æ ¼æ„ä¹‰çš„ç§æœ‰å±æ€§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å®é™…ä¸Šä¹Ÿèƒ½ç›´æ¥è®¿é—®ï¼Œä½†æ˜¯åœ¨ç¤¾åŒºäººä»¬çº¦å®š ä¸‹åˆ’çº¿_å¼€å¤´çš„å±æ€§å®šä¹‰ä¸ºç§æœ‰å±æ€§</span></span><br><span class="line"><span class="comment">// 1.éšè—æŸä¸€ä¸ªç§æœ‰å±æ€§(address)ä¸å¸Œæœ›ç›´æ¥è¢«å¤–ç•Œä½¿ç”¨å’Œèµ‹å€¼</span></span><br><span class="line"><span class="comment">// 2.å¦‚æœæˆ‘ä»¬å¸Œæœ›æˆªè·æŸä¸ªå±æ€§è¢«è®¿é—®å’Œè®¾ç½®å€¼çš„è¿‡ç¨‹æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨å­˜å‚¨å±æ€§æè¿°ç¬¦</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&quot;address&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="comment">// å¯æšä¸¾</span></span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>, <span class="comment">// å¯åˆ é™¤ï¼Œå¯ä¿®æ”¹æè¿°ç¬¦</span></span><br><span class="line">  <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è·å–äº†ä¸€æ¬¡addressçš„å€¼&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_address</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è®¾ç½®äº†addressçš„å€¼&quot;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_address</span> = value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">address</span>); <span class="comment">// å¹¿ä¸œ</span></span><br></pre></td></tr></table></figure></li></ul><p>å¯æšä¸¾å±æ€§çš„è¡¥å……</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;why&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&quot;address&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&quot;åŒ—äº¬å¸‚&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line"><span class="comment">// addresså±æ€§é»˜è®¤æ˜¯ä¸å¯æšä¸¾çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸Šé¢æ˜¯å¯ä»¥çœ‹åˆ°çš„ï¼ˆç¨å¾®æµ…è‰²ä¸€ç‚¹ï¼‰ï¼Œè¿™æ˜¯æµè§ˆå™¨ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•åšçš„å¤„ç†</span></span><br></pre></td></tr></table></figure><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2fca538eddaf4ec39491455e819979ef~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h2 id="Object-defineProperties">Object.defineProperties()</h2><p><strong>Object.defineProperties()</strong> æ–¹æ³•å¯ä»¥ç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰å¤šä¸ªæ–°çš„å±æ€§</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">_age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(obj, &#123;</span><br><span class="line">  <span class="attr">name</span>: &#123;</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&#x27;jackson&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">age</span>: &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_age</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¯¹è±¡æ–¹æ³•è¡¥å……(äº†è§£)</p><ul><li>è·å–å¯¹è±¡çš„å±æ€§æè¿°ç¬¦<ul><li>getOwnPropertyDescriptor</li><li>getOwnPropertyDescriptors</li></ul></li><li>ç¦æ­¢å¯¹è±¡æ‰©å±•æ–°å±æ€§<ul><li>preventExtensionsï¼šç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ æ–°çš„å±æ€§ä¼šå¤±è´¥(åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ¥é”™)</li></ul></li><li>å¯†å°å¯¹è±¡ï¼Œä¸å…è®¸é…ç½®å’Œåˆ é™¤å±æ€§ï¼šseal<ul><li>å®é™…æ˜¯è°ƒç”¨preventExtensions</li><li>å¹¶ä¸”å°†ç°æœ‰å±æ€§çš„configurable:false</li></ul></li><li>å†»ç»“å¯¹è±¡ï¼Œä¸å…è®¸ä¿®æ”¹ç°æœ‰å±æ€§ï¼šfreeze<ul><li>å®é™…ä¸Šæ˜¯è°ƒç”¨seal</li><li>å¹¶ä¸”å°†ç°æœ‰å±æ€§çš„writable: false</li></ul></li></ul><h2 id="åˆ›å»ºå¤šä¸ªå¯¹è±¡çš„æ–¹å¼">åˆ›å»ºå¤šä¸ªå¯¹è±¡çš„æ–¹å¼</h2><blockquote><p>é€šè¿‡æƒ³è¦åˆ›å»ºå¤šä¸ªå¯¹è±¡çš„ç›®çš„ï¼Œæ¥å¼•å‡ºåé¢çš„æ„é€ å‡½æ•°</p></blockquote><p>å‰é¢æˆ‘ä»¬é€šè¿‡ new Objectï¼Œå­—é¢é‡çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸¤ç§æ–¹å¼æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼š</p><p>åˆ›å»ºåŒæ ·çš„å¯¹è±¡æ—¶ï¼Œéœ€è¦ç¼–å†™é‡å¤ä»£ç </p><p>æ¯”å¦‚è¯´å­—é¢é‡ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = &#123;<span class="attr">name</span>: , <span class="attr">age</span>: &#125;</span><br><span class="line"><span class="keyword">var</span> p2 = &#123;<span class="attr">name</span>: , <span class="attr">age</span>: &#125;</span><br><span class="line"><span class="keyword">var</span> p3 = &#123;<span class="attr">name</span>: , <span class="attr">age</span>: &#125; <span class="comment">// å®ƒä»¬æœ‰åŒæ ·çš„å±æ€§æˆ–è€…æ–¹æ³•</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºå¯¹è±¡çš„æ–¹å¼-å·¥å‚æ¨¡å¼">åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ - å·¥å‚æ¨¡å¼</h3><ul><li>å·¥å‚æ¨¡å¼å…¶å®æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼</li><li>é€šå¸¸æˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼Œé€šè¿‡è¯¥å·¥å‚æ–¹æ³•æˆ‘ä»¬å¯ä»¥äº§ç”Ÿæƒ³è¦çš„å¯¹è±¡</li><li>å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡æœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜ï¼šæˆ‘ä»¬åœ¨æ‰“å°å¯¹è±¡æ—¶ï¼Œå¯¹è±¡çš„ç±»å‹éƒ½æ˜¯Objectç±»å‹</li><li>ä½†æ˜¯ä»æŸäº›è§’åº¦æ¥è¯´ï¼Œè¿™äº›å¯¹è±¡åº”è¯¥æœ‰ä¸€ä¸ªä»–ä»¬å…±åŒçš„ç±»å‹</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createPerson</span>(<span class="params">name, age, height</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> p = &#123;&#125; <span class="comment">// å®šä¹‰ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">  p.<span class="property">name</span> = name</span><br><span class="line">  p.<span class="property">age</span> = age</span><br><span class="line">  p.<span class="property">height</span> = height</span><br><span class="line"></span><br><span class="line">  p.<span class="property">eating</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;is eating&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> p <span class="comment">// æŠŠå¯¹è±¡è¿”å›</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="title function_">createPerson</span>(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">18</span>, <span class="number">1.88</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="title function_">createPerson</span>(<span class="string">&quot;æå››&quot;</span>, <span class="number">20</span>, <span class="number">1.98</span>)</span><br><span class="line"><span class="keyword">var</span> p3 = <span class="title function_">createPerson</span>(<span class="string">&quot;ç‹äº”&quot;</span>, <span class="number">30</span>, <span class="number">1.78</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥å‚æ¨¡å¼çš„ç¼ºç‚¹ï¼šè·å–ä¸åˆ°å¯¹è±¡æœ€çœŸå®çš„ç±»å‹</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1, p2, p3); <span class="comment">// æˆ‘åªçŸ¥é“ä½ æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æˆ‘ä¸çŸ¥é“ä½ æ˜¯personç±»å‹</span></span><br></pre></td></tr></table></figure><h3 id="è®¤è¯†æ„é€ å‡½æ•°">è®¤è¯†æ„é€ å‡½æ•°</h3><h4 id="ä»€ä¹ˆæ˜¯æ„é€ å‡½æ•°ï¼Ÿ">ä»€ä¹ˆæ˜¯æ„é€ å‡½æ•°ï¼Ÿ</h4><ul><li>æ„é€ å‡½æ•°ä¹Ÿç§°ä¹‹ä¸ºæ„é€ å™¨ï¼ˆconstructorï¼‰ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä¼šè°ƒç”¨çš„å‡½æ•°</li><li>JavaScript ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ™®é€šçš„å‡½æ•°è¢«ä½¿ç”¨ new æ“ä½œç¬¦æ¥è°ƒç”¨äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±ç§°ä¹‹ä¸ºæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°</li></ul><blockquote><p>æ‰€ä»¥è¯´æ„é€ å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œåªä¸è¿‡ç”¨ new å»è°ƒç”¨ï¼Œå°±ç§°ä¸ºæ„é€ å‡½æ•°</p><p>newä¹Ÿæ˜¯å¯ä»¥è°ƒç”¨å‡½æ•°çš„å–”</p></blockquote><h4 id="newæ“ä½œç¬¦">newæ“ä½œç¬¦</h4><p>å¦‚æœä¸€ä¸ªå‡½æ•°è¢«ä½¿ç”¨newæ“ä½œç¬¦è°ƒç”¨äº†ï¼Œé‚£ä¹ˆå®ƒä¼šæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ol><li>åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆç©ºå¯¹è±¡ï¼‰</li><li>è¿™ä¸ªå¯¹è±¡å†…éƒ¨çš„ **[[prototype]]**å±æ€§ä¼šè¢«èµ‹å€¼ä¸ºè¯¥æ„é€ å‡½æ•°çš„ <strong>prototype</strong>å±æ€§</li><li>æ„é€ å‡½æ•°çš„ this ï¼Œä¼šæŒ‡å‘åˆ›å»ºå‡ºæ¥çš„æ–°å¯¹è±¡</li><li>æ‰§è¡Œå‡½æ•°çš„å†…éƒ¨ä»£ç </li><li>å¦‚æœæ„é€ å‡½æ•°æ²¡æœ‰è¿”å›éç©ºå¯¹è±¡ï¼Œåˆ™è¿”å›åˆ›å»ºå‡ºæ¥çš„æ–°å¯¹è±¡</li></ol><h4 id="æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡">æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è§„èŒƒï¼šæ„é€ å‡½æ•°çš„é¦–å­—æ¯ä¸€èˆ¬æ˜¯å¤§å†™</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age, height, address</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">height</span> = height</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">address</span> = address</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">eating</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;is eating&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">running</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;is running&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">18</span>, <span class="number">1.88</span>, <span class="string">&#x27;å¹¿å·&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;æå››&quot;</span>, <span class="number">20</span>, <span class="number">1.78</span>, <span class="string">&#x27;åŒ—äº¬&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1); <span class="comment">// Person &#123;...&#125; æ˜¯å¯ä»¥çœ‹è§ç±»å‹çš„</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2);</span><br></pre></td></tr></table></figure><ul><li>è¿™ä¸ªæ„é€ å‡½æ•°å¯ä»¥ç¡®ä¿æˆ‘ä»¬çš„å¯¹è±¡æ˜¯æœ‰Personçš„ç±»å‹çš„</li><li>ä½†æ˜¯ä¹Ÿæœ‰ç¼ºç‚¹ï¼šæˆ‘ä»¬éœ€è¦ç»™æ¯ä¸ªå¯¹è±¡çš„å‡½æ•°å»åˆ›å»ºä¸€ä¸ªå‡½æ•°å¯¹è±¡å®ä¾‹ï¼ˆå¼€è¾Ÿæ–°çš„å†…å­˜ç©ºé—´ï¼‰</li></ul><h3 id="å¯¹è±¡çš„åŸå‹-prototype">å¯¹è±¡çš„åŸå‹ [[prototype]]</h3><ul><li><p>JavaScript ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å†…ç½®å±æ€§ <strong>[[prototype]]</strong>ï¼Œè¿™ä¸ªå±æ€§ç§°ä¹‹ä¸ºå¯¹è±¡çš„åŸå‹ï¼ˆéšå¼åŸå‹ï¼‰ï¼ˆåªè¦æ˜¯å¯¹è±¡ï¼Œå°±ä¼šæœ‰è¿™ä¸ªå†…ç½®å±æ€§ï¼‰</p></li><li><p>[[prototype]] æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯è¯´å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼‰</p></li><li><p>é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><ul><li>å½“æˆ‘ä»¬é€šè¿‡å¼•ç”¨å¯¹è±¡çš„å±æ€§keyæ¥è·å–ä¸€ä¸ªvalueæ—¶ï¼Œå®ƒä¼šè§¦å‘ [[Get]]çš„æ“ä½œ</li><li>è¿™ä¸ªæ“ä½œä¼šé¦–å…ˆæ£€æŸ¥è¯¥å±æ€§æ˜¯å¦æœ‰å¯¹åº”çš„å±æ€§ï¼Œå¦‚æœæœ‰çš„è¯å°±ä½¿ç”¨å®ƒ</li><li>å¦‚æœå¯¹è±¡ä¸­æ²¡æœ‰è¯¥å±æ€§ï¼Œ é‚£ä¹ˆä¼šæ²¿ç€å®ƒçš„åŸå‹å»æŸ¥æ‰¾ [[prototype]]</li></ul></li><li><p>å¦‚æœé€šè¿‡å­—é¢é‡ç›´æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä¹Ÿæœ‰[[prototype]]è¿™ä¸ªå±æ€§</p><p>å¦‚ä½•æŸ¥çœ‹è¿™ä¸ªå±æ€§å‘¢</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">&quot;jackson&quot;</span>&#125;</span><br><span class="line"><span class="keyword">var</span> info = &#123;&#125;</span><br><span class="line"><span class="comment">// åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ä¸Šéƒ½æœ‰ [[prototype]]å±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚ä½•æŸ¥çœ‹è¿™ä¸ªå±æ€§ï¼Ÿ</span></span><br><span class="line"><span class="comment">// æ—©æœŸçš„ECMAæ˜¯æ²¡æœ‰è§„èŒƒå¦‚ä½•å»æŸ¥çœ‹ [[prototype]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»™å¯¹è±¡ä¸­æä¾›äº†ä¸€ä¸ªå±æ€§ __proto__, å¯ä»¥è®©æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåŸå‹å¯¹è±¡(æµè§ˆå™¨æä¾›)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>);<span class="comment">// [Object: null prototype] &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å½“äº(ä¼ªä»£ç )</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>: <span class="string">&#x27;jackson&#x27;</span>, <span class="attr">__proto__</span>: &#123;&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5ä¹‹åæä¾›çš„Object.getPrototypeOf()æŸ¥çœ‹</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(obj)); <span class="comment">// &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾‹å¦‚æ‰¾ age è¿™ä¸ªå±æ€§ï¼Œè¯¥å¯¹è±¡æœ¬èº«æ²¡æœ‰ï¼Œæ²¿ç€åŸå‹æŸ¥æ‰¾</span></span><br><span class="line">obj.<span class="property">__proto__</span>.<span class="property">age</span> = <span class="number">18</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">age</span>); <span class="comment">// 18</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="å‡½æ•°çš„åŸå‹-prototype">å‡½æ•°çš„åŸå‹ prototype</h3><ul><li>æ‰€æœ‰çš„å‡½æ•°éƒ½æœ‰ä¸€ä¸ª prototype å±æ€§ï¼ˆæ˜¾å¼åŸå‹ï¼‰</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯æœ‰[[prototype]]éšå¼å±æ€§</span></span><br><span class="line"><span class="comment">// å¦å¤–ï¼Œå‡½æ•°è¿˜ä¼šå¤šå‡ºæ¥ä¸€ä¸ªæ˜¾å¼åŸå‹å±æ€§ï¼šprototype</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>); </span><br></pre></td></tr></table></figure><ul><li><p>å†çœ‹å›newæ“ä½œç¬¦å…¶ä¸­çš„ä¸€ä¸ªæ­¥éª¤ï¼š</p><p>è¿™ä¸ªå¯¹è±¡å†…éƒ¨çš„[[prototype]]å±æ€§ä¼šè¢«èµ‹å€¼ä¸ºè¯¥æ„é€ å‡½æ•°çš„prototypeå±æ€§</p></li><li><p>ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬é€šè¿‡ Foo æ„é€ å‡½æ•°åˆ›å»ºå‡ºçš„æ‰€æœ‰å¯¹è±¡çš„ [[prototype]] éƒ½æŒ‡å‘ Foo.prototype</p></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> f1 = <span class="keyword">new</span> <span class="title class_">Foo</span>()</span><br><span class="line"><span class="keyword">var</span> f2 = <span class="keyword">new</span> <span class="title class_">Foo</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f1.<span class="property">__proto__</span> === <span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f2.<span class="property">__proto__</span> === <span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºå¯¹è±¡çš„å†…å­˜è¡¨ç°</strong></p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70022f5ae6854d12aad1feb4059f06af~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>æ„é€ å‡½æ•°çš„ prototype å±æ€§æŒ‡å‘è¯¥å‡½æ•°çš„åŸå‹å¯¹è±¡</li><li>åŸå‹å¯¹è±¡èº«ä¸Šæœ‰ä¸€ä¸ª constructor å±æ€§æŒ‡å›æ„é€ å‡½æ•°æœ¬èº«</li><li>newå‡ºæ¥çš„å®ä¾‹å¯¹è±¡ p1ï¼Œp2 å¯¹è±¡èº«ä¸Šæœ‰<code> __proto__</code>å±æ€§ä¹ŸæŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡</li></ul><h3 id="å‡½æ•°åŸå‹ä¸Šçš„å±æ€§constructor">å‡½æ•°åŸå‹ä¸Šçš„å±æ€§constructor</h3><ul><li>é»˜è®¤æƒ…å†µä¸‹åŸå‹ä¸Šéƒ½ä¼šæ·»åŠ ä¸€ä¸ªå±æ€§å«åšconstructorï¼Œè¿™ä¸ªconstructoræŒ‡å‘å½“å‰çš„å‡½æ•°å¯¹è±¡</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. constructorå±æ€§</span></span><br><span class="line"><span class="comment">// Foo.prototypeè¿™ä¸ªå¯¹è±¡ä¸­æœ‰ä¸€ä¸ªconstructorå±æ€§</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// &#123;&#125; ä¸ºä»€ä¹ˆæ²¡çœ‹åˆ°constructorï¼Ÿ</span></span><br><span class="line"><span class="comment">// é‚£æ¢ä¸€ç§æ–¹å¼çœ‹</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>));</span><br><span class="line"><span class="comment">//æ‰“å° </span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   constructor: &#123;</span></span><br><span class="line"><span class="comment">//     value: [Function: Foo],</span></span><br><span class="line"><span class="comment">//     writable: true,        </span></span><br><span class="line"><span class="comment">//     enumerable: false,</span></span><br><span class="line"><span class="comment">//     configurable: true</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// å¯ä»¥çœ‹åˆ°enumerableä¸ºfalseï¼Œæ‰€ä»¥ç¬¬ä¸€ç§æ–¹å¼ä¸èƒ½çœ‹åˆ°constructor</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½é‡å†™è¿™ä¸ªå¯¹è±¡çš„å±æ€§constructorå‘¢ï¼Ÿè‚¯å®šå¯ä»¥å‘€</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&quot;constructor&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="comment">//å¯æšä¸¾</span></span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>, <span class="comment">// å¯åˆ é™¤ï¼Œæè¿°ç¬¦å¯ä¿®æ”¹</span></span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>, <span class="comment">// å¯å†™</span></span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;hahahha&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†æ¥ç›´æ¥æ‰“å°ï¼Œå°±å¯ä»¥çœ‹åˆ°constructoräº†(è¢«æˆ‘ä»¬æ”¹æˆå¯æšä¸¾äº†)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>);<span class="comment">// &#123; constructor: &#x27;hahahha&#x27; &#125;</span></span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨prototypeä¸Šæ·»åŠ è‡ªå·±çš„å±æ€§</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">name</span> = <span class="string">&quot;jackson&quot;</span></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">age</span> = <span class="number">18</span></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eating</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ‘ä»¬å†newå¯¹è±¡çš„æ—¶å€™ï¼Œè¿™äº›å±æ€§éƒ½å¯ä»¥é€šè¿‡å®ä¾‹çš„åŸå‹__proto__æ‰¾åˆ°</span></span><br><span class="line"><span class="keyword">var</span> f1 = <span class="keyword">new</span> <span class="title class_">Foo</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f1.<span class="property">name</span>); <span class="comment">// jackson</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f1.<span class="property">__proto__</span>); </span><br><span class="line"><span class="comment">// æ‰“å°</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   constructor: &#x27;hahahha&#x27;,</span></span><br><span class="line"><span class="comment">//   name: &#x27;jackson&#x27;,</span></span><br><span class="line"><span class="comment">//   age: 18,</span></span><br><span class="line"><span class="comment">//   eating: [Function (anonymous)]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f5bf25777e8f4d79acf69ac0f18ee3ef~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><ul><li>ç›´æ¥ä¿®æ”¹æ•´ä¸ªprototypeå¯¹è±¡ï¼ˆèµ‹å€¼ï¼Œæ–°å¼€å†…å­˜ç©ºé—´ï¼‰</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="attr">constructor</span>: <span class="title class_">Foo</span>, <span class="comment">// è®©å®ƒæŒ‡å›æœ¬èº«(ä½†è¿™æ ·å®ƒé»˜è®¤æ˜¯å¯æšä¸¾çš„)</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;jackson&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f1 = <span class="keyword">new</span> <span class="title class_">Foo</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f1.<span class="property">name</span>); <span class="comment">// &quot;jackson&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºäº†å¯ä»¥è‡ªå®šå±æ€§æè¿°ç¬¦,çœŸå®å¼€å‘ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡Object.definePropertyæ·»åŠ constructor</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&quot;constructor&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">value</span>: <span class="title class_">Foo</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5af35cbd1ec241cdba0a2f6059dfc55d~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><p>åŸæ¥çš„fooå‡½æ•°çš„åŸå‹å¯¹è±¡å› ä¸ºæ²¡æœ‰å¯¹å®ƒçš„å¼•ç”¨ï¼Œä¼šè¢«å›æ”¶çš„</p><h3 id="åˆ›å»ºå¯¹è±¡çš„æ–¹å¼-â€”-æ„é€ å‡½æ•°å’ŒåŸå‹ç»„åˆ">åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ â€” æ„é€ å‡½æ•°å’ŒåŸå‹ç»„åˆ</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age, address</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">address</span> = address</span><br><span class="line">  <span class="comment">// this.fn = function()</span></span><br><span class="line">  <span class="comment">// ä¸ºäº†ä¸ç»™æ¯ä¸ªå®ä¾‹éƒ½æ–°å¼€å†…å­˜ç©ºé—´ä¿å­˜ç›¸åŒçš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸æŠŠå…±åŒçš„æ–¹æ³•å®šä¹‰åœ¨è¿™</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›å…¬å…±çš„æ–¹æ³•ç›´æ¥é€šè¿‡åŸå‹å¯¹è±¡æ·»åŠ </span></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eating</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;is eating&#x27;</span>);</span><br><span class="line">  <span class="comment">// è¿™é‡Œçš„thisæ€ä¹ˆæ‰¾åˆ°å®ä¾‹å¯¹è±¡çš„ï¼Ÿ</span></span><br><span class="line">  <span class="comment">// è°ƒç”¨å‡½æ•°çš„æ—¶å€™éšå¼ç»‘å®šå•Š</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">running</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;is running&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;jackson&quot;</span>, <span class="number">18</span>, <span class="string">&quot;guangdong&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;yuzi&quot;</span>, <span class="number">18</span>, <span class="string">&quot;beijing&quot;</span>)</span><br><span class="line">p1.<span class="title function_">eating</span>()</span><br><span class="line">p2.<span class="title function_">eating</span>()</span><br></pre></td></tr></table></figure><p><strong>JavaScriptä¸­çš„ç±»å’Œå¯¹è±¡</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ JS ä¸­ï¼ŒPersonåº”è¯¥è¢«ç§°ä¹‹ä¸ºæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°</p><p>ä½†æ˜¯ä»å¾ˆå¤šé¢å‘å¯¹è±¡è¯­è¨€çš„å¼€å‘è€…ä¹ æƒ¯ç§°ä¹‹ä¸ºç±»ï¼Œå› ä¸ºç±»å¯ä»¥å¸®æˆ‘ä»¬åˆ›å»ºå‡ºæ¥å®ä¾‹å¯¹è±¡ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„</p><h2 id="é¢å‘å¯¹è±¡çš„ç‰¹æ€§-ç»§æ‰¿">é¢å‘å¯¹è±¡çš„ç‰¹æ€§ - ç»§æ‰¿</h2><p>é¢å‘å¯¹è±¡æœ‰ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€</p><ul><li>å°è£…ï¼šæˆ‘ä»¬å‰é¢å°†å±æ€§å’Œæ–¹æ³•å°è£…åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¯ä»¥ç§°ä¹‹ä¸ºå°è£…çš„è¿‡ç¨‹</li><li>ç»§æ‰¿ï¼šç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ä¸­éå¸¸é‡è¦çš„ï¼Œä¸ä»…ä»…å¯ä»¥å‡å°‘é‡å¤ä»£ç çš„æ•°é‡ï¼Œä¹Ÿæ˜¯å¤šæ€å‰æï¼ˆçº¯é¢å‘å¯¹è±¡ä¸­ï¼‰</li><li>å¤šæ€ï¼šä¸åŒçš„å¯¹è±¡åœ¨æ‰§è¡Œæ—¶è¡¨ç°å‡ºä¸åŒçš„å½¢æ€</li></ul><h3 id="JavaScriptåŸå‹é“¾">JavaScriptåŸå‹é“¾</h3><p><strong>åŸå‹é“¾çš„ç†è§£</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;jackson&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“æˆ‘ä»¬&quot;.&quot;çš„æ—¶å€™å°±æ˜¯[[get]]æ“ä½œ</span></span><br><span class="line"><span class="comment">// 1.åœ¨å½“å‰çš„å¯¹è±¡ä¸­æŸ¥æ‰¾å±æ€§</span></span><br><span class="line"><span class="comment">// 2.å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå»åŸå‹é“¾(__proto__)å¯¹è±¡ä¸ŠæŸ¥æ‰¾</span></span><br><span class="line">obj.<span class="property">__proto__</span> = &#123;</span><br><span class="line">  <span class="comment">// address: &quot;å¹¿å·å¸‚&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸå‹é“¾</span></span><br><span class="line">obj.<span class="property">__proto__</span>.<span class="property">__proto__</span>= &#123;</span><br><span class="line">  <span class="comment">// address: &quot;å¹¿å·å¸‚&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.<span class="property">__proto__</span>.<span class="property">__proto__</span>.<span class="property">__proto__</span>= &#123;</span><br><span class="line">  <span class="attr">address</span>: <span class="string">&quot;å¹¿å·å¸‚&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">address</span>); <span class="comment">// &quot;å¹¿å·å¸‚&quot;</span></span><br><span class="line"><span class="comment">// åªè¦åœ¨åŸå‹é“¾ä¸Šéƒ½å¯ä»¥æ‰¾åˆ°çš„</span></span><br></pre></td></tr></table></figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c063bcc6504441389d9b3c70db077d8~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" /><p>è¿™æ ·ä¸€ç›´å‘ä¸Šæ‰¾çš„è¯ï¼Œé‚£ä¹ˆ<strong>é¡¶å±‚åŸå‹</strong>ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>: <span class="string">&quot;Jackson&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¾åˆ°é‚£ä¸€å±‚å¯¹è±¡ä¹‹åä¼šåœæ­¢ç»§ç»­æŸ¥æ‰¾å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>); </span><br><span class="line"><span class="comment">// å¯ä»¥çœ‹åˆ°å­—é¢é‡objçš„åŸå‹æ˜¯ [Object: null prototype] &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ‘ä»¬ç»§ç»­å¾€ä¸Šçœ‹çœ‹</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>.<span class="property">__proto__</span>); <span class="comment">// null</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯´ [Object: null prototype] &#123;&#125; å°±æ˜¯é¡¶å±‚çš„åŸå‹</span></span><br></pre></td></tr></table></figure><p>é¡¶å±‚å¯¹è±¡æœ‰ä»€ä¹ˆç‰¹åˆ«å—ï¼Ÿè¯¥å¯¹è±¡ä¸Šæœ‰å¾ˆå¤šé»˜è®¤çš„å±æ€§å’Œæ–¹æ³•</p><p>é¡¶å±‚åŸå‹åˆæ¥è‡ªå“ªé‡Œå‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬åˆ›å»ºObjectå¯¹è±¡çœ‹çœ‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå¯¹è±¡(è¿™ç§æ–¹å¼ç›¸å½“äºä¸‹é¢ä¸€ç§æ–¹å¼çš„è¯­æ³•ç³–ï¼Œæœ¬è´¨éƒ½æ˜¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡)</span></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;&#125; </span><br><span class="line"><span class="keyword">var</span> obj2 = <span class="keyword">new</span> <span class="title class_">Object</span>() <span class="comment">// åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">// åˆ›å»ºå¯¹è±¡çš„è¯ï¼Œå…¶ä¸­æœ‰ä¸€æ­¥æ˜¯ï¼šå°†Objectå‡½æ•°çš„æ˜¾å¼åŸå‹prototypeèµ‹å€¼ç»™å®ä¾‹çš„éšå¼åŸå‹</span></span><br><span class="line"><span class="comment">// ç›¸å½“äºè¿™é‡Œ</span></span><br><span class="line"><span class="comment">// Object.prototype = obj2.__proto__</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å› æ­¤ï¼ˆæˆ‘ä»¬çŸ¥é“è¿™é‡Œobj1/2.__proto__å·²ç»æ˜¯åˆ°é¡¶å±‚äº†ï¼‰</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span> === obj1.<span class="property">__proto__</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span> === obj2.<span class="property">__proto__</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.prototypeä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥ä¹Ÿæœ‰ __proto__</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>); <span class="comment">// null</span></span><br><span class="line"><span class="comment">// å› æ­¤Object.prototypeæŒ‡å‘çš„å·²ç»æ˜¯é¡¶å±‚åŸå‹äº†</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>)) </span><br><span class="line"><span class="comment">// æœ‰constructor,toStringç­‰å±æ€§å’Œæ–¹æ³•</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œ<strong>åŸå‹é“¾æœ€é¡¶å±‚çš„åŸå‹å¯¹è±¡å°±æ˜¯Objectçš„åŸå‹å¯¹è±¡</strong></p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b10008bf8e7c4bdbab8263ac50ea0ead~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>Objectæ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœ‹çœ‹æ„é€ å‡½æ•°Personçš„åŸå‹</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>);<span class="comment">// &#123;&#125; çœ‹ä¸åˆ°ï¼åº”è¯¥æ˜¯ä¸å¯æšä¸¾å§</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>));</span><br><span class="line"><span class="comment">//è¾“å‡º &#123;constructor: &#123;...&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>);<span class="comment">//[Object: null prototype] &#123;&#125;</span></span><br></pre></td></tr></table></figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cab7b21f72df4098af70a97cb23b19a9~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><h3 id="é€šè¿‡åŸå‹é“¾å®ç°ç»§æ‰¿">é€šè¿‡åŸå‹é“¾å®ç°ç»§æ‰¿</h3><p><strong>ä¸ºä»€ä¹ˆéœ€è¦æœ‰ç»§æ‰¿ï¼Ÿ</strong></p><p>å¦‚æœæ²¡æœ‰ç»§æ‰¿ï¼Œæˆ‘ä»¬æƒ³åˆ›å»ºå¤šä¸ªç±»ï¼Œç±»é‡Œé¢çš„å±æ€§å’Œæ–¹æ³•å¾ˆå¤šæ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šå†™å¾ˆå¤šé‡å¤çš„ä»£ç ï¼Œæ‰€ä»¥ä¸»è¦æ˜¯ä¸ºäº†ä»£ç çš„å¤ç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Student</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name, age, sno</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sno</span> = sno</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">running</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="comment">// Teacher</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Teacher</span>(<span class="params">name, age, title</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">title</span> = title</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Teacher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">running</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸå‹é“¾çš„ç»§æ‰¿æ–¹æ¡ˆ</strong></p><blockquote><p>è‡ªå·±ç”»ç”»å›¾æ›´å¥½ç†è§£</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çˆ¶ç±»ï¼šå…¬å…±å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;Jackson&quot;</span>,</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">friends</span> = []</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eating</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;is eating&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç±»ï¼šç‰¹æœ‰å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sno</span> = <span class="number">111</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// newä¸€ä¸ªperson</span></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span> = p </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stu = <span class="keyword">new</span> <span class="title class_">Student</span>()</span><br><span class="line"><span class="comment">// console.log(stu.sno); // 111</span></span><br><span class="line"><span class="comment">// console.log(stu.name);// Jackson</span></span><br><span class="line"><span class="comment">// stu.eating()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸå‹é“¾å®ç°ç»§æ‰¿çš„å¼Šç«¯ï¼š</span></span><br><span class="line"><span class="comment">// 1.æ‰“å°stuå¯¹è±¡ï¼Œç»§æ‰¿çš„å±æ€§æ˜¯ä¸èƒ½ç›´è§‚çœ‹åˆ°çš„</span></span><br><span class="line"><span class="comment">// console.log(stu); // Person &#123; sno: 111 &#125;</span></span><br><span class="line"><span class="comment">// å‰é¢æ˜¾ç¤ºçš„ Person ç±»å‹,å®é™…ä¸Šæ˜¯å®ä¾‹çš„nameå±æ€§ï¼Œæ˜¾ç„¶è¿™é‡Œåº”è¯¥æ˜¯Student</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.åˆ›å»ºå‡ºæ¥ä¸¤ä¸ªstuå¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> stu1 = <span class="keyword">new</span> <span class="title class_">Student</span>()</span><br><span class="line"><span class="keyword">var</span> stu2 = <span class="keyword">new</span> <span class="title class_">Student</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å¼•ç”¨ï¼Œä¿®æ”¹å¼•ç”¨ä¸­çš„å€¼ï¼Œä¼šç›¸äº’å½±å“</span></span><br><span class="line"><span class="comment">// å› ä¸ºè¿™ä¸ªfre1è¢«åŠ åˆ°på¯¹è±¡ï¼Œè€Œstu1,stu2çš„__proto__éƒ½æŒ‡å‘p</span></span><br><span class="line">stu1.<span class="property">friends</span>.<span class="title function_">push</span>(<span class="string">&quot;fre1&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu1.<span class="property">friends</span>); <span class="comment">// [ &#x27;fre1&#x27; ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu2.<span class="property">friends</span>); <span class="comment">// [ &#x27;fre1&#x27; ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. åœ¨å‰é¢å®ç°ç±»çš„è¿‡ç¨‹ä¸­éƒ½æ²¡æœ‰ä¼ é€’å‚æ•°</span></span><br><span class="line"><span class="keyword">var</span> stu3 = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;jeccy&quot;</span>, <span class="number">112</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥åœ¨function Student(name,age)&#123;this.name = name this.age = age&#125;ï¼Ÿ</span></span><br><span class="line"><span class="comment">// è‚¯å®šä¸è¡Œå•Šï¼Œæˆ‘ä»¬æ˜¯æƒ³è¦æŠŠnameçš„å¤„ç†æ”¾åœ¨Personçš„</span></span><br></pre></td></tr></table></figure><h3 id="å€Ÿç”¨æ„é€ å‡½æ•°å®ç°ç»§æ‰¿">å€Ÿç”¨æ„é€ å‡½æ•°å®ç°ç»§æ‰¿</h3><blockquote><p>ä½¿ç”¨callè°ƒç”¨æ„é€ å‡½æ•°ï¼Œ</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çˆ¶ç±»ï¼šå…¬å…±å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age, friends</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name,</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">friends</span> = friends</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eating</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;is eating&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç±»ï¼šç‰¹æœ‰å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name, age, friends, sno</span>) &#123;</span><br><span class="line">  <span class="comment">// æˆ‘ä»¬åœ¨è¿™é‡Œè°ƒç”¨Person,å¹¶æŠŠéœ€è¦Personå¤„ç†çš„å‚æ•°ä¼ è¿‡å»</span></span><br><span class="line">  <span class="comment">// this å°±æ˜¯Studentçš„å®ä¾‹ </span></span><br><span class="line">  <span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age, friends) <span class="comment">// è¿™é‡Œå¯ä»¥è·å¾—çˆ¶ç±»çš„å±æ€§</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sno</span> = sno</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// newä¸€ä¸ªperson</span></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>() <span class="comment">// ä¾ç„¶éœ€è¦è¿™é‡Œæ¥è·å¾—æ–¹æ³•</span></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span> = p </span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³å¼Šç«¯3</span></span><br><span class="line"><span class="keyword">var</span> stu1 = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;aaa&quot;</span>, <span class="number">18</span>, [<span class="string">&#x27;fred1&#x27;</span>], <span class="number">111</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu1); </span><br><span class="line"><span class="comment">// Person &#123; name: &#x27;aaa&#x27;, age: 18, friends: [ &#x27;fred1&#x27; ], sno: 111 &#125; è§£å†³å¼Šç«¯1</span></span><br><span class="line"><span class="keyword">var</span> stu2 = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;vvv&quot;</span>, <span class="number">20</span>, [<span class="string">&#x27;fred2&#x27;</span>], <span class="number">112</span>)</span><br><span class="line">stu1.<span class="property">friends</span>.<span class="title function_">push</span>(<span class="string">&quot;hahaha&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu1.<span class="property">friends</span>); <span class="comment">// [ &#x27;fred2&#x27; ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu2.<span class="property">friends</span>); <span class="comment">// [ &#x27;fred1&#x27;, &#x27;hahaha&#x27; ]</span></span><br><span class="line"><span class="comment">// è§£å†³å¼Šç«¯2</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ç§æ–¹æ³•ä¾ç„¶å­˜åœ¨å¼Šç«¯ï¼š</p><ol><li>Person è‡³å°‘è¢«è°ƒç”¨ä¸¤æ¬¡ï¼ˆä¸€å¼€å§‹new Personä¸€æ¬¡ï¼Œåé¢Person.callåˆä¼šè°ƒç”¨Personï¼‰</li><li>stuçš„åŸå‹å¯¹è±¡ä¸Šä¼šå¤šå‡ºä¸€äº›å±æ€§, ä½†æ˜¯è¿™äº›å±æ€§æ˜¯æ²¡æœ‰å­˜åœ¨çš„å¿…è¦ï¼ˆnew Personçš„æ—¶å€™çš„ï¼‰</li></ol><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a1097b7c69f4850b9e4d5f245de611e~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><p>æ³¨æ„ï¼š</p><p>é‚£ä¹ˆæˆ‘ä»¬æ¢ä¸€ç§è·å¾—çˆ¶ç±»æ–¹æ³•çš„æ–¹æ³•ï¼Œç›´æ¥<strong>å°†çˆ¶ç±»åŸå‹èµ‹å€¼ç»™å­ç±»</strong>ï¼Ÿ</p><p>è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºä»¥åç»™æŸä¸ªå­ç±»æ·»åŠ æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šä½¿æ‰€æœ‰çš„å­ç±»éƒ½æœ‰è¯¥æ–¹æ³•ï¼Œæ˜¾ç„¶æ˜¯ä¸è¡Œçš„</p><p>å› ä¸ºæ‰€æœ‰å­ç±»çš„prototypeéƒ½æŒ‡å‘åŒä¸€ä¸ªçˆ¶ç±»çš„åŸå‹</p><h3 id="åŸå‹å¼ç»§æ‰¿å‡½æ•°-å¯¹è±¡">åŸå‹å¼ç»§æ‰¿å‡½æ•° - å¯¹è±¡</h3><blockquote><p>æˆ‘ä»¬å…ˆå®ç°å¯¹è±¡çš„ç»§æ‰¿ï¼Œåé¢å†æ‰©å±•åˆ°ç±»</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Jackson&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸå‹å¼ç»§æ‰¿å‡½æ•°</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªå‡½æ•°è¦åšåˆ°çš„æ˜¯ï¼Œä½ ç»™æˆ‘ä¼ å…¥çš„å¯¹è±¡ï¼Œä½œä¸ºæ–°å¯¹è±¡çš„åŸå‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createObject</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> newObj = &#123;&#125;</span><br><span class="line">  <span class="comment">// è¿™ä¸ªæ–¹æ³•æ˜¯æŠŠoè®¾ç½®ä¸ºnewObjçš„åŸå‹</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(newObj, o)</span><br><span class="line">  <span class="keyword">return</span> newObj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Douglas çš„å®ç°(å½“æ—¶è¿˜æ²¡æœ‰setPrototypeOfè¿™ä¸ªæ–¹æ³•)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createObject2</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Fn</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title class_">Fn</span>.<span class="property"><span class="keyword">prototype</span></span> = o</span><br><span class="line">  <span class="keyword">var</span> newObj = <span class="keyword">new</span> <span class="title class_">Fn</span>()</span><br><span class="line">  <span class="comment">// å› æ­¤ newObj.__proto__ = Fn.prototype = o</span></span><br><span class="line">  <span class="keyword">return</span> newObj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³è¦æ–°å»ºçš„å¯¹è±¡infoçš„åŸå‹æŒ‡å‘objï¼ˆåé¢æ‰©å±•åˆ°ç±»ï¼‰</span></span><br><span class="line"><span class="comment">// var info = createObject(obj)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½†æ˜¯ æ–°çš„ECMA ç»™æˆ‘ä»¬æä¾›äº†æ–°çš„æ–¹æ³•ï¼šObject.create(obj)</span></span><br><span class="line"><span class="comment">// Object.create()æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨ç°æœ‰çš„å¯¹è±¡æ¥æä¾›æ–°åˆ›å»ºçš„å¯¹è±¡çš„__proto__</span></span><br><span class="line"><span class="comment">// å®é™…ä¸Šè¿™ä¸ªæ–¹æ³•è·Ÿæˆ‘ä»¬ä¸Šé¢çš„ä¸¤ç§å®ç°æ–¹æ³•å®ç°çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="keyword">var</span> info = <span class="title class_">Object</span>.<span class="title function_">create</span>(obj)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info);</span><br><span class="line"><span class="comment">// å·²ç»å®ç°äº†æˆ‘ä»¬çš„ç›®çš„</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="property">__proto__</span>); <span class="comment">// &#123; name: &#x27;Jackson&#x27;, age: 18 &#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>Object.create() ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create</a></p></blockquote><h3 id="å¯„ç”Ÿå¼ç»§æ‰¿å‡½æ•°ï¼ˆäº†è§£ï¼‰">å¯„ç”Ÿå¼ç»§æ‰¿å‡½æ•°ï¼ˆäº†è§£ï¼‰</h3><ul><li><p>å¯„ç”Ÿå¼ç»§æ‰¿çš„æ€è·¯æ˜¯ç»“åˆåŸå‹ç±»ç»§æ‰¿å’Œå·¥å‚æ¨¡å¼çš„ä¸€ç§æ–¹å¼</p></li><li><p>å³åˆ›å»ºä¸€ä¸ªå°è£…ç»§æ‰¿è¿‡ç¨‹çš„å‡½æ•°, è¯¥å‡½æ•°åœ¨å†…éƒ¨ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºå¯¹è±¡ï¼Œæœ€åå†å°†è¿™ä¸ªå¯¹è±¡è¿”å›</p></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> personObj = &#123;</span><br><span class="line">  <span class="attr">running</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;running&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›®çš„ï¼šç»§æ‰¿ personObjé‡Œé¢çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createStudent</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> stu = <span class="title class_">Object</span>.<span class="title function_">create</span>(personObj)</span><br><span class="line">  stu.<span class="property">name</span> = name</span><br><span class="line">  stu.<span class="property">studying</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;studying&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> stu</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stuObj = <span class="title function_">createStudent</span>(<span class="string">&quot;why&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿-æœ€ç»ˆæ–¹æ¡ˆ">å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿(æœ€ç»ˆæ–¹æ¡ˆ)</h3><p>åˆ©ç”¨å¯„ç”Ÿå¼ç»§æ‰¿å°†ç»„åˆå¼ç»§æ‰¿çš„ä¸¤ä¸ªé—®é¢˜è§£å†³</p><ul><li>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç¡®ï¼Œå½“æˆ‘ä»¬åœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨çˆ¶ç±».call(thisï¼Œå‚æ•°)çš„æ—¶å€™ï¼Œå°±ä¼šå°†çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•å¤åˆ¶ä¸€ä»½åˆ°å­ç±»ä¸­ï¼Œæ‰€ä»¥çˆ¶ç±»æœ¬èº«é‡Œé¢çš„å†…å®¹æˆ‘ä»¬æ˜¯ä¸éœ€è¦çš„</li><li>ç„¶åï¼Œæˆ‘ä»¬è¿˜éœ€è¦è·å–åˆ°ä¸€ä»½çˆ¶ç±»çš„åŸå‹å¯¹è±¡ä¸­çš„å±æ€§å’Œæ–¹æ³•</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœä¸æƒ³ä½¿ç”¨Object.createè¿™ä¸ªæ–¹æ³•çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å‰é¢è¯´è¿‡çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createObject</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Fn</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title class_">Fn</span>.<span class="property"><span class="keyword">prototype</span></span> = o</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Fn</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">inheritPrototype</span>(<span class="params">SubType, SuperType</span>) &#123;</span><br><span class="line">  <span class="comment">// SubType.prototype = Object.create(SuperType.prototype)</span></span><br><span class="line">  <span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title function_">createObject</span>(<span class="title class_">SuperType</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line">  <span class="comment">// å½“ç„¶å­ç±»çš„prototypeè¿˜éœ€è¦æœ‰constructoræŒ‡å‘å­æ„é€ å‡½æ•°æœ¬èº«</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&quot;constructor&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="title class_">SubType</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age, friends</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">friends</span> = friends</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">running</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;running~&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­ç±»</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name, age, friends, sno</span>) &#123;</span><br><span class="line">  <span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age, friends) <span class="comment">// è·å–ä¸€ä»½Personä¸­çš„å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sno</span> = sno</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Studentç±»è¿˜éœ€è¦è·å–ä¸€ä»½çˆ¶ç±»çš„prototypeçš„å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="title function_">inheritPrototype</span>(<span class="title class_">Student</span>, <span class="title class_">Person</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stu = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;why&quot;</span>, <span class="number">18</span>, [<span class="string">&quot;kobe&quot;</span>], <span class="number">111</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu);</span><br><span class="line"> <span class="comment">// æ‰“å°  Student &#123; name: &#x27;why&#x27;,age: 18,friends: [ &#x27;kobe&#x27; ],sno: 111,&#125;</span></span><br></pre></td></tr></table></figure><h3 id="JSåŸå‹çš„è¡¥å……">JSåŸå‹çš„è¡¥å……</h3><h4 id="hasOwnProperty">hasOwnProperty</h4><ul><li>åˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰æŸä¸ªå±äºè‡ªå·±çš„å±æ€§ï¼Œä¸åŒ…æ‹¬åœ¨åŸå‹ä¸Šçš„</li></ul><h4 id="in-for-in-æ“ä½œç¬¦">in/ for in æ“ä½œç¬¦</h4><ul><li>åˆ¤æ–­æŸä¸ªå±æ€§æ˜¯å¦åœ¨æŸä¸ªå¯¹è±¡æˆ–è€…å¯¹è±¡çš„åŸå‹ä¸Š</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;jackson&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒä¸ªå‚æ•°æ˜¯infoæ·»åŠ å±äºè‡ªå·±çš„å±æ€§</span></span><br><span class="line"><span class="keyword">var</span> info = <span class="title class_">Object</span>.<span class="title function_">create</span>(obj, &#123;</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&quot;åŒ—äº¬&quot;</span>,</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// hasOwnProperty</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;address&quot;</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;name&quot;</span>)); <span class="comment">//  false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// in æ“ä½œç¬¦: ä¸ç®¡åœ¨å½“å‰å¯¹è±¡è¿˜æ˜¯åŸå‹ä¸­è¿”å›çš„éƒ½æ˜¯true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;address&quot;</span> <span class="keyword">in</span> info); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;name&quot;</span> <span class="keyword">in</span> info); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// for in (åŒ…æ‹¬åŸå‹ä¸Šçš„å±æ€§éƒ½å¯ä»¥éå†åˆ°)</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> info) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// address name age</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="instanceof">instanceof</h4><p>ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ <code>prototype</code> å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨å‰é¢çš„å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</span></span><br><span class="line"><span class="title function_">inheritPrototype</span>(<span class="title class_">Student</span>, <span class="title class_">Person</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>); <span class="comment">// [Object: null prototype] &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stu = <span class="keyword">new</span> <span class="title class_">Student</span>()</span><br><span class="line"><span class="comment">// stuæ˜¯å¦å‡ºç°åœ¨æ„é€ å‡½æ•° Student çš„åŸå‹é“¾ä¸Š</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu <span class="keyword">instanceof</span> <span class="title class_">Student</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu <span class="keyword">instanceof</span> <span class="title class_">Person</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu <span class="keyword">instanceof</span> <span class="title class_">Object</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="isPrototypeOf-äº†è§£">isPrototypeOf(äº†è§£)</h4><p>ç”¨äºæ£€æµ‹æŸä¸ªå¯¹è±¡ï¼Œæ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> info = <span class="title class_">Object</span>.<span class="title function_">create</span>(obj)</span><br><span class="line"><span class="comment">// objæ˜¯å¦å‡ºç°åœ¨infoçš„åŸå‹é“¾ä¸Š</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="title function_">isPrototypeOf</span>(info))</span><br></pre></td></tr></table></figure><h2 id="å¯¹è±¡-å‡½æ•°-åŸå‹ä¹‹é—´çš„å…³ç³»">å¯¹è±¡-å‡½æ•°-åŸå‹ä¹‹é—´çš„å…³ç³»</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;jackson&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åªè¦æ˜¯å¯¹è±¡ï¼Œé‡Œé¢å°±ä¼šæœ‰ä¸€ä¸ª__proto__å¯¹è±¡ï¼ˆéšå¼åŸå‹å¯¹è±¡ï¼‰</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>);<span class="comment">// [Object: null prototype] &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="comment">// æ‰€æœ‰çš„ function xx() &#123;&#125;</span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬éƒ½å¯ä»¥è®¤ä¸º xx æ˜¯ new Function åˆ›å»ºå‡ºæ¥çš„</span></span><br><span class="line"><span class="comment">// ç›¸å½“äº var xxx = new Function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åªè¦æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæœ‰ä¸€ä¸ªæ˜¾å¼åŸå‹å¯¹è±¡ï¼šFoo.prototype</span></span><br><span class="line"><span class="comment">// é‚£ Foo.prototype è¿™ä¸ªå¯¹è±¡åˆæ¥è‡ªå“ªé‡Œå‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment">// åˆ›å»ºå‡½æ•°çš„æ—¶å€™ï¼ŒJSå†…éƒ¨å°±ä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡,å¹¶æ·»åŠ åˆ°å‡½æ•°çš„prototypeå±æ€§ä¸­ï¼šFoo.prototype = &#123;constructor: Foo&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Fooä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåªè¦æ˜¯å¯¹è±¡ï¼Œå°±ä¼šæœ‰éšå¼åŸå‹å¯¹è±¡ Foo.__proto__</span></span><br><span class="line"><span class="comment">// Foo.__proto__æ¥è‡ªå“ªé‡Œï¼Ÿ</span></span><br><span class="line"><span class="comment">// var Foo = new Function() </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Foo</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// è€Œ Function.prototypeå¯¹è±¡æ˜¯æˆ‘ä»¬åˆ›å»ºFunctionå‡½æ•°çš„æ—¶å€™åˆ›å»ºå‡ºæ¥çš„</span></span><br><span class="line"><span class="comment">// Function.prototype = &#123;constructor: Function&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºFunctionå‡½æ•°</span></span><br><span class="line"><span class="comment">// function Function() &#123;&#125;</span></span><br><span class="line"><span class="comment">// Function.prototype</span></span><br><span class="line"><span class="comment">// Function åˆæ˜¯ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">// Function.__proto__</span></span><br><span class="line"><span class="comment">// å”¯ä¸€ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ä¸œè¥¿</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Function</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦å¤–è¿˜æœ‰ function Object() &#123;&#125;</span></span><br><span class="line"><span class="comment">// Objectä½œä¸ºå‡½æ•°, å°±ä¼šæœ‰Object.prototype</span></span><br><span class="line"><span class="comment">// Objectä½œä¸ºå¯¹è±¡, å°±ä¼šæœ‰Object.__proto__</span></span><br><span class="line"><span class="comment">// Objectå‡½æ•°æ˜¯Functionåˆ›å»ºå‡ºæ¥çš„ï¼Œæ‰€ä»¥</span></span><br><span class="line"><span class="comment">// Objcet.__proto__ === Function.prototype</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€åå°±æ˜¯æ¯ä¸ªå‡½æ•°çš„åŸå‹prototypeéƒ½ä¼šæœ‰ä¸€ä¸ªconstructoræŒ‡å›å‡½æ•°æœ¬èº«</span></span><br></pre></td></tr></table></figure><p>æœ€å ä¸Šå›¾ï¼</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98247be221ed4805a65a68e7f0d8fffd~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4465e678da8240028f973262ac63399d~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:80%;" />]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>07_ä¸¥æ ¼æ¨¡å¼</title>
      <link href="/2022/04/02/07_%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F/"/>
      <url>/2022/04/02/07_%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸¥æ ¼æ¨¡å¼">ä¸¥æ ¼æ¨¡å¼</h3><h4 id="å¦‚ä½•å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼Ÿ">å¦‚ä½•å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼Ÿ</h4><p>åœ¨æ–‡ä»¶æˆ–è€…å‡½æ•°å¼€å¤´ä½¿ç”¨ â€œuse strictâ€</p><h4 id="ä¸¥æ ¼æ¨¡å¼å¸¸è§çš„é™åˆ¶">ä¸¥æ ¼æ¨¡å¼å¸¸è§çš„é™åˆ¶</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span></span><br><span class="line"><span class="comment">// 1.ç¦æ­¢æ„å¤–åˆ›å»ºå…¨å±€å˜é‡</span></span><br><span class="line"><span class="comment">// åœ¨å…¨å±€ä¸­ä¸ä½¿ç”¨å…³é”®å­—ç›´æ¥å®šä¹‰å˜é‡</span></span><br><span class="line">message = <span class="string">&quot;hello&quot;</span></span><br><span class="line">message is not defined</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä¸å…è®¸å‡½æ•°æœ‰ç›¸åŒçš„å‚æ•°åç§°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x, y, x</span>) &#123;&#125;</span><br><span class="line"><span class="comment">// Duplicate parameter name not allowed in this context</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.ä½¿é™é»˜é”™è¯¯(ä¸æŠ¥é”™ä½†ä¹Ÿæ²¡æœ‰ä»»ä½•æ•ˆæœ)çš„èµ‹å€¼æ“ä½œæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="literal">true</span>.<span class="property">name</span> = <span class="string">&quot;abc&quot;</span></span><br><span class="line"><span class="title class_">NaN</span> = <span class="number">123</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&quot;name&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">false</span>, <span class="comment">// ä¸å¯å†™</span></span><br><span class="line">  <span class="attr">value</span>: <span class="string">&quot;hillyee&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&quot;jenny&quot;</span></span><br><span class="line"><span class="comment">// è¯•å›¾åˆ é™¤ä¸å¯åˆ é™¤çš„å±æ€§ï¼ŒæŠ¥é”™</span></span><br><span class="line"><span class="keyword">delete</span> obj.<span class="property">name</span></span><br><span class="line"><span class="comment">// Cannot delete property &#x27;name&#x27; of #&lt;Object&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.ä¸å…è®¸ä½¿ç”¨åŸå…ˆçš„å…«è¿›åˆ¶æ ¼å¼</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">0o123</span> <span class="comment">// å…«è¿›åˆ¶</span></span><br><span class="line"><span class="keyword">var</span> num2 = <span class="number">0x123</span> <span class="comment">// åå…­è¿›åˆ¶</span></span><br><span class="line"><span class="keyword">var</span> num3 = <span class="number">0b100</span> <span class="comment">// äºŒè¿›åˆ¶</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ä¸¥æ ¼æ¨¡å¼ä¸‹çš„this">ä¸¥æ ¼æ¨¡å¼ä¸‹çš„this</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œç‹¬ç«‹å‡½æ•°è°ƒç”¨thisé»˜è®¤ç»‘å®šä¸æ˜¯windowï¼Œè€Œæ˜¯undefined</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// undefined</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;hill&quot;</span>,</span><br><span class="line">  <span class="attr">foo</span>: foo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = obj.<span class="property">foo</span></span><br><span class="line"><span class="title function_">bar</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// setTimeoutçš„this</span></span><br><span class="line"><span class="comment">// å†…éƒ¨ fn.apply(this=window)</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// window</span></span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>06_çº¯å‡½æ•°-æŸ¯é‡ŒåŒ–-ç»„åˆ</title>
      <link href="/2022/04/02/06_%E7%BA%AF%E5%87%BD%E6%95%B0-%E6%9F%AF%E9%87%8C%E5%8C%96-%E7%BB%84%E5%90%88/"/>
      <url>/2022/04/02/06_%E7%BA%AF%E5%87%BD%E6%95%B0-%E6%9F%AF%E9%87%8C%E5%8C%96-%E7%BB%84%E5%90%88/</url>
      
        <content type="html"><![CDATA[<h3 id="çº¯å‡½æ•°-æŸ¯é‡ŒåŒ–-ç»„åˆ">çº¯å‡½æ•° - æŸ¯é‡ŒåŒ– - ç»„åˆ</h3><h4 id="çº¯å‡½æ•°">çº¯å‡½æ•°</h4><ul><li><p>ä»€ä¹ˆæ˜¯çº¯å‡½æ•°ï¼Ÿ</p><ul><li><p>ç¡®å®šçš„è¾“å…¥ï¼Œä¸€å®šä¼šäº§ç”Ÿç¡®å®šçš„è¾“å‡º</p></li><li><p>å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸èƒ½äº§ç”Ÿå‰¯ä½œç”¨</p></li></ul></li><li><p>ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ï¼Ÿ</p><ul><li>åœ¨æ‰§è¡Œä¸€ä¸ªå‡½æ•°æ—¶ï¼Œé™¤äº†è¿”å›å€¼å‡½æ•°ä¹‹å¤–ï¼Œè¿˜å¯¹è°ƒç”¨å‡½æ•°äº§ç”Ÿäº†é™„åŠ çš„å½±å“ï¼Œæ¯”å¦‚è¯´ä¿®æ”¹äº†å…¨å±€å˜é‡ï¼Œä¿®æ”¹å‚æ•°æˆ–è€…æ”¹å˜å¤–éƒ¨çš„å­˜å‚¨</li></ul></li><li><p>çº¯å‡½æ•°ä¾‹å­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> names = [<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;cba&quot;</span>, <span class="string">&quot;nba&quot;</span>, <span class="string">&quot;dna&quot;</span>]</span><br><span class="line"><span class="comment">// sliceåªè¦ç»™å®ƒä¼ å…¥ä¸€ä¸ªstart/end, é‚£ä¹ˆå¯¹äºåŒä¸€ä¸ªæ•°ç»„æ¥è¯´, å®ƒä¼šç»™æˆ‘ä»¬è¿”å›ç¡®å®šçš„å€¼</span></span><br><span class="line"><span class="comment">// sliceå‡½æ•°æœ¬èº«å®ƒæ˜¯ä¸ä¼šä¿®æ”¹åŸæ¥çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥sliceå‡½æ•°æœ¬èº«å°±æ˜¯ä¸€ä¸ªçº¯å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> newNames1 = names.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newNames1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// spliceä¸æ˜¯ä¸€ä¸ªçº¯å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> newNames2 = names.<span class="title function_">splice</span>(<span class="number">2</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newNames2)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(names) <span class="comment">// [ &#x27;abc&#x27;, &#x27;cba&#x27; ] æ”¹å˜äº†åŸæ•°ç»„</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="JavaScriptæŸ¯é‡ŒåŒ–">JavaScriptæŸ¯é‡ŒåŒ–</h4><ul><li><p>ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–ï¼Ÿ</p><ul><li>æŠŠæ¥æ”¶å¤šä¸ªå‚æ•°çš„å‡½æ•°å˜æˆæ¥æ”¶ä¸€ä¸ªå•ä¸€å‚æ•°çš„å‡½æ•°</li><li>â€œå¦‚æœä½ å›ºå®šæŸäº›å‚æ•°ï¼Œä½ å°†å¾—åˆ°æ¥å—ä½™ä¸‹å‚æ•°çš„ä¸€ä¸ªå‡½æ•°â€</li><li>åªä¼ é€’ç»™å‡½æ•°ä¸€éƒ¨åˆ†å‚æ•°æ¥è°ƒç”¨å®ƒï¼Œè®©å®ƒè¿”å›ä¸€ä¸ªå‡½æ•°å»å¤„ç†å‰©ä½™çš„å‚æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸ºæŸ¯é‡ŒåŒ–</li></ul></li><li><p>æŸ¯é‡ŒåŒ–çš„ç»“æ„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x, y, z</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y + z</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result = <span class="title function_">add</span>(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result); <span class="comment">// 60</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum1</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">z</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> x + y + z</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result2 = <span class="title function_">sum1</span>(<span class="number">10</span>)(<span class="number">20</span>)(<span class="number">30</span>) <span class="comment">// 60</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€åŒ–</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">sum2</span> = x =&gt; <span class="function"><span class="params">y</span> =&gt;</span> <span class="function"><span class="params">z</span> =&gt;</span> x + y + z</span><br></pre></td></tr></table></figure></li><li><p>æŸ¯é‡ŒåŒ–è®©å‡½æ•°çš„èŒè´£å•ä¸€</p><p>æ¯æ¬¡æ¥æ”¶çš„ä¸€ä¸ªå‚æ•°ï¼Œéƒ½åšå®ƒè‡ªå·±çš„é€»è¾‘</p></li><li><p>å¯ä»¥æ›´å¥½çš„å¤ç”¨å‚æ•°é€»è¾‘</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">makeAdder</span>(<span class="params">count</span>) &#123;</span><br><span class="line">  count = count * count</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">num</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> count + num</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯”å¦‚è¯´æˆ‘ä»¬æƒ³è¦æ¯æ¬¡çš„countéƒ½æ˜¯5</span></span><br><span class="line"><span class="keyword">var</span> adder5 = <span class="title function_">makeAdder</span>(<span class="number">5</span>)</span><br><span class="line"><span class="title function_">adder5</span>(<span class="number">10</span>)</span><br><span class="line"><span class="title function_">adder5</span>(<span class="number">13</span>) </span><br></pre></td></tr></table></figure></li><li><p>æŸ¯é‡ŒåŒ–å‡½æ•°çš„å®ç°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myCurrying</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">curried</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="comment">// å½“å·²ç»ä¼ å…¥çš„å‚æ•° å¤§äºç­‰äº éœ€è¦çš„å‚æ•°æ—¶, å°±æ‰§è¡Œå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (args.<span class="property">length</span> &gt;= fn.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="comment">// fn()</span></span><br><span class="line">      <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ²¡æœ‰è¾¾åˆ°ä¸ªæ•°æ—¶, éœ€è¦è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°,ç»§ç»­æ¥æ¥æ”¶å‚æ•°</span></span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">curried2</span>(<span class="params">...args2</span>) &#123;</span><br><span class="line">        <span class="comment">// æ¥æ”¶åˆ°å‚æ•°å, éœ€è¦é€’å½’è°ƒç”¨curriedæ¥æ£€æŸ¥å‡½æ•°çš„ä¸ªæ•°æ˜¯å¦è¾¾åˆ°</span></span><br><span class="line">        <span class="keyword">return</span> curried.<span class="title function_">apply</span>(<span class="variable language_">this</span>, [...args, ...args2])</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> curried2</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›ä¸€ä¸ªæŸ¯é‡ŒåŒ–çš„å‡½æ•°</span></span><br><span class="line">  <span class="keyword">return</span> curried</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add1</span>(<span class="params">x, y, z</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y + z</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> curryAdd = <span class="title function_">myCurrying</span>(add1)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curryAdd</span>(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curryAdd</span>(<span class="number">10</span>)(<span class="number">20</span>, <span class="number">30</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">curryAdd</span>(<span class="number">10</span>)(<span class="number">20</span>)(<span class="number">30</span>));</span><br></pre></td></tr></table></figure></li></ul><h4 id="ç»„åˆå‡½æ•°">ç»„åˆå‡½æ•°</h4><ul><li><p>ä»€ä¹ˆæ˜¯ç»„åˆå‡½æ•°ï¼Ÿ</p><ul><li>ç»„åˆå‡½æ•°æ˜¯åœ¨ JavaScript å¼€å‘è¿‡ç¨‹ä¸­ä¸€ç§å¯¹å‡½æ•°çš„ä½¿ç”¨æŠ€å·§ã€æ¨¡å¼</li></ul></li><li><p>ç»„åˆå‡½æ•°çš„ä¾‹å­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">double</span>(<span class="params">num</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> num * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">square</span>(<span class="params">num</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> num ** <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> count = <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> result = <span class="title function_">square</span>((<span class="title function_">double</span>(count)))</span><br></pre></td></tr></table></figure></li><li><p>å®ç°ç»„åˆå‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hyCompose</span>(<span class="params">...fns</span>) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°,ç›´æ¥æŠ¥é”™</span></span><br><span class="line">  <span class="keyword">let</span> length = fns.<span class="property">length</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> fns[i] !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Expected a function&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å–å‡ºæ‰€æœ‰çš„å‡½æ•°ä¸€æ¬¡è°ƒç”¨</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> result = length ? fns[index].<span class="title function_">apply</span>(<span class="variable language_">this</span>, args) : args</span><br><span class="line">    <span class="keyword">while</span>(++index &lt; length) &#123;</span><br><span class="line">      result = fns[index].<span class="title function_">call</span>(<span class="variable language_">this</span>, result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">double</span>(<span class="params">m</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> m * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">square</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> n ** <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newFn = <span class="title function_">hyCompose</span>(double, square)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">newFn</span>(<span class="number">10</span>))</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>05_è®¤è¯†arguments</title>
      <link href="/2022/04/02/05_%E8%AE%A4%E8%AF%86arguments/"/>
      <url>/2022/04/02/05_%E8%AE%A4%E8%AF%86arguments/</url>
      
        <content type="html"><![CDATA[<h3 id="è®¤è¯†-arguments">è®¤è¯† arguments</h3><h4 id="ä»€ä¹ˆæ˜¯-arguments">ä»€ä¹ˆæ˜¯ arguments</h4><p><strong><code>arguments</code></strong> æ˜¯ä¸€ä¸ªå¯¹åº”äºä¼ é€’ç»™å‡½æ•°çš„å‚æ•°çš„ç±»æ•°ç»„å¯¹è±¡ã€‚(MDN)</p><ul><li><p>ç±»æ•°ç»„å¯¹è±¡ï¼Œå°±è¯´æ˜å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹</p></li><li><p>ç±»æ•°ç»„è¡¨ç¤ºå®ƒé•¿å¾—åƒæ•°ç»„ï¼Œå¹¶ä¸”æ‹¥æœ‰æ•°ç»„çš„ä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚è¯´ lengthï¼Œå¯ä»¥é€šè¿‡ index è®¿é—®</p><p>ä½†æ˜¯å´æ²¡æœ‰æ•°ç»„çš„ä¸€äº›æ–¹æ³•ï¼Œæ¯”å¦‚è¯´ forEachï¼Œmap ç­‰</p></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ä¼šå¸®ä½ æ¥æ”¶æ‰€æœ‰ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>); <span class="comment">// [Arguments] &#123; &#x27;0&#x27;: 10, &#x27;1&#x27;: 20, &#x27;2&#x27;: 30 &#125;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–å‚æ•°çš„é•¿åº¦</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>.<span class="property">length</span>); <span class="comment">// 3</span></span><br><span class="line">  <span class="comment">// æ ¹æ®ç´¢å¼•å€¼è·å–æŸä¸€ä¸ªå‚æ•°</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>[<span class="number">1</span>]); <span class="comment">// 20</span></span><br><span class="line">  <span class="comment">// è·å–å½“å‰ arguments æ‰€åœ¨çš„å‡½æ•°</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>.<span class="property">callee</span>); <span class="comment">// [Function: foo]</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// arguments.forEach() æ˜¯ä¸å¯ä»¥çš„</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>)</span><br></pre></td></tr></table></figure><h4 id="arguments-è½¬æˆæ•°ç»„">arguments è½¬æˆæ•°ç»„</h4><p>å¦‚æœæˆ‘ä»¬éœ€è¦éå†é‡Œé¢çš„å‚æ•°å‘¢ï¼Ÿæˆ–è€…è¯´ä½¿ç”¨ä¸€äº›æ•°ç»„çš„æ–¹æ³•å‘¢ï¼Ÿ</p><p>æ‰€ä»¥åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæŠŠ arguments è½¬æˆæ•°ç»„</p><h5 id="ç¬¬ä¸€ç§æ–¹æ³•-è‡ªå·±éå†">ç¬¬ä¸€ç§æ–¹æ³•: è‡ªå·±éå†</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// æˆ‘ä»¬å¯ä»¥é€šè¿‡ç´¢å¼•å€¼æ‹¿åˆ° arguments çš„æ¯ä¸€ä¸ªå€¼</span></span><br><span class="line">  <span class="comment">// ç„¶åæ·»åŠ åˆ°æ–°çš„æ•°ç»„</span></span><br><span class="line">  <span class="keyword">let</span> newArr = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    newArr.<span class="title function_">push</span>(<span class="variable language_">arguments</span>[i])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(newArr); <span class="comment">// [ 10, 20, 30, 40, 50 ]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>) </span><br></pre></td></tr></table></figure><h5 id="ç¬¬äºŒç§æ–¹æ³•ï¼šArray-prototype-slice">ç¬¬äºŒç§æ–¹æ³•ï¼šArray.prototype.slice</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> newArr = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(newArr); <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br></pre></td></tr></table></figure><p>Array.prototype.slice.call(arguments) ï¼Ÿä»€ä¹ˆæ„æ€å‘€ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ slice çš„æ—¶å€™ï¼Œæ˜¯ <code>arr.slice(start, end)</code>ï¼Œé‚£å¦‚æœæ²¡æœ‰è¿™ä¸ªarrå‘¢ï¼Ÿæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½æ‹¿åˆ° slice è¿™ä¸ªæ–¹æ³•</p><p>æ˜¯ä¸æ˜¯å¯ä»¥åœ¨ Array çš„åŸå‹ä¸Šé¢æ‰¾è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ Array.prototype.slice()</p><p>é‚£ä¸ºä»€ä¹ˆè¦ç”¨ call æ¥è°ƒç”¨ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥æ¨¡æ‹Ÿä¸€ä¸‹ Array ä¸­çš„ slice æ˜¯æ€ä¹ˆå®ç°çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myslice</span> = <span class="keyword">function</span>(<span class="params">start, end</span>) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæˆ‘ä»¬ç›´æ¥ Array.prototype.myslice() è¿™æ ·è°ƒç”¨çš„è¯, this æŒ‡å‘çš„å°±æ˜¯prototypeäº†</span></span><br><span class="line">  <span class="comment">// è€Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯, è¿™é‡Œçš„ this æ˜¯æŒ‡å‘è°ƒç”¨ slice è¿™ä¸ªæ–¹æ³•çš„æ•°ç»„</span></span><br><span class="line">  <span class="keyword">let</span> arr = <span class="variable language_">this</span></span><br><span class="line">  start = start || <span class="number">0</span></span><br><span class="line">  end = end || arr.<span class="property">length</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> newArray = []</span><br><span class="line">  <span class="comment">// ä»startåˆ°end(ä¸åŒ…æ‹¬end),æŠŠå…ƒç´ æ·»åŠ åˆ°æ•°ç»„</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = start; i &lt; end; i++) &#123;</span><br><span class="line">    newArray.<span class="title function_">push</span>(arr[i])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newArray</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ call æ¥æ˜¾å¼ç»‘å®šè¿™ä¸ª thisï¼Œè®©thisæŒ‡å‘æ•°ç»„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> newArr = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myslice</span>.<span class="title function_">call</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newArr); <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ç„¶å¯ä»¥ä¼ é€’å‚æ•°</span></span><br><span class="line"><span class="keyword">let</span> newArr2 = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myslice</span>.<span class="title function_">call</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>], <span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newArr2); <span class="comment">// [3, 4]</span></span><br></pre></td></tr></table></figure><p>é‚£è·Ÿæˆ‘ä»¬ arguments æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p><p>Arrayå†…éƒ¨ slice çš„å®ç°åªä¸è¿‡æ˜¯å¯¹ thisï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä½¿ç”¨ slice çš„æ•°ç»„è¿›è¡Œéå†ï¼Œç„¶åæŠŠéœ€è¦çš„éƒ¨åˆ†åŠ å…¥åˆ°æ–°æ•°ç»„</p><p>é‚£éå† arguments ä¹Ÿå¯ä»¥å•Šï¼ŒæŠŠå…ƒç´ ä¸€ä¸ªä¸ªåŠ å…¥åˆ°ä¸€ä¸ªæ•°ç»„é‡Œé¢ï¼Œå†æŠŠè¿™ä¸ªæ•°ç»„è¿”å›ï¼Œæœ€åä¸å°±å®ç°äº† arguments è½¬æ•°ç»„äº†å—</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> newArr = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(newArr); <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// åŒæ ·é“ç†çš„è¿˜æœ‰ä¸€ç§æ–¹æ³•, æˆ‘ä»¬ç›®çš„å°±æ˜¯æ‹¿åˆ° slice è¿™ä¸ªæ–¹æ³•,å¹¶ä¸”è®© this ç»‘å®š arguments,è®©å†…éƒ¨éå†arguments</span></span><br><span class="line">  <span class="keyword">let</span> newArr2 = [].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br></pre></td></tr></table></figure><p>å†çœ‹å›è¿™ä¸ªï¼Œåº”è¯¥ç†è§£äº†å§</p><h5 id="Array-from-ES6"><strong>Array</strong>.from (ES6)</h5><p><strong>Array.from()</strong> æ–¹æ³•å¯¹ä¸€ä¸ªç±»ä¼¼æ•°ç»„æˆ–å¯è¿­ä»£å¯¹è±¡åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œæµ…æ‹·è´çš„æ•°ç»„å®ä¾‹ï¼ˆMDNï¼‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> newArr = <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">arguments</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(newArr); <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br></pre></td></tr></table></figure><h5 id="å±•å¼€è¿ç®—ç¬¦-ES6">å±•å¼€è¿ç®—ç¬¦ (ES6)</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// å› ä¸ºå±•å¼€è¿ç®—ç¬¦å®é™…ä¸Šä¹Ÿæ˜¯éå†ï¼ŒæŠŠéå†çš„å…ƒç´ ä¸€ä¸ªä¸ªæ”¾åˆ°æ•°ç»„</span></span><br><span class="line">  <span class="keyword">let</span> newArr = [...<span class="variable language_">arguments</span>]</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(newArr); <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br></pre></td></tr></table></figure><h4 id="ç®­å¤´å‡½æ•°æ²¡æœ‰-arguments">ç®­å¤´å‡½æ•°æ²¡æœ‰ arguments</h4><p>ç®­å¤´å‡½æ•°æ˜¯ä¸ç»‘å®š arguments çš„ï¼Œå¦‚æœåœ¨ç®­å¤´å‡½æ•°ä¸­ä½¿ç”¨ argumentsï¼Œä¼šå»æ‰¾ä¸Šå±‚ä½œç”¨åŸŸä¸­çš„arguments</p><p>æ³¨æ„ï¼Œå…¨å±€ä½œç”¨åŸŸæ˜¯æ²¡æœ‰ arguments çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">foo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ‰¾ä¸Šå±‚ä½œç”¨åŸŸï¼Œæ‰¾åˆ° window</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>); <span class="comment">// arguments is not defined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>() </span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// arguments æœ‰ 123</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>); <span class="comment">// ArgumentsÂ [123]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> <span class="title function_">bar</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>); <span class="comment">// ArgumentsÂ [123]</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> bar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = <span class="title function_">foo</span>(<span class="number">123</span>)</span><br><span class="line"><span class="title function_">fn</span>() </span><br></pre></td></tr></table></figure><p>é‚£å¦‚æœæƒ³ä¼ é€’å¤šä¸ªå‚æ•°å‘¢ï¼Ÿç”¨ ES6 çš„å‰©ä½™å‚æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">foo</span> = (<span class="params">a, b, ...args</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a, b); <span class="comment">// 1 2 </span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(args); <span class="comment">// [3,4,5,6]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue3æºç å­¦ä¹ </title>
      <link href="/2022/03/31/Vue3%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/03/31/Vue3%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1>Vue3æºç å­¦ä¹ </h1><blockquote><p>ç¬¬ä¸€æ¬¡è¿™æ ·å­¦ä¹ æºç è¿˜æ˜¯æŒºæœ‰éš¾åº¦çš„ï¼Œå¸Œæœ›åé¢å¯ä»¥æ…¢æ…¢æå‡ï¼Œæœ‰è‡ªå·±é˜…è¯»æºç çš„èƒ½åŠ›å­</p></blockquote><h2 id="1-çœŸå®çš„DOMæ¸²æŸ“">1. çœŸå®çš„DOMæ¸²æŸ“</h2><p>ä¼ ç»Ÿçš„å‰ç«¯å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ˜¯ç¼–å†™è‡ªå·±çš„HTMLï¼Œæœ€ç»ˆè¢«æ¸²æŸ“åˆ°æµè§ˆå™¨ä¸Šçš„ï¼Œè¿™ä¸ªè¿‡ç¨‹å¤§æ¦‚æ˜¯ï¼š</p><p>è§£æ html è½¬åŒ–æˆ DOM æ ‘ï¼Œç„¶åæ¸²æŸ“åˆ°é¡µé¢</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06870cfbd95e41b6b19f557735a82565~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h2 id="2-è™šæ‹ŸDOM">2. è™šæ‹ŸDOM</h2><h3 id="2-1-æ¸²æŸ“è¿‡ç¨‹">2.1 æ¸²æŸ“è¿‡ç¨‹</h3><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f5da766b840443a082d46dea3ef61179~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h2 id="3-Vue-æºç çš„ä¸‰å¤§æ ¸å¿ƒç³»ç»Ÿ">3. Vue æºç çš„ä¸‰å¤§æ ¸å¿ƒç³»ç»Ÿ</h2><ul><li><p>Complieræ¨¡å—ï¼šç¼–è¯‘æ¨¡æ¿ç³»ç»Ÿ</p></li><li><p>Runtimeæ¨¡å—ï¼šä¹Ÿå¯ä»¥ç§°ä¹‹ä¸º Rendereræ¨¡å—ï¼ŒçœŸæ­£æ¸²æŸ“çš„æ¨¡å—</p></li><li><p>Reactivityæ¨¡å—ï¼šå“åº”å¼ç³»ç»Ÿ</p></li></ul><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2570e47944e340d09d20b337494d597a~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><ul><li>ä¸‰å¤§ç³»ç»ŸååŒå·¥ä½œ</li></ul><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/917ae20ad154485f86dc308eb3841d69~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h2 id="4-å®ç°-Mini-Vue">4. å®ç° Mini-Vue</h2><blockquote><p>mini-vueçš„å®ç°ä¹Ÿæ˜¯ï¼Œåé¢æœ‰æ—¶é—´å¾—å›æ¥é‡æ–°çœ‹çœ‹</p></blockquote><p>åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š</p><ul><li>æ¸²æŸ“ç³»ç»Ÿæ¨¡å—</li><li>å¯å“åº”å¼ç³»ç»Ÿæ¨¡å—</li><li>åº”ç”¨ç¨‹åºå…¥å£æ¨¡å—</li></ul><h3 id="4-1-æ¸²æŸ“ç³»ç»Ÿå®ç°">4.1 æ¸²æŸ“ç³»ç»Ÿå®ç°</h3><p>åŒ…å«ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li>h å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª VNode å¯¹è±¡</li><li>mount å‡½æ•°ï¼Œç”¨äºå°† VNode æŒ‚è½½åˆ° DOM ä¸Š</li><li>patch å‡½æ•°ï¼Œç”¨äºå¯¹æ¯”ä¸¤ä¸ª VNodeï¼Œå†³å®šå¦‚ä½•å¤„ç†æ–°çš„VNodeï¼ˆdiffï¼‰</li></ul><h4 id="hå‡½æ•°ç”Ÿæˆ-VNode">hå‡½æ•°ç”Ÿæˆ VNode</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆ VNode</span></span><br><span class="line"><span class="comment">// ç›´æ¥è¿”å›ä¸€ä¸ª VNodeå¯¹è±¡å³å¯</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">h</span> = (<span class="params">tag, props, children</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    tag,</span><br><span class="line">    props,</span><br><span class="line">    children</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="mountå‡½æ•°æŒ‚è½½-vnode">mountå‡½æ•°æŒ‚è½½ vnode</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// mountå‡½æ•°, æŒ‚è½½VNode</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mount</span> = (<span class="params">vnode, container</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 1.æ ¹æ®tagåˆ›å»ºHTMLå…ƒç´ ,å¹¶ä¸”å­˜å‚¨åˆ°vnodeçš„elä¸­</span></span><br><span class="line">  <span class="keyword">const</span> el = vnode.<span class="property">el</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(vnode.<span class="property">tag</span>)</span><br><span class="line">  <span class="comment">// 2.å¤„ç†propså±æ€§</span></span><br><span class="line">  <span class="comment">// 2.1 å¦‚æœä»¥onå¼€å¤´,é‚£ä¹ˆç›‘å¬äº‹ä»¶</span></span><br><span class="line">  <span class="comment">// 2.2 æ™®é€šå±æ€§ç›´æ¥é€šè¿‡ setAttribute æ·»åŠ </span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">props</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> vnode.<span class="property">props</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = vnode.<span class="property">props</span>[key]</span><br><span class="line">      <span class="keyword">if</span> (key.<span class="title function_">startsWith</span>(<span class="string">&quot;on&quot;</span>)) &#123;</span><br><span class="line">        el.<span class="title function_">addEventListener</span>(key.<span class="title function_">slice</span>(<span class="number">2</span>).<span class="title function_">toLowerCase</span>(), value)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        el.<span class="title function_">setAttribute</span>(key, value)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 3.å¤„ç†children</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">children</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">children</span> === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      el.<span class="property">textContent</span> = vnode.<span class="property">children</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vnode.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">mount</span>(item, el)</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4.å°† elæŒ‚è½½åˆ°containerä¸Š</span></span><br><span class="line">  container.<span class="title function_">appendChild</span>(el)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="patchå‡½æ•°-å¯¹æ¯”ä¸¤ä¸ªVNode">patchå‡½æ•° - å¯¹æ¯”ä¸¤ä¸ªVNode</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// patch,å¯¹æ¯”ä¸¤ä¸ª VNode</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">patch</span> = (<span class="params">n1, n2</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 1. tagä¸åŒ,ç›´æ¥åŠ å…¥æ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (n1.<span class="property">tag</span> !== n2.<span class="property">tag</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> n1Elparent = n1.<span class="property">el</span>.<span class="property">parentElement</span></span><br><span class="line">    n1Elparent.<span class="title function_">removeChild</span>(n1.<span class="property">el</span>)</span><br><span class="line">    <span class="title function_">mount</span>(n2, n1Elparent)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 1. å–å‡ºelementå¯¹è±¡,å¹¶ä¸”åœ¨n2ä¸­è¿›è¡Œä¿å­˜</span></span><br><span class="line">    <span class="keyword">const</span> el = n2.<span class="property">el</span> = n1.<span class="property">el</span></span><br><span class="line">    <span class="comment">// 2. å¤„ç†props</span></span><br><span class="line">    <span class="keyword">const</span> oldProps = n1.<span class="property">props</span> || &#123;&#125;</span><br><span class="line">    <span class="keyword">const</span> newProps = n2.<span class="property">props</span> || &#123;&#125;</span><br><span class="line">    <span class="comment">// 2.1 è·å–æ‰€æœ‰çš„newPropsæ·»åŠ åˆ°el</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> newProps) &#123;</span><br><span class="line">      <span class="keyword">const</span> oldValue = oldProps[key]</span><br><span class="line">      <span class="keyword">const</span> newValue = newProps[key]</span><br><span class="line">      <span class="keyword">if</span> (newValue !== oldValue) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key.<span class="title function_">startsWith</span>(<span class="string">&quot;on&quot;</span>)) &#123; <span class="comment">// å¯¹äº‹ä»¶ç›‘å¬çš„åˆ¤æ–­</span></span><br><span class="line">          el.<span class="title function_">addEventListener</span>(key.<span class="title function_">slice</span>(<span class="number">2</span>).<span class="title function_">toLowerCase</span>(), </span><br><span class="line">          newValue)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          el.<span class="title function_">setAttribute</span>(key, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.2åˆ é™¤æ—§çš„props</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> key <span class="keyword">in</span> oldProps) &#123;</span><br><span class="line">      <span class="keyword">if</span> (key.<span class="title function_">startsWith</span>(<span class="string">&quot;on&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">const</span> value = oldProps[key]</span><br><span class="line">        el.<span class="title function_">removeEventListener</span>(key.<span class="title function_">slice</span>(<span class="number">2</span>).<span class="title function_">toLowerCase</span>(), value)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!(key <span class="keyword">in</span> newProps)) &#123;</span><br><span class="line">        el.<span class="title function_">removeAttribute</span>(key)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å¤„ç†children</span></span><br><span class="line">    <span class="keyword">const</span> oldChildren = n1.<span class="property">children</span> || []</span><br><span class="line">    <span class="keyword">const</span> newChildren = n2.<span class="property">children</span> || []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> newChildren === <span class="string">&quot;string&quot;</span>) &#123; <span class="comment">// 3.1newChildrenæœ¬èº«æ˜¯ä¸€ä¸ªstring</span></span><br><span class="line">      <span class="comment">// è¾¹ç•Œæƒ…å†µ å¦‚æœoldChildrenä¹Ÿæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> oldChildren === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (newChildren !== oldChildren) &#123;</span><br><span class="line">          el.<span class="property">textContent</span> = newChildren</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        el.<span class="property">innerHTML</span> = newChildren</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 3.2 newChildrenæœ¬èº«æ˜¯ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> oldChildren === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        el.<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        newChildren.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">mount</span>(item, el)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// oldChildren ä¹Ÿæ˜¯æ•°ç»„</span></span><br><span class="line">        <span class="comment">// 1. å‰é¢æœ‰ç›¸åŒèŠ‚ç‚¹çš„</span></span><br><span class="line">        <span class="keyword">const</span> commonLength = <span class="title class_">Math</span>.<span class="title function_">min</span>(oldChildren.<span class="property">length</span>, newChildren.<span class="property">length</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; commonLength; i++) &#123;</span><br><span class="line">          <span class="title function_">patch</span>(oldChildren[i], newChildren[i])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.å¦‚æœæ–°èŠ‚ç‚¹çš„lengthæ›´é•¿ï¼Œé‚£ä¹ˆå‰©ä½™çš„æ–°èŠ‚ç‚¹è¿›è¡ŒæŒ‚è½½æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> (newChildren.<span class="property">length</span> &gt; oldChildren.<span class="property">length</span>) &#123;</span><br><span class="line">          newChildren.<span class="title function_">slice</span>(oldChildren.<span class="property">length</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">mount</span>(item, el)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.å¦‚æœæ—§èŠ‚ç‚¹çš„lengthæ›´é•¿ï¼Œé‚£ä¹ˆç§»é™¤å‰©ä½™çš„æ—§èŠ‚ç‚¹è¿›è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (newChildren.<span class="property">length</span> &lt; oldChildren.<span class="property">length</span>) &#123;</span><br><span class="line">          oldChildren.<span class="title function_">slice</span>(newChildren.<span class="property">length</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            el.<span class="title function_">removeChild</span>(item.<span class="property">el</span>)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-å“åº”å¼ç³»ç»Ÿ">4.2 å“åº”å¼ç³»ç»Ÿ</h3><h4 id="ä¾èµ–æ”¶é›†ç³»ç»Ÿ-vue2å“åº”å¼ç³»ç»Ÿ">ä¾èµ–æ”¶é›†ç³»ç»Ÿ + vue2å“åº”å¼ç³»ç»Ÿ</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dep</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123; <span class="comment">// åªè¦new Dep,å°±ä¼šç»™ä½ æ·»åŠ subscribeså±æ€§ </span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subscribers</span> = <span class="keyword">new</span> <span class="title class_">Set</span>() <span class="comment">// åˆ›å»ºé›†åˆ(é‡Œé¢æ”¾æŸå±æ€§ä¾èµ–çš„å‡½æ•°)</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">depend</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// æ”¶é›†ä¾èµ–</span></span><br><span class="line">    <span class="keyword">if</span> (activeEffect) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">add</span>(activeEffect)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">effect</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">effect</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> activeEffect = <span class="literal">null</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">watchEffect</span>(<span class="params">effect</span>) &#123;</span><br><span class="line">  activeEffect = effect</span><br><span class="line">  <span class="title function_">effect</span>() <span class="comment">// åŸå§‹æ•°æ®å…ˆæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">  activeEffect = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDep</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">  <span class="comment">// 1.æ ¹æ®å¯¹è±¡(target)å–å‡ºå¯¹åº”çš„Mapå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">let</span> depsMap = targetMap.<span class="title function_">get</span>(target)</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    depsMap = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    targetMap.<span class="title function_">set</span>(target, depsMap)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.å–å‡ºå…·ä½“çš„depå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">let</span> dep = depsMap.<span class="title function_">get</span>(key)</span><br><span class="line">  <span class="keyword">if</span> (!dep) &#123;</span><br><span class="line">    dep = <span class="keyword">new</span> <span class="title class_">Dep</span>()</span><br><span class="line">    depsMap.<span class="title function_">set</span>(key, dep)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dep</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vue2å¯¹rawè¿›è¡Œæ•°æ®åŠ«æŒ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">raw</span>) &#123;</span><br><span class="line">  <span class="comment">// æ ¹æ®å¯¹è±¡æ‹¿åˆ°æ‰€æœ‰key,ç»„æˆæ•°ç»„</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(raw).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–keyå¯¹åº”çš„ä¾èµ–</span></span><br><span class="line">    <span class="keyword">const</span> dep = <span class="title function_">getDep</span>(raw, key)</span><br><span class="line">    <span class="keyword">let</span> value = raw[key]</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(raw, key, &#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123; <span class="comment">// ç”¨åˆ°äº†æŸä¸ªkey,è°ƒç”¨get,æ‰€ä»¥å¯ä»¥åœ¨è¿™é‡Œæ”¶é›†ä¾èµ–</span></span><br><span class="line">        dep.<span class="title function_">depend</span>()</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newValue</span>) &#123; <span class="comment">// å½“å±æ€§è¢«é‡æ–°èµ‹å€¼çš„æ—¶å€™,ä¼šè°ƒç”¨set,æ‰€ä»¥åœ¨è¿™é‡Œæ‰§è¡Œè¿™ä¸ªå±æ€§ä¾èµ–çš„å‡½æ•°</span></span><br><span class="line">        <span class="comment">// raw[key] = newValue ä¸èƒ½è¿™æ ·è®¾ç½®,å¦åˆ™é€’å½’äº†(åˆå¯¹rawæ“ä½œ,åˆåŠ«æŒ,åˆæ¥åˆ°setè¿™é‡Œäº†)</span></span><br><span class="line">        <span class="keyword">if</span> (value !== newValue) &#123;</span><br><span class="line">          value = newValue</span><br><span class="line">          dep.<span class="title function_">notify</span>()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> raw</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•ä»£ç </span></span><br><span class="line"><span class="keyword">const</span> info = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">counter</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;hillyee&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// watchEffect1</span></span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="property">counter</span> * <span class="number">2</span>, info.<span class="property">name</span>, <span class="string">&#x27;w1&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// watchEffect2</span></span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="property">counter</span> * info.<span class="property">counter</span>, <span class="string">&#x27;w2&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// info.counter++ // ä¿®æ”¹æ•°æ®çš„æ—¶å€™,æ‰€æœ‰å¯¹è¿™ä¸ªæ•°æ®æœ‰ä¾èµ–çš„å‡½æ•°éƒ½åº”è¯¥è¢«æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line"><span class="comment">// info.name = &quot;hahahhahah&quot;</span></span><br></pre></td></tr></table></figure><h4 id="å“åº”å¼ç³»ç»Ÿ-vue3-proxyå®ç°">å“åº”å¼ç³»ç»Ÿ vue3-proxyå®ç°</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue3å¯¹rawè¿›è¡Œæ•°æ®åŠ«æŒ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">raw</span>) &#123;</span><br><span class="line">  <span class="comment">// Proxy(åŸå¯¹è±¡,ä»£ç†å¯¹è±¡)</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(raw, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> dep = <span class="title function_">getDep</span>(target, key) <span class="comment">// è·å–è¯¥å±æ€§çš„ä¾èµ–</span></span><br><span class="line">      dep.<span class="title function_">depend</span>()</span><br><span class="line">      <span class="keyword">return</span> target[key]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, newValue</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> dep = <span class="title function_">getDep</span>(target, key)</span><br><span class="line">      target[key] = newValue</span><br><span class="line">      dep.<span class="title function_">notify</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸ºä»€ä¹ˆ-Vue3-é€‰æ‹©-Proxy-å‘¢ï¼Ÿ">ä¸ºä»€ä¹ˆ Vue3 é€‰æ‹© Proxy å‘¢ï¼Ÿ</h4><ul><li><p>Object.definedProperty æ˜¯åŠ«æŒå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå¦‚æœæ–°å¢å…ƒç´ ï¼Œ</p><p>é‚£ä¹ˆVue2éœ€è¦å†æ¬¡ è°ƒç”¨definedPropertyï¼Œè€Œ Proxy åŠ«æŒçš„æ˜¯æ•´ä¸ªå¯¹è±¡ï¼Œä¸éœ€è¦åšç‰¹æ®Šå¤„ç†</p></li><li><p>ä¿®æ”¹å¯¹è±¡çš„ä¸åŒï¼š ä½¿ç”¨ defineProperty æ—¶ï¼Œæˆ‘ä»¬ä¿®æ”¹åŸæ¥çš„ obj å¯¹è±¡å°±å¯ä»¥è§¦å‘æ‹¦æˆªï¼›</p><p>è€Œä½¿ç”¨ proxyï¼Œå°±å¿…é¡»ä¿®æ”¹ä»£ç†å¯¹è±¡ï¼Œå³ Proxy çš„å®ä¾‹æ‰å¯ä»¥è§¦å‘æ‹¦æˆªï¼›</p></li></ul><h3 id="4-3-æ¡†æ¶å¤–å±‚-API-è®¾è®¡">4.3 æ¡†æ¶å¤–å±‚ API è®¾è®¡</h3><h4 id="createApp">createApp()</h4><p>ç”¨äºåˆ›å»ºä¸€ä¸ªappå¯¹è±¡ï¼Œè¯¥appå¯¹è±¡æœ‰ä¸€ä¸ªmountæ–¹æ³•ï¼Œå¯ä»¥å°†æ ¹ç»„ä»¶æŒ‚è½½åˆ°æŸä¸€ä¸ªdomå…ƒç´ ä¸Š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createApp</span>(<span class="params">rootComponent</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">mount</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(selector)</span><br><span class="line">      <span class="keyword">let</span> isMounted = <span class="literal">false</span></span><br><span class="line">      <span class="keyword">let</span> oldVNode = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">      <span class="title function_">watchEffect</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isMounted) &#123;</span><br><span class="line">          <span class="comment">// rootComponent.render() è¿”å›æ ¹ç»„ä»¶çš„vnode</span></span><br><span class="line">          oldVNode = rootComponent.<span class="title function_">render</span>()</span><br><span class="line">          <span class="title function_">mount</span>(oldVNode, container)</span><br><span class="line">          isMounted = <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> newVNode = rootComponent.<span class="title function_">render</span>()</span><br><span class="line">          <span class="title function_">patch</span>(oldVNode, newVNode)</span><br><span class="line">          oldVNode = newVNode</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ¡ˆä¾‹â€“è®¡æ•°">ä½¿ç”¨æ¡ˆä¾‹â€“è®¡æ•°</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../mini_vue/renderer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../mini_vue/reactive.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 1.åˆ›å»ºæ ¹ç»„ä»¶</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> <span class="title class_">App</span> = &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: <span class="title function_">reactive</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">counter</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">      &#125;),</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">render</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, [</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">h</span>(<span class="string">&quot;h2&quot;</span>, <span class="literal">null</span>, <span class="string">`å½“å‰è®¡æ•°:<span class="subst">$&#123;<span class="variable language_">this</span>.data.counter&#125;</span>`</span>),</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">h</span>(<span class="string">&quot;button&quot;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">onClick</span>: <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">counter</span>++</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">counter</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;, <span class="string">&quot;+1&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        ])</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 2.æŒ‚è½½æ ¹ç»„ä»¶</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span></span><br><span class="line"><span class="language-javascript">    app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h1>Vue3æºç é˜…è¯»</h1><blockquote><p>æ ¹æ®å›¾çš„æµç¨‹ï¼ŒåŠ ä¸Šæºç ï¼Œå¤šçœ‹çœ‹å­ï¼Œç¬¬ä¸€æ¬¡çœ‹æºç ç¡®å®æœ‰ç‚¹åƒåŠ›äº†</p><p>å…ˆçœ‹ç†Ÿæ‚‰æµç¨‹ï¼Œç„¶åå¯ä»¥ debugger åœ¨æµè§ˆå™¨ä¸Šç®€å•è¿‡ä¸€ä¸‹æ•´ä¸ªæµç¨‹</p></blockquote><h2 id="createApp-2">createApp</h2><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/941441a206f545c488351612ee7f0a96~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h2 id="æºç é˜…è¯»ä¹‹æŒ‚è½½æ ¹ç»„ä»¶">æºç é˜…è¯»ä¹‹æŒ‚è½½æ ¹ç»„ä»¶</h2><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8e27cf0afe14494e963576c217bff7ab~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> app = &#123;<span class="attr">props</span>: &#123;<span class="attr">message</span>: <span class="title class_">String</span>&#125;</span><br><span class="line">instance</span><br><span class="line"><span class="comment">// 1.å¤„ç†propså’Œattrs</span></span><br><span class="line">instance.<span class="property">props</span></span><br><span class="line">instance.<span class="property">attrs</span></span><br><span class="line"><span class="comment">// 2.å¤„ç†slots</span></span><br><span class="line">instance.<span class="property">slots</span></span><br><span class="line"><span class="comment">// 3.æ‰§è¡Œsetup</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="title function_">setup</span>()</span><br><span class="line">instance.<span class="property">setupState</span> = <span class="title function_">proxyRefs</span>(result);</span><br><span class="line"><span class="comment">// 4.ç¼–è¯‘template -&gt; compile</span></span><br><span class="line">&lt;template&gt; -&gt; renderå‡½æ•°</span><br><span class="line">instance.<span class="property">render</span> = <span class="title class_">Component</span>.<span class="property">render</span> = renderå‡½æ•°</span><br><span class="line"><span class="comment">// 5.å¯¹vue2çš„options apiè¿›è¡ŒçŸ¥è¯†</span></span><br><span class="line">data/methods/computed/ç”Ÿå‘½å‘¨æœŸ</span><br></pre></td></tr></table></figure><h2 id="ç»„ä»¶åŒ–çš„åˆå§‹åŒ–">ç»„ä»¶åŒ–çš„åˆå§‹åŒ–</h2><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/40e10ca0c2b044d78ba221099f6d9eef~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h2 id="Compileè¿‡ç¨‹">Compileè¿‡ç¨‹</h2><p>å¯¹äºä¸ä¼šæ”¹å˜çš„é™æ€èŠ‚ç‚¹è¿›è¡Œä½œç”¨äºæå‡</p><blockquote><p>æˆ‘éƒ½æ²¡æ‰¾åˆ°è¿™éƒ¨åˆ†å‡½æ•°ã€‚ã€‚ã€‚</p></blockquote><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd404365f8f946d89e99ccc604ffa235~tplv-k3u1fbpfcp-watermark.image?" alt="image.png " style="zoom:67%;" /><h2 id="Block-Tree-åˆ†æ">Block Tree åˆ†æ</h2><p>vue3çš„ä¸€ä¸ªä¼˜åŒ–ï¼šå¯¹äºä¸ä¼šæ”¹å˜çš„é™æ€èŠ‚ç‚¹è¿›è¡Œä½œç”¨åŸŸæå‡ï¼Œä»…å¯¹æ–°çš„vnodeè¿›è¡Œåˆ›å»º</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1c78021a3a241ca8ef00958116b4445~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h2 id="ç”Ÿå‘½å‘¨æœŸå›è°ƒ">ç”Ÿå‘½å‘¨æœŸå›è°ƒ</h2><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8269743b1fb949219a2216950b8b1fb6~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h2 id="templateä¸­æ•°æ®çš„ä½¿ç”¨é¡ºåº">templateä¸­æ•°æ®çš„ä½¿ç”¨é¡ºåº</h2><blockquote><p>å¦‚æœsetupè·Ÿdataä¸­æœ‰åŒä¸€ä¸ªå±æ€§,é¦–å…ˆé€‰æ‹©setupçš„,å†…éƒ¨åšäº†ä¸€ä¸ªåˆ¤æ–­å§</p></blockquote><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2f6505298f6148e69434be3079bb168c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥Vue3+Typescriptå­¦ä¹ âš¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue3_compositionAPI</title>
      <link href="/2022/03/31/Vue3-compositionAPI/"/>
      <url>/2022/03/31/Vue3-compositionAPI/</url>
      
        <content type="html"><![CDATA[<h3 id="Composition-API">Composition API</h3><h4 id="1-setup">1. setup</h4><p><strong>1.1 setupå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼špropsï¼Œcontext</strong></p><ul><li>propsï¼šå…¶å®å°±æ˜¯çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å±æ€§ï¼Œä½†æ˜¯åœ¨setupå¤–é¢ä¾ç„¶éœ€è¦ç”¨propsæ¥æ”¶</li><li>contextï¼šé‡Œé¢åŒ…å«ä¸‰ä¸ªå±æ€§ï¼š<ul><li>attrsï¼šçˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ²¡æœ‰è¢«propæ¥æ”¶çš„å±æ€§</li><li>slotsï¼šçˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ’æ§½</li><li>emitï¼šå½“ç»„ä»¶å†…éƒ¨éœ€è¦å‘å‡ºäº‹ä»¶çš„æ—¶å€™ç”¨ï¼ˆvue2é‡Œé¢æ˜¯this.$emitï¼Œä½†æ˜¯vue3ä¸­ï¼Œsetupä¸èƒ½è®¿é—®thisï¼‰</li></ul></li></ul><p><strong>1.2 setup å‡½æ•°çš„è¿”å›å€¼</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        a</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>setupçš„è¿”å›å€¼å¯ä»¥åœ¨æ¨¡æ¿ template ä¸­ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä»£æ›¿data</p><p>ä½†æ˜¯ç›´æ¥è¿™ä¹ˆè¿”å›å˜é‡ï¼Œæ˜¯æ²¡æœ‰å“åº”å¼çš„</p><p><strong>1.3 setup ä¸å¯ä»¥ä½¿ç”¨ this</strong></p><ul><li>this å¹¶æ²¡æœ‰æŒ‡å‘å½“å‰ç»„ä»¶å®ä¾‹</li><li>åœ¨ setup è¢«è°ƒç”¨ä¹‹å‰ï¼Œdataã€computedã€ç­‰éƒ½æ²¡æœ‰è¢«è§£æ</li><li>æ‰€ä»¥æ— æ³•åœ¨ setup ä¸­è·å–this</li></ul><h4 id="2-reactive-API">2. reactive API</h4><p>ä¸ºsetupä¸­å®šä¹‰çš„æ•°æ®æä¾›å“åº”å¼çš„ç‰¹æ€§</p><p>reactive API ä¼ å…¥çš„ç±»å‹å¿…é¡»æ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;why&quot;</span>  <span class="comment">// è¿™æ—¶å€™è¿™ä¸ªnameå°±æ˜¯å“åº”å¼çš„</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="3-ref-API">3. ref API</h4><h5 id="3-1-ref-API-åŸºæœ¬ä½¿ç”¨">3.1 ref API åŸºæœ¬ä½¿ç”¨</h5><p>å¯ä»¥ä¼ å…¥åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåœ¨å¼€å‘ä¸­æ¨èä½¿ç”¨ refï¼Œä¾¿äºä»£ç çš„æŠ½ç¦»ï¼Œå½“ç„¶å¦‚æœå±æ€§å…³ç³»å¾ˆç´§å¯†çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ reactive</p><p>ref ä¼šè¿”å›ä¸€ä¸ªå¯å˜çš„å“åº”å¼å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> message = <span class="title function_">ref</span>(<span class="string">&quot;hello world&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li>åœ¨ template ä¸­å¼•ç”¨ ref çš„å€¼æ—¶ï¼ŒVueä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è¿›è¡Œè§£åŒ…ï¼Œå°±æ˜¯è¯´æˆ‘ä»¬ä¸éœ€è¦åœ¨æ¨¡æ¿ä¸­ xxx.value æ¥ä½¿ç”¨</li><li>ä½†æ˜¯åœ¨ setup å†…éƒ¨ï¼Œå®ƒä¾ç„¶æ˜¯ä¸€ä¸ª ref çš„å¼•ç”¨ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ <strong>ref.value</strong></li></ul><h5 id="3-2-ref-API-çš„è¡¥å……">3.2 ref API çš„è¡¥å……</h5><ul><li>toRefs å’Œ toRef</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> info = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;why&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// å½“æˆ‘ä»¬æƒ³è§£æ„çš„æ—¶å€™</span></span><br><span class="line"><span class="comment">// let &#123;name, age&#125; = info // ä¸å†æ˜¯å“åº”å¼çš„äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœå¸Œæœ›å“åº”å¼çš„è¯</span></span><br><span class="line"><span class="comment">// 1. toRefs: å°† reactive å¯¹è±¡ä¸­æ‰€æœ‰å±æ€§éƒ½è½¬æˆ ref</span></span><br><span class="line"><span class="comment">// let &#123;name, age&#125; = toRefs(info)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åªå¸Œæœ›å•ä¸ªå“åº”å¼çš„è¯</span></span><br><span class="line"><span class="comment">// 2. toRef</span></span><br><span class="line"><span class="keyword">let</span> &#123;name&#125; = info <span class="comment">// ä¸æ˜¯å“åº”å¼</span></span><br><span class="line"><span class="keyword">let</span> age = <span class="title function_">toRef</span>(info, <span class="string">&quot;age&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">change</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  age.<span class="property">value</span>++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>shallowRefï¼šåˆ›å»ºä¸€ä¸ªè·Ÿè¸ªè‡ªèº« .value å˜åŒ–çš„ refï¼Œä½†ä¸ä¼šä½¿å…¶å€¼ä¹Ÿå˜æˆå“åº”å¼çš„</li><li>triggerRefï¼šæ‰‹åŠ¨è§¦å‘å’Œ shallowRef ç›¸å…³è”çš„å‰¯ä½œç”¨</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> info = <span class="title function_">shallowRef</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;why&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">change</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// info.value = &quot;hello&quot; å“åº”å¼</span></span><br><span class="line">  info.<span class="property">value</span>.<span class="property">name</span> = <span class="string">&quot;james&quot;</span> <span class="comment">// ä¸æ˜¯å“åº”å¼</span></span><br><span class="line">  <span class="comment">// æ‰‹åŠ¨è§¦å‘å’Œ shallowRef ç›¸å…³è”çš„å‰¯ä½œç”¨(å˜æˆå“åº”å¼)</span></span><br><span class="line">  <span class="title function_">triggerRef</span>(info)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>customRef è‡ªå®šä¹‰ ref</li></ul><h4 id="4-readonly">4. readonly</h4><ul><li><p>å½“æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬ç»™å…¶ä»–ç»„ä»¶ä¼ é€’æ•°æ®æ—¶ï¼Œå¸Œæœ›å…¶ä»–ç»„ä»¶åªæ˜¯ä½¿ç”¨æˆ‘ä»¬çš„å†…å®¹ï¼Œä½†æ˜¯ä¸å…è®¸å®ƒä»¬ä¿®æ”¹çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨readonly</p></li><li><p>å®é™…ä¸Šï¼Œreadonly ä¼šè¿”å›åŸç”Ÿå¯¹è±¡çš„åªè¯»ä»£ç†ï¼Œä¹Ÿå°±æ˜¯å®ƒä¾ç„¶æ˜¯ä¸€ä¸ª Proxyï¼Œä½†æ˜¯setæ–¹æ³•è¢«åŠ«æŒ</p></li><li><p>å¼€å‘ä¸­å¸¸è§çš„readonlyæ–¹æ³•ä¼šä¼ å…¥ä¸‰ä¸ªç±»å‹çš„å€¼</p><ul><li>æ™®é€šå¯¹è±¡</li><li>reactive è¿”å›çš„å¯¹è±¡</li><li>ref çš„å¯¹è±¡</li></ul></li><li><p>readonly ä½¿ç”¨æ—¶ï¼Œreadonly è¿”å›çš„å¯¹è±¡ä¸å…è®¸ä¿®æ”¹ï¼Œä½†æ˜¯ç»è¿‡ readonly å¤„ç†çš„åŸæ¥çš„å¯¹è±¡æ˜¯å¯ä»¥ä¿®æ”¹çš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> info = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;why&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">readonly</span>(info)</span><br><span class="line">state.<span class="property">name</span> = <span class="string">&quot;aaa&quot;</span> <span class="comment">// ä¸å¯ä»¥</span></span><br><span class="line">info.<span class="property">name</span> = <span class="string">&quot;aaa&quot;</span> <span class="comment">// å¯ä»¥</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="5-computed">5. computed</h4><ul><li><p>ç”¨æ³•ä¸€ï¼šä¼ å…¥ä¸€ä¸ªgetterå‡½æ•°,computedçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªåªè¯»çš„refå¯¹è±¡(ä¸èƒ½ä¿®æ”¹)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fullName = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> firstName.<span class="property">value</span> + <span class="string">&quot;-&quot;</span> +lastName.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">   firstName.<span class="property">value</span> = <span class="string">&quot;james&quot;</span> <span class="comment">// å¯ä¿®æ”¹</span></span><br><span class="line">   fullName.<span class="property">value</span> = <span class="string">&quot;yuzi bing&quot;</span> <span class="comment">// ä¸å¯ä¿®æ”¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç”¨æ³•äºŒï¼šä¼ å…¥ä¸€ä¸ªå¯¹è±¡,å¯¹è±¡åŒ…å« getter/setter,è¿”å›ä¸€ä¸ªå¯è¯»å†™çš„ref å¯¹è±¡</p></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fullName = <span class="title function_">computed</span>(&#123;</span><br><span class="line">  <span class="attr">get</span>: <span class="function">() =&gt;</span> firstName.<span class="property">value</span> + <span class="string">&quot;-&quot;</span> +lastName.<span class="property">value</span>,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> names = newValue.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    firstName.<span class="property">value</span> = names[<span class="number">0</span>]</span><br><span class="line">    lastName.<span class="property">value</span> = names[<span class="number">1</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  fullName.<span class="property">value</span> = <span class="string">&quot;yuzi bing&quot;</span> <span class="comment">// å¯ä¿®æ”¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-watchEffect">6. watchEffect</h4><p><strong>6.1 watchEffect åŸºæœ¬ä½¿ç”¨</strong></p><ul><li>watchEffect ä¼ å…¥çš„å‡½æ•°ä¼šè¢«ç«‹å³æ‰§è¡Œä¸€æ¬¡, å¹¶åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­è‡ªåŠ¨æ”¶é›†ä¾èµ–ï¼ˆç›¸å½“äºä½ åœ¨è¿™ä¸ªå‡½æ•°ä½¿ç”¨äº†ä»€ä¹ˆå˜é‡ï¼Œå®ƒä¼šè‡ªåŠ¨æ”¶é›†åˆ°ï¼‰</li><li>åªæœ‰æ”¶é›†çš„ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒwatchEffect ä¼ å…¥çš„å‡½æ•°æ‰ä¼šå†æ¬¡æ‰§è¡Œ</li></ul><p>ä¸‹é¢æ¡ˆä¾‹ä¸­ï¼Œname çš„æ”¹å˜ä¼šè¢«ä¾¦å¬åˆ°ï¼Œè€Œ age ä¸ä¼šè¢«ä¾¦å¬</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// watchEffect: è‡ªåŠ¨æ”¶é›†å“åº”å¼çš„ä¾èµ–</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="title function_">ref</span>(<span class="string">&quot;jenny&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> age = <span class="title function_">ref</span>(<span class="number">18</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeName</span> = (<span class="params"></span>) =&gt; name.<span class="property">value</span> = <span class="string">&quot;tony&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeAge</span> = (<span class="params"></span>) =&gt; age.<span class="property">value</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;name:&quot;</span>, name.<span class="property">value</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>6.2 watchEffect åœæ­¢ä¾¦å¬</strong></p><p>å¦‚æœåœ¨å‘ç”ŸæŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœæ­¢ä¾¦å¬ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥è·å–watchEffectçš„è¿”å›å€¼å‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°å³å¯</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> age = <span class="title function_">ref</span>(<span class="number">18</span>)</span><br><span class="line"><span class="comment">// watchEffect ä¼šè¿”å›ä¸€ä¸ªå‡½æ•°,ä¾›æˆ‘ä»¬åœæ­¢ä¾¦å¬ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> stop = <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;age:&quot;</span>, age.<span class="property">value</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeAge</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  age.<span class="property">value</span>++</span><br><span class="line">  <span class="comment">// æ¡ˆä¾‹ï¼šage åˆ°25çš„æ—¶å€™å°±åœæ­¢ä¾¦å¬</span></span><br><span class="line">  <span class="keyword">if</span> (age.<span class="property">value</span> &gt; <span class="number">25</span>) &#123;</span><br><span class="line">    <span class="title function_">stop</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>6.3 watchEffect æ¸…é™¤å‰¯ä½œç”¨</strong></p><p>æ¸…é™¤å‰¯ä½œç”¨ï¼Ÿ</p><p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨ä¾¦å¬å™¨ä¸­æ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯åœ¨ç½‘ç»œè¯·æ±‚è¿˜æ²¡å®Œæˆä¹‹å‰ï¼Œæˆ‘ä»¬åœæ­¢äº†ä¾¦å¬å™¨æˆ–è€…ä¿®æ”¹äº†æ•°æ®è®©ä¾¦å¬å™¨ä¾¦å¬å‡½æ•°å†æ¬¡æ‰§è¡Œäº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åº”è¯¥æ¸…é™¤ä¸Šä¸€æ¬¡çš„å‰¯ä½œç”¨ï¼ˆæ•°æ®æ”¹å˜äº†è¦é‡æ–°å‘é€è¯·æ±‚æˆ–è€…è¯´ä¸éœ€è¦å‘äº†ï¼‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> stop = <span class="title function_">watchEffect</span>(<span class="function">(<span class="params">onInvalidate</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç½‘ç»œè¯·æ±‚æˆåŠŸ~&#x27;</span>); <span class="comment">// å®šæ—¶å™¨æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚</span></span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨ä¼ å…¥çš„å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œä¸€äº›æ¸…é™¤å·¥ä½œ</span></span><br><span class="line">  <span class="title function_">onInvalidate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onInvalidate&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">    </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;age:&quot;</span>, age.<span class="property">value</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>6.4 watchEffect æ‰§è¡Œæ—¶æœº</strong></p><ul><li><p>é¦–å…ˆè¡¥å……ä¸€ä¸‹ï¼šåœ¨ setup ä¸­å¦‚ä½•å±äº ref æˆ–è€…å…ƒç´ æˆ–è€…ç»„ä»¶ï¼Ÿ</p><p>å®šä¹‰ä¸€ä¸ª ref å¯¹è±¡ï¼Œç»‘å®šåˆ°å…ƒç´ æˆ–ç»„ä»¶çš„refå±æ€§ä¸Š</p></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;h2 ref=<span class="string">&quot;title&quot;</span>&gt;hello&lt;<span class="regexp">/h2&gt; /</span><span class="regexp">/ ç»‘å®šåˆ°å…ƒç´ çš„refå±æ€§</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const title = ref(null) /</span><span class="regexp">/ å®šä¹‰ ref å¯¹è±¡</span></span><br></pre></td></tr></table></figure><ul><li><p>watchEffect æ‰§è¡Œæ—¶æœº</p><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸­è·å–å…ƒç´ ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ‰“å°ç»“æœæœ‰ä¸¤ä¸ª</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(title.<span class="property">value</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><img src="D:/web_a/typora%E5%9B%BE%E7%89%87/image-20220329144156444-16485361187171.png" alt="image-20220329144156444 " style="zoom:60%;" /><ul><li>è¿™æ˜¯å› ä¸º setup å‡½æ•°åœ¨æ‰§è¡Œæ—¶å°±ä¼šç«‹å³æ‰§è¡Œä¼ å…¥çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™ DOM å¹¶æ²¡æœ‰æŒ‚è½½ï¼Œæ‰€ä»¥æ‰“å°ä¸º null</li><li>å½“ DOM æŒ‚è½½æ—¶ï¼Œä¼šç»™ title çš„ ref å¯¹è±¡èµ‹æ–°çš„å€¼ï¼Œå‰¯ä½œç”¨å‡½æ•°ä¼šå†æ¬¡æ‰§è¡Œ</li></ul></li><li><p>è°ƒæ•´ watchEffect çš„æ‰§è¡Œæ—¶æœº</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(title.<span class="property">value</span>);</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="comment">// flush: &quot;pre&quot; // åœ¨å…ƒç´ æŒ‚è½½æˆ–æ›´æ–°ä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line">    <span class="attr">flush</span>: <span class="string">&quot;post&quot;</span> <span class="comment">// å…ƒç´ æŒ‚è½½æ›´æ–°ä¹‹åæ‰§è¡Œ, è¿™æ—¶å€™åªæ‰“å°ä¸€æ¬¡&lt;h2&gt;&lt;/h2&gt;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h4 id="7-watch">7. watch</h4><h5 id="7-1-ä¾¦å¬å•ä¸ªæ•°æ®æº">7.1 ä¾¦å¬å•ä¸ªæ•°æ®æº</h5><ul><li>ä¾¦å¬ä¸€ä¸ª getter å‡½æ•°</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> info = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;jenny&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. watchä¾¦å¬æ—¶,ä¼ å…¥ä¸€ä¸ªgetterå‡½æ•°, å…·ä½“ç›‘å¬æŸä¸ªå±æ€§</span></span><br><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> info.<span class="property">name</span>, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue, oldValue); <span class="comment">// Tom jenny</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    info.<span class="property">name</span> = <span class="string">&quot;Tom&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç›´æ¥ä¾¦å¬ä¸€ä¸ªå¯å“åº”å¼çš„å¯¹è±¡ï¼Œreactive æˆ– ref ï¼ˆrefæ›´å¸¸ç”¨ï¼‰</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¼ å…¥ä¸€ä¸ªå¯å“åº”å¼å¯¹è±¡: reactiveå¯¹è±¡/refå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> info = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;jenny&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(info, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue, oldValue); </span><br><span class="line">    <span class="comment">// ProxyÂ &#123;name: &#x27;Tom&#x27;, age: 18&#125;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">watch</span>(title, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue, oldValue); <span class="comment">// world hello</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    info.<span class="property">name</span> = <span class="string">&quot;Tom&quot;</span></span><br><span class="line">    title.<span class="property">value</span> = <span class="string">&quot;world&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="7-2-ä¾¦å¬å¤šä¸ªæ•°æ®æº">7.2 ä¾¦å¬å¤šä¸ªæ•°æ®æº</h5><p>æ³¨ï¼šå¦‚æœæˆ‘ä»¬å¸Œæœ›ä¾¦å¬ä¸€ä¸ªæ•°ç»„æˆ–è€…å¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸€ä¸ªgetterå‡½æ•°ï¼Œå¹¶ä¸”å¯¹å¯å“åº”å¯¹è±¡è¿›è¡Œè§£æ„</p><p>(ä¸è§£æ„ä¹Ÿè¡Œ,ä¸è§£æ„n,oå°±æ˜¯ä¸€ä¸ªProxyå¯¹è±¡)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> info = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;jenny&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒæ—¶ä¾¦å¬å¤šä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="title function_">watch</span>([<span class="function">() =&gt;</span> (&#123;...info&#125;), title], <span class="function">(<span class="params">[newInfo, newTitle], [oldInfo, oldTitle]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newInfo, newTitle, oldInfo, oldTitle);</span><br><span class="line">    <span class="comment">// &#123;name: &#x27;Tom&#x27;, age: 18&#125; &#x27;world&#x27; </span></span><br><span class="line">    <span class="comment">// &#123;name: &#x27;jenny&#x27;, age: 18&#125; &#x27;hello&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    info.<span class="property">name</span> = <span class="string">&quot;Tom&quot;</span></span><br><span class="line">    title.<span class="property">value</span> = <span class="string">&quot;world&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="7-3-watch-çš„é€‰é¡¹">7.3 watch çš„é€‰é¡¹</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> info = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;jenny&quot;</span>,</span><br><span class="line">    <span class="attr">hobby</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;haha&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> (&#123;...info&#125;), <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue, oldValue);</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">deep</span>: <span class="literal">true</span>, <span class="comment">// æ·±åº¦ç›‘å¬</span></span><br><span class="line">    <span class="attr">immediate</span>: <span class="literal">true</span> <span class="comment">// ç«‹å³æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// info.name = &quot;Tom&quot;</span></span><br><span class="line">    info.<span class="property">hobby</span>.<span class="property">title</span> = <span class="string">&quot;hehe&quot;</span> <span class="comment">// å¼€å¯æ·±åº¦ç›‘å¬</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-ç”Ÿå‘½å‘¨æœŸé’©å­">8. ç”Ÿå‘½å‘¨æœŸé’©å­</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨æŒ‚è½½å¼€å§‹ä¹‹å‰è¢«è°ƒç”¨ï¼šç›¸å…³çš„ render å‡½æ•°é¦–æ¬¡è¢«è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="title function_">onBeforeMount</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line"><span class="comment">// å®ä¾‹æŒ‚è½½å®Œæ¯•åè°ƒç”¨</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ•°æ®å‘ç”Ÿæ”¹å˜åï¼ŒDOM è¢«æ›´æ–°ä¹‹å‰è¢«è°ƒç”¨ã€‚è¿™é‡Œé€‚åˆåœ¨ç°æœ‰ DOM å°†è¦è¢«æ›´æ–°ä¹‹å‰è®¿é—®å®ƒï¼Œæ¯”å¦‚ç§»é™¤æ‰‹åŠ¨æ·»åŠ çš„äº‹ä»¶ç›‘å¬å™¨ã€‚</span></span><br><span class="line"><span class="title function_">onBeforeUpdate</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line"><span class="comment">// åœ¨æ•°æ®æ›´æ”¹å¯¼è‡´çš„è™šæ‹Ÿ DOM é‡æ–°æ¸²æŸ“å’Œæ›´æ–°å®Œæ¯•ä¹‹åè¢«è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="title function_">onUpdated</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸è½½ç»„ä»¶å®ä¾‹å‰è°ƒç”¨, è¿™ä¸ªé˜¶æ®µ,å®ä¾‹ä»ç„¶æ˜¯å®Œå…¨æ­£å¸¸çš„</span></span><br><span class="line"><span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line"><span class="comment">// å¸è½½ç»„ä»¶å®ä¾‹åè°ƒç”¨,è°ƒç”¨æ­¤é’©å­æ—¶ï¼Œç»„ä»¶å®ä¾‹çš„æ‰€æœ‰æŒ‡ä»¤éƒ½è¢«è§£é™¤ç»‘å®šï¼Œæ‰€æœ‰äº‹ä»¶ä¾¦å¬å™¨éƒ½è¢«ç§»é™¤ï¼Œæ‰€æœ‰å­ç»„ä»¶å®ä¾‹è¢«å¸è½½ã€‚</span></span><br><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;&#125;),</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¢« keep-alive ç¼“å­˜çš„ç»„ä»¶æ¿€æ´»æ—¶è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="title function_">onActivated</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line"><span class="comment">// è¢« keep-alive ç¼“å­˜çš„ç»„ä»¶å¤±æ´»æ—¶è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="title function_">onDeactivated</span>(<span class="function">()=&gt;</span>&#123;&#125;)</span><br></pre></td></tr></table></figure><h4 id="9-Provide-å’Œ-Inject">9. Provide å’Œ Inject</h4><p>çˆ¶ç»„ä»¶é€šè¿‡ provide æ¥æä¾›æ•°æ®ï¼ˆå¿…é¡»è¦åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨è¿‡å­ç»„ä»¶ï¼Œå»ºç«‹è”ç³»æ‰èƒ½æä¾›æ•°æ®ï¼‰</p><p>provide(å±æ€§åï¼Œå±æ€§å€¼)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title function_">ref</span>(<span class="string">&quot;jenny&quot;</span>)</span><br><span class="line"><span class="comment">// ç»™åä»£ç»„ä»¶æä¾›å±æ€§æˆ–æ–¹æ³•(ä¸ºäº†ä¸è®©å­ç»„ä»¶éšæ„ä¿®æ”¹çˆ¶ç»„ä»¶çš„æ•°æ®,å¯ä»¥ä½¿ç”¨readonly)</span></span><br><span class="line"><span class="title function_">provide</span>(<span class="string">&quot;name&quot;</span>, <span class="title function_">readonly</span>(name))</span><br></pre></td></tr></table></figure><p>åä»£ç»„ä»¶å¯ä»¥é€šè¿‡ Inject æ¥æ³¨å…¥éœ€è¦çš„å±æ€§å’Œå¯¹åº”å€¼</p><p>inject(è¦æ³¨å…¥çš„å±æ€§å, é»˜è®¤å€¼) ï¼Œé»˜è®¤å€¼å°±æ˜¯å¦‚æœçˆ¶ç»„ä»¶æ²¡æœ‰æä¾›æ”¹æ•°æ®çš„è¯å°±ä½¿ç”¨é»˜è®¤å€¼</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title function_">inject</span>(<span class="string">&quot;name&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="10-composition-API-ç»ƒä¹ ">10. composition API ç»ƒä¹ </h4><p>è‡ªå®šä¹‰ hooks</p><h5 id="1-useTitle">1. useTitle</h5><p>æ”¹å˜é¡µé¢æ ‡é¢˜</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">title = <span class="string">&quot;é»˜è®¤çš„title&quot;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> titleRef = <span class="title function_">ref</span>(title)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">watch</span>(titleRef, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">title</span> = newValue</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">immediate</span>: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> titleRef</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-useScrollPosition">2. useScrollPosition</h5><p>ç›‘å¬é¡µé¢æ»šåŠ¨ä½ç½®</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useScrollPosition</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> scrollX = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> scrollY = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;scroll&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    scrollX.<span class="property">value</span> = <span class="variable language_">window</span>.<span class="property">scrollX</span></span><br><span class="line">    scrollY.<span class="property">value</span> = <span class="variable language_">window</span>.<span class="property">scrollY</span></span><br><span class="line">  &#125;)</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    scrollX,</span><br><span class="line">    scrollY</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-useMousePosition">3. useMousePosition</h5><p>ç›‘å¬é¼ æ ‡ä½ç½®</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useMousePosition</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> mouseX = <span class="title function_">ref</span>(<span class="number">0</span>)  </span><br><span class="line">  <span class="keyword">const</span> mouseY = <span class="title function_">ref</span>(<span class="number">0</span>)  </span><br><span class="line"></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    mouseX.<span class="property">value</span> = event.<span class="property">pageX</span></span><br><span class="line">    mouseY.<span class="property">value</span> = event.<span class="property">pageY</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    mouseX,</span><br><span class="line">    mouseY</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-useLocalStorage">4. useLocalStorage</h5><p>ä½¿ç”¨ localStorage å­˜å‚¨å’Œè·å–æ•°æ®</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">ref</span>(value)</span><br><span class="line">  <span class="comment">// å¦‚æœæœ‰ä¼ value,è¡¨ç¤ºè¦å­˜å‚¨å€¼,å¦åˆ™æ˜¯è·å–å€¼</span></span><br><span class="line">  <span class="keyword">if</span> (value) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    data.<span class="property">value</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(key))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">watch</span>(data, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(newValue))</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨æµè§ˆå™¨å­˜å–å€¼</span></span><br><span class="line"><span class="keyword">let</span> data = <span class="title function_">useLocalStorage</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;jenny&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeData</span> = (<span class="params"></span>) =&gt; data.<span class="property">value</span> = <span class="string">&quot;hahaha&quot;</span></span><br></pre></td></tr></table></figure><h5 id="5-useCounter">5. useCounter</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> counter = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> doubleCounter = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> counter.<span class="property">value</span> * <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; counter.<span class="property">value</span>++;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; counter.<span class="property">value</span>--;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    counter, </span><br><span class="line">    doubleCounter, </span><br><span class="line">    increment, </span><br><span class="line">    decrement</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="11-è®¤è¯†è‡ªå®šä¹‰æŒ‡ä»¤">11. è®¤è¯†è‡ªå®šä¹‰æŒ‡ä»¤</h4><h5 id="11-1-ç®€å•ä½¿ç”¨">11.1 ç®€å•ä½¿ç”¨</h5><ul><li><p>é™¤äº† v-for, v-showï¼Œç­‰æŒ‡ä»¤ï¼ŒVueä¹Ÿå…è®¸æˆ‘ä»¬è‡ªå®šä¹‰æŒ‡ä»¤</p></li><li><p>è‡ªå®šä¹‰æŒ‡ä»¤åˆ†ä¸ºä¸¤ç§</p><ul><li>è‡ªå®šä¹‰å±€éƒ¨æŒ‡ä»¤ï¼šç»„ä»¶ä¸­é€šè¿‡ directives é€‰é¡¹ï¼Œåªèƒ½åœ¨å½“å‰ç»„ä»¶ä¸­ä½¿ç”¨</li><li>è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤ï¼šappçš„ directive æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä»»æ„ç»„ä»¶ä¸­è¢«ä½¿ç”¨</li></ul></li><li><p>ç®€å•çš„æ¡ˆä¾‹ï¼šå½“æŸä¸ªå…ƒç´ æŒ‚è½½å®Œæˆåå¯ä»¥è‡ªå®šè·å–ç„¦ç‚¹</p><ul><li><p>é»˜è®¤æ–¹å¼çš„å®ç°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; ref=&quot;input&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;ref, onMounted&#125; from &#x27;vue&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const input = ref(null)</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      input.value.focus()</span><br><span class="line">    &#125;)</span><br><span class="line">    return &#123;</span><br><span class="line">      input</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è‡ªå®šä¹‰å±€éƒ¨æŒ‡ä»¤ v-focus</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; ref=&quot;input&quot; v-focus&gt;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  directives: &#123;</span><br><span class="line">    // è‡ªå®šä¹‰å±æ€§çš„åç§°(è¿™é‡Œä¸éœ€è¦å†™ v-)</span><br><span class="line">    focus: &#123;</span><br><span class="line">      mounted(el) &#123;</span><br><span class="line">        el.focus()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤ v-focus (main.jsä¸­)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">app.directive(&quot;focus&quot;, &#123;</span><br><span class="line">  mounted(el) &#123;</span><br><span class="line">    el.focus()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="11-2-æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸ">11.2 æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸ</h5><ul><li>ä¸€ä¸ªæŒ‡ä»¤å®šä¹‰çš„å¯¹è±¡ï¼ŒVueæä¾›äº†å¦‚ä¸‹çš„å‡ ä¸ªé’©å­å‡½æ•°ï¼š</li><li>createdï¼šåœ¨ç»‘å®šå…ƒç´ çš„ attribute æˆ–äº‹ä»¶ç›‘å¬å™¨è¢«åº”ç”¨ä¹‹å‰è°ƒç”¨ï¼›</li><li>beforeMountï¼šå½“æŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ å¹¶ä¸”åœ¨æŒ‚è½½çˆ¶ç»„ä»¶ä¹‹å‰è°ƒç”¨</li><li>mountedï¼šåœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶è¢«æŒ‚è½½åè°ƒç”¨</li><li>beforeUpdateï¼šåœ¨æ›´æ–°åŒ…å«ç»„ä»¶çš„ VNode ä¹‹å‰è°ƒç”¨</li><li>updatedï¼šåœ¨åŒ…å«ç»„ä»¶çš„ VNode åŠå…¶å­ç»„ä»¶çš„ VNode æ›´æ–°åè°ƒç”¨</li><li>beforeUnmountï¼šåœ¨å¸è½½ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶ä¹‹å‰è°ƒç”¨</li><li>unmountedï¼šå½“æŒ‡ä»¤ä¸å…ƒç´ è§£é™¤ç»‘å®šä¸”çˆ¶ç»„ä»¶å·²å¸è½½æ—¶ï¼Œåªè°ƒç”¨ä¸€æ¬¡</li></ul><p>æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥æ‹¿åˆ°å‡ ä¸ªå‚æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">directive</span>(<span class="string">&quot;focus&quot;</span>, &#123;</span><br><span class="line">  <span class="comment">// el: &lt;input&gt;</span></span><br><span class="line">  <span class="comment">// bindings: åŒ…å«ä¸€äº›å±æ€§çš„å¯¹è±¡</span></span><br><span class="line">  <span class="comment">// vnode: ä¸€ä¸ªçœŸå® DOM å…ƒç´ </span></span><br><span class="line">  <span class="comment">// preVnode: ä¸Šä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹</span></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el, bindings, vnode, preVnode</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;focus created&quot;</span>, el, bindings, vnode, preVnode);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(bindings.<span class="property">value</span>); <span class="comment">// æ‹¿åˆ°ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(bindings.<span class="property">modifiers</span>); <span class="comment">// æŒ‡ä»¤çš„ä¿®é¥°ç¬¦</span></span><br><span class="line">    el.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="11-3-æŒ‡ä»¤çš„å‚æ•°å’Œä¿®é¥°ç¬¦">11.3 æŒ‡ä»¤çš„å‚æ•°å’Œä¿®é¥°ç¬¦</h5><ul><li><p>æŒ‡ä»¤æ¥å—å‚æ•°æˆ–è€…ä¿®é¥°ç¬¦</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">v-æŒ‡ä»¤å:å‚æ•°å.ä¿®é¥°ç¬¦=&quot;å…·ä½“å€¼&quot;</span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-why:info.aaa.bbb</span>=<span class="string">&quot;&#123;title: &#x27;hello&#x27;, name: &#x27;me&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="11-4-è‡ªå®šä¹‰æŒ‡ä»¤ç»ƒä¹ ">11.4 è‡ªå®šä¹‰æŒ‡ä»¤ç»ƒä¹ </h5><p>è‡ªå®šä¹‰æ—¶é—´æ ¼å¼åŒ–çš„æŒ‡ä»¤ v-format-time</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&quot;dayjs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">app</span>) &#123;</span><br><span class="line">  app.<span class="title function_">directive</span>(<span class="string">&quot;format-time&quot;</span>, &#123;</span><br><span class="line">    <span class="title function_">created</span>(<span class="params">el, bindings</span>) &#123;</span><br><span class="line">      <span class="comment">// é»˜è®¤æ ¼å¼</span></span><br><span class="line">      bindings.<span class="property">formatString</span> = <span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span></span><br><span class="line">      <span class="comment">// å¦‚æœæœ‰ä¼ å…¥æ ¼å¼çš„å‚æ•°ï¼Œé‚£ä¹ˆä½¿ç”¨ä¼ å…¥çš„æ ¼å¼</span></span><br><span class="line">      <span class="keyword">if</span> (bindings.<span class="property">value</span>) &#123;</span><br><span class="line">        bindings.<span class="property">formatString</span> = bindings.<span class="property">value</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">mounted</span>(<span class="params">el, bindings</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> textContent = el.<span class="property">textContent</span> <span class="comment">// èŠ‚ç‚¹åŠå…¶åä»£çš„æ–‡æœ¬å†…å®¹</span></span><br><span class="line">      <span class="keyword">let</span> timestamp = <span class="built_in">parseInt</span>(textContent)</span><br><span class="line">      <span class="keyword">if</span> (textContent.<span class="property">length</span> === <span class="number">10</span>) &#123;</span><br><span class="line">        timestamp = timestamp * <span class="number">1000</span> <span class="comment">// è½¬æˆæ¯«ç§’</span></span><br><span class="line">      &#125;</span><br><span class="line">      el.<span class="property">textContent</span> = <span class="title function_">dayjs</span>(timestamp).<span class="title function_">format</span>(bindings.<span class="property">formatString</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="12-nextTick">12. nextTick</h4><blockquote><p>å°†å›è°ƒæ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ª DOM æ›´æ–°å‘¨æœŸä¹‹åæ‰§è¡Œã€‚åœ¨æ›´æ”¹äº†ä¸€äº›æ•°æ®ä»¥ç­‰å¾… DOM æ›´æ–°åç«‹å³ä½¿ç”¨å®ƒ</p></blockquote><p>æ¡ˆä¾‹ï¼šå½“messageæ›´æ–°æ—¶ï¼Œæ‹¿åˆ°å®ƒçš„é«˜åº¦</p><p>å¦‚æœä¸æ”¾åˆ° nextTickæ‰§è¡Œï¼Œæ‹¿åˆ°çš„å°±æ˜¯æœªæ›´æ–°ä¹‹å‰çš„æ•°æ®ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡ç‚¹æ·»åŠ å†…å®¹ï¼Œè¾“å‡º0</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2 class=&quot;title&quot; ref=&quot;titleRef&quot;&gt;&#123;&#123;message&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;addContent&quot;&gt;æ·»åŠ å†…å®¹&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref, nextTick &#125; from &#x27;vue&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const message = ref(&quot;&quot;)</span><br><span class="line">    const titleRef = ref(null)</span><br><span class="line"></span><br><span class="line">    const addContent = () =&gt; &#123;</span><br><span class="line">      message.value += &quot;å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ&quot;</span><br><span class="line">      // console.log(titleRef.value.offsetHeight);</span><br><span class="line">      nextTick(() =&gt; &#123;</span><br><span class="line">        console.log(titleRef.value.offsetHeight);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>nextTickçš„å›è°ƒå‡½æ•°ä¼šè¢«åŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¹‹åï¼Œåœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼ŒDOMæ›´æ–°å®Œä¹‹åæ‰è½®åˆ°å®ƒæ‰§è¡Œ</p><h3 id="å…¶ä»–è¡¥å……">å…¶ä»–è¡¥å……</h3><h4 id="1-renderå‡½æ•°">1. renderå‡½æ•°</h4><h5 id="1-1-è®¤è¯†-h-å‡½æ•°">1.1 è®¤è¯† h å‡½æ•°</h5><ul><li><p>ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„HTMLéƒ½æ˜¯ç”¨æ¨¡æ¿<code>&lt;template&gt;</code>åˆ›å»ºçš„ï¼Œå¦‚æœåœ¨ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ï¼ŒçœŸçš„éœ€è¦JavaScriptçš„å®Œå…¨ç¼–ç¨‹èƒ½åŠ›ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ æ¸²æŸ“å‡½æ•°ï¼Œå®ƒæ¯”æ¨¡æ¿æ›´æ¥è¿‘ç¼–è¯‘å™¨</p><ul><li><p>Vueåœ¨ç”ŸæˆçœŸå®çš„ DOM ä¹‹å‰ï¼Œä¼šå°†æˆ‘ä»¬çš„èŠ‚ç‚¹è½¬æ¢æˆ VNodeï¼ˆè™šæ‹ŸèŠ‚ç‚¹ï¼‰ï¼Œè€ŒVNodeç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€æ£µæ ‘ç»“æ„ï¼Œå°±æ˜¯è™šæ‹ŸDOMï¼ˆVDOMï¼‰</p></li><li><p>ä½ æƒ³å……åˆ†çš„åˆ©ç”¨JavaScriptçš„ç¼–ç¨‹èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥ç¼–å†™ createVNode å‡½æ•°ï¼Œç”Ÿæˆå¯¹åº”çš„ VNode</p></li></ul></li><li><p>h()å‡½æ•°æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»º VNode çš„å‡½æ•°</p></li></ul><h5 id="1-2-h-å‡½æ•°åŸºæœ¬ä½¿ç”¨">1.2 h å‡½æ•°åŸºæœ¬ä½¿ç”¨</h5><ul><li>h() å‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œï¼ˆæ ‡ç­¾åï¼Œç»„ä»¶åâ€¦ï¼‰ï¼ˆå±æ€§ï¼‰ï¼ˆå­èŠ‚ç‚¹ï¼Œå†…å®¹ï¼‰</li><li>h å‡½æ•°å¯ä»¥åœ¨ä¸¤ä¸ªåœ°æ–¹ä½¿ç”¨ï¼Œrender å‡½æ•°é€‰é¡¹ä¸­æˆ–è€… setup å‡½æ•°é€‰é¡¹ä¸­</li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// render å‡½æ•°é€‰é¡¹ä¸­</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&quot;h2&quot;</span>, &#123;<span class="attr">class</span>: <span class="string">&quot;title&quot;</span>&#125;, <span class="string">&quot;Hello Render&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="string">&quot;h2&quot;</span>, &#123;<span class="attr">class</span>: <span class="string">&quot;title&quot;</span>&#125;, <span class="string">&quot;Hello Render&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="D:/web_a/typora%E5%9B%BE%E7%89%87/image-20220330152843095-16486253285831.png" alt="image-20220330152843095 " style="zoom:67%;" /><h5 id="1-3-h-å‡½æ•°å®ç°è®¡æ•°å™¨æ¡ˆä¾‹">1.3 h å‡½æ•°å®ç°è®¡æ•°å™¨æ¡ˆä¾‹</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">counter</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, &#123;<span class="attr">class</span>: <span class="string">&quot;app&quot;</span>&#125;, [</span><br><span class="line">            <span class="title function_">h</span>(<span class="string">&quot;h2&quot;</span>, <span class="literal">null</span>, <span class="string">`å½“å‰è®¡æ•°:<span class="subst">$&#123;<span class="variable language_">this</span>.counter&#125;</span>`</span>),</span><br><span class="line">            <span class="title function_">h</span>(<span class="string">&quot;button&quot;</span>, &#123;<span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">counter</span>++&#125;, <span class="string">&quot;+1&quot;</span>),</span><br><span class="line">            <span class="title function_">h</span>(<span class="string">&quot;button&quot;</span>, &#123;<span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">counter</span>--&#125;, <span class="string">&quot;-1&quot;</span>)</span><br><span class="line">        ])</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-jsx">2. jsx</h4><ul><li><p>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ jsx éœ€è¦æ·»åŠ å¯¹ jsx çš„æ”¯æŒ</p><ul><li><p>å®‰è£…Babelæ”¯æŒVueçš„jsxæ’ä»¶</p><p><code>npm install @vue/babel-plugin-jsx -D</code></p></li><li><p>åœ¨ babel.config.js é…ç½®æ–‡ä»¶ä¸­é…ç½®æ’ä»¶</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="string">&quot;@vue/babel-plugin-jsx&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>åŸºæœ¬ä½¿ç”¨ï¼šè®¡æ•°å™¨æ¡ˆä¾‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">counter</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; <span class="variable language_">this</span>.<span class="property">counter</span>++;</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; <span class="variable language_">this</span>.<span class="property">counter</span>--;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>å½“å‰è®¡æ•°: &#123;this.counter&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;increment&#125;</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;decrement&#125;</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-è®¤è¯†-Teleport">3. è®¤è¯† Teleport</h4><p>(å…ˆäº†è§£ä¸€ä¸‹)</p><p>åœ¨ç»„ä»¶åŒ–å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å°è£…ä¸€ä¸ªç»„ä»¶Aï¼Œåœ¨å¦å¤–ä¸€ä¸ªç»„ä»¶Bä¸­ä½¿ç”¨ï¼Œp é‚£ä¹ˆç»„ä»¶Aä¸­templateçš„å…ƒç´ ï¼Œä¼šè¢«æŒ‚è½½åˆ°ç»„ä»¶Bä¸­templateçš„æŸä¸ªä½ç½®ï¼Œæœ€ç»ˆå½¢æˆä¸€æ£µ DOM æ ‘ç»“æ„</p><p>ä½†æ˜¯æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ç»„ä»¶ä¸æ˜¯æŒ‚è½½åœ¨è¿™ä¸ªç»„ä»¶æ ‘ä¸Šçš„ï¼Œå¯èƒ½æ˜¯ç§»åŠ¨åˆ°Vue appä¹‹å¤–çš„å…¶ä»–ä½ç½®ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡teleportå®Œæˆ</p><h4 id="4-è®¤è¯†-Vue-æ’ä»¶">4. è®¤è¯† Vue æ’ä»¶</h4><p>é€šå¸¸æˆ‘ä»¬å‘Vueå…¨å±€æ·»åŠ ä¸€äº›åŠŸèƒ½æ—¶ï¼Œä¼šé‡‡ç”¨æ’ä»¶çš„æ¨¡å¼ï¼Œå®ƒæœ‰ä¸¤ç§ç¼–å†™æ–¹å¼</p><ul><li><p>å¯¹è±¡ç±»å‹ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å¿…é¡»åŒ…å«ä¸€ä¸ª install çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨å®‰è£…æ’ä»¶æ—¶æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>) &#123; <span class="comment">//</span></span><br><span class="line">    app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$name</span> = <span class="string">&quot;hillyee&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å‡½æ•°ç±»å‹ï¼šä¸€ä¸ªfunctionï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨å®‰è£…æ’ä»¶æ—¶è‡ªåŠ¨æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// plugins_function.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">app</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(app);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>main.js</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(pluginsFunction)</span><br><span class="line">app.<span class="title function_">use</span>(pluginsObject)</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥Vue3+Typescriptå­¦ä¹ âš¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•é¢˜ â€” JSç¯‡</title>
      <link href="/2022/03/31/%E9%9D%A2%E8%AF%95%E9%A2%98%E2%80%94JS%E7%AF%87/"/>
      <url>/2022/03/31/%E9%9D%A2%E8%AF%95%E9%A2%98%E2%80%94JS%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é¢è¯•é¢˜ â€” JSç¯‡</p></blockquote><h3 id="é—®ï¼šJS-åŸå§‹æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿå¼•ç”¨æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ">é—®ï¼šJS åŸå§‹æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿå¼•ç”¨æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ</h3><p>ç­”ï¼šåœ¨JSä¸­,å­˜åœ¨7ä¸­åŸå§‹æ•°æ®ç±»å‹,åˆ†åˆ«æ˜¯ï¼š<br>boolean,null,undefined,number,string,symbol,bigint<br>å¼•ç”¨ç±»å‹ï¼šObject(åŒ…å«æ™®é€šå¯¹è±¡ Object, æ•°ç»„å¯¹è±¡ Array, æ­£åˆ™å¯¹è±¡ RegExp,æ—¥æœŸå¯¹è±¡ Date,æ•°å­—å‡½æ•° Math,å‡½æ•°å¯¹è±¡ Function)</p><ul><li>Symbolè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ï¼Œä¸»è¦æ˜¯ç”¨æ¥å®šä¹‰å¯¹è±¡çš„å”¯ä¸€å±æ€§å</li><li>bigint å¯ä»¥è¡¨ç¤ºä»»æ„å¤§å°çš„æ•´æ•°</li></ul><h3 id="é—®ï¼šè¯·è¯´å‡ºä¸‹é¢ä»£ç çš„è¿è¡Œç»“æœï¼Œå¹¶è§£é‡ŠåŸå› ">é—®ï¼šè¯·è¯´å‡ºä¸‹é¢ä»£ç çš„è¿è¡Œç»“æœï¼Œå¹¶è§£é‡ŠåŸå› </h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">person</span>) &#123;</span><br><span class="line">  person.<span class="property">age</span> = <span class="number">26</span></span><br><span class="line">  person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;hzj&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> person</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> p1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;fyq&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">19</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="title function_">test</span>(p1)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1) <span class="comment">// -&gt; &#123;name: &#x27;fyq&#x27;,age: 26&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2) <span class="comment">// -&gt; &#123; name: &#x27;hzj&#x27;,age: 18 &#125;</span></span><br></pre></td></tr></table></figure><p>ç­”ï¼šå› ä¸ºåœ¨testå‡½æ•°ä¼ å‚çš„æ—¶å€™ï¼Œå®é™…ä¸Šä¼ é€’çš„æ˜¯p1å¯¹è±¡åœ¨å †ä¸­çš„å†…å­˜åœ°å€å€¼ï¼Œæ‰€ä»¥é€šè¿‡è°ƒç”¨person.age = 26ç¡®å®æ”¹å˜äº†p1çš„å€¼ï¼Œä½†æ˜¯éšåpersonå˜æˆäº†å¦ä¸€å—å†…å­˜ç©ºé—´çš„åœ°å€ï¼Œå¹¶ä¸”åœ¨æœ€åå°†è¿™ä¸ªå†…å­˜ç©ºé—´çš„åœ°å€è¿”å›ï¼Œç„¶åèµ‹å€¼ç»™äº†p2</p><h3 id="é—®ï¼šä¸‹é¢ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ-å’Œ-æ“ä½œç¬¦çš„ä¼˜å…ˆçº§">é—®ï¼šä¸‹é¢ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ(. å’Œ = æ“ä½œç¬¦çš„ä¼˜å…ˆçº§)</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;n : <span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">let</span> b = a</span><br><span class="line">a.<span class="property">x</span> = a = &#123;<span class="attr">n</span>: <span class="number">2</span>&#125;</span><br><span class="line">      </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">x</span>) <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b.<span class="property">x</span>) <span class="comment">// &#123;n:2&#125;</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ åœ¨jsçš„è¿ç®—ä¸­&quot;.â€œå’Œâ€=â€œè¿ç®—ç¬¦åŒæ—¶å‡ºç°æ—¶ï¼Œä¼šå…ˆæ‰§è¡Œâ€.&quot;è¿ç®—<br>æ‰€ä»¥ a.x = a = {n:2} --&gt; a.x = {n:2} --&gt; a = {n:2}</p><h3 id="é—®ï¼š0-1-0-2ä¸ºä»€ä¹ˆä¸ç­‰äº0-3ï¼Ÿ">é—®ï¼š0.1+0.2ä¸ºä»€ä¹ˆä¸ç­‰äº0.3ï¼Ÿ</h3><p>ç­”ï¼š(è¿›åˆ¶è½¬æ¢) jsåœ¨åšæ•°å­—è®¡ç®—çš„æ—¶å€™ï¼Œ0.1å’Œ0.2éƒ½ä¼šè¢«è½¬æˆäºŒè¿›åˆ¶åæ— é™å¾ªç¯ï¼Œä½†æ˜¯jsé‡‡ç”¨çš„IEEE 754äºŒè¿›åˆ¶æµ®ç‚¹è¿ç®—ï¼Œæœ€å¤§å¯ä»¥å­˜å‚¨53ä½æœ‰æ•ˆæ•°å­—ï¼Œäºæ˜¯å¤§äº53ä½åé¢çš„ä¼šå…¨éƒ¨æˆªæ‰ï¼Œå°†ä¼šå¯¼è‡´ç²¾åº¦ç¼ºå¤±ã€‚<br>(å¯¹é˜¶è¿ç®—) ç”±äºæŒ‡æ•°ä½æ•°ä¸ç›¸åŒï¼Œè¿ç®—æ—¶éœ€è¦å¯¹é˜¶è¿ç®—ï¼Œè¿™éƒ¨åˆ†ä¹Ÿå¯èƒ½äº§ç”Ÿç²¾åº¦ç¼ºå¤±</p><blockquote><p><a href="https://juejin.cn/post/6940405970954616839">https://juejin.cn/post/6940405970954616839</a><br><a href="https://juejin.cn/post/6844903680362151950">https://juejin.cn/post/6844903680362151950</a></p></blockquote><h3 id="ä½ çœŸçš„äº†è§£ä½œç”¨åŸŸå—ï¼Ÿ">ä½ çœŸçš„äº†è§£ä½œç”¨åŸŸå—ï¼Ÿ</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">0</span>,b = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    A = <span class="keyword">function</span> (<span class="params">b</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(a + b++)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a++)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">A</span>(<span class="number">1</span>) <span class="comment">// 1</span></span><br><span class="line"><span class="title function_">A</span>(<span class="number">2</span>) <span class="comment">// 4</span></span><br></pre></td></tr></table></figure><h3 id="â€˜1â€™-toString-ä¸ºä»€ä¹ˆå¯ä»¥è°ƒç”¨ï¼Ÿ">â€˜1â€™.toString()ä¸ºä»€ä¹ˆå¯ä»¥è°ƒç”¨ï¼Ÿ</h3><p>å®é™…ä¸Šè¿™ä¸ªè¯­å¥è¿è¡Œçš„è¿‡ç¨‹ä¸­åšäº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="title class_">Object</span>(<span class="string">&quot;1&quot;</span>) <span class="comment">// ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºObjectå®ä¾‹ã€‚</span></span><br><span class="line">s.<span class="title function_">toString</span>() <span class="comment">// ç¬¬äºŒæ­¥ï¼šè°ƒç”¨å®ä¾‹æ–¹æ³•</span></span><br><span class="line">s = <span class="literal">null</span> <span class="comment">// ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œå®Œæ–¹æ³•ç«‹å³é”€æ¯è¿™ä¸ªå®ä¾‹</span></span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºObjectå®ä¾‹ã€‚æ³¨æ„ä¸ºä»€ä¹ˆä¸æ˜¯Stringï¼Ÿç”±äºSymbolå’ŒBigIntçš„å‡ºç°ï¼Œå¯¹å®ƒä»¬è°ƒç”¨newéƒ½ä¼šæŠ¥é”™ï¼Œç›®å‰ES6è§„èŒƒä¹Ÿä¸å»ºè®®ç”¨newæ¥åˆ›å»ºåŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»</p><p>æ•´ä¸ªè¿‡ç¨‹ä½“ç°äº†åŸºæœ¬åŒ…è£…ç±»å‹çš„æ€§è´¨ï¼Œè€ŒåŸºæœ¬åŒ…è£…ç±»å‹æ°æ°å±äºåŸºæœ¬æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬Booleanï¼ŒNumberå’ŒString</p></blockquote><h3 id="æ•°æ®ç±»å‹çš„åˆ¤æ–­-2">æ•°æ®ç±»å‹çš„åˆ¤æ–­</h3><ul><li><p><strong>typeof</strong>ï¼šèƒ½åˆ¤æ–­æ‰€æœ‰å€¼ç±»å‹ï¼Œå‡½æ•°ã€‚ä¸å¯å¯¹nullã€å¯¹è±¡ã€æ•°ç»„è¿›è¡Œç²¾ç¡®åˆ¤æ–­ï¼Œå› ä¸ºéƒ½è¿”å›object</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">undefined</span>); <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="number">2</span>); <span class="comment">// number</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">true</span>); <span class="comment">// boolean</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="string">&quot;str&quot;</span>); <span class="comment">// string</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Symbol</span>(<span class="string">&quot;foo&quot;</span>)); <span class="comment">// symbol</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="number">2172141653n</span>); <span class="comment">// bigint</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;); <span class="comment">// function</span></span><br><span class="line"><span class="comment">// ä¸èƒ½åˆ¤åˆ«</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> []); <span class="comment">// object</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> &#123;&#125;); <span class="comment">// object</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">null</span>); <span class="comment">// object</span></span><br></pre></td></tr></table></figure></li><li><p><strong>instanceof</strong>ï¼šå¯ç”¨äºåˆ¤æ–­å¯¹è±¡ç±»å‹</p><blockquote><p><strong><code>instanceof</code></strong> <strong>è¿ç®—ç¬¦</strong>ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ <code>prototype</code> å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Person</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>() <span class="comment">// p1.__proto__ === Person.prototype</span></span><br><span class="line">p1 <span class="keyword">instanceof</span> <span class="title class_">Person</span> <span class="comment">// true å³Personæ„é€ å‡½æ•°çš„prototypeå‡ºç°åœ¨å®ä¾‹p1çš„åŸå‹é“¾ä¸Š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str1 = <span class="string">&quot;hello&quot;</span></span><br><span class="line">str1 <span class="keyword">instanceof</span> <span class="title class_">String</span> <span class="comment">// falseï¼ˆstr1ä¸æ˜¯å¯¹è±¡å®ä¾‹ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str2 = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">str2 <span class="keyword">instanceof</span> <span class="title class_">String</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p><strong>Object.prototype.toString.call()</strong>ï¼šæ‰€æœ‰åŸå§‹æ•°æ®ç±»å‹éƒ½èƒ½åˆ¤æ–­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="number">2</span>); <span class="comment">// &quot;[object Number]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="string">&quot;&quot;</span>); <span class="comment">// &quot;[object String]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">true</span>); <span class="comment">// &quot;[object Boolean]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">undefined</span>); <span class="comment">// &quot;[object Undefined]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">null</span>); <span class="comment">// &quot;[object Null]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="title class_">Math</span>); <span class="comment">// &quot;[object Math]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(&#123;&#125;); <span class="comment">// &quot;[object Object]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>([]); <span class="comment">// &quot;[object Array]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;); <span class="comment">// &quot;[object Function]&quot;</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p>ä¸ºä»€ä¹ˆè¦ç”¨callå»è°ƒç”¨toStringæ–¹æ³•å‘¢ï¼Ÿ</p><p>å€Ÿç”¨ObjectåŸå‹å¯¹è±¡ä¸Šçš„toStringæ–¹æ³•ï¼Œé€šè¿‡thisç»‘å®šè°ƒç”¨ï¼Œè¿”å›<code>&quot;[object ç±»å‹]&quot;</code></p></blockquote><h3 id="å¦‚ä½•åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºæ•°ç»„ï¼Ÿ">å¦‚ä½•åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºæ•°ç»„ï¼Ÿ</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="title function_">isArray</span>(arr); <span class="comment">// true</span></span><br><span class="line">arr.<span class="property">__proto__</span> === <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br><span class="line">arr <span class="keyword">instanceof</span> <span class="title class_">Array</span>; <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(arr); <span class="comment">// &quot;[object Array]&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å’Œ-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">== å’Œ === æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ul><li><p>=== å«ä¸¥æ ¼ç›¸ç­‰ï¼Œå·¦å³ä¸¤è¾¹ä¸ä»…å€¼è¦ç›¸ç­‰ï¼Œç±»å‹ä¹Ÿè¦ç›¸ç­‰</p></li><li><p>== å¯¹äºä¸€èˆ¬æƒ…å†µï¼Œåªè¦å€¼ç›¸ç­‰å°±è¿”å› trueï¼Œä½† == è¿˜æ¶‰åŠä¸€äº›ç±»å‹è½¬æ¢ï¼Œè½¬æ¢è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>ä¸¤è¾¹ç±»å‹æ˜¯å¦ç›¸åŒï¼Œç›¸åŒçš„è¯å°±æ¯”è¾ƒå€¼çš„å¤§å°ï¼Œå¦‚ï¼š1==2 false</li><li>åˆ¤æ–­ä¸¤è¾¹æ˜¯å¦æ˜¯ null å’Œ undefinedï¼Œæ˜¯çš„è¯å°±è¿”å›true</li><li>ä¸¤è¾¹æ˜¯å¦æ˜¯ String å’Œ Numberï¼Œæ˜¯çš„è¯ï¼Œå°±æŠŠStringç±»å‹è½¬æ¢æˆ Numberï¼Œå†è¿›è¡Œæ¯”è¾ƒ</li><li>åˆ¤æ–­å…¶ä¸­ä¸€è¾¹æ˜¯å¦æ˜¯ Booleanï¼Œæ˜¯çš„è¯å°±æŠŠBooleanè½¬æ¢æˆNumberï¼Œå†è¿›è¡Œæ¯”è¾ƒ</li><li>å¦‚æœå…¶ä¸­ä¸€è¾¹ä¸º Objectï¼Œè€Œå¦ä¸€è¾¹ä¸ºStringã€Numberæˆ–Symbolï¼Œä¼šå°†Objectè½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå†è¿›è¡Œæ¯”è¾ƒ</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;<span class="attr">a</span>: <span class="number">1</span>&#125; == <span class="literal">true</span>) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;<span class="attr">a</span>: <span class="number">1</span>&#125; == <span class="string">&quot;[object Object]&quot;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ">[ ] == ![ ]çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[] == ![] <span class="comment">// é€»è¾‘è¿ç®—éœ€è¿›è¡Œå¸ƒå°”å€¼è½¬æ¢, [] -&gt; true</span></span><br><span class="line">[] == !<span class="literal">true</span></span><br><span class="line">[] == <span class="literal">false</span> <span class="comment">// false -&gt; 0</span></span><br><span class="line">[] == <span class="number">0</span></span><br><span class="line"><span class="comment">// [] è½¬æ¢ä¸ºæ•°å€¼ï¼Œç»è¿‡ [].valueOf() --&gt; []</span></span><br><span class="line"><span class="comment">// [].toString -&gt; &quot;&quot;</span></span><br><span class="line">    <span class="comment">// &quot;&quot;.toNumber() -&gt; 0</span></span><br><span class="line"><span class="number">0</span> == <span class="number">0</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="å¯¹è±¡è½¬åŸå§‹ç±»å‹æ˜¯æ ¹æ®ä»€ä¹ˆæµç¨‹è¿è¡Œçš„ï¼Ÿ">å¯¹è±¡è½¬åŸå§‹ç±»å‹æ˜¯æ ¹æ®ä»€ä¹ˆæµç¨‹è¿è¡Œçš„ï¼Ÿ</h3><p>å¯¹è±¡è½¬åŸå§‹ç±»å‹ï¼Œä¼šè°ƒç”¨å†…ç½®çš„ [ToPrimitive] å‡½æ•°ï¼Œå¯¹äºè¯¥å‡½æ•°ï¼Œå…¶é€»è¾‘å¦‚ä¸‹ï¼š</p><blockquote><p><code>Symbol.toPrimitive</code> æ˜¯ä¸€ä¸ªå†…ç½®çš„ Symbol å€¼ï¼Œå®ƒæ˜¯ä½œä¸ºå¯¹è±¡çš„å‡½æ•°å€¼å±æ€§å­˜åœ¨çš„ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¯¹åº”çš„åŸå§‹å€¼æ—¶ï¼Œä¼šè°ƒç”¨æ­¤å‡½æ•°ã€‚</p></blockquote><ol><li>å¦‚æœæœ‰Symbol.toPrimitive()æ–¹æ³•ï¼Œä¼˜å…ˆè°ƒç”¨å†è¿”å›</li><li>è°ƒç”¨valueOf()ï¼Œå¦‚æœè½¬æ¢åä¸ºåŸå§‹ç±»å‹ï¼Œåˆ™è¿”å›ï¼Œå¦åˆ™ç»§ç»­</li><li>è°ƒç”¨toString()ï¼Œå¦‚æœè½¬æ¢åä¸ºåŸå§‹ç±»å‹ï¼Œåˆ™è¿”å›</li><li>å¦‚æœéƒ½æ²¡æœ‰è¿”å›åŸå§‹ç±»å‹ï¼Œä¼šæŠ¥é”™</li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="title function_">valueOf</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;5&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">toPrimitive</span>]() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">6</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj + <span class="number">1</span>); <span class="comment">// 7</span></span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•è®©-if-a-1-a-2-æ¡ä»¶æˆç«‹ï¼Ÿ">å¦‚ä½•è®© if(a == 1 &amp;&amp; a == 2)æ¡ä»¶æˆç«‹ï¼Ÿ</h3><blockquote><p>å¦‚æœ a æ˜¯å¯¹è±¡ï¼Œåˆ™åœ¨æ‰§è¡Œ == æ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ valueOf æ–¹æ³•(æˆ–toString)ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é‡å†™è¯¥æ–¹æ³•è®©æ¡ä»¶æˆç«‹</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">valueOf</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span>++</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a == <span class="number">1</span> &amp;&amp; a == <span class="number">2</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="è°ˆè°ˆä½ å¯¹é—­åŒ…çš„ç†è§£">è°ˆè°ˆä½ å¯¹é—­åŒ…çš„ç†è§£</h3><h4 id="ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ">ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ</h4><p>MDNå¯¹JSé—­åŒ…çš„è§£é‡Šï¼š</p><blockquote><ul><li>ä¸€ä¸ªå‡½æ•°å’Œå¯¹å…¶å‘¨å›´çŠ¶æ€ï¼ˆ<strong>lexical environmentï¼Œè¯æ³•ç¯å¢ƒ</strong>ï¼‰çš„å¼•ç”¨æ†ç»‘åœ¨ä¸€èµ·ï¼ˆæˆ–è€…è¯´å‡½æ•°è¢«å¼•ç”¨åŒ…å›´ï¼‰ï¼Œè¿™æ ·çš„ç»„åˆå°±æ˜¯<strong>é—­åŒ…</strong>ï¼ˆ<strong>closure</strong>ï¼‰ã€‚</li><li>ä¹Ÿå°±æ˜¯è¯´ï¼Œé—­åŒ…è®©ä½ å¯ä»¥åœ¨ä¸€ä¸ªå†…å±‚å‡½æ•°ä¸­è®¿é—®åˆ°å…¶å¤–å±‚å‡½æ•°çš„ä½œç”¨åŸŸã€‚</li><li>åœ¨JavaScript ä¸­ï¼Œæ¯å½“åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œé—­åŒ…å°±ä¼šåœ¨å‡½æ•°åˆ›å»ºçš„åŒæ—¶è¢«åˆ›å»ºå‡ºæ¥ã€‚</li></ul></blockquote><p>ä¹Ÿå¯ä»¥è¯´ï¼š</p><blockquote><p>é—­åŒ…æ˜¯æŒ‡é‚£äº›èƒ½å¤Ÿè®¿é—®è‡ªç”±å˜é‡çš„å‡½æ•°ã€‚è‡ªç”±å˜é‡æ˜¯æŒ‡åœ¨å‡½æ•°ä¸­ä½¿ç”¨çš„ï¼Œä½†æ—¢ä¸æ˜¯å‡½æ•°å‚æ•°ä¹Ÿä¸æ˜¯å‡½æ•°çš„å±€éƒ¨å˜é‡çš„å˜é‡</p><p>é—­åŒ… = å‡½æ•° + å‡½æ•°èƒ½å¤Ÿè®¿é—®çš„è‡ªç”±å˜é‡</p></blockquote><h4 id="é—­åŒ…çš„äº§ç”Ÿ">é—­åŒ…çš„äº§ç”Ÿ</h4><p>åœ¨æŸä¸ªå†…éƒ¨å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºæ—¶ï¼Œä¼šå°†çˆ¶çº§å‡½æ•°çš„æ´»åŠ¨å¯¹è±¡(VO)åŠ åˆ°å†…éƒ¨å‡½æ•°çš„ [[scope]]ä¸­ï¼Œå½¢æˆä½œç”¨åŸŸé“¾ï¼Œæ‰€ä»¥å³ä½¿çˆ¶çº§å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡é”€æ¯ï¼Œä½†æ˜¯å› ä¸ºå…¶æ´»åŠ¨å¯¹è±¡å®é™…ä¸Šè¿˜å­˜å‚¨åœ¨å†…å­˜ä¸­å¯è¢«å†…éƒ¨å‡½æ•°è®¿é—®åˆ°ï¼Œä»è€Œå®ç°äº†é—­åŒ…</p><h4 id="é—­åŒ…çš„åº”ç”¨">é—­åŒ…çš„åº”ç”¨</h4><ul><li><p>å‡½æ•°ä½œä¸ºå‚æ•°è¢«ä¼ é€’</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">bar</span>(baz);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params">fn</span>)&#123;</span><br><span class="line">  <span class="comment">// è¿™å°±æ˜¯é—­åŒ…</span></span><br><span class="line">  <span class="title function_">fn</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure></li><li><p>å‡½æ•°ä½œä¸ºè¿”å›å€¼è¢«è¿”å›</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> a = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fn = <span class="title function_">foo</span>()</span><br><span class="line"><span class="keyword">const</span> a = <span class="number">200</span></span><br><span class="line"><span class="title function_">fn</span>() <span class="comment">// 100</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p>é—­åŒ…ï¼šè‡ªç”±å˜é‡çš„æŸ¥æ‰¾ï¼Œæ˜¯åœ¨å‡½æ•°å®šä¹‰çš„åœ°æ–¹ï¼Œå‘ä¸Šçº§ä½œç”¨åŸŸæŸ¥æ‰¾ã€‚ä¸æ˜¯åœ¨æ‰§è¡Œçš„åœ°æ–¹</p></blockquote><h4 id="å¦‚ä½•è§£å†³ä¸‹é¢çš„å¾ªç¯è¾“å‡ºé—®é¢˜ï¼Ÿ">å¦‚ä½•è§£å†³ä¸‹é¢çš„å¾ªç¯è¾“å‡ºé—®é¢˜ï¼Ÿ</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i ++)&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timer</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå…¨éƒ¨è¾“å‡º6ï¼Ÿå¦‚ä½•æ”¹è¿›è®©å®ƒè¾“å‡º1,2,3,4,5ï¼Ÿ</p><p>å› ä¸ºsetTimeoutä¸ºå®ä»»åŠ¡ï¼Œç”±äºJSä¸­å•çº¿ç¨‹eventLoopæœºåˆ¶ï¼Œåœ¨ä¸»çº¿ç¨‹åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œåæ‰å»æ‰§è¡Œå®ä»»åŠ¡ï¼Œå› æ­¤å¾ªç¯ç»“æŸåsetTimeoutä¸­çš„å›è°ƒæ‰ä¾æ¬¡æ‰§è¡Œï¼Œè¾“å‡ºiçš„æ—¶å€™ï¼Œå½“å‰ä½œç”¨åŸŸæ²¡æœ‰ï¼Œå¾€ä¸Šä¸€å±‚æ‰¾ï¼Œå› ä¸ºå¾ªç¯å·²ç»“æŸï¼Œä¸Šå±‚ä½œç”¨åŸŸä¸­çš„iä¸º6ã€‚å› æ­¤ä¼šå…¨éƒ¨è¾“å‡º6</p><p>è§£å†³æ–¹æ³•ï¼š</p><ol><li><p>åˆ©ç”¨IIFEï¼Œæ¯æ¬¡forå¾ªç¯æ—¶ï¼ŒæŠŠæ­¤æ—¶çš„ i å˜é‡ä¼ é€’åˆ°å®šæ—¶å™¨ä¸­</p><blockquote><p><strong>IIFE</strong>ï¼ˆ ç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼ï¼‰æ˜¯ä¸€ä¸ªåœ¨å®šä¹‰æ—¶å°±ä¼šç«‹å³æ‰§è¡Œçš„ JavaScript å‡½æ•°</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>;i &lt;= <span class="number">5</span>;i++)&#123;</span><br><span class="line">  (<span class="keyword">function</span>(<span class="params">j</span>)&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timer</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(j)</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">  &#125;)(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç»™å®šæ—¶å™¨ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä½œä¸ºtimerå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‡½æ•°å‚æ•°</p><blockquote><p>å®šæ—¶å™¨ä»ç¬¬ä¸‰ä¸ªå‚æ•°å¼€å§‹æ˜¯é™„åŠ å‚æ•°ï¼Œä¸€æ—¦å®šæ—¶å™¨åˆ°æœŸï¼Œå®ƒä»¬ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™function</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params">j</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(j);</span><br><span class="line">    &#125;, <span class="number">0</span>, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ES6ä¸­çš„let</p><p>letæ˜¯å—çº§ä½œç”¨åŸŸï¼Œç”¨letåï¼Œå˜é‡åªåœ¨å®ƒæ‰€åœ¨çš„ä»£ç å—ç”Ÿæ•ˆï¼Œæ²¡æœ‰ä»€ä¹ˆä½œç”¨åŸŸé“¾äº†</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// i = 1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timer</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// i = 2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timer</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>); </span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// i = 3</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timer</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>); <span class="comment">// 3</span></span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥ä¾æ¬¡è¾“å‡º1,2,3,4,5</p></li></ol><h3 id="è°ˆè°ˆä½ å¯¹åŸå‹é“¾çš„ç†è§£">è°ˆè°ˆä½ å¯¹åŸå‹é“¾çš„ç†è§£</h3><ul><li><strong>åŸå‹å¯¹è±¡å’Œæ„é€ å‡½æ•°æœ‰ä½•å…³ç³»ï¼Ÿ</strong></li></ul><p>åœ¨JavaScriptä¸­ï¼Œæ¯å½“å®šä¹‰ä¸€ä¸ªå‡½æ•°æ•°æ®ç±»å‹ï¼ˆæ™®é€šå‡½æ•°ã€ç±»ï¼‰çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šè‡ªå¸¦ä¸€ä¸ªprototypeå±æ€§ï¼Œè¿™ä¸ªå±æ€§æŒ‡å‘å‡½æ•°çš„åŸå‹å¯¹è±¡</p><p>å¦å¤–ï¼Œè¿™ä¸ªåŸå‹å¯¹è±¡ä¼šæœ‰ä¸€ä¸ªconstructorå±æ€§æŒ‡å›å‡½æ•°æœ¬èº«</p><p>å½“å‡½æ•°è¢«newè°ƒç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°å°±ç§°ä¸ºäº†æ„é€ å‡½æ•°</p><p>newè°ƒç”¨ä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªå®ä¾‹å¯¹è±¡ä¼šè‡ªå¸¦ä¸€ä¸ª<code>__proto__</code>å±æ€§ï¼Œè¿™ä¸ªå±æ€§æŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡</p><p>å³<code>o.__proto__ === Foo.prototype</code></p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e27264b5519e45b083a64fb8934f7a88~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><ul><li>æè¿°ä¸€ä¸‹åŸå‹é“¾ï¼Ÿ</li></ul><p>JavaScriptå¯¹è±¡é€šè¿‡<code>__proto__</code>æŒ‡å‘çˆ¶ç±»åŸå‹å¯¹è±¡ï¼Œç›´åˆ°æŒ‡å‘Objectå¯¹è±¡ä¸ºæ­¢ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªåŸå‹æŒ‡å‘çš„é“¾æ¡ï¼Œå³åŸå‹é“¾</p><p>åŸå‹é“¾æœ€é¡¶å±‚çš„åŸå‹å¯¹è±¡å°±æ˜¯Objectçš„åŸå‹å¯¹è±¡</p><p>å¦å¤–ï¼Œæ£€æŸ¥å¯¹è±¡è‡ªèº«æ˜¯å¦åŒ…å«æŸå±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ hasOwnProperty()</p><p>ä½¿ç”¨ in çš„è¯ï¼Œå³ä½¿è‡ªèº«æ²¡æœ‰ï¼Œä½†æ˜¯åŸå‹é“¾ä¸­æœ‰ï¼Œä¹Ÿä¼šè¿”å›true</p><blockquote><p>ç»¿è‰²ç®­å¤´ï¼ŒåŸå‹é“¾</p><p><code>o.__proto__.__proto__.__proto__</code></p></blockquote><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e945e58756d643809d5e0c6c6d2d6797~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" style="zoom:67%;" /><blockquote><p>å¸¦ç€æ˜é‡‘çš„å„ç§æ–‡ç« ä¸€èµ·çœ‹,æ‰¾åˆ°è‡ªå·±æƒ³è¦çš„ç­”æ¡ˆ<br>åšäº†ä¸€ä»½å‰ç«¯é¢è¯•å¤ä¹ è®¡åˆ’ï¼Œä¿ç†Ÿï½<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/7061588533214969892">https://juejin.cn/post/7061588533214969892</a><br>ç¥åä¸‰-åŸç”ŸJSçµé­‚ä¹‹é—®, è¯·é—®ä½ èƒ½æ¥å¾—ä½å‡ ä¸ª<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/6844903974378668039">https://juejin.cn/post/6844903974378668039</a><br>å­—èŠ‚è·³åŠ¨æœ€çˆ±è€ƒçš„å‰ç«¯é¢è¯•é¢˜ï¼šJavaScript åŸºç¡€<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/6934500357091360781">https://juejin.cn/post/6934500357091360781</a><br>ã€ŒæŸ¥ç¼ºè¡¥æ¼ã€é€ä½  54 é“ JavaScript é¢è¯•é¢˜<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/6854573211443544078#comment">https://juejin.cn/post/6854573211443544078#comment</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ğŸ˜£é¢è¯•é¢˜-jsç¯‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TCPä¸‰æ¬¡æ¡æ‰‹</title>
      <link href="/2022/03/30/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/"/>
      <url>/2022/03/30/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/</url>
      
        <content type="html"><![CDATA[<h4 id="1-TCP-ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹">1. TCP ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ ?</h4><p>ï¼ˆé¦–å…ˆï¼Œä¸¤ä¸ªæ¦‚å¿µï¼šSYNï¼šåŒæ­¥æ ‡å¿—   ACKï¼šç¡®è®¤æ ‡å¿—ï¼‰</p><p>åˆšå¼€å§‹å®¢æˆ·ç«¯å¤„äº Closed çš„çŠ¶æ€ï¼ŒæœåŠ¡ç«¯å¤„äº Listen çŠ¶æ€ã€‚è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼š</p><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯ç»™æœåŠ¡å™¨å‘é€ä¸€ä¸ªSYNæŠ¥æ–‡ï¼Œå¹¶æŒ‡æ˜å®¢æˆ·ç«¯çš„åˆå§‹åŒ–åºåˆ—å· ISNã€‚æ­¤æ—¶å®¢æˆ·ç«¯å¤„äº SYN_SEND çŠ¶æ€</p><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡å™¨æ”¶åˆ° SYN æŠ¥æ–‡ä¹‹åï¼Œä¼šä»¥è‡ªå·±çš„ SYN æŠ¥æ–‡ä½œä¸ºåº”ç­”ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æŒ‡å®šäº†è‡ªå·±çš„åˆå§‹åŒ–åºåˆ—å·åºåˆ—å· ISNï¼ŒåŒæ—¶ä¼šæŠŠå®¢æˆ·ç«¯çš„ ISN + 1 ä½œä¸º ACK çš„å€¼ï¼Œè¡¨ç¤ºè‡ªå·±å·²ç»æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„ SYNï¼Œæ­¤æ—¶æœåŠ¡å™¨å¤„äº SYN_REVD çš„çŠ¶æ€</p><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯æ”¶åˆ° SYN æŠ¥æ–‡ä¹‹åï¼Œä¼šå›åº”ä¸€ä¸ª ACK æŠ¥æ–‡ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„æŠŠæœåŠ¡å™¨çš„ ISN + 1 ä½œä¸º ACK çš„å€¼ï¼Œè¡¨ç¤ºå·²ç»æ”¶åˆ°äº†æœåŠ¡ç«¯çš„ SYN æŠ¥æ–‡ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¤„äº established çŠ¶æ€</p><p>æœ€åæœåŠ¡å™¨æ”¶åˆ° ACK æŠ¥æ–‡ä¹‹åï¼Œä¹Ÿå¤„äº established çŠ¶æ€ï¼Œæ­¤æ—¶ï¼ŒåŒæ–¹å»ºç«‹è¿æ¥</p><h4 id="2-ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸¤æ¬¡ä¸è¡Œå—ï¼Ÿ">2. ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸¤æ¬¡ä¸è¡Œå—ï¼Ÿ</h4><p>å…¶å®è¿™æ˜¯ç”± TCP çš„è‡ªèº«ç‰¹ç‚¹å¯é ä¼ è¾“å†³å®šçš„ã€‚</p><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯å‘é€ç½‘ç»œåŒ…ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°äº†ï¼Œè¿™æ ·æœåŠ¡ç«¯å°±èƒ½å¾—å‡ºç»“è®ºï¼šå®¢æˆ·ç«¯çš„å‘é€èƒ½åŠ›ã€æœåŠ¡ç«¯çš„æ¥æ”¶èƒ½åŠ›æ˜¯æ­£å¸¸çš„</p><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡ç«¯å‘åŒ…ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°äº†ã€‚è¿™æ ·å®¢æˆ·ç«¯å°±èƒ½å¾—å‡ºç»“è®ºï¼šæœåŠ¡ç«¯çš„å‘é€èƒ½åŠ›ã€å®¢æˆ·ç«¯çš„æ¥æ”¶èƒ½åŠ›æ˜¯æ­£å¸¸çš„ã€‚</p><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯å‘åŒ…ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°äº†ã€‚è¿™æ ·æœåŠ¡ç«¯å°±èƒ½å¾—å‡ºç»“è®ºï¼šå®¢æˆ·ç«¯çš„æ¥æ”¶ã€å‘é€èƒ½åŠ›æ­£å¸¸ï¼ŒæœåŠ¡å™¨è‡ªå·±çš„å‘é€ï¼Œæ¥æ”¶èƒ½åŠ›ä¹Ÿæ­£å¸¸ã€‚</p><h4 id="3-ISN-æ˜¯å›ºå®šçš„å—">3. (ISN) æ˜¯å›ºå®šçš„å—?</h4><p>ä¸‰æ¬¡æ¡æ‰‹çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº¤æ¢ ISN ï¼Œä»¥ä¾¿è®©å¯¹æ–¹çŸ¥é“æ¥ä¸‹æ¥æ¥å—æ•°æ®çš„æ—¶å€™å¦‚ä½•æŒ‰åºåˆ—å·ç»„è£…æ•°æ®</p><p>å¦‚æœ ISN æ˜¯å›ºå®šçš„ï¼Œæ”»å‡»è€…å¾ˆå®¹æ˜“çŒœå‡ºåç»­çš„ç¡®è®¤å·ï¼Œå› æ­¤ ISN æ˜¯åŠ¨æ€ç”Ÿæˆçš„</p><h4 id="4-ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­å¯ä»¥æºå¸¦æ•°æ®å—">4. ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­å¯ä»¥æºå¸¦æ•°æ®å—</h4><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™å¯ä»¥æºå¸¦æ•°æ®ã€‚å› ä¸ºå‡å¦‚ç¬¬ä¸€æ¬¡æ¡æ‰‹å¯ä»¥æºå¸¦æ•°æ®çš„è¯ï¼Œå¦‚æœæœ‰äººè¦æ¶æ„æ”»å‡»æœåŠ¡å™¨ï¼Œé‚£ä»–æ¯æ¬¡éƒ½åœ¨ç¬¬ä¸€æ¬¡æ¡æ‰‹ä¸­çš„ SYN æŠ¥æ–‡ä¸­æ”¾å…¥å¤§é‡çš„æ•°æ®ï¼Œå› ä¸ºæ”»å‡»è€…æ ¹æœ¬å°±ä¸ç†æœåŠ¡å™¨çš„æ¥æ”¶ã€å‘é€èƒ½åŠ›æ˜¯å¦æ­£å¸¸ã€‚ç„¶åç–¯ç‹‚é‡å¤å‘ SYN æŠ¥æ–‡çš„è¯ï¼Œè¿™ä¼šè®©æœåŠ¡å™¨èŠ±è´¹å¾ˆå¤šæ—¶é—´ã€å†…å­˜ç©ºé—´æ¥æ¥æ”¶è¿™äº›æŠ¥æ–‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€æ¬¡æ¡æ‰‹å¯ä»¥æ”¾æ•°æ®çš„è¯ï¼Œå¯èƒ½ä¼šè®©æœåŠ¡å™¨æ›´åŠ å®¹æ˜“å—åˆ°æ”»å‡»ã€‚</p><p>è€Œå¯¹äºç¬¬ä¸‰æ¬¡çš„è¯ï¼Œå®¢æˆ·ç«¯å·²ç»å»ºç«‹èµ·è¿æ¥äº†ï¼Œå¹¶ä¸”ä¹Ÿå·²ç»çŸ¥é“æœåŠ¡å™¨çš„æ¥æ”¶ã€å‘é€èƒ½åŠ›æ˜¯æ­£å¸¸çš„ï¼Œæ‰€ä»¥æºå¸¦æ•°æ®ä¹Ÿæ²¡é—®é¢˜</p><h4 id="5-å››æ¬¡æŒ¥æ‰‹ï¼Ÿä¸ºä»€ä¹ˆè¦å››æ¬¡ï¼Ÿ">5. å››æ¬¡æŒ¥æ‰‹ï¼Ÿä¸ºä»€ä¹ˆè¦å››æ¬¡ï¼Ÿ</h4><p>åˆšå¼€å§‹åŒæ–¹éƒ½å¤„äº established çŠ¶æ€ï¼Œå‡å¦‚æ˜¯å®¢æˆ·ç«¯å…ˆå‘èµ·å…³é—­è¯·æ±‚ï¼Œåˆ™ï¼š</p><p>åˆšå¼€å§‹åŒæ–¹éƒ½å¤„äºestablishedçŠ¶æ€ï¼Œå‡å¦‚æ˜¯å®¢æˆ·ç«¯å…ˆå‘èµ·å…³é—­è¯·æ±‚</p><p>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªFINæŠ¥æ–‡ï¼ŒæŠ¥æ–‡ä¸­ä¼šæŒ‡å®šä¸€ä¸ªåºåˆ—å·ã€‚æ­¤æ—¶å®¢æˆ·ç«¯å¤„äºFIN_WAIT1çŠ¶æ€</p><p>ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡ç«¯æ”¶åˆ°FINä¹‹åï¼Œä¼šå‘é€ACKæŠ¥æ–‡ï¼Œä¸”æŠŠå®¢æˆ·ç«¯çš„åºåˆ—å·å€¼+1ä½œä¸ºACKæŠ¥æ–‡çš„åºåˆ—å·å€¼ï¼Œè¡¨æ˜å·²ç»æ”¶åˆ°å®¢æˆ·ç«¯çš„æŠ¥æ–‡äº†ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å¤„äºCLOSE_WAITçŠ¶æ€</p><p>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šå¦‚æœæœåŠ¡ç«¯ä¹Ÿæƒ³æ–­å¼€è¿æ¥äº†ï¼Œå’Œå®¢æˆ·ç«¯çš„ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ä¸€æ ·ï¼Œå‘é€FINæŠ¥æ–‡ï¼Œä¸”æŒ‡å®šä¸€ä¸ªåºåˆ—å·ã€‚æ­¤æ—¶æœåŠ¡ç«¯å¤„äºLAST_ACKçš„çŠ¶æ€</p><p>ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ° FIN ä¹‹åï¼Œä¸€æ ·å‘é€ä¸€ä¸ª ACK æŠ¥æ–‡ä½œä¸ºåº”ç­”ï¼Œä¸”æŠŠæœåŠ¡ç«¯çš„åºåˆ—å·å€¼ +1 ä½œä¸ºè‡ªå·± ACK æŠ¥æ–‡çš„åºåˆ—å·å€¼ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¤„äº TIME_WAIT çŠ¶æ€ã€‚éœ€è¦è¿‡ä¸€é˜µå­ä»¥ç¡®ä¿æœåŠ¡ç«¯æ”¶åˆ°è‡ªå·±çš„ACKæŠ¥æ–‡ä¹‹åæ‰ä¼šè¿›å…¥CLOSEDçŠ¶æ€ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ACKæŠ¥æ–‡ä¹‹åï¼Œå°±å¤„äºå…³é—­è¿æ¥äº†ï¼Œå¤„äºCLOSEDçŠ¶æ€ã€‚</p><h4 id="6-SYN-æ”»å‡»æ˜¯ä»€ä¹ˆï¼Ÿ">6. SYN æ”»å‡»æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>æœåŠ¡å™¨ç«¯çš„èµ„æºåˆ†é…æ˜¯åœ¨äºŒæ¬¡æ¡æ‰‹æ—¶åˆ†é…çš„ï¼Œè€Œå®¢æˆ·ç«¯çš„èµ„æºæ˜¯åœ¨å®Œæˆä¸‰æ¬¡æ¡æ‰‹æ—¶åˆ†é…çš„ï¼Œæ‰€ä»¥æœåŠ¡å™¨å®¹æ˜“å—åˆ° SYN æ´ªæ³›æ”»å‡»ã€‚SYN æ”»å‡»å°±æ˜¯ Client åœ¨çŸ­æ—¶é—´å†…ä¼ªé€ å¤§é‡ä¸å­˜åœ¨çš„ IP åœ°å€ï¼Œå¹¶å‘ Server ä¸æ–­åœ°å‘é€ SYN åŒ…ï¼ŒServer åˆ™å›å¤ç¡®è®¤åŒ…ï¼Œå¹¶ç­‰å¾… Client ç¡®è®¤ï¼Œç”±äºæºåœ°å€ä¸å­˜åœ¨ï¼Œå› æ­¤ Server éœ€è¦ä¸æ–­é‡å‘ç›´è‡³è¶…æ—¶ï¼Œè¿™äº›ä¼ªé€ çš„ SYN åŒ…å°†é•¿æ—¶é—´å ç”¨æœªè¿æ¥é˜Ÿåˆ—ï¼Œå¯¼è‡´æ­£å¸¸çš„ SYN è¯·æ±‚å› ä¸ºé˜Ÿåˆ—æ»¡è€Œè¢«ä¸¢å¼ƒï¼Œä»è€Œå¼•èµ·ç½‘ç»œæ‹¥å¡ç”šè‡³ç³»ç»Ÿç˜«ç—ªã€‚</p><h5 id="æ£€æµ‹-SYN-æ”»å‡»ï¼Ÿ">æ£€æµ‹ SYN æ”»å‡»ï¼Ÿ</h5><p>æ£€æµ‹ SYN æ”»å‡»éå¸¸çš„æ–¹ä¾¿ï¼Œå½“ä½ åœ¨æœåŠ¡å™¨ä¸Šçœ‹åˆ°å¤§é‡çš„åŠè¿æ¥çŠ¶æ€æ—¶ï¼Œç‰¹åˆ«æ˜¯æº IP åœ°å€æ˜¯éšæœºçš„ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥æ–­å®šè¿™æ˜¯ä¸€æ¬¡ SYN æ”»å‡»ã€‚</p><h5 id="å¸¸è§çš„é˜²å¾¡-SYN-æ”»å‡»çš„æ–¹æ³•ï¼Ÿ">å¸¸è§çš„é˜²å¾¡ SYN æ”»å‡»çš„æ–¹æ³•ï¼Ÿ</h5><p>ç¼©çŸ­è¶…æ—¶æ—¶é—´</p><p>å¢åŠ æœ€å¤§åŠè¿æ¥æ•°</p><p>è¿‡æ»¤ç½‘å…³é˜²æŠ¤</p><p>SYN cookiesæŠ€æœ¯</p><h4 id="7-ä»€ä¹ˆæ˜¯åŠè¿æ¥é˜Ÿåˆ—ï¼Ÿ">7. ä»€ä¹ˆæ˜¯åŠè¿æ¥é˜Ÿåˆ—ï¼Ÿ</h4><p>æœåŠ¡å™¨ç¬¬ä¸€æ¬¡æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN ä¹‹åï¼Œå°±ä¼šå¤„äº SYN_REVD çŠ¶æ€ï¼Œæ­¤æ—¶åŒæ–¹è¿˜æ²¡æœ‰å®Œå…¨å»ºç«‹èµ·è¿æ¥ï¼ŒæœåŠ¡å™¨ä¼šæŠŠæ­¤ç§çŠ¶æ€ä¸‹è¯·æ±‚è¿æ¥æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œè¿™ç§é˜Ÿåˆ—ç§°ä¹‹ä¸ºåŠè¿æ¥é˜Ÿåˆ—ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>var_let_conståŒºåˆ«</title>
      <link href="/2022/03/30/var-let-const%E5%8C%BA%E5%88%AB/"/>
      <url>/2022/03/30/var-let-const%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h3 id="varã€letã€const-ç›¸å…³">varã€letã€const ç›¸å…³</h3><p>varï¼ˆES5ï¼‰let,constï¼ˆES6ï¼‰</p><h4 id="1-ä½œç”¨åŸŸï¼Ÿ"><strong>1. ä½œç”¨åŸŸï¼Ÿ</strong></h4><p>ç®€å•æ¥è¯´ï¼Œä½œç”¨åŸŸå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åœ°ç›˜ï¼Œå¤–å±‚ä½œç”¨åŸŸæ— æ³•è¯»å–å†…å±‚ä½œç”¨åŸŸçš„å˜é‡ï¼Œä½†æ˜¯å†…å±‚ä½œç”¨åŸŸå¯ä»¥è®¿é—®å¤–å±‚ä½œç”¨åŸŸçš„å˜é‡æˆ–è€…å®šä¹‰å¤–å±‚ä½œç”¨åŸŸçš„åŒåå˜é‡ã€‚</p><h4 id="2-var-å˜é‡æå‡ï¼Ÿ-var-ç‰¹ç‚¹ï¼Ÿ"><strong>2. var å˜é‡æå‡ï¼Ÿ var ç‰¹ç‚¹ï¼Ÿ</strong></h4><p>æ— è®ºåœ¨å…¨å±€ä½œç”¨åŸŸè¿˜æ˜¯åœ¨å±€éƒ¨ä½œç”¨åŸŸä¸­ï¼Œä½¿ç”¨ var å…³é”®å­—å£°æ˜çš„å˜é‡éƒ½ä¼šè¢«æå‡åˆ°è¯¥ä½œç”¨åŸŸçš„æœ€é¡¶éƒ¨ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<strong>å˜é‡æå‡</strong></p><p>åœ¨ä»£ç é¢„ç¼–è¯‘çš„æ—¶å€™ï¼ŒJavaScript å¼•æ“ä¼šè‡ªåŠ¨å°†æ‰€æœ‰ä»£ç é‡Œé¢ä»¥var å…³é”®å­—å£°æ˜çš„è¯­å¥æå‡åˆ°<strong>å½“å‰ä½œç”¨åŸŸ</strong>çš„é¡¶ç«¯</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">&quot;jack&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> name;</span><br><span class="line">    name = <span class="string">&quot;jack&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name) <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;jack&quot;</span></span><br></pre></td></tr></table></figure><h4 id="var-çš„ç‰¹ç‚¹"><strong>var çš„ç‰¹ç‚¹</strong></h4><ul><li><p>å­˜åœ¨å˜é‡æå‡</p></li><li><p>åœ¨å˜é‡æœªèµ‹å€¼æ—¶ï¼Œå˜é‡ä¸º undefined</p></li><li><p>ä¸€ä¸ªå˜é‡å¯ä»¥å¤šæ¬¡å£°æ˜ï¼Œåé¢çš„å£°æ˜ä¼šè¦†ç›–å‰é¢çš„å£°æ˜</p></li><li><p>åœ¨å‡½æ•°ä¸­ä½¿ç”¨ var å£°æ˜å˜é‡çš„æ—¶å€™ï¼Œè¯¥å˜é‡æ˜¯å±€éƒ¨çš„ï¼ˆå› ä¸ºåœ¨ä½¿ç”¨ var å£°æ˜å˜é‡æ—¶ï¼Œå˜é‡ä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°æœ€æ¥è¿‘çš„ä¸Šä¸‹æ–‡ã€‚åœ¨å‡½æ•°ä¸­ï¼Œæœ€æ¥è¿‘çš„ä¸Šä¸‹æ–‡å°±æ˜¯å‡½æ•°çš„å±€éƒ¨ä¸Šä¸‹æ–‡ï¼‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">num1, num2</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> sum = num1 + num2;</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> result = <span class="title function_">add</span>(<span class="number">10</span>, <span class="number">20</span>) <span class="comment">// 30</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum)  <span class="comment">// æŠ¥é”™ sum is not defined</span></span><br></pre></td></tr></table></figure><p><strong>å¦‚æœå‡½æ•°å†…ä¸ä½¿ç”¨ var å£°æ˜ï¼Œè¯¥å˜é‡æ˜¯å…¨å±€çš„</strong>ï¼Œsum è¢«æ·»åŠ åˆ°å…¨å±€ä¸Šä¸‹æ–‡ï¼ˆwindowï¼‰window.sum</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">num1, num2</span>) &#123;</span><br><span class="line">    sum = num1 + num2;</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> result = <span class="title function_">add</span>(<span class="number">10</span>, <span class="number">20</span>) <span class="comment">// 30</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum)  <span class="comment">// 30</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="3-let"><strong>3. let</strong></h4><ul><li><p>let ä¸å­˜åœ¨å˜é‡æå‡ï¼Œlet å£°æ˜å˜é‡å‰ï¼Œè¯¥å˜é‡ä¸èƒ½ä½¿ç”¨(æš‚æ—¶æ€§æ­»åŒº)</p></li><li><p>let ä¸ºå—çº§ä½œç”¨åŸŸï¼Œæ‰€æœ‰å¤–é¢çš„è¯­å¥å—è®¿é—®ä¸åˆ°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(value)  <span class="comment">// æŠ¥é”™</span></span><br><span class="line"><span class="keyword">let</span> value = <span class="string">&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>let <strong>ä¸å…è®¸é‡å¤å£°æ˜</strong>ï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸­æŸä¸ªå˜é‡å·²ç»å­˜åœ¨ï¼Œå†æ¬¡ä½¿ç”¨ let å…³é”®å­—å£°æ˜çš„è¯ä¼šæŠ¥é”™</p></li></ul><h4 id="4-const"><strong>4. const</strong></h4><p>ä¸ let æ²¡ä»€ä¹ˆå¤§ä¸åŒ</p><ul><li><p>const å£°æ˜çš„æ˜¯å¸¸é‡ï¼Œå¸¸é‡å°±æ˜¯ä¸€æ—¦å®šä¹‰å®Œå°±ä¸èƒ½ä¿®æ”¹çš„å€¼ã€‚</p></li><li><p>å¿…é¡»åˆå§‹åŒ–å€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p></li><li><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šconst å˜é‡ä¸èƒ½å†è¢«é‡æ–°èµ‹å€¼ä¸ºå…¶ä»–å¼•ç”¨å€¼ï¼Œä½†å¯¹è±¡çš„é”®ä¸å—é™åˆ¶</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸æ˜¯å˜é‡çš„å€¼ä¸èƒ½æ”¹åŠ¨ï¼Œè€Œæ˜¯å˜é‡æŒ‡å‘çš„é‚£ä¸ªå†…å­˜åœ°å€ä¸å¾—æ”¹åŠ¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123;&#125;</span><br><span class="line">obj1 = &#123;&#125; <span class="comment">// æŠ¥é”™ï¼Œä¸èƒ½ç»™å¸¸é‡èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2 = &#123; <span class="attr">name</span>: <span class="string">&quot;jack&quot;</span> &#125;</span><br><span class="line">obj2.<span class="property">name</span> = <span class="string">&quot;tony&quot;</span>  <span class="comment">// æ²¡é—®é¢˜</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="5-æš‚æ—¶æ€§æ­»åŒºï¼Ÿ"><strong>5. æš‚æ—¶æ€§æ­»åŒºï¼Ÿ</strong></h4><p>å¦‚æœåŒºå—ä¸­å­˜åœ¨ let å’Œ const å‘½ä»¤ï¼Œä»¥è¿™ä¸ªå‘½ä»¤å£°æ˜çš„å˜é‡ä»ä¸€å¼€å§‹å°±å½¢æˆäº†å°é—­ä½œç”¨åŸŸã€‚å‡¡æ˜¯åœ¨å£°æ˜ä¹‹å‰å°±æ˜¯ç”¨è¿™äº›å˜é‡ï¼Œå°±ä¼šæŠ¥é”™</p><p>æ€»ä¹‹ï¼Œåœ¨ä»£ç å—å†…ï¼Œä½¿ç”¨ let å‘½ä»¤å£°æ˜å˜é‡ä¹‹å‰ï¼Œè¯¥å˜é‡éƒ½æ˜¯ä¸å¯ç”¨çš„ã€‚è¿™åœ¨è¯­æ³•ä¸Šï¼Œç§°ä¸º â€œæš‚æ—¶æ€§æ­»åŒºâ€(temporal dead zone ç®€ç§° TDZ )</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">   <span class="comment">// TDZ å¼€å§‹</span></span><br><span class="line">    tmp = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(tmp); <span class="comment">// æŠ¥é”™</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> tmp; <span class="comment">// TDZ ç»“æŸ</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(tmp)</span><br><span class="line">    </span><br><span class="line">    tmp = <span class="number">123</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(tmp); <span class="comment">// 123</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œåœ¨ let å‘½ä»¤å£°æ˜å˜é‡ tmp ä¹‹å‰ï¼Œéƒ½å±äºå˜é‡ tmp çš„æ­»åŒº</p><h4 id="6-åœ¨-for-å¾ªç¯ä¸­ä½¿ç”¨-varï¼Œlet-çš„åŒºåˆ«"><strong>6. åœ¨ for å¾ªç¯ä¸­ä½¿ç”¨ varï¼Œlet çš„åŒºåˆ«</strong></h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">&#125;,<span class="number">100</span>)</span><br><span class="line">&#125;  <span class="comment">// è¾“å‡ºå…¨æ˜¯10</span></span><br><span class="line"><span class="comment">// å› ä¸º i æ˜¯å…¨å±€å˜é‡ï¼Œæœ€åè®¿é—®çš„éƒ½æ˜¯å…¨å±€å˜é‡</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">&#125;,<span class="number">100</span>)</span><br><span class="line">&#125;  <span class="comment">// 0123456789; </span></span><br><span class="line"><span class="comment">// i æ˜¯å±€éƒ¨å˜é‡ï¼Œæ¯æ¬¡å¾ªç¯æ”¹å˜çš„æ˜¯å¯¹å±€éƒ¨å˜é‡èµ‹å€¼</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>04_å®ç°call_apply_bind</title>
      <link href="/2022/03/30/04_%E6%89%8B%E5%86%99call-apply-bind/"/>
      <url>/2022/03/30/04_%E6%89%8B%E5%86%99call-apply-bind/</url>
      
        <content type="html"><![CDATA[<h3 id="callã€applyã€bind-å®ç°">callã€applyã€bind å®ç°</h3><h4 id="1-call-å®ç°">1. call å®ç°</h4><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ç³»ç»Ÿçš„ call æ–¹æ³•ä¸»è¦å®ç°äº†ä»€ä¹ˆ</p><ul><li>æ‰§è¡Œäº†å‡½æ•°</li><li>æ”¹å˜äº† this çš„æŒ‡å‘</li></ul><p>å…ˆçœ‹ç³»ç»Ÿçš„callæ–¹æ³•</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fooå‡½æ•°è¢«æ‰§è¡Œ&quot;</span>, <span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">num1, num2</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sumå‡½æ•°è¢«æ‰§è¡Œ&quot;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  <span class="keyword">return</span> num1 + num2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. ä¼ å…¥å¯¹è±¡</span></span><br><span class="line">foo.<span class="title function_">call</span>(&#123;&#125;) </span><br><span class="line"><span class="comment">// 2. ä¼ å…¥null/undefined</span></span><br><span class="line">foo.<span class="title function_">call</span>(<span class="literal">null</span>) <span class="comment">// thisè‡ªåŠ¨æ›¿æ¢ä¸ºæŒ‡å‘å…¨å±€å¯¹è±¡</span></span><br><span class="line"><span class="comment">// 3. ä¼ å…¥å…¶ä»–ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œå¸ƒå°”å€¼ç­‰ç­‰</span></span><br><span class="line">foo.<span class="title function_">call</span>(<span class="string">&quot;abc&quot;</span>) <span class="comment">// this æŒ‡å‘ç›¸åº”çš„å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> res = sum.<span class="title function_">call</span>(<span class="string">&quot;123&quot;</span>, <span class="number">10</span>,<span class="number">20</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res) <span class="comment">// 30</span></span><br></pre></td></tr></table></figure><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b796e59e07f4560acdbfe38abe4ad79~tplv-k3u1fbpfcp-watermark.image?" alt="img0328_01.png"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å®ç°è‡ªå·±çš„callï¼ˆä¸»è¦æ˜¯å®ç°æ€è·¯ï¼Œæ²¡æœ‰æŠŠæ‰€æœ‰çš„è¾¹ç¼˜æ¡ä»¶è€ƒè™‘å®Œå…¨ï¼Œä½†æ˜¯åŸºæœ¬éƒ½æœ‰ï¼‰</p><p><strong>1.1 è®©å‡½æ•°æ‰§è¡Œèµ·æ¥</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mycall</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> fn = <span class="variable language_">this</span> <span class="comment">// thiså°±æ˜¯æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å‡½æ•° foo,æŠŠå®ƒä¿å­˜åˆ° fn</span></span><br><span class="line">    <span class="comment">// æ¥ç€è®©å‡½æ•°æ‰§è¡Œèµ·æ¥</span></span><br><span class="line">    <span class="title function_">fn</span>() <span class="comment">// ä½†æ˜¯è¿™é‡Œæ˜¯ç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼ŒthisæŒ‡å‘window</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo.<span class="title function_">mycall</span>() <span class="comment">// è¿™é‡Œç›¸å½“äºmycalléšå¼ç»‘å®šäº†foo,å› æ­¤ mycallä¸­çš„thiså°±æ˜¯foo</span></span><br></pre></td></tr></table></figure><p><strong>2.2 æ˜¾å¼ç»‘å®šthis</strong></p><p>ç°åœ¨æˆ‘ä»¬è¦ç»‘å®šæˆ‘ä»¬æŒ‡å®šçš„this</p><ul><li>å…ˆçœ‹ç¬¬ä¸€ç§ï¼š<code>foo.mycall(&#123;name: 'hello'&#125;)</code>ï¼Œç»‘å®šä¸€ä¸ªå¯¹è±¡</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mycall</span> = <span class="keyword">function</span>(<span class="params">thisArg</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> fn = <span class="variable language_">this</span> <span class="comment">// thiså°±æ˜¯æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å‡½æ•° foo,æŠŠå®ƒä¿å­˜åˆ° fn</span></span><br><span class="line">  <span class="comment">// æ¥ç€è°ƒç”¨è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">  <span class="comment">// æˆ‘ä»¬çš„ç›®çš„æ˜¯è®©å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ç»‘å®šthisArgè¿™ä¸ªå¯¹è±¡æ‰§è¡Œå³thisArg.fn()(éšå¼ç»‘å®š)</span></span><br><span class="line">  <span class="comment">// ä½†æ˜¯ç°åœ¨ thisArgæ²¡æœ‰ fn è¿™ä¸ªå±æ€§å‘€ï¼Œæ€ä¹ˆè°ƒç”¨å‘¢</span></span><br><span class="line">  <span class="comment">// æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™thisArgæ·»åŠ ä¸€ä¸ªå±æ€§ fn, å€¼å°±æ˜¯æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">  thisArg.<span class="property">fn</span> = fn</span><br><span class="line">  <span class="comment">// ç„¶åå†è°ƒç”¨</span></span><br><span class="line">  thisArg.<span class="title function_">fn</span>()</span><br><span class="line">  <span class="comment">// ä½†æ˜¯è¿™æ ·æˆ‘ä»¬ä¸å°±è®©thisArgå¤šå‡ºæ¥ä¸€ä¸ªå±æ€§fnäº†å—ï¼Ÿ</span></span><br><span class="line">  <span class="comment">// æ²¡å…³ç³»ï¼Œå‡½æ•°æ‰§è¡Œå®Œ åˆ æ‰å°±å¥½</span></span><br><span class="line">  <span class="keyword">delete</span> thisArg.<span class="property">fn</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„ä¸æ˜¯å¯¹è±¡å‘¢ï¼Ÿé‚£å°±ä¸èƒ½ç»™thisArgæ·»åŠ å±æ€§å•¦</p><p><code>foo.mycall(&quot;123&quot;)</code></p></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mycall</span> = <span class="keyword">function</span>(<span class="params">thisArg</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> fn = <span class="variable language_">this</span> </span><br><span class="line">  <span class="comment">// æ‰€ä»¥è¦æŠŠ thisArg è½¬æˆå¯¹è±¡ç±»å‹(Objectæ„é€ å‡½æ•°å¯ä»¥å°†ç»™å®šçš„å€¼åŒ…è£…ä¸ºä¸€ä¸ªæ–°å¯¹è±¡)</span></span><br><span class="line">  thisArg = <span class="title class_">Object</span>(thisArg)</span><br><span class="line">  thisArg.<span class="property">fn</span> = fn</span><br><span class="line">  thisArg.<span class="title function_">fn</span>()</span><br><span class="line">  <span class="keyword">delete</span> thisArg.<span class="property">fn</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœä¼ å…¥çš„æ˜¯ null / undefined å‘¢</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mycall</span> = <span class="keyword">function</span>(<span class="params">thisArg</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> fn = <span class="variable language_">this</span> </span><br><span class="line">  <span class="comment">// å¦‚æœthisArgä¼ å…¥çš„æ˜¯ undefined / null, åº”è¯¥è®©å®ƒæŒ‡å‘å…¨å±€å¯¹è±¡</span></span><br><span class="line">  <span class="comment">// æ‰€ä»¥æˆ‘ä»¬è¦åšä¸€ä¸ªåˆ¤æ–­</span></span><br><span class="line">  thisArg = (thisArg !== <span class="literal">null</span> &amp;&amp; thisArg !== <span class="literal">undefined</span>) ? <span class="title class_">Object</span>(thisArg) : <span class="variable language_">window</span></span><br><span class="line">  thisArg.<span class="property">fn</span> = fn</span><br><span class="line">  thisArg.<span class="title function_">fn</span>()</span><br><span class="line">  <span class="keyword">delete</span> thisArg.<span class="property">fn</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.3 æ¥ä¸‹æ¥è¦è€ƒè™‘å‚æ•°äº†</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// restè¿ç®—ç¬¦</span></span><br><span class="line"><span class="comment">// ...args ä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°åˆ—è¡¨ç»„åˆåˆ°ä¸€ä¸ªæ•°ç»„ [num1,num2]</span></span><br><span class="line"><span class="comment">// ...args ä¹Ÿå¯ä»¥å±•å¼€æ•°ç»„, ç›¸å½“äºå¯¹æ•°ç»„çš„ä¸€ä¸ªéå†</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mycall</span> = <span class="keyword">function</span>(<span class="params">thisArg, ...args</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> fn = <span class="variable language_">this</span> </span><br><span class="line">  thisArg = (thisArg !== <span class="literal">null</span> &amp;&amp; thisArg !== <span class="literal">undefined</span>) ? <span class="title class_">Object</span>(thisArg) : <span class="variable language_">window</span></span><br><span class="line">  thisArg.<span class="property">fn</span> = fn</span><br><span class="line">  <span class="comment">// æŠŠå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œå¹¶ç”¨ result æ¥æ”¶å‡½æ•°æ‰§è¡Œå®Œçš„ç»“æœ(ä¾‹å­ä¸­å°±æ˜¯sumå‡½æ•°æ‰§è¡Œå®Œçš„ç»“æœ)</span></span><br><span class="line">  <span class="keyword">let</span> result = thisArg.<span class="title function_">fn</span>(...args) <span class="comment">// ...[num1, num2] --&gt; num1, num2</span></span><br><span class="line">  <span class="keyword">delete</span> thisArg.<span class="property">fn</span></span><br><span class="line">  <span class="comment">// æœ€åæŠŠç»“æœè¿”å›å‡ºå»</span></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼ŒåŸºæœ¬çš„callå°±å·²ç»å®ç°äº†</p><p>æ£€éªŒä¸€ä¸‹å­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">foo.<span class="title function_">mycall</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;hello&#x27;</span>&#125;)</span><br><span class="line">foo.<span class="title function_">mycall</span>(<span class="string">&quot;123&quot;</span>)</span><br><span class="line">foo.<span class="title function_">mycall</span>(<span class="literal">undefined</span>)</span><br><span class="line">foo.<span class="title function_">mycall</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">sum.<span class="title function_">mycall</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;hello&quot;</span>&#125;, <span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"><span class="keyword">let</span> res1 = sum.<span class="title function_">mycall</span>(<span class="number">123</span>, <span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res1);</span><br></pre></td></tr></table></figure><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6d4b709b153349f7afbde95a6b9af35c~tplv-k3u1fbpfcp-watermark.image?" alt="image0328_02.png style=&quot;zoom:70%;&quot;"></p><h4 id="2-apply-å®ç°">2. apply å®ç°</h4><p>è·Ÿ call ç±»ä¼¼ï¼Œåªä¸è¿‡å‚æ•°çš„å¤„ç†æœ‰ä¸åŒ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myapply</span> = <span class="keyword">function</span>(<span class="params">thisArg, argsArray</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> fn = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">  thisArg = (thisArg !== <span class="literal">null</span> &amp;&amp; thisArg !== <span class="literal">undefined</span>) ? <span class="title class_">Object</span>(thisArg) : <span class="variable language_">window</span></span><br><span class="line"></span><br><span class="line">  thisArg.<span class="property">fn</span> = fn</span><br><span class="line">  <span class="comment">// æ²¡æœ‰ä¼ argArray,é‚£ä¹ˆargsArrayé»˜è®¤ä¸º undefined,é‚£ä¹ˆå°±ä¸èƒ½ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦äº†</span></span><br><span class="line">  <span class="comment">// æ‰€ä»¥å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°, é‚£ä¹ˆæŠŠå®ƒåˆå§‹åŒ–ä¸º [], ç©ºæ•°ç»„ä¹Ÿæ˜¯å¯ä»¥å±•å¼€çš„ ...[]</span></span><br><span class="line">  argsArray = argsArray || []</span><br><span class="line">  <span class="keyword">let</span> result = thisArg.<span class="title function_">fn</span>(...argsArray)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> thisArg.<span class="property">fn</span></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-bind-å®ç°">3. bind å®ç°</h4><p>bind éœ€è¦æˆ‘ä»¬è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå¹¶ä¸”è°ƒç”¨ bind çš„æ—¶å€™ä¸éœ€è¦æ‰§è¡Œå‡½æ•°</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mybind</span> = <span class="keyword">function</span>(<span class="params">thisArg, ...args</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fn = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">  thisArg = (thisArg !== <span class="literal">null</span> &amp;&amp; thisArg !== <span class="literal">undefined</span>) ? <span class="title class_">Object</span>(thisArg) : <span class="variable language_">window</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">newFn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    thisArg.<span class="property">fn</span> = fn</span><br><span class="line">    <span class="keyword">let</span> result = thisArg.<span class="title function_">fn</span>(...args)</span><br><span class="line">    <span class="keyword">delete</span> thisArg.<span class="property">fn</span></span><br><span class="line">    <span class="comment">// è¿”å›ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// bind éœ€è¦è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•° ä½ ä¹Ÿå¯ä»¥ç›´æ¥ return function() &#123;...&#125;</span></span><br><span class="line">  <span class="keyword">return</span> newFn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§ä½“ä¸Šä¹Ÿå·®ä¸å¤šï¼Œä½†æˆ‘ä»¬å¯ä»¥å°±ä¸‹é¢è¿™ç§æƒ…å†µæ”¹è¿›ä¸€ä¸‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum2</span>(<span class="params">num1, num2, num3, num4</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sum2å‡½æ•°è¢«æ‰§è¡Œ&quot;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  <span class="keyword">return</span> num1 + num2 + num3 + num4</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newSum2 = sum2.<span class="title function_">mybind</span>(<span class="string">&quot;abc&quot;</span>, <span class="number">10</span>,<span class="number">20</span>) <span class="comment">// ç»‘å®šçš„æ—¶å€™ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">newSum2</span>(<span class="number">30</span>,<span class="number">40</span>)); <span class="comment">// ä½¿ç”¨æ–°è¿”å›çš„å‡½æ•°çš„æ—¶å€™å†ä¼ å…¥å‰©ä½™çš„å‚æ•°</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠä¸¤æ¬¡ä¼ å…¥çš„å‚æ•°åˆå¹¶èµ·æ¥ï¼Œå†è°ƒç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mybind</span> = <span class="keyword">function</span>(<span class="params">thisArg, ...args</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> fn = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">  thisArg = (thisArg !== <span class="literal">null</span> &amp;&amp; thisArg !== <span class="literal">undefined</span>) ? <span class="title class_">Object</span>(thisArg) : <span class="variable language_">window</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">newFn</span>(<span class="params">...newArgs</span>) &#123;</span><br><span class="line">    <span class="comment">// åˆå¹¶ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line">    <span class="keyword">let</span> allArgs = [...args, ...newArgs]</span><br><span class="line"></span><br><span class="line">    thisArg.<span class="property">fn</span> = fn</span><br><span class="line">    <span class="keyword">let</span> result = thisArg.<span class="title function_">fn</span>(...allArgs)</span><br><span class="line">    <span class="keyword">delete</span> thisArg.<span class="property">fn</span></span><br><span class="line">    <span class="comment">// è¿”å›ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newFn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼ŒåŸºæœ¬çš„bindä¹Ÿå®ç°äº†</p><p>æœ€åè¯´æ˜ä¸€ä¸‹ï¼Œå®ç°çš„æ€è·¯æ˜¯è¿™æ ·ï¼Œä½†æ˜¯æ–¹æ³•ä¸å”¯ä¸€çš„ï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›è¾¹è¾¹è§’è§’æ²¡æœ‰è€ƒè™‘åˆ°çš„è¯ï¼Œå¯ä»¥è‡ªå·±æ·»åŠ è¿›å»</p>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>03_JSå‡½æ•°çš„thisæŒ‡å‘</title>
      <link href="/2022/03/30/03_JS%E5%87%BD%E6%95%B0%E7%9A%84this%E6%8C%87%E5%90%91/"/>
      <url>/2022/03/30/03_JS%E5%87%BD%E6%95%B0%E7%9A%84this%E6%8C%87%E5%90%91/</url>
      
        <content type="html"><![CDATA[<h3 id="JS-å‡½æ•°çš„-this-æŒ‡å‘">JS å‡½æ•°çš„ this æŒ‡å‘</h3><h4 id="1-this-åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹çš„æŒ‡å‘">1. this åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹çš„æŒ‡å‘</h4><p>åœ¨æµè§ˆå™¨ä¸­ï¼Œthisåœ¨å…¨å±€ä½œç”¨åŸŸä¸‹æŒ‡å‘ window</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) <span class="comment">// window</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> title = <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">title</span>) <span class="comment">// hello</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">title</span>) <span class="comment">// hello</span></span><br></pre></td></tr></table></figure><h4 id="2-this-çš„å››ä¸ªç»‘å®šè§„åˆ™">2. this çš„å››ä¸ªç»‘å®šè§„åˆ™</h4><h4 id="2-1-è§„åˆ™ä¸€ï¼šé»˜è®¤ç»‘å®š">2.1 è§„åˆ™ä¸€ï¼šé»˜è®¤ç»‘å®š</h4><p>åœ¨<strong>ç‹¬ç«‹å‡½æ•°è°ƒç”¨</strong>çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨é»˜è®¤ç»‘å®š</p><p>ç‹¬ç«‹å‡½æ•°è°ƒç”¨ç®€å•æ¥è¯´å°±æ˜¯å®ƒæ²¡æœ‰ç»‘å®šåˆ°æŸä¸ªå¯¹è±¡ä¸Šè¿›è¡Œè°ƒç”¨ï¼Œç®€å•çœ‹å‡ ä¸ªä¾‹å­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¾‹1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>() <span class="comment">// window</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¾‹2</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">foo1</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo3</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">foo2</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo3</span>() <span class="comment">// window</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¾‹3</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">  <span class="attr">foo</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = obj.<span class="property">foo</span></span><br><span class="line"><span class="title function_">bar</span>() <span class="comment">// window</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œéƒ½æ˜¯æ²¡æœ‰è¢«ç»‘å®šåˆ°å¯¹è±¡ä¸­è°ƒç”¨çš„ï¼Œæ‰€ä»¥ this éƒ½æŒ‡å‘ window</p><h4 id="2-2-è§„åˆ™äºŒï¼šéšå¼ç»‘å®š">2.2 è§„åˆ™äºŒï¼šéšå¼ç»‘å®š</h4><p>å‡½æ•°é€šè¿‡æŸä¸ªå¯¹è±¡è¿›è¡Œè°ƒç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè¢« js å¼•æ“ç»‘å®šåˆ°å‡½æ•°ä¸­çš„ this é‡Œ</p><p>ä¸‹é¢çœ‹å‡ ä¸ªä¾‹å­ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1.</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">  <span class="attr">fn</span>: foo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">fn</span>() <span class="comment">// obj å¯¹è±¡</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 2.</span></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">  <span class="attr">bar</span>: obj1.<span class="property">foo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj2.<span class="title function_">bar</span>() <span class="comment">// obj2å¯¹è±¡</span></span><br></pre></td></tr></table></figure><h4 id="2-3-æ˜¾å¼ç»‘å®š">2.3 æ˜¾å¼ç»‘å®š</h4><p>åˆ©ç”¨ callï¼Œapplyï¼Œbindæ‰‹åŠ¨æŒ‡å®š this çš„ç»‘å®šï¼Œè¿™ç§æ˜ç¡®çš„ç»‘å®šç§°ä¸ºæ˜¾å¼ç»‘å®š</p><p><strong>(1) callï¼Œapply</strong></p><p>callï¼Œapply éƒ½æ˜¯å¯ä»¥è°ƒç”¨å‡½æ•°çš„</p><p>fn.call(è‡ªå®šçš„thisæŒ‡å‘ï¼Œå‚æ•°1ï¼Œå‚æ•°2)  fn.apply(thisæŒ‡å‘ï¼Œ[å‚æ•°1ï¼Œå‚æ•°2])</p><p>ä¸¤è€…çš„åŒºåˆ«åœ¨äºä¼ å‚çš„æ–¹å¼ï¼Œä¸‹é¢ä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ call ä¼ å…¥å‚æ•°åˆ—è¡¨ï¼Œapplyæ˜¯æ•°ç»„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">num1, num2, num3</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(num1 + num2 + num3, <span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;hello&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sum.<span class="title function_">call</span>(<span class="string">&quot;123&quot;</span>, <span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>) <span class="comment">// æ‰‹åŠ¨è®©thisæŒ‡å‘&quot;123&quot;</span></span><br><span class="line">sum.<span class="title function_">apply</span>(obj, [<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>]) <span class="comment">// æ‰‹åŠ¨è®©thisæŒ‡å‘obj</span></span><br></pre></td></tr></table></figure><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc769b40fc274f32b225566e2b2dec07~tplv-k3u1fbpfcp-watermark.image?" alt="image-20220327114447032.png"></p><p><strong>(2) bind</strong></p><p>bindä¸ä¼šè°ƒç”¨å‡½æ•°ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">num1, num2, num3</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(num1 + num2 + num3, <span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// var obj = &#123;</span></span><br><span class="line"><span class="comment">//   title: &quot;hello&quot;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// sum.call(&quot;123&quot;, 20,30,40) // æ‰‹åŠ¨è®©thisæŒ‡å‘&quot;123&quot;</span></span><br><span class="line"><span class="comment">// sum.apply(obj, [20,30,40]) // æ‰‹åŠ¨è®©thisæŒ‡å‘obj</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newSum = sum.<span class="title function_">bind</span>(<span class="string">&#x27;aaa&#x27;</span>,<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>)</span><br><span class="line"><span class="title function_">newSum</span>() <span class="comment">// 60 String &#123;&#x27;aaa&#x27;&#125;</span></span><br></pre></td></tr></table></figure><p>å’¦ï¼ŸnewSum ä¸ä¹Ÿæ˜¯ç‹¬ç«‹å‡½æ•°è°ƒç”¨å—ï¼Œæ€ä¹ˆä¸æŒ‡å‘ window äº†</p><p>è¿™å°±æ˜¯é»˜è®¤ç»‘å®šå’Œæ˜¾å¼ç»‘å®šbindçš„å†²çªï¼Œæ˜¾å¼ç»‘å®šçš„ä¼˜å…ˆçº§æ›´é«˜ï¼</p><h4 id="2-4-newç»‘å®š">2.4 newç»‘å®š</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="comment">// å®é™…ä¸Šè¿™é‡Œæ˜¯ä¼šæŠŠ this è¿”å›å‡ºå»çš„,å³return thisï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">  <span class="comment">// this = åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// new ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;jenny&quot;</span>, <span class="number">12</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;tony&quot;</span>, <span class="number">15</span>)</span><br></pre></td></tr></table></figure><h4 id="3-ä¸€äº›å†…ç½®å‡½æ•°çš„-this-ç»‘å®š">3. ä¸€äº›å†…ç½®å‡½æ•°çš„ this ç»‘å®š</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šè°ƒç”¨ä¸€äº› JS çš„å†…ç½®å‡½æ•°ï¼Œè¿™äº›å‡½æ•°è¦æ±‚æˆ‘ä»¬ä¼ å…¥å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸ä¼šè‡ªå·±å»è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œè€Œæ˜¯ JS å†…éƒ¨ä¼šå¸®åŠ©æˆ‘ä»¬æ‰§è¡Œã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œthis çš„ç»‘å®šå°±è·Ÿå†…éƒ¨å¸®æˆ‘ä»¬æŒ‡å‘å‡½æ•°çš„æ–¹å¼æœ‰å…³ç³»äº†ã€‚</p><p>çœ‹å‡ ä¸ªä¾‹å­å§</p><h5 id="3-1-setTimeout">3.1 setTimeout</h5><p>å†…éƒ¨é€šè¿‡ apply è°ƒç”¨å‡½æ•°ï¼Œå¹¶ç»‘å®šäº†thiså¯¹è±¡ï¼Œæ˜¯window</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// window</span></span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure><h5 id="3-2-æ•°ç»„çš„å†…ç½®å‡½æ•°-forEach">3.2 æ•°ç»„çš„å†…ç½®å‡½æ•° forEach</h5><p>é»˜è®¤æƒ…å†µä¸‹ä¼ å…¥çš„å‡½æ•°æ˜¯è‡ªåŠ¨è°ƒç”¨å‡½æ•°ï¼ˆé»˜è®¤ç»‘å®šï¼‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> names = [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>,<span class="string">&#x27;ccc&#x27;</span>]</span><br><span class="line">names.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// ä¸‰æ¬¡ window</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é€šè¿‡ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ”¹å˜thisæŒ‡å‘</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> names = [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>,<span class="string">&#x27;ccc&#x27;</span>]</span><br><span class="line">names.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// ä¸‰æ¬¡ &#x27;obj&#x27;</span></span><br><span class="line">&#125;, <span class="string">&#x27;obj&#x27;</span>)</span><br></pre></td></tr></table></figure><h5 id="3-3-ç‚¹å‡»äº‹ä»¶">3.3 ç‚¹å‡»äº‹ä»¶</h5><p>åœ¨å‘ç”Ÿç‚¹å‡»æ—¶ï¼Œå›è°ƒå‡½æ•°è¢«è°ƒç”¨ï¼Œä¼šå°† this ç»‘å®šåˆ°è¯¥å‡½æ•°ä¸­</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> box = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.box&quot;</span>)</span><br><span class="line">box.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// boxå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¯´ï¼ŒæŸäº›å†…ç½®çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¾ˆéš¾ç¡®å®šå®ƒå†…éƒ¨æ˜¯å¦‚ä½•è°ƒç”¨ä¼ å…¥çš„å›è°ƒå‡½æ•°çš„ï¼Œå¯ä»¥è‡ªå·±æµ‹è¯•ä¸€ä¸‹ï¼Œè®°ä¸€ä¸‹ï¼Œçœ‹æºç å½“ç„¶æ›´å¥½å•¦</p><h4 id="4-å‡ ä¸ªè§„åˆ™çš„ä¼˜å…ˆçº§">4. å‡ ä¸ªè§„åˆ™çš„ä¼˜å…ˆçº§</h4><p>ä»é«˜åˆ°ä½ï¼šnewç»‘å®š &gt; æ˜¾å¼ç»‘å®š(bind) &gt; éšå¼ç»‘å®š &gt; é»˜è®¤ç»‘å®š</p><p>newç»‘å®šå’Œcallï¼Œapplyæ˜¯ä¸å…è®¸åŒæ—¶ä½¿ç”¨çš„ï¼Œï¼ˆæ¯•ç«Ÿéƒ½ä¼šè°ƒç”¨å‡½æ•°ï¼‰ï¼Œæ‰€ä»¥ä¸å­˜åœ¨è°çš„ä¼˜å…ˆçº§æ›´é«˜</p><ul><li><p>æ˜¾å¼ç»‘å®šé«˜äºéšå¼ç»‘å®š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ˜¾å¼ç»‘å®šå’Œéšå¼ç»‘å®š</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;obj&#x27;</span>,</span><br><span class="line">  <span class="attr">foo</span>: foo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">foo</span>() <span class="comment">// obj å¯¹è±¡</span></span><br><span class="line">obj.<span class="property">foo</span>.<span class="title function_">call</span>(<span class="string">&quot;aaa&quot;</span>) <span class="comment">// &#x27;aaa&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>new ç»‘å®šé«˜äºéšå¼ç»‘å®š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">  <span class="attr">foo</span>: foo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> obj.<span class="title function_">foo</span>() <span class="comment">// è¾“å‡º foo å¯¹è±¡è€Œä¸æ˜¯ obj</span></span><br></pre></td></tr></table></figure></li><li><p>new ç»‘å®šé«˜äºbind</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, title);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = foo.<span class="title function_">bind</span>(obj) <span class="comment">// æ˜¾å¼ç»‘å®šobj</span></span><br><span class="line"><span class="keyword">new</span> <span class="title function_">bar</span>() <span class="comment">// æ‰“å° fooå¯¹è±¡ è€Œä¸æ˜¯ obj</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="5-ä¸¤ç§ç‰¹æ®Šæƒ…å†µ">5. ä¸¤ç§ç‰¹æ®Šæƒ…å†µ</h4><p><strong>5.1 åœ¨æ˜¾å¼ç»‘å®šä¸­ä¼ å…¥ null æˆ– undefined</strong></p><p>è¿™æ—¶å€™ï¼Œæ˜¾å¼ç»‘å®šä¼šè¢«å¿½ç•¥ï¼Œä½¿ç”¨é»˜è®¤è§„åˆ™</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">  <span class="attr">foo</span>: foo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo.<span class="title function_">call</span>(obj) <span class="comment">// obj</span></span><br><span class="line">foo.<span class="title function_">call</span>(<span class="literal">null</span>) <span class="comment">// window</span></span><br><span class="line">foo.<span class="title function_">call</span>(<span class="literal">undefined</span>) <span class="comment">// window</span></span><br></pre></td></tr></table></figure><p><strong>5.2 é—´æ¥å‡½æ•°å¼•ç”¨</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;obj1&#x27;</span>,</span><br><span class="line">  <span class="attr">foo</span>: foo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;obj2&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªèµ‹å€¼çš„ç»“æœ, æ˜¯ foo å‡½æ•°</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((obj2.<span class="property">foo</span> = obj1.<span class="property">foo</span>)); <span class="comment">// fooå‡½æ•°</span></span><br><span class="line"><span class="comment">// è¿™ç§å«åšé—´æ¥å‡½æ•°å¼•ç”¨ï¼Œæ˜¯ä¼šæŠŠèµ‹å€¼è¯­å¥å³è¾¹çš„ç»“æœè¿”å›ï¼Œç„¶åç›´æ¥è°ƒç”¨ï¼Œæ˜¯ç‹¬ç«‹å‡½æ•°è°ƒç”¨</span></span><br><span class="line">(obj2.<span class="property">foo</span> = obj1.<span class="property">foo</span>)() <span class="comment">// ç›¸å½“äºç›´æ¥è°ƒç”¨ foo å‡½æ•°ï¼Œæ‰€ä»¥æ˜¯é»˜è®¤ç»‘å®šï¼Œè¾“å‡ºwindow</span></span><br></pre></td></tr></table></figure><h4 id="6-ç®­å¤´å‡½æ•°çš„this">6. ç®­å¤´å‡½æ•°çš„this</h4><p>ç®­å¤´å‡½æ•°ä¸ç»‘å®š thisï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ²¡æœ‰è‡ªå·±çš„ thisï¼Œè€Œæ˜¯æ ¹æ®å¤–å±‚ä½œç”¨åŸŸæ¥å†³å®šthis</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">foo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// åœ¨è¿™é‡Œthisçš„å¤–å±‚ä½œç”¨åŸŸå°±æ˜¯ window</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">foo</span>: foo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">foo</span>() <span class="comment">// window</span></span><br><span class="line">obj.<span class="property">foo</span>.<span class="title function_">call</span>(<span class="string">&quot;aaa&quot;</span>) <span class="comment">// window</span></span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼š</p><p>ä½¿ç”¨<strong>setTimeout</strong>æ¨¡æ‹Ÿä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠè¿”å›æ¥çš„æ•°æ®ä¿å­˜åˆ° data ä¸­ï¼Œè¯¥æ€ä¹ˆåš</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">getData</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// obj å¯¹è±¡</span></span><br><span class="line">      <span class="comment">// è¿™é‡Œçš„ this ä¸æ˜¯åº”è¯¥æŒ‡å‘windowå—ï¼Ÿ</span></span><br><span class="line">      <span class="comment">// å¦‚æœæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯æ™®é€šçš„å‡½æ•° function() &#123;console.log(this)&#125;</span></span><br><span class="line">      <span class="comment">// é‚£ä¹ˆè¿™ä¸ªå‡½æ•°åœ¨å†…éƒ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šç»‘å®šthisï¼Œå°±æ˜¯window</span></span><br><span class="line">      <span class="comment">// ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨äº†ç®­å¤´å‡½æ•°ï¼Œå®ƒä¸ç»‘å®šthisï¼Œä¼šå¾€ä¸Šå±‚ä½œç”¨åŸŸä¸­æ‰¾åˆ°å¯¹åº”çš„this</span></span><br><span class="line">      <span class="comment">// æ‰€ä»¥æ‰¾åˆ°äº† obj</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">data</span> = <span class="string">&#x27;hello&#x27;</span> <span class="comment">// --&gt; obj.data = &quot;hello&quot;</span></span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="title function_">getData</span>()</span><br></pre></td></tr></table></figure><h4 id="7-this-çš„é¢è¯•é¢˜">7. this çš„é¢è¯•é¢˜</h4><p>å¦‚æœæ¯é¢˜éƒ½ä¼šäº†ï¼Œé‚£ä¹ˆ this ç»‘å®šçš„é—®é¢˜ï¼Œå°±æ˜¯ä½ çš„é€åˆ†é¢˜è€Œä¸æ˜¯é€å‘½é¢˜äº†å“ˆå“ˆå“ˆ</p><p>å»ºè®®æŠŠæˆ‘çš„ç­”æ¡ˆè·Ÿæ³¨é‡Šéƒ½åˆ æ‰ï¼Œè‡ªå·±ä¸€ç‚¹ç‚¹ç†æ¸…å“¦</p><p><strong>é¢˜ä¸€</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;window&quot;</span>; <span class="comment">// window.name = &quot;window&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;person&quot;</span>,</span><br><span class="line">  <span class="attr">sayName</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sayName</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> sss = person.<span class="property">sayName</span>;</span><br><span class="line">  <span class="title function_">sss</span>(); <span class="comment">// window å¾ˆæ˜æ˜¾æ˜¯ç‹¬ç«‹å‡½æ•°è°ƒç”¨,æ²¡æœ‰ä¸ä»»ä½•å¯¹è±¡å…³è”</span></span><br><span class="line">  person.<span class="title function_">sayName</span>(); <span class="comment">// person éšå¼ç»‘å®š,ä¸personå…³è”</span></span><br><span class="line">  (person.<span class="property">sayName</span>)(); <span class="comment">// person åŒä¸Š(åŠ æ‹¬å·åªæ˜¯ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªæ•´ä½“)</span></span><br><span class="line">  <span class="comment">// console.log((b = person.sayName)); // è¿™é‡Œå®é™…ä¸Šå°±æ˜¯sayNameè¿™ä¸ªå‡½æ•°</span></span><br><span class="line">  (b = person.<span class="property">sayName</span>)(); <span class="comment">// é—´æ¥å‡½æ•°å¼•ç”¨ï¼Œæ˜¯ç‹¬ç«‹å‡½æ•°è°ƒç”¨, è¾“å‡º window</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sayName</span>();</span><br></pre></td></tr></table></figure><p><strong>é¢˜äºŒ</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;window&#x27;</span></span><br><span class="line"><span class="keyword">var</span> person1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;person1&#x27;</span>,</span><br><span class="line">  <span class="attr">foo1</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">foo2</span>: <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>),</span><br><span class="line">  <span class="attr">foo3</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">foo4</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = &#123; <span class="attr">name</span>: <span class="string">&#x27;person2&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éšå¼ç»‘å®šperson1å¯¹è±¡</span></span><br><span class="line">person1.<span class="title function_">foo1</span>(); <span class="comment">// person1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾å¼ç»‘å®šperson2</span></span><br><span class="line">person1.<span class="property">foo1</span>.<span class="title function_">call</span>(person2);  <span class="comment">// person2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®­å¤´å‡½æ•°ä¸é€‚ç”¨ä»»ä½•è§„åˆ™, å‘ä¸Šå±‚ä½œç”¨åŸŸä¸­æ‰¾this</span></span><br><span class="line">person1.<span class="title function_">foo2</span>(); <span class="comment">// window</span></span><br><span class="line">person1.<span class="property">foo2</span>.<span class="title function_">call</span>(person2); <span class="comment">// window</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// person1.foo3()è¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åç‹¬ç«‹è°ƒç”¨</span></span><br><span class="line">person1.<span class="title function_">foo3</span>()(); <span class="comment">// window</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// person1.foo3.call(person2) è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åç‹¬ç«‹è°ƒç”¨</span></span><br><span class="line">person1.<span class="property">foo3</span>.<span class="title function_">call</span>(person2)(); <span class="comment">// window</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// person1.foo3()è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åæ˜¾å¼ç»‘å®šåˆ° person2</span></span><br><span class="line">person1.<span class="title function_">foo3</span>().<span class="title function_">call</span>(person2); <span class="comment">// person2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// person1.foo4()è¿”å›ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œå¾€ä¸Šå±‚ä½œç”¨åŸŸæ‰¾ï¼Œæ‰¾åˆ°foo4ä¸­ç»‘å®šçš„this,æ˜¯ person1</span></span><br><span class="line">person1.<span class="title function_">foo4</span>()(); <span class="comment">// person1</span></span><br><span class="line"><span class="comment">// foo4æ˜¾å¼ç»‘å®šåˆ° person2</span></span><br><span class="line">person1.<span class="property">foo4</span>.<span class="title function_">call</span>(person2)(); <span class="comment">// person2</span></span><br><span class="line"><span class="comment">// person1.foo4()è¿”å›ç®­å¤´å‡½æ•°ï¼Œå¾€ä¸Šå±‚ä½œç”¨åŸŸæ‰¾</span></span><br><span class="line">person1.<span class="title function_">foo4</span>().<span class="title function_">call</span>(person2); <span class="comment">// person1</span></span><br></pre></td></tr></table></figure><p><strong>é¢˜ä¸‰</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;window&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span> (name) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">foo1</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">foo2</span> = <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>),</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">foo3</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">foo4</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;person1&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;person2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">person1.<span class="title function_">foo1</span>() <span class="comment">// person1 éšå¼ç»‘å®š</span></span><br><span class="line">person1.<span class="property">foo1</span>.<span class="title function_">call</span>(person2) <span class="comment">// person2 æ˜¾å¼ç»‘å®š</span></span><br><span class="line"></span><br><span class="line">person1.<span class="title function_">foo2</span>() <span class="comment">// person1 éšå¼ç»‘å®š</span></span><br><span class="line"><span class="comment">// ç®­å¤´å‡½æ•°ä¸é€‚ç”¨æ˜¾å¼ç»‘å®šè§„åˆ™ï¼Œç›´æ¥å‘ä¸Šå±‚ä½œç”¨åŸŸæ‰¾</span></span><br><span class="line">person1.<span class="property">foo2</span>.<span class="title function_">call</span>(person2) <span class="comment">// person1 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// person1.foo3() è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å…¨å±€è°ƒç”¨</span></span><br><span class="line">person1.<span class="title function_">foo3</span>()() <span class="comment">// window</span></span><br><span class="line">person1.<span class="property">foo3</span>.<span class="title function_">call</span>(person2)() <span class="comment">// window // åŒç†</span></span><br><span class="line"><span class="comment">// person1.foo3() è¿”å›çš„å‡½æ•°ä½¿ç”¨ .call æ˜¾å¼ç»‘å®š person2</span></span><br><span class="line">person1.<span class="title function_">foo3</span>().<span class="title function_">call</span>(person2) <span class="comment">//person2 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// person1.foo4() è¿”å›ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œå†è°ƒç”¨ï¼Œå‘ä¸Šå±‚ä½œç”¨åŸŸæ‰¾</span></span><br><span class="line">person1.<span class="title function_">foo4</span>()() <span class="comment">// person1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// person1.foo4.call(person2) è¿”å›ç®­å¤´å‡½æ•°ï¼Œå¹¶ä¸”foo4æ˜¾å¼ç»‘å®šthisä¸ºperson2</span></span><br><span class="line"><span class="comment">// å†è°ƒç”¨è¿™ä¸ªç®­å¤´å‡½æ•°ï¼Œå‘ä¸Šæ‰¾å°±æ‰¾åˆ° foo4 çš„this ä¸ºperson2</span></span><br><span class="line">person1.<span class="property">foo4</span>.<span class="title function_">call</span>(person2)() <span class="comment">// person2 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// person1.foo4() è¿”å›ç®­å¤´å‡½æ•°,ä¸é€‚ç”¨æ˜¾å¼ç»‘å®šï¼Œå‘ä¸Šæ‰¾åˆ° person1</span></span><br><span class="line"><span class="comment">// æ³¨æ„è¿™é‡Œè·Ÿä¸Šé¢çš„åŒºåˆ«ï¼Œè¿™é‡Œçš„foo4è°ƒç”¨ä¸æ˜¯.callè°ƒç”¨çš„ï¼Œè€Œæ˜¯.foo4()è¿™æ ·è°ƒç”¨çš„</span></span><br><span class="line"><span class="comment">// callæ˜¯æ¥è°ƒç”¨ç®­å¤´å‡½æ•°çš„ï¼Œè€Œç®­å¤´å‡½æ•°ä¸é€‚ç”¨æ˜¾å¼ç»‘å®šï¼Œå‘ä¸Šæ‰¾åˆ°çš„æ˜¯person1</span></span><br><span class="line">person1.<span class="title function_">foo4</span>().<span class="title function_">call</span>(person2) <span class="comment">// person1</span></span><br></pre></td></tr></table></figure><p><strong>é¢˜å››</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;window&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span> (name) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">obj</span> = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;obj&#x27;</span>,</span><br><span class="line">    <span class="attr">foo1</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">foo2</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;person1&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;person2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// person1.obj.foo1()è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å…¨å±€ä¸­è°ƒç”¨</span></span><br><span class="line">person1.<span class="property">obj</span>.<span class="title function_">foo1</span>()() <span class="comment">// window</span></span><br><span class="line"><span class="comment">// person1.obj.foo1.call(person2) è¿”å›ä¸€ä¸ªå‡½æ•° åœ¨å…¨å±€ä¸­è°ƒç”¨</span></span><br><span class="line">person1.<span class="property">obj</span>.<span class="property">foo1</span>.<span class="title function_">call</span>(person2)() <span class="comment">// window</span></span><br><span class="line"><span class="comment">// person1.obj.foo1() è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ˜¾å¼ç»‘å®šperson2</span></span><br><span class="line">person1.<span class="property">obj</span>.<span class="title function_">foo1</span>().<span class="title function_">call</span>(person2) <span class="comment">// person2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®­å¤´å‡½æ•°è°ƒç”¨ï¼Œå‘ä¸Šæ‰¾åˆ° foo2 ä¸­çš„thisæ˜¯obj</span></span><br><span class="line">person1.<span class="property">obj</span>.<span class="title function_">foo2</span>()() <span class="comment">// obj</span></span><br><span class="line"><span class="comment">// foo2è°ƒç”¨çš„æ—¶å€™æ˜¾å¼ç»‘å®šperson2ï¼Œç®­å¤´å‡½æ•°å‘ä¸Šå±‚æ‰¾åˆ°çš„å°±æ˜¯person2</span></span><br><span class="line">person1.<span class="property">obj</span>.<span class="property">foo2</span>.<span class="title function_">call</span>(person2)() <span class="comment">// person2</span></span><br><span class="line"><span class="comment">// ç®­å¤´å‡½æ•°ä¸é€‚ç”¨ æ˜¾å¼ç»‘å®šï¼Œå‘ä¸Šæ‰¾æ‰¾åˆ° obj</span></span><br><span class="line">person1.<span class="property">obj</span>.<span class="title function_">foo2</span>().<span class="title function_">call</span>(person2) <span class="comment">// obj</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02_JSå†…å­˜ç®¡ç†å’Œé—­åŒ…</title>
      <link href="/2022/03/30/02_JS%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%92%8C%E9%97%AD%E5%8C%85/"/>
      <url>/2022/03/30/02_JS%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%92%8C%E9%97%AD%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€JS-çš„å†…å­˜ç®¡ç†">ä¸€ã€JS çš„å†…å­˜ç®¡ç†</h2><h4 id="1-JS-çš„å†…å­˜ç®¡ç†">1. JS çš„å†…å­˜ç®¡ç†</h4><ul><li>JavaScript ä¼šåœ¨å®šä¹‰å˜é‡æ—¶ä¸ºæˆ‘ä»¬åˆ†é…å†…å­˜</li><li>å†…å­˜åˆ†é…çš„æ–¹å¼æ˜¯ä¸€æ ·çš„å—ï¼Ÿ<ul><li>JS å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹å†…å­˜çš„åˆ†é…ï¼Œä¼šåœ¨æ‰§è¡Œæ—¶ç›´æ¥åœ¨æ ˆç©ºé—´è¿›è¡Œåˆ†é…</li><li>JS å¯¹äºå¤æ‚æ•°æ®ç±»å‹å†…å­˜çš„åˆ†é…ï¼Œä¼šåœ¨å †å†…å­˜ä¸­å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œå¹¶ä¸”å°†è¿™å—ç©ºé—´çš„åœ°å€ä¿å­˜åœ¨æ ˆç©ºé—´</li></ul></li></ul><h4 id="2-JS-çš„åƒåœ¾å›æ”¶">2. JS çš„åƒåœ¾å›æ”¶</h4><ul><li>åƒåœ¾å›æ”¶çš„è‹±æ–‡æ˜¯ Garbage Collectionï¼Œç®€ç§° GC</li><li>å¯¹äºé‚£äº›ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œæˆ‘ä»¬éƒ½ç§°ä¹‹ä¸ºåƒåœ¾ï¼Œå®ƒéœ€è¦è¢«å›æ”¶ï¼Œä»¥é‡Šæ”¾å‡ºæ›´å¤šçš„å†…å­˜ç©ºé—´</li><li>JavaScriptçš„è¿è¡Œç¯å¢ƒ jså¼•æ“éƒ½ä¼šå†…å­˜åƒåœ¾å›æ”¶å™¨</li></ul><h4 id="3-å¸¸è§çš„ä¸¤ä¸ª-GC-ç®—æ³•">3. å¸¸è§çš„ä¸¤ä¸ª GC ç®—æ³•</h4><p>GCæ€ä¹ˆçŸ¥é“å“ªäº›å¯¹è±¡æ˜¯ä¸å†ä½¿ç”¨çš„å‘¢ï¼Ÿè¿™é‡Œå°±è¦ç”¨åˆ° GC ç®—æ³•äº†</p><h5 id="3-1-å¼•ç”¨è®¡æ•°"><strong>3.1 å¼•ç”¨è®¡æ•°</strong></h5><ul><li><p>å½“ä¸€ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨æŒ‡å‘å®ƒçš„æ—¶å€™ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨å°± +1ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ä¸º 0 æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è¢«å›æ”¶æ‰</p></li><li><p>ä½†æ˜¯è¿™ä¸ªç®—æ³•æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼Œå°±æ˜¯ä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;<span class="attr">friend</span>: obj2&#125;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;<span class="attr">friend</span>: obj1&#125;</span><br></pre></td></tr></table></figure></li></ul><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5ae097e453a43cc84b2ff11211ac823~tplv-k3u1fbpfcp-watermark.image?" alt="image-20220326000211839.png"></p><hr><h5 id="3-2-æ ‡è®°æ¸…é™¤">3.2 æ ‡è®°æ¸…é™¤</h5><ul><li>è¿™ä¸ªç®—æ³•æ˜¯è®¾ç½®ä¸€ä¸ªæ ¹å¯¹è±¡ï¼ˆroot objectï¼‰ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šå®šæœŸä»è¿™ä¸ªæ ¹å¼€å§‹ï¼Œæ‰¾åˆ°æ‰€æœ‰ä»æ ¹å¼€å§‹æœ‰å¼•ç”¨åˆ°çš„å¯¹è±¡ï¼Œå¯¹äºé‚£äº›æ²¡æœ‰å¼•ç”¨åˆ°çš„å¯¹è±¡ï¼Œå°±è®¤ä¸ºæ˜¯ä¸å¯ç”¨çš„å¯¹è±¡</li></ul><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d16ee47dfe794e74a2cef9747d341bcc~tplv-k3u1fbpfcp-watermark.image?" alt="image-20220326000504460.png"></p><p>â€‹å›¾ä¸­ä» A å¼€å§‹æ‰¾ï¼Œæ‰¾åˆ° D çš„æ—¶å€™ç»“æŸï¼ŒM,Nä¸å¯è¾¾ï¼Œè¢«è®¤ä¸ºæ˜¯ä¸å¯ç”¨çš„å¯¹è±¡</p><ul><li>è¿™ä¸ªç®—æ³•å¯ä»¥å¾ˆå¥½çš„è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜</li></ul><p>æ³¨ï¼šJS å¼•æ“æ¯”è¾ƒå¹¿æ³›é‡‡ç”¨çš„å°±æ˜¯æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œå½“ç„¶ç±»ä¼¼äº V8 å¼•æ“ä¸ºäº†è¿›è¡Œæ›´å¥½çš„ä¼˜åŒ–ï¼Œåœ¨ç®—æ³•çš„å®ç°ç»†èŠ‚ä¸Šä¹Ÿä¼šç»“åˆä¸€äº›å…¶ä»–çš„ç®—æ³•</p><h2 id="äºŒã€JSä¸­çš„é—­åŒ…">äºŒã€JSä¸­çš„é—­åŒ…</h2><h4 id="1-ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ">1. ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ</h4><p>JavaScript ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœå®ƒè®¿é—®äº†å¤–å±‚ä½œç”¨åŸŸçš„å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚</p><p>MDNä¸­çš„ä¸€ä¸ªè§£é‡Šï¼šä¸€ä¸ªå‡½æ•°å’Œå¯¹å…¶å‘¨å›´çŠ¶æ€ï¼ˆlexical environmentï¼Œè¯æ³•ç¯å¢ƒï¼‰çš„å¼•ç”¨æ†ç»‘åœ¨ä¸€èµ·ï¼ˆæˆ–è€…è¯´å‡½æ•°è¢«å¼•ç”¨åŒ…å›´ï¼‰ï¼Œè¿™æ ·çš„ç»„åˆå°±æ˜¯é—­åŒ…ï¼ˆclosureï¼‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">&quot;foo&quot;</span></span><br><span class="line">    <span class="keyword">var</span> age = <span class="number">18</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(name)<span class="comment">// nameè®¿é—®äº†å¤–å±‚ä½œç”¨åŸŸçš„å˜é‡name</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(age) <span class="comment">// ageè®¿é—®äº†å¤–å±‚ä½œç”¨åŸŸçš„å˜é‡age</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bar <span class="comment">// è¿”å›ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = <span class="title function_">foo</span>()</span><br><span class="line"><span class="title function_">fn</span>()</span><br></pre></td></tr></table></figure><h4 id="2-é—­åŒ…çš„è®¿é—®è¿‡ç¨‹">2. é—­åŒ…çš„è®¿é—®è¿‡ç¨‹</h4><p>ç®€å•æè¿°ä¸Šé¢å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="attr">GO</span>: &#123;<span class="attr">foo</span>:åœ°å€<span class="number">1</span>, <span class="attr">fn</span>:<span class="literal">undefined</span>&#125;</span><br><span class="line"><span class="number">2.</span> æ‰§è¡Œä»£ç ï¼š</span><br><span class="line">   <span class="number">2.1</span> <span class="title function_">foo</span>():åªè¦æ‰§è¡Œå‡½æ•°ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</span><br><span class="line">     (<span class="number">1</span>)<span class="attr">VO</span>: &#123;<span class="variable constant_">AO</span>å¯¹è±¡:&#123;<span class="attr">name</span>: <span class="literal">undefined</span>;<span class="attr">age</span>:<span class="literal">undefined</span>;<span class="attr">bar</span>:åœ°å€<span class="number">2</span>&#125;&#125;</span><br><span class="line">        <span class="attr">scopechain</span>:[<span class="variable constant_">VO</span>+parent scopes]</span><br><span class="line"> (<span class="number">2</span>)å¼€å§‹æ‰§è¡Œä»£ç  &#123;<span class="attr">name</span>: <span class="string">&quot;foo&quot;</span>, <span class="attr">age</span>:<span class="number">18</span>;&#125; <span class="keyword">return</span> baråœ°å€<span class="number">2</span></span><br><span class="line"> (<span class="number">3</span>)fooæ‰§è¡Œå®Œæ¯•</span><br><span class="line">   <span class="number">2.2</span> <span class="attr">fn</span>: baråœ°å€<span class="number">2</span></span><br><span class="line">   <span class="number">2.3</span> <span class="title function_">fn</span>(),å³æ‰§è¡Œ baråœ°å€<span class="number">2</span>ä¸­çš„å‡½æ•°æ‰§è¡Œä½“,åˆ›å»ºbarçš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</span><br><span class="line">      (<span class="number">1</span>)&#123;<span class="attr">AO</span>:&#123;&#125;,scopechain&#125;</span><br><span class="line">       (<span class="number">2</span>)æ‰§è¡Œä»£ç :</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(name):åœ¨è‡ªå·±çš„<span class="variable constant_">AO</span>ä¸­æ‰¾ä¸åˆ°ï¼Œé€šè¿‡ä½œç”¨åŸŸé“¾æ‰¾åˆ°fooçš„<span class="variable constant_">AO</span>ï¼Œæ‰¾åˆ°<span class="attr">name</span>:<span class="string">&quot;foo&quot;</span>,è¾“å‡º <span class="string">&quot;foo&quot;</span></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(age)åŒç†</span><br><span class="line">   (<span class="number">3</span>)<span class="title function_">fn</span>()æ‰§è¡Œå®Œæ¯•</span><br><span class="line"><span class="number">3.</span>æ‰§è¡Œå®Œæ¯•</span><br><span class="line">åœ°å€<span class="number">1</span>:fooå‡½æ•°å¯¹è±¡: &#123;<span class="attr">parentScope</span>: <span class="variable constant_">GO</span>&#125;,&#123;fooå‡½æ•°çš„æ‰§è¡Œä½“&#125;</span><br><span class="line">åœ°å€<span class="number">2</span>:barå‡½æ•°å¯¹è±¡: &#123;<span class="attr">parentScope</span>: fooçš„<span class="variable constant_">AO</span>å¯¹è±¡&#125;,&#123;barå‡½æ•°çš„æ‰§è¡Œä½“&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼šfooå‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¸æ˜¯åº”è¯¥å¼¹å‡ºæ ˆå—ï¼Œfooçš„AOå¯¹è±¡ä¸åº”è¯¥è¢«é‡Šæ”¾äº†å—ï¼Ÿæ€ä¹ˆbarè¿˜èƒ½æ‰¾åˆ° nameï¼Œæ‰¾åˆ° age å‘¢ï¼Ÿ</p><p>çœ‹ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0596bf34709b420e83d0b18255b35a8e~tplv-k3u1fbpfcp-watermark.image?" alt="image-20220326190828378.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œå®Œ foo å‡½æ•°çš„æ—¶å€™ï¼Œè¿”å›çš„æ˜¯ bar å‡½æ•°(æˆ–è€…è¯´æ˜¯barçš„åœ°å€)ï¼Œç„¶åå› ä¸º <code>fn = foo()</code>ï¼ŒæŠŠè¿™ä¸ªåœ°å€èµ‹å€¼ç»™äº†fnï¼Œå› æ­¤ä¼šå­˜åœ¨ fn æŒ‡å‘ barå‡½æ•°å¯¹è±¡ï¼Œè€Œbarçš„çˆ¶ä½œç”¨åŸŸåˆæŒ‡å‘äº† foo çš„AOå¯¹è±¡ï¼Œå› æ­¤fooçš„AOæ˜¯ä¸ä¼šè¢«é‡Šæ”¾çš„</p><h4 id="3-é—­åŒ…çš„å†…å­˜æ³„æ¼">3. é—­åŒ…çš„å†…å­˜æ³„æ¼</h4><p><strong>ä¸ºä»€ä¹ˆæ€»è¯´é—­åŒ…æ˜¯æœ‰å†…å­˜æ³„æ¼çš„å‘¢ï¼Ÿä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ</strong></p><p>æ‹¿ä¸Šé¢çš„ä¾‹å­è¯´ï¼Œå¦‚æœåç»­æˆ‘ä»¬ä¸ä¼šå†ç”¨ fooï¼Œbar è¿™äº›å‡½æ•°äº†ï¼Œä½†æ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹ fn å˜é‡å¯¹barå‡½æ•°å¯¹è±¡æœ‰å¼•ç”¨ï¼Œè€Œbarçš„ä½œç”¨åŸŸä¸­AOå¯¹fooçš„AOæœ‰å¼•ç”¨ï¼Œæ‰€ä»¥ä¼šé€ æˆè¿™äº›å†…å­˜éƒ½æ˜¯æ— æ³•è¢«é‡Šæ”¾çš„ã€‚</p><p>è¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å†…å­˜æ³„æ¼ï¼Œå…¶å®å°±æ˜¯åˆšæ‰çš„å¼•ç”¨é“¾ä¸­çš„å¯¹è±¡æ— æ³•é‡Šæ”¾</p><p><strong>æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</strong></p><p>å¾ˆç®€å•ï¼Œè®¾ç½® fn = nullï¼Œå°±ä¸å†å¯¹ bar å‡½æ•°å¯¹è±¡æœ‰å¼•ç”¨ï¼Œé‚£ä¹ˆä»GOå‡ºå‘ï¼Œbaræ˜¯ä¸å¯è¾¾çš„ï¼Œé‚£ä¹ˆå¯¹åº”çš„AOå¯¹è±¡(foo) åŒæ ·ä¹Ÿå°±ä¸å¯è¾¾ã€‚</p><p>åœ¨ä¸‹ä¸€æ¬¡ GC çš„çš„æ£€æµ‹ä¸­ï¼Œå®ƒä»¬å°±ä¼šè¢«é”€æ¯æ‰</p><p><strong>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½¢æˆé—­åŒ…ä¹‹åï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰çš„å±æ€§éƒ½ä¸ä¼šè¢«é‡Šæ”¾å‘¢ï¼Ÿ</strong></p><p>è¿˜æ˜¯è¿™ä¸ªä¾‹å­</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">&quot;why&quot;</span></span><br><span class="line">  <span class="keyword">var</span> age = <span class="number">18</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(name)</span><br><span class="line">    <span class="comment">// console.log(age) </span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> bar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = <span class="title function_">foo</span>()</span><br><span class="line"><span class="title function_">fn</span>()</span><br></pre></td></tr></table></figure><p>å¦‚æœageä¸ä½¿ç”¨äº†ï¼Œä¼šä¸ä¼šè¢«é”€æ¯æ‰å‘¢ï¼Ÿ<br>ç­”æ¡ˆæ˜¯ä¼šçš„ï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ddf0ce1e854b45628e802630620b740b~tplv-k3u1fbpfcp-watermark.image?" alt="image-20220327110308371.png"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8ae9ba0420c41a0bc10be84501afbd4~tplv-k3u1fbpfcp-watermark.image?" alt="image-20220327110407999.png"></p><p>è¿™æ˜¯å› ä¸º V8 å¼•æ“åšçš„ä¼˜åŒ–ï¼Œå› ä¸ºè§„èŒƒä¸­é—­åŒ…çš„å±æ€§åº”è¯¥æ˜¯ä¸ä¼šè¢«é”€æ¯çš„</p>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01_æ·±å…¥JSè¿è¡ŒåŸç†</title>
      <link href="/2022/03/30/01_%E6%B7%B1%E5%85%A5JS%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/"/>
      <url>/2022/03/30/01_%E6%B7%B1%E5%85%A5JS%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="1-ä»è¾“å…¥-URL-åˆ°é¡µé¢å±•ç¤º-å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ">1. ä»è¾“å…¥ URL åˆ°é¡µé¢å±•ç¤º å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h3><p>â€‹æ€»ä½“åˆ†ä¸ºä»¥ä¸‹è¿‡ç¨‹ï¼š</p><ul><li>DNS åŸŸåè§£æï¼šå°†åŸŸåè§£ææˆ IP åœ°å€</li><li>TCP è¿æ¥ï¼šTCP ä¸‰æ¬¡æ¡æ‰‹</li><li>å‘é€ HTTP è¯·æ±‚</li><li>æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å› HTTP æŠ¥æ–‡</li><li>æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</li><li>æ–­å¼€è¿æ¥ï¼šTCP å››æ¬¡æŒ¥æ‰‹</li></ul><h3 id="2-æµè§ˆå™¨å·¥ä½œåŸç†">2. æµè§ˆå™¨å·¥ä½œåŸç†</h3><p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥æŸ¥æ‰¾å†…å®¹ï¼Œæµè§ˆå™¨æ˜¯æ€æ ·å°†é¡µé¢åŠ è½½å‡ºæ¥çš„ï¼Ÿ</p><p>å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>é¦–å…ˆï¼Œç”¨æˆ·è¾“å…¥æœåŠ¡å™¨åœ°å€ï¼Œä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥</li><li>æœåŠ¡å™¨è¿”å›å¯¹åº”çš„é™æ€èµ„æºï¼ˆindex.htmlï¼‰</li><li>ç„¶åæµè§ˆå™¨æ‹¿åˆ° index.html åè¿›è¡Œè§£æ</li><li>å½“è§£ææ—¶é‡åˆ° css æˆ– js æ–‡ä»¶ï¼Œå°±å‘æœåŠ¡å™¨è¯·æ±‚å¹¶ä¸‹è½½å¯¹åº”çš„ css å’Œ js æ–‡ä»¶</li><li>æœ€åæµè§ˆå™¨å¯¹é¡µé¢è¿›è¡Œæ¸²æŸ“ï¼Œæ‰§è¡Œ js ä»£ç </li></ul><h3 id="3-æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹">3. æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fceb0c8f81764c578d11e3b428d9ec61~tplv-k3u1fbpfcp-watermark.image?" alt="image-20220325160129577.png"></p><ol><li><p>HTML Parser å°† HTMLè§£æè½¬æ¢æˆ DOM æ ‘</p></li><li><p>CSS Parser å°† æ ·å¼è¡¨è½¬æ¢æˆ CSS è§„åˆ™æ ‘</p></li><li><p>åˆå¹¶ DOM æ ‘å’Œ CSS è§„åˆ™æ ‘ï¼Œç”Ÿæˆ renderï¼ˆæ¸²æŸ“ï¼‰ æ ‘</p></li><li><p>å¸ƒå±€ render æ ‘ï¼ˆLayoutï¼‰</p><p>é€šè¿‡æ¸²æŸ“æ ‘ä¸­æ¸²æŸ“å¯¹è±¡çš„ä¿¡æ¯ï¼Œè®¡ç®—å‡ºæ¯ä¸€ä¸ªæ¸²æŸ“å¯¹è±¡çš„ä½ç½®å’Œå°ºå¯¸</p></li><li><p>ç»˜åˆ¶ render æ ‘ï¼ˆpaintingï¼‰ï¼Œè¿›è¡Œ Display å±•ç¤º</p></li></ol><p>æ³¨æ„å›¾ä¸­é¡¶éƒ¨çš„ç´«è‰² DOM ä¸‰è§’å½¢ï¼Œå®é™…ä¸Šæ˜¯ js å¯¹ DOM çš„ç›¸å…³æ“ä½œã€‚</p><h3 id="4-ä¸€ä¸ªå¼ºå¤§çš„-JavaScript-å¼•æ“-â€”-V8-å¼•æ“">4. ä¸€ä¸ªå¼ºå¤§çš„ JavaScript å¼•æ“ â€” V8 å¼•æ“</h3><p>åœ¨è§£æ HTML çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº† JavaScript æ ‡ç­¾ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><ul><li>ä¼šåœæ­¢è§£æ HTML ï¼Œè€Œå»åŠ è½½å’Œæ‰§è¡Œ JavaScript ä»£ç </li></ul><p>é‚£ä¹ˆï¼ŒJavaScript ä»£ç ç”±è°æ¥æ‰§è¡Œå‘¢ï¼Ÿ</p><ul><li><p>JavaScript å¼•æ“</p><p>é«˜çº§çš„ç¼–ç¨‹è¯­è¨€æœ€ç»ˆéƒ½è¦è½¬æˆæœºå™¨æŒ‡ä»¤æ¥æ‰§è¡Œçš„ï¼Œ</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ JavaScript å¼•æ“å¸®åŠ©æˆ‘ä»¬å°† JavaScript ä»£ç ç¿»è¯‘æˆ CPU æŒ‡ä»¤æ¥æ‰§è¡Œ</p></li></ul><h4 id="ï¼ˆ1ï¼‰V8-å¼•æ“çš„æ¶æ„">ï¼ˆ1ï¼‰V8 å¼•æ“çš„æ¶æ„</h4><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d5b0f83a00e64e2587ab3d79a4c524fd~tplv-k3u1fbpfcp-watermark.image?" alt="image-20220325165859884.png"></p><p>V8 çš„åº•å±‚æ¶æ„ä¸»è¦æœ‰ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ï¼ˆParseã€Ignitionã€TurboFanï¼‰</p><p><strong>1. Parse</strong>ï¼š</p><p>è¯¥è¿‡ç¨‹ä¸»è¦æ˜¯å¯¹ JavaScript æºä»£ç è¿›è¡Œ<strong>è¯æ³•åˆ†æ</strong>å’Œ<strong>è¯­æ³•åˆ†æ</strong>ã€‚</p><p><strong>è¯æ³•åˆ†æ</strong>ï¼šå¯¹ä»£ç ä¸­çš„æ¯ä¸€ä¸ªè¯æ¯ä¸€ä¸ªç¬¦å·è¿›è¡Œè§£æï¼Œæœ€ç»ˆç”Ÿæˆå¾ˆå¤š tokens</p><p>ä¾‹å¦‚ï¼šå¯¹ const name = â€œcurryâ€</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¦–å…ˆå¯¹constè¿›è¡Œè§£æï¼Œå› ä¸ºconstä¸ºä¸€ä¸ªå…³é”®å­—ï¼Œæ‰€ä»¥ç±»å‹ä¼šè¢«è®°ä¸ºä¸€ä¸ªå…³é”®è¯ï¼Œå€¼ä¸ºconst</span></span><br><span class="line"><span class="attr">tokens</span>: [</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;keyword&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;const&#x27;</span> &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥ç€å¯¹nameè¿›è¡Œè§£æï¼Œå› ä¸ºnameä¸ºä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œæ‰€ä»¥ç±»å‹ä¼šè¢«è®°ä¸ºä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå€¼ä¸ºname</span></span><br><span class="line"><span class="attr">tokens</span>: [</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;keyword&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;const&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;identifier&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;name&#x27;</span> &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥æ­¤ç±»æ¨...</span></span><br></pre></td></tr></table></figure><p><strong>è¯­æ³•åˆ†æ</strong>ï¼šåœ¨è¯æ³•åˆ†æçš„åŸºç¡€ä¸Šï¼Œæ‹¿åˆ° tokens ä¸­çš„ä¸€ä¸ªä¸ªå¯¹è±¡ï¼Œæ ¹æ®ä¸åŒç±»å‹ï¼Œå†è¿›ä¸€æ­¥åˆ†æå…·ä½“è¯­æ³•ï¼Œæœ€ç»ˆç”Ÿæˆ AST æŠ½è±¡è¯­æ³•æ ‘</p><p>å¯ä»¥è¯¦ç»†æŸ¥çœ‹é€šè¿‡ Parse è½¬æ¢åçš„ AST çš„å·¥å…·ï¼šAST Explorer</p><p><strong>2. Ignition</strong></p><p>ä¸€ä¸ªè§£æå™¨ï¼Œå¯ä»¥å°† AST è½¬æ¢æˆ ByteCodeï¼ˆå­—èŠ‚ç ï¼‰</p><p><strong>3. TurboFan</strong></p><p>ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œå¯ä»¥å°†å­—èŠ‚ç ç¼–è¯‘ä¸º CPU è®¤è¯†çš„æœºå™¨ç </p><h4 id="ï¼ˆ2ï¼‰V8-å¼•æ“çš„æ‰§è¡Œè¿‡ç¨‹">ï¼ˆ2ï¼‰V8 å¼•æ“çš„æ‰§è¡Œè¿‡ç¨‹</h4><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8f816f1a12884ef6bf8fe4ffec33a2ce~tplv-k3u1fbpfcp-watermark.image?" alt="image-20220325171051967.png"></p><ul><li>Blink å†…æ ¸å°† JS æºç äº¤ç»™ V8 å¼•æ“</li><li>Stream è·å–åˆ° JS æºç è¿›è¡Œç¼–ç è½¬æ¢</li><li>Scanner è¿›è¡Œè¯æ³•åˆ†æï¼Œå°†ä»£ç è½¬æ¢æˆ tokens</li><li>Parser å’Œ PreParser<ul><li>Parser ï¼šç›´æ¥è§£æï¼Œå°† tokens è½¬æˆ AST æ ‘</li><li>PreParserï¼šé¢„è§£æï¼Œå¯¹ä¸å¿…è¦çš„å‡½æ•°è¿›è¡Œé¢„è§£æï¼Œä¹Ÿå°±æ˜¯åªè§£ææš‚æ—¶éœ€è¦çš„å†…å®¹ï¼Œè€Œåœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶æ‰è¿›è¡Œå‡½æ•°çš„å…¨é‡è§£æ</li></ul></li><li>ç”Ÿæˆ AST æ ‘åï¼Œä¼šè¢« Ignition è½¬æˆå­—èŠ‚ç ï¼Œä¹‹åå°±æ˜¯ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹</li></ul><h3 id="5-JavaScript-çš„æ‰§è¡Œè¿‡ç¨‹">5. JavaScript çš„æ‰§è¡Œè¿‡ç¨‹</h3><p>å‡å¦‚è¦æ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> title = <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num1)</span><br><span class="line"><span class="keyword">var</span> num1 = <span class="number">20</span></span><br><span class="line"><span class="keyword">var</span> num2 = <span class="number">30</span></span><br><span class="line"><span class="keyword">var</span> result = num1 + num2</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰é¦–å…ˆï¼Œ<strong>ä»£ç è¢«è§£æ</strong>ï¼ŒV8 å¼•æ“å†…éƒ¨ä¼šå¸®åŠ©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼šGlobal Objectï¼ˆGOï¼‰</p><ul><li><p>GO å¯ä»¥è®¿é—®æ‰€æœ‰çš„ä½œç”¨åŸŸ</p></li><li><p>é‡Œé¢ä¼šåŒ…å« Dateã€Arrayã€Stringã€setTimeoutç­‰ç­‰ï¼ˆæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ new Date() ï¼‰</p></li><li><p>GO è¿˜æœ‰ä¸€ä¸ªwindow å±æ€§æŒ‡å‘è‡ªå·±ï¼ˆæ‰€ä»¥window.window.windowè¿˜æ˜¯æŒ‡å‘ GOè‡ªå·±ï¼‰</p></li></ul><p>ç”¨ä¼ªä»£ç è¡¨ç¤ºä¸ºï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> globalObject = &#123;</span><br><span class="line">    <span class="title class_">String</span>: ç±»,</span><br><span class="line">    <span class="attr">setTimeout</span>: å‡½æ•°,</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">window</span>: globalObject</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰<strong>ç„¶åè¿è¡Œä»£ç </strong></p><ol><li><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ js å¼•æ“å†…éƒ¨æœ‰ä¸€ä¸ª<strong>æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ</strong>ï¼ˆExecution Context Stackï¼Œç®€ç§° ESCï¼‰ï¼Œå®ƒæ˜¯ç”¨äºæ‰§è¡Œä»£ç çš„è°ƒç”¨æ ˆã€‚</p></li><li><p>ä¸ºäº†å…¨å±€ä»£ç èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª**å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ **ï¼ˆGlobal Execution Contextï¼Œç®€ç§°GECï¼‰ï¼Œå…¨å±€ä»£ç éœ€è¦è¢«æ‰§è¡Œæ—¶æ‰ä¼šåˆ›å»º</p></li><li><p>ç„¶åå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šè¢«æ”¾å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­æ‰§è¡Œï¼ŒåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>åœ¨ä»£ç æ‰§è¡Œå‰ï¼Œä¼šå°†å…¨å±€å®šä¹‰çš„å˜é‡ï¼Œå‡½æ•°ç­‰åŠ å…¥åˆ° <strong>GlobalOject</strong> ä¸­ï¼Œä½†æ˜¯å¹¶ä¸ä¼šèµ‹å€¼ï¼ˆä¹Ÿç§°ä¸º<strong>å˜é‡çš„ä½œç”¨åŸŸæå‡</strong>ï¼‰</li></ul></li></ol><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/848e146926d641b99e2b502e31c08913~tplv-k3u1fbpfcp-watermark.image?" alt="image-20220325191605422.png"></p><ul><li><p>å¼€å§‹ä¾æ¬¡æ‰§è¡Œä»£ç ï¼š</p><p>title = â€œhelloâ€ // èµ‹å€¼</p><p>console.log(num1) // undefined, ä¸ä¼šæŠ¥é”™</p><p>num1= 20 â€¦</p></li></ul><p><strong>é‡åˆ°å‡½æ•°å¦‚ä½•æ‰§è¡Œ?</strong></p><p>å…ˆæ ¹æ®å‡½æ•°ä½“åˆ›å»ºä¸€ä¸ª<strong>å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼Œå¹¶ä¸”å‹å…¥åˆ°æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­ï¼ˆEC Stackï¼‰</p><blockquote><p>åœ¨åˆå§‹åŒ– GO çš„æ—¶å€™ï¼Œå‡½æ•°çš„ AO ä¹Ÿæ˜¯ä¼šè¢«åˆå§‹åŒ–çš„</p><p>æ¯”å¦‚è¯´ ï¼Œå…¨å±€ä¸­ï¼Œæœ‰function foo() {}ï¼Œä¸€å¼€å§‹åˆå§‹åŒ–GOçš„æ—¶å€™ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œåˆ° foo</p><p>ä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºfooï¼Œå¹¶ä¸”ä¿å­˜ä½œç”¨åŸŸé“¾åˆ°fooçš„å†…éƒ¨å±æ€§[[scope]]ï¼Œå³</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">foo.[[scope]] = [</span><br><span class="line"> globalContext.<span class="property">VO</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></blockquote><p><strong>ä½œç”¨åŸŸé“¾ï¼Ÿ</strong></p><p>ç”± VO(å˜é‡å¯¹è±¡ï¼Œåœ¨å‡½æ•°ä¸­å°±æ˜¯ AO å¯¹è±¡)å’Œ çˆ¶çº§ VOç»„æˆï¼ŒæŸ¥æ‰¾æ—¶ä¼šä¸€å±‚å±‚æŸ¥æ‰¾</p><p>çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> message = <span class="string">&quot;Hello Global&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(message) <span class="comment">// Hello Global</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> message = <span class="string">&quot;Hello Bar&quot;</span></span><br><span class="line">  <span class="title function_">foo</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">bar</span>()</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚è¯´è¿™é‡Œï¼Œå½“æ‰§è¡Œ foo å‡½æ•°çš„æ—¶å€™ï¼Œ foo çš„ AO ä¸­æ²¡æœ‰messageï¼Œå°±ä¼šå»å®ƒçš„çˆ¶çº§ VO ä¸­æŸ¥æ‰¾ã€‚ä¸€å®šè¦æ³¨æ„ï¼å½“ç¬¬ä¸€æ¬¡ä»£ç è§£æçš„æ—¶å€™ï¼Œ foo çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡å°±å·²ç»ç¡®å®šäº†ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š</p><ul><li><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šåœ¨è§£æå‡½æ•°æˆä¸º AST æ ‘ç»“æ„çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ª AOï¼ˆActivationï¼‰</p><p>å…¶ä¸­åŒ…å«å½¢å‚ã€argumentsã€å‡½æ•°å®šä¹‰ã€æŒ‡å‘å‡½æ•°å¯¹è±¡æˆ–å®šä¹‰çš„å˜é‡</p></li><li><p>ç¬¬äºŒéƒ¨åˆ†ï¼šå°±æ˜¯ä½œç”¨åŸŸé“¾</p></li><li><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼šthis ç»‘å®šçš„å€¼</p></li></ul><p>å› æ­¤ï¼å½“fooåœ¨è‡ªå·±çš„AOæ‰¾ä¸åˆ°messageçš„æ—¶å€™ï¼Œå»çˆ¶çº§ VO æ‰¾ï¼Œè¿™ä¸ªçˆ¶çº§ VO å°±æ˜¯ä¸€å¼€å§‹è§£ææ—¶å€™ä¿å­˜çš„ GOï¼Œæ‰€ä»¥messageä¸º â€œHello Globalâ€</p><p>ç®€å•æè¿°ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹å§ï¼š(æˆ‘ä¸ä¸“ä¸šçš„è¡¨è¾¾)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ– GO</span></span><br><span class="line"><span class="attr">GO</span>: &#123;<span class="variable language_">window</span>; <span class="attr">message</span>:<span class="literal">undefined</span>; <span class="attr">foo</span>: åœ°å€<span class="number">1</span>; <span class="attr">bar</span>: åœ°å€<span class="number">2</span>;&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œä»£ç </span></span><br><span class="line"><span class="attr">GO</span>: &#123;<span class="variable language_">window</span>; <span class="attr">message</span>:<span class="string">&quot;Hello Global&quot;</span>; <span class="attr">foo</span>: åœ°å€<span class="number">1</span>; <span class="attr">bar</span>: åœ°å€<span class="number">2</span>;&#125;</span><br><span class="line">barå‡½æ•°æ‰§è¡Œ,åˆ›å»ºä¸€ä¸ªå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡,</span><br><span class="line">å…¶ä¸­åŒ…æ‹¬ <span class="variable constant_">VO</span>å¯¹è±¡: <span class="attr">AO</span>:&#123;<span class="attr">message</span>: <span class="literal">undefined</span>&#125;</span><br><span class="line">ç„¶åå¼€å§‹æ‰§è¡Œ barå‡½æ•°</span><br><span class="line"><span class="attr">message</span>:<span class="string">&quot;Hello Bar&quot;</span> (èµ‹å€¼)</span><br><span class="line"><span class="title function_">foo</span>()</span><br><span class="line">  fooå‡½æ•°æ‰§è¡Œï¼Œåˆ›å»ºä¸€ä¸ªfooçš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</span><br><span class="line">  å…¶ä¸­åŒ…æ‹¬ï¼š<span class="attr">VO</span>: <span class="attr">AO</span>: &#123;&#125; </span><br><span class="line">  ç„¶åå¼€å§‹æ‰§è¡Œä»£ç </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(message)</span><br><span class="line">  å‘ç°è‡ªå·±çš„<span class="variable constant_">AO</span>æ²¡æœ‰message,ä¼šå‘ä¸Šæ‰¾ï¼Œå³ä»è‡ªå·±ä¿å­˜çš„çˆ¶çº§<span class="variable constant_">VO</span>ä¸­æŸ¥æ‰¾ï¼Œæ‰¾åˆ°<span class="variable constant_">GO</span>ä¸­çš„messageä¸º <span class="string">&quot;Hello Global&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5dfbf8412334fbfbec579813c39c58d~tplv-k3u1fbpfcp-watermark.image?" alt="image-20220325231532928.png"><br>(å›¾æ¥æºäºcoderwhy)</p><blockquote><p>JSæ‰§è¡Œä¸Šä¸‹æ–‡ï¼š<a href="https://github.com/mqyqingfeng/Blog/issues/8">https://github.com/mqyqingfeng/Blog/issues/8</a></p><p>å†™çš„æŒºæ¸…æ™°è¯¦ç»†çš„</p></blockquote><h4 id="å‡ é“å¸¸è§çš„ä½œç”¨åŸŸæå‡é¢è¯•é¢˜ï¼š">å‡ é“å¸¸è§çš„ä½œç”¨åŸŸæå‡é¢è¯•é¢˜ï¼š</h4><ol><li></li></ol> <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="number">100</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  n = <span class="number">200</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n) <span class="comment">// 200</span></span><br></pre></td></tr></table></figure><ol start="2"><li></li></ol> <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(n) <span class="comment">// undefined</span></span><br><span class="line">  <span class="keyword">var</span> n = <span class="number">200</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(n) <span class="comment">// 200</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> n = <span class="number">100</span></span><br><span class="line"><span class="title function_">foo</span>()</span><br></pre></td></tr></table></figure><ol start="3"><li></li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// undefined</span></span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">200</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>()</span><br></pre></td></tr></table></figure><ol start="4"><li></li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  m = <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(m) <span class="comment">// 100</span></span><br></pre></td></tr></table></figure><ol start="5"><li></li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = b = <span class="number">10</span></span><br><span class="line">  <span class="comment">// =&gt; è½¬æˆä¸‹é¢çš„ä¸¤è¡Œä»£ç </span></span><br><span class="line">  <span class="comment">// var a = 10</span></span><br><span class="line">  <span class="comment">// b = 10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//console.log(a) // æŠ¥é”™ a is not defined(å› ä¸ºå½“ fooå‡½æ•°æ‰§è¡Œå®Œä¹‹åï¼Œfooçš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡å°±ä¼šå¼¹å‡ºæ ˆ(æ²¡å•¦ï¼å“ªé‡Œè¿˜ä¼šæœ‰aå‘¢))</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ğŸ”«æ·±å…¥JSé«˜çº§è¯­æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/03/29/hello-world/"/>
      <url>/2022/03/29/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start">Quick Start</h2><h3 id="Create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
